<div id="Rref">
<div class="head">
<h1>Theory Rref</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Rref.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Reduced row echelon form›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rref
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Rank_Nullity_Theorem/Mod_Type.html">Rank_Nullity_Theorem.Mod_Type</a>
  <a href="../Rank_Nullity_Theorem/Miscellaneous.html">Rank_Nullity_Theorem.Miscellaneous</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Defining the concept of Reduced Row Echelon Form›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Previous definitions and properties›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This function returns True if each position lesser than k in a column contains a zero.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_zero_row_upt_k</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'rows</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span> <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_zero_row_upt_k</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">::</span><span class="tfree">'columns</span><span class="main">.</span> <span class="main">(</span>to_nat <span class="bound">j</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_zero_row</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'rows</span> <span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span> <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_zero_row</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> is_zero_row_upt_k <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="Rref-is_zero_row_upt_ncols"><span class="command">lemma</span></span> is_zero_row_upt_ncols<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>ncols <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">::</span><span class="tfree">'columns</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> is_zero_row_def'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">::</span><span class="tfree">'columns</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_zero_row_upt_ncols <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def ncols_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Rref-is_zero_row_eq_row_zero"><span class="command">lemma</span></span> is_zero_row_eq_row_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">a</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">a</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' row_def
  <span class="keyword1"><span class="command">unfolding</span></span> vec_nth_inverse
  <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff zero_index <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Rref-not_is_zero_row_upt_suc"><span class="command">lemma</span></span> not_is_zero_row_upt_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms from_nat_to_nat_id 
  <span class="keyword1"><span class="command">using</span></span> is_zero_row_upt_k_def less_SucE 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Rref-is_zero_row_upt_k_suc"><span class="command">lemma</span></span> is_zero_row_upt_k_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> less_SucE to_nat_from_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Rref-is_zero_row_utp_0"><span class="command">lemma</span></span> is_zero_row_utp_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">m</span> <span class="main">0</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rref-is_zero_row_utp_0'"><span class="command">lemma</span></span> is_zero_row_utp_0'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">0</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rref-is_zero_row_upt_k_le"><span class="command">lemma</span></span> is_zero_row_upt_k_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rref-is_zero_row_imp_is_zero_row_upt"><span class="command">lemma</span></span> is_zero_row_imp_is_zero_row_upt<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span>  is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Definition of reduced row echelon form up to a column›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This definition returns True if a matrix is in reduced row echelon form up to the column k (not included), otherwise False.›</span></span>

<span class="comment1">(*In the third condition, i&lt;i+1 is assumed to avoid that row i can be the last row (in that case, i+1 would be the first row):*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reduced_row_echelon_form_upt_k</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span> one<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">,</span> plus<span class="main">,</span> one<span class="main">}</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">reduced_row_echelon_form_upt_k</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> 
  <span class="main">(</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>


<span class="keyword1" id="Rref-rref_upt_0"><span class="command">lemma</span></span> rref_upt_0<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rref-rref_upt_condition1"><span class="command">lemma</span></span> rref_upt_condition1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rref-rref_upt_condition2"><span class="command">lemma</span></span> rref_upt_condition2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rref-rref_upt_condition3"><span class="command">lemma</span></span> rref_upt_condition3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rref-rref_upt_condition4"><span class="command">lemma</span></span> rref_upt_condition4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Explicit lemmas for each condition›</span></span>

<span class="keyword1" id="Rref-rref_upt_condition1_explicit"><span class="command">lemma</span></span> rref_upt_condition1_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms rref_upt_condition1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rref-rref_upt_condition2_explicit"><span class="command">lemma</span></span> rref_upt_condition2_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rref_upt_condition2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rref-rref_upt_condition3_explicit"><span class="command">lemma</span></span> rref_upt_condition3_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>  
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span> "</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms rref_upt_condition3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rref-rref_upt_condition4_explicit"><span class="command">lemma</span></span> rref_upt_condition4_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms rref_upt_condition4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Intro lemma and general properties›</span></span>

<span class="keyword1" id="Rref-reduced_row_echelon_form_upt_k_intro"><span class="command">lemma</span></span> reduced_row_echelon_form_upt_k_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rref-rref_suc_imp_rref"><span class="command">lemma</span></span> rref_suc_imp_rref<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k_le_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_row_echelon_form_upt_k_intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> less_SucI <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rref_upt_condition3<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> less_SucI <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> less_SucI <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> not_zero_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> not_zero_j_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_zero_j <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> not_zero_i_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> not_zero_i_plus_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_j_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc_less<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_j False<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> not_zero_j_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_less_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_lessD from_nat_mono' from_nat_to_nat_id k_le_card less_Suc_eq_le n_less_suc ncols_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> least_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> least_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc zero_i <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id less_SucE<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> from_nat <span class="free">k</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def not_le_imp_less to_nat_le zero_i<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc_le'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_0 diff_add_cancel diff_minus_eq_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_is_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rref_upt_condition3<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> i_less not_zero_i_suc not_zero_i_plus_suc least_eq_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rref-reduced_row_echelon_if_all_zero"><span class="command">lemma</span></span> reduced_row_echelon_if_all_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The definition of reduced row echelon form›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definition of reduced row echelon form, based on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>reduced_row_echelon_form_upt_k_def›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reduced_row_echelon_form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span> one<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">,</span> plus<span class="main">,</span> one<span class="main">}</span> <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">reduced_row_echelon_form</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> reduced_row_echelon_form_upt_k <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Equivalence between our definition of reduced row echelon form and the one presented
in Steven Roman's book: Advanced Linear Algebra.›</span></span>

<span class="keyword1" id="Rref-reduced_row_echelon_form_def'"><span class="command">lemma</span></span> reduced_row_echelon_form_def'<span class="main">:</span> 
<span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span> <span class="main">=</span> 
  <span class="main">(</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def reduced_row_echelon_form_upt_k_def is_zero_row_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties of the reduced row echelon form of a matrix›</span></span>

<span class="keyword1" id="Rref-rref_condition1"><span class="command">lemma</span></span> rref_condition1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rref-rref_condition2"><span class="command">lemma</span></span> rref_condition2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rref-rref_condition3"><span class="command">lemma</span></span> rref_condition3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rref-rref_condition4"><span class="command">lemma</span></span> rref_condition4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Explicit lemmas for each condition›</span></span>

<span class="keyword1" id="Rref-rref_condition1_explicit"><span class="command">lemma</span></span> rref_condition1_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="free">i</span><span class="main">.</span> is_zero_row <span class="bound">j</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rref_condition1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rref-rref_condition2_explicit"><span class="command">lemma</span></span> rref_condition2_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rref_condition2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rref-rref_condition3_explicit"><span class="command">lemma</span></span> rref_condition3_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rref_condition3 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rref-rref_condition4_explicit"><span class="command">lemma</span></span> rref_condition4_explicit<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rref_condition4 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Other properties and equivalences›</span></span>

<span class="keyword1" id="Rref-rref_condition3_equiv1"><span class="command">lemma</span></span> rref_condition3_equiv1<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> j_less_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> not_zero_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="free">j</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> i_less_j not_zero_j j_less_nrows
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
<span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">)</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">&lt;</span> nrows <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i_less_suc_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> not_zero_suc_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Suc_j_less_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">&lt;</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> j_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_j_less_nrows<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">hence</span></span> not_zero_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> not_zero_suc_j <span class="keyword1"><span class="command">unfolding</span></span> Suc_eq_plus1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="skolem">j</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True 
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> True Suc_eq_plus1 from_nat_suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rref_condition3_explicit<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_less <span class="keyword1"><span class="command">unfolding</span></span> from_nat_suc <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_j <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_suc_j <span class="keyword1"><span class="command">unfolding</span></span> Suc_eq_plus1 from_nat_suc <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False 
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hyp<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False i_less_suc_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_j <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_j_less_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> from_nat_suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rref_condition3_explicit<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_less <span class="keyword1"><span class="command">unfolding</span></span> from_nat_suc <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">j</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_j <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_suc_j <span class="keyword1"><span class="command">unfolding</span></span> Suc_eq_plus1 from_nat_suc <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Suc_eq_plus1 <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rref_condition3_equiv<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_condition3_equiv1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat <span class="free"><span class="free">i</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat <span class="free"><span class="free">j</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> from_nat_to_nat_id<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> to_nat <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> to_nat_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_j<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">&lt;</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Rref-rref_implies_rref_upt"><span class="command">lemma</span></span> rref_implies_rref_upt<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_row_echelon_form_upt_k_intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rref_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> is_zero_row_imp_is_zero_row_upt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rref_condition3<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> is_zero_row_imp_is_zero_row_upt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rref_condition4<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> is_zero_row_imp_is_zero_row_upt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> zero_i_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> not_zero_j_k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> not_zero_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">j</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_zero_row_imp_is_zero_row_upt not_zero_j_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">hence</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">i</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> Least_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rref_condition3_equiv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref i_less_j not_zero_i not_zero_j<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI2_ex<span class="main">)</span>   
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_i <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> Aix_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> k_less_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> to_nat <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> zero_i_k Aix_not_0 <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
     <span class="keyword1"><span class="command">hence</span></span> k_less_ncols<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">using</span></span> to_nat_less_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ajs_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">s</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_j_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ajs_not_zero Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> from_nat <span class="main">(</span>to_nat <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">..</span></span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s_less_k k_less_ncols<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_less_x leD not_le_imp_less to_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
     <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Rref-rref_first_position_zero_imp_column_0"><span class="command">lemma</span></span> rref_first_position_zero_imp_column_0<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> A_00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"column <span class="main">0</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> column_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">0</span> <span class="main">1</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> A_00 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def less_Suc0 to_nat_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="main">1</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> rref_implies_rref_upt<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> least_mod_type less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> to_nat_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Rref-rref_first_element"><span class="command">lemma</span></span> rref_first_element<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> column_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"column <span class="main">0</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> A_00_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> A_00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ai0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> column_not_0 <span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> column_def rref rref_first_position_zero_imp_column_0<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">0</span> <span class="main">1</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> A_00 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def less_Suc0 to_nat_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">1</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ai0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def to_nat_0 zero_less_one<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> reduced_row_echelon_form <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_00 column_not_0 rref_first_position_zero_imp_column_0<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">assume</span></span> A_00_not_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> Least_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A_00_not_0<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> least_mod_type <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">0</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">using</span></span> A_00_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> Least_eq_0 <span class="keyword1"><span class="command">using</span></span> A_00_not_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Set">
<div class="head">
<h1>Theory Code_Set</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Set.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Code set"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Set
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Cardinality.html">HOL-Library.Cardinality</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following setup could help to get code generation for List.coset, 
  but it neither works correctly it complains that code
  equations for remove are missed, even when List.coset should be rewritten
  to an enum:›</span></span>

<span class="keyword1"><span class="command">declare</span></span> minus_coset_filter <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> remove_code<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> insert_code<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> inter_coset_fold <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> compl_coset<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Cardinality.card'_code<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">set</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following code equation could be useful to avoid the problem of
  code generation for List.coset []:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"List.coset <span class="main">(</span><span class="free">l</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>enum list<span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>enum_class.enum<span class="main">)</span> <span class="main">-</span> set <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Compl_eq_Diff_UNIV coset_def enum_UNIV<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now the following examples work:›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span>bool set"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"List.coset <span class="main">(</span><span class="main">[]</span><span class="main">::</span>bool list<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span>Enum.finite_2 set"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"List.coset <span class="main">(</span><span class="main">[]</span><span class="main">::</span>Enum.finite_2 list<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"List.coset <span class="main">(</span><span class="main">[]</span><span class="main">::</span>Enum.finite_5 list<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Matrix">
<div class="head">
<h1>Theory Code_Matrix</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Matrix.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Code generation for vectors and matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Matrix
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Rank_Nullity_Theorem/Miscellaneous.html">Rank_Nullity_Theorem.Miscellaneous</a>
  <a href="Code_Set.html">Code_Set</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this file the code generator is set up properly to allow the execution of matrices 
      represented as funcions over finite types.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> vec.vec_nth_inverse<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abstype</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> zero_index<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_index<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span><span class="main">$</span><span class="bound">i</span> <span class="main">+</span> <span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vector_add_component<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span><span class="main">$</span><span class="bound">i</span> <span class="main">-</span> <span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vector_minus_component<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>vec <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vector_mult_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">c</span> <span class="keyword1">*s</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vector_scalar_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span><span class="main">$</span><span class="bound">i</span> <span class="main">-</span> <span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vector_minus_component<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_mult_row</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_mult_row</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">c</span><span class="main">.</span> sum <span class="main">(</span><span class="main">%</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">$</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">$</span><span class="bound">k</span><span class="main">)</span><span class="main">$</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'n</span><span class="main">::</span>finite set<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Matrix-mat_mult_row_code"><span class="command">lemma</span></span> mat_mult_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mat_mult_row <span class="free">m</span> <span class="free">m'</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">c</span><span class="main">.</span> sum <span class="main">(</span><span class="main">%</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">$</span><span class="free">f</span><span class="main">)</span><span class="main">$</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m'</span><span class="main">$</span><span class="bound">k</span><span class="main">)</span><span class="main">$</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'n</span><span class="main">::</span>finite set<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_mult_row_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Code_Matrix-mat_mult"><span class="command">lemma</span></span> mat_mult <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">m</span> <span class="main">**</span> <span class="free">m'</span><span class="main">)</span> <span class="main">=</span> mat_mult_row <span class="free">m</span> <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_matrix_mult_def mat_mult_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> vec_lambda_beta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Code_Matrix-matrix_vector_mult_code"><span class="command">lemma</span></span> matrix_vector_mult_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Code_Matrix-vector_matrix_mult_code"><span class="command">lemma</span></span> vector_matrix_mult_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vector_matrix_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_row</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_row</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Matrix-mat_row_code"><span class="command">lemma</span></span> mat_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mat_row <span class="free">k</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> mat_row <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">unfolding</span></span> mat_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">transpose_row</span>
   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">transpose_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Matrix-transpose_row_code"><span class="command">lemma</span></span> transpose_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>transpose_row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span>  <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpose_row_def vec_lambda_beta<span class="main">)</span>

<span class="keyword1" id="Code_Matrix-transpose_code"><span class="command">lemma</span></span> transpose_code<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> transpose_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transpose_def transpose_row_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>row <span class="free">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">($)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rowvector_row</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Matrix-rowvector_row_code"><span class="command">lemma</span></span> rowvector_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>rowvector_row <span class="free">v</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rowvector_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>rowvector <span class="free">v</span><span class="main">)</span> <span class="main">=</span> rowvector_row <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rowvector_def <span class="keyword1"><span class="command">unfolding</span></span> rowvector_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">columnvector_row</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Matrix-columnvector_row_code"><span class="command">lemma</span></span> columnvector_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>columnvector_row <span class="free">v</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> columnvector_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>columnvector <span class="free">v</span><span class="main">)</span> <span class="main">=</span> columnvector_row <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> columnvector_def <span class="keyword1"><span class="command">unfolding</span></span> columnvector_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Elementary_Operations">
<div class="head">
<h1>Theory Elementary_Operations</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Elementary_Operations.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Elementary Operations over matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Elementary_Operations
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Rank_Nullity_Theorem/Fundamental_Subspaces.html">Rank_Nullity_Theorem.Fundamental_Subspaces</a>
  <a href="Code_Matrix.html">Code_Matrix</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some previous results:›</span></span>

<span class="keyword1" id="Elementary_Operations-mat_1_fun"><span class="command">lemma</span></span> mat_1_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Elementary_Operations-mat1_sum_eq"><span class="command">lemma</span></span> mat1_sum_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">)</span> <span class="main">$</span> <span class="free">s</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">1</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> mat <span class="main">1</span> <span class="main">$</span> <span class="free">s</span> <span class="main">$</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> UNIV <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'b</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_t<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> UNIV <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Elementary_Operations-invertible_mat_n"><span class="command">lemma</span></span> invertible_mat_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="main">(</span>mat <span class="free">n</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"mat <span class="main"><span class="main">(</span></span>inverse <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="main">**</span> mat <span class="main">(</span>inverse <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def mat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span> <span class="main">=</span> insert <span class="skolem">ia</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>insert <span class="skolem">ia</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">ia</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> finite_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">∉</span> UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">ia</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> right_inverse<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> i_not_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_not_ia<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>inverse <span class="free">n</span><span class="main">)</span> <span class="main">**</span> mat <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>mat <span class="main">1</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def mat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span> <span class="main">=</span> insert <span class="skolem">ia</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>insert <span class="skolem">ia</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">ia</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">ia</span><span class="main">}</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> finite_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">∉</span> UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">ia</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> left_inverse<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> i_not_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> inverse <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_not_ia<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> invertible_mat_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invertible_mat_n zero_neq_one<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions of elementary row and column operations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions of elementary row operations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interchange_rows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'m</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">interchange_rows</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_row</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>times<span class="main">)</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span> times<span class="main">}</span><span class="main">)</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'m</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_add</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions of elementary column operations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interchange_columns</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'n</span> <span class="main">=&gt;</span> <span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">interchange_columns</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_column</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>times<span class="main">)</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'n</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="free">mult_column</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">column_add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span> times<span class="main">}</span><span class="main">)</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'n</span> <span class="main">=&gt;</span> <span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">column_add</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties about elementary row operations›</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about interchanging rows›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"interchange_rows"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Elementary_Operations-interchange_same_rows"><span class="command">lemma</span></span> interchange_same_rows<span class="main">:</span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="free">a</span> <span class="free">a</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1" id="Elementary_Operations-interchange_rows_i"><span class="command">lemma</span></span> interchange_rows_i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1" id="Elementary_Operations-interchange_rows_j"><span class="command">lemma</span></span> interchange_rows_j<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1" id="Elementary_Operations-interchange_rows_preserves"><span class="command">lemma</span></span> interchange_rows_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1" id="Elementary_Operations-interchange_rows_mat_1"><span class="command">lemma</span></span> interchange_rows_mat_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def interchange_rows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_code<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> univ_rw'<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> UNIV <span class="main">=</span> sum <span class="var">?g</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?g</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> univ_rw''<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?h</span> UNIV <span class="main">=</span> sum <span class="var">?h</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?h</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?h</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  sum <span class="var">?h</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?h</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elementary_Operations-invertible_interchange_rows"><span class="command">lemma</span></span> invertible_interchange_rows<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"interchange_rows <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> 
    <span class="operator">unfold</span> interchange_rows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span>   
  <span class="keyword3"><span class="command">assume</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span><span class="tfree">'b</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_t<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> b_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_t<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a_noteq_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_noteq_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> s_noteq_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> b_noteq_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_noteq_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a_noteq_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_noteq_t a_noteq_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a_noteq_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>    
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about multiplying a row by a constant›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"mult_row"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Elementary_Operations-mult_row_mat_1"><span class="command">lemma</span></span> mult_row_mat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"mult_row <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> mult_row <span class="free">A</span> <span class="free">a</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def mult_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">q</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">q</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> univ_rw''<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> UNIV <span class="main">=</span> sum <span class="var">?g</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  sum <span class="var">?g</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elementary_Operations-invertible_mult_row"><span class="command">lemma</span></span> invertible_mult_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> qk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> kq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">*</span><span class="free">q</span><span class="main">=</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>mult_row <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"mult_row <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_row <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span> <span class="main">**</span> mult_row <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">k</span> <span class="main">=</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ka</span><span class="main">.</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qk <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>        
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_noteq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_noteq_a<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> a_noteq_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ka</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>            
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_t a_noteq_t<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>            
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_row <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">k</span> <span class="main">**</span> mult_row <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span> <span class="main">=</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ka</span><span class="main">.</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>        
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_a<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> a_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_not_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_t<span class="main">)</span>    
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> invertible_mult_row'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>mult_row <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_mult_row<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">q</span>"</span></span><span class="main"><span class="main">]</span></span> q_not_zero<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about adding a row multiplied by a constant to another row›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"row_add"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Elementary_Operations-row_add_mat_1"><span class="command">lemma</span></span> row_add_mat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> row_add <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def row_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sum_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_rw add.assoc <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum.neutral_const <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV  <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum.neutral_const <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> True mat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> vector_add_component vector_sadd_rdistrib vector_smult_component vector_smult_lid<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> UNIV <span class="main">=</span> sum <span class="var">?g</span> <span class="main">(</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum.neutral_const <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elementary_Operations-invertible_row_add"><span class="command">lemma</span></span> invertible_row_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_noteq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>row_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>row_add <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">**</span> row_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> row_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span><span class="tfree">'b</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span><span class="tfree">'b</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> 
      <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> 
        <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span><span class="tfree">'b</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_a<span class="main">)</span>       
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> b_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_not_t a_not_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>     
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span>  b_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_not_t a_not_t s_not_t<span class="main">)</span>     
  <span class="keyword1"><span class="command">next</span></span>         
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>         
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="free">a</span>"</span></span><span class="main">)</span>         
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False s_not_b a_noteq_b<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>         
      <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹This case is different from the other cases›</span>                  
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_a<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">-</span><span class="free">q</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> s_not_b <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> s_not_b <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_rest<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True s_not_b a_noteq_b<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint a_noteq_b<span class="main">)</span>     
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_a sum_b sum_rest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">**</span> row_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">=</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> row_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>     
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_a<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> b_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_not_t a_not_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> b_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>     
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_not_t a_not_t s_not_t<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="free">a</span>"</span></span><span class="main">)</span>         
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False s_not_b a_noteq_b<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>         
      <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹This case is different from the other cases›</span>                  
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_a<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="free">q</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> s_not_b <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">-</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> s_not_b <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_rest<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True s_not_b a_noteq_b<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint a_noteq_b<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_a sum_b sum_rest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties about elementary column operations›</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about interchanging columns›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"interchange_columns"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Elementary_Operations-interchange_columns_mat_1"><span class="command">lemma</span></span> interchange_columns_mat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> interchange_columns <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> interchange_columns <span class="free">A</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> interchange_columns_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword3"><span class="command">assume</span></span> a_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> j_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">using</span></span> j_not_b j_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elementary_Operations-invertible_interchange_columns"><span class="command">lemma</span></span> invertible_interchange_columns<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>interchange_columns <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"interchange_columns <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> 
    <span class="operator">unfold</span> interchange_columns_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> b_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> b_not_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> b_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> b_not_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> a_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_not_b a_not_t<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> b_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> t_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t_not_a t_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> t_not_a t_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> s_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_not_a s_not_b s_not_t<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about multiplying a column by a constant›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"mult_column"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Elementary_Operations-mult_column_mat_1"><span class="command">lemma</span></span> mult_column_mat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> mult_column <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span> <span class="main">=</span> mult_column <span class="free">A</span> <span class="free">a</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_column_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">a</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">a</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">a</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">a</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elementary_Operations-invertible_mult_column"><span class="command">lemma</span></span> invertible_mult_column<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> qk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> kq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>mult_column <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"mult_column <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_column <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span> <span class="main">**</span> mult_column <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">k</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_column_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">λ</span><span class="bound">ka</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>     
    <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> s_not_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>       
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_column <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">k</span> <span class="main">**</span> mult_column <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span> <span class="main">=</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_column_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">λ</span><span class="bound">ka</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s_not_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">ka</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> s_not_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> invertible_mult_column'<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> q_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>mult_column <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_mult_column<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">q</span>"</span></span><span class="main"><span class="main">]</span></span> q_not_zero<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about adding a column multiplied by a constant to another column›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"column_add"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Elementary_Operations-column_add_mat_1"><span class="command">lemma</span></span> column_add_mat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> column_add <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">=</span> column_add <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> 
    <span class="operator">unfold</span> column_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">a</span> <span class="main">+</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">b</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span>  <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">a</span> <span class="main">+</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">a</span> <span class="main">+</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> mat_1_fun <span class="keyword1"><span class="command">using</span></span> distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sum_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sum_rw add.assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">a</span> <span class="main">+</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> j_noteq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≠</span><span class="free">a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Elementary_Operations-invertible_column_add"><span class="command">lemma</span></span> invertible_column_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_noteq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>column_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>column_add <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" column_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">**</span> column_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> a_noteq_b
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> column_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> <span class="main">0</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> i_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_not_b i_not_a i_not_j<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> a_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> a_not_j a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_not_b j_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_not_b j_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> b_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="free">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False b_not_j<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹This case is different from the other cases›</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_a<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="free">q</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> b_not_j <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">-</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> b_not_j <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_rest<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True b_not_j a_noteq_b<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint a_noteq_b<span class="main">)</span>     
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_a sum_b sum_rest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>                        
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" column_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">**</span> column_add <span class="main">(</span>mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">=</span> mat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> column_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mat_1_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> a_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> a_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_noteq_b j_not_b j_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> i_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_not_b i_not_a i_not_j<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> b_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="free">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False b_not_j<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹This case is different from the other cases›</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> univ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_a<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">-</span><span class="free">q</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> b_not_j <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> b_not_j <span class="keyword1"><span class="command">using</span></span> a_noteq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum_rest<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True b_not_j a_noteq_b<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> univ_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint a_noteq_b<span class="main">)</span>     
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_a sum_b sum_rest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>                   
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Relationships amongst the definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Relationships between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"interchange_rows"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"interchange_columns"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Elementary_Operations-interchange_rows_transpose"><span class="command">lemma</span></span> interchange_rows_transpose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> transpose <span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def interchange_columns_def transpose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1" id="Elementary_Operations-interchange_rows_transpose'"><span class="command">lemma</span></span> interchange_rows_transpose'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> transpose <span class="main">(</span>interchange_columns <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def interchange_columns_def transpose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1" id="Elementary_Operations-interchange_columns_transpose"><span class="command">lemma</span></span> interchange_columns_transpose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interchange_columns <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> transpose <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def interchange_columns_def transpose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1" id="Elementary_Operations-interchange_columns_transpose'"><span class="command">lemma</span></span> interchange_columns_transpose'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interchange_columns <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> transpose <span class="main">(</span>interchange_rows <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def interchange_columns_def transpose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Code Equations›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Code equations for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> interchange_rows_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> interchange_columns_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> row_add_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> column_add_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mult_row_def<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mult_column_def<span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interchange_rows_row</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">interchange_rows_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elementary_Operations-interchange_rows_code"><span class="command">lemma</span></span> interchange_rows_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>interchange_rows_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Elementary_Operations-interchange_rows_code_nth"><span class="command">lemma</span></span> interchange_rows_code_nth <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> interchange_rows_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interchange_columns_row</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">interchange_columns_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span>  <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elementary_Operations-interchange_columns_code"><span class="command">lemma</span></span> interchange_columns_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>interchange_columns_row <span class="free">A</span> <span class="free">n</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span>  <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">m</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_columns_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Elementary_Operations-interchange_columns_code_nth"><span class="command">lemma</span></span> interchange_columns_code_nth <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> interchange_columns_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_columns_def <span class="keyword1"><span class="command">unfolding</span></span> interchange_columns_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_add_row</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_add_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elementary_Operations-row_add_code"><span class="command">lemma</span></span> row_add_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>row_add_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> row_add_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Elementary_Operations-row_add_code_nth"><span class="command">lemma</span></span> row_add_code_nth <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>row_add <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> row_add_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">unfolding</span></span> row_add_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">column_add_row</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">column_add_row</span>  <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elementary_Operations-column_add_code"><span class="command">lemma</span></span> column_add_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>column_add_row <span class="free">A</span> <span class="free">n</span> <span class="free">m</span> <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span> <span class="main">+</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">m</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> column_add_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Elementary_Operations-column_add_code_nth"><span class="command">lemma</span></span> column_add_code_nth <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>column_add <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> column_add_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> column_add_def <span class="keyword1"><span class="command">unfolding</span></span> column_add_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_row_row</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_row_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elementary_Operations-mult_row_code"><span class="command">lemma</span></span> mult_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mult_row_row <span class="free">A</span> <span class="free">a</span> <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_row_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Elementary_Operations-mult_row_code_nth"><span class="command">lemma</span></span> mult_row_code_nth <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mult_row_row <span class="free">A</span> <span class="free">a</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_row_def <span class="keyword1"><span class="command">unfolding</span></span> mult_row_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_column_row</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_column_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elementary_Operations-mult_column_code"><span class="command">lemma</span></span> mult_column_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mult_column_row <span class="free">A</span> <span class="free">n</span> <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_column_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Elementary_Operations-mult_column_code_nth"><span class="command">lemma</span></span> mult_column_code_nth <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mult_column <span class="free">A</span> <span class="free">a</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mult_column_row <span class="free">A</span> <span class="free">a</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_column_def <span class="keyword1"><span class="command">unfolding</span></span> mult_column_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Rank">
<div class="head">
<h1>Theory Rank</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Rank.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
    Maintainer: Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Rank of a matrix›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rank
<span class="keyword2"><span class="keyword">imports</span></span> 
      <a href="../Rank_Nullity_Theorem/Dim_Formula.html">Rank_Nullity_Theorem.Dim_Formula</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Row rank, column rank and rank›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions of row rank, column rank and rank›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_rank</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">=&gt;</span>nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_rank</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> vec.dim <span class="main">(</span>row_space <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">col_rank</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">=&gt;</span>nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">col_rank</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> vec.dim <span class="main">(</span>col_space <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rank-rank_def"><span class="command">lemma</span></span> rank_def<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> row_rank <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> row_rank_def row_rank_def_gen row_space_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1" id="Rank-rrk_is_preserved"><span class="command">lemma</span></span> rrk_is_preserved<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_rank <span class="free">A</span> <span class="main">=</span> row_rank <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> row_space_is_preserved row_rank_def inv_P<span class="main">)</span>

<span class="keyword1" id="Rank-crk_is_preserved"><span class="command">lemma</span></span> crk_is_preserved<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col_rank <span class="free">A</span> <span class="main">=</span> col_rank <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rank_nullity_theorem_matrices <span class="keyword1"><span class="command">unfolding</span></span> ncols_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> col_rank_def inv_P add_left_cancel null_space_is_preserved<span class="main">)</span> 

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Gauss_Jordan">
<div class="head">
<h1>Theory Gauss_Jordan</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Gauss_Jordan.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Gauss Jordan algorithm over abstract matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Gauss_Jordan
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Rref.html">Rref</a>
  <a href="Elementary_Operations.html">Elementary_Operations</a>
  <a href="Rank.html">Rank</a>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Gauss-Jordan Algorithm›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now, a computable version of the Gauss-Jordan algorithm is presented. The output will be a matrix in reduced row echelon form.
We present an algorithm in which the reduction is applied by columns›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Using this definition, zeros are made in the column j of a matrix A placing the pivot entry (a nonzero element) in the position (i,j).
For that, a suitable row interchange is made to achieve a non-zero entry in position (i,j). Then, this pivot entry is multiplied by its inverse
to make the pivot entry equals to 1. After that, are other entries of the j-th column are eliminated by subtracting suitable multiples of the
i-th row from the other rows.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_in_ij</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">,</span> inverse<span class="main">,</span> one<span class="main">,</span> uminus<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">=&gt;</span> <span class="tfree">'n</span><span class="main">=&gt;</span><span class="tfree">'m</span><span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_in_ij</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span> 
                                <span class="bound">interchange_A</span> <span class="main">=</span> <span class="main">(</span>interchange_rows <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span> 
                                <span class="bound">A'</span> <span class="main">=</span> mult_row <span class="bound">interchange_A</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="bound">interchange_A</span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
                                vec_lambda<span class="main">(</span><span class="main">%</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="bound">A'</span> <span class="main">$</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="bound">A'</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="bound">interchange_A</span><span class="main">$</span><span class="bound">s</span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gauss_Jordan-Gauss_Jordan_in_ij_unfold"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_unfold<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">interchange_A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A'</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">interchange_A</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">=</span> mult_row <span class="free">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">interchange_A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">A'</span> <span class="main">$</span> <span class="bound">s</span> 
      <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="free">A'</span> <span class="bound">s</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">interchange_A</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> Anj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> P2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LeastI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">interchange_A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">interchange_A</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> P4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">interchange_A</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> mult_row <span class="skolem">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">interchange_A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> P5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> mult_row <span class="skolem">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">interchange_A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> P6<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">s</span> 
    <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="skolem">A'</span> <span class="bound">s</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">interchange_A</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Gauss_Jordan_in_ij_def P1 P4 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> P5 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> P1 P2 P3 P4 P5 P6 that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
                                
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following definition makes the step of Gauss-Jordan in a column. This function receives two input parameters: the column k
where the step of Gauss-Jordan must be applied and a pair (which consists of the row where the pivot should be placed in the column k and the original matrix).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_column_k</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span>inverse<span class="main">,</span>uminus<span class="main">,</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">)</span> 
<span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_column_k</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i</span><span class="main">=</span>fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">from_nat_i</span><span class="main">=</span><span class="main">(</span>from_nat <span class="bound">i</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span><span class="main">;</span> <span class="bound">from_nat_k</span><span class="main">=</span><span class="main">(</span>from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">::</span><span class="tfree">'m</span><span class="main">)</span> <span class="keyword1">in</span> 
        <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="bound">from_nat_i</span><span class="main">)</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span><span class="main">(</span><span class="bound">from_nat_k</span><span class="main">)</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> nrows <span class="bound">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="bound">A</span> <span class="main">(</span><span class="bound">from_nat_i</span><span class="main">)</span> <span class="main">(</span><span class="bound">from_nat_k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following definition applies the Gauss-Jordan step from the first column up to the k one (included).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_upt_k</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>inverse<span class="main">,</span>uminus<span class="main">,</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">=&gt;</span> nat 
<span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_upt_k</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Gauss-Jordan is to apply the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_column_k"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in all columns.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>inverse<span class="main">,</span>uminus<span class="main">,</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>  
<span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Gauss_Jordan_upt_k <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties about rref and the greatest nonzero row.›</span></span>

<span class="keyword1" id="Gauss_Jordan-greatest_plus_one_eq_0"><span class="command">lemma</span></span> greatest_plus_one_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">R</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">R</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'rows</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> to_nat_plus_one_less_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-from_nat_to_nat_greatest"><span class="command">lemma</span></span> from_nat_to_nat_greatest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Suc_eq_plus1
  <span class="keyword1"><span class="command">unfolding</span></span> to_nat_1<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> add_to_nat_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan-greatest_less_zero_row"><span class="command">lemma</span></span> greatest_less_zero_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>linorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> not_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_less_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> GreatestI neqE not_all_zero not_less_i zero_i<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r zero_i i_less_greatest <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> GreatestI_ex not_all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-rref_suc_if_zero_below_greatest"><span class="command">lemma</span></span> rref_suc_if_zero_below_greatest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>linorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="comment1">(*This premisse is necessary to assure the existence of the Greatest*)</span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">&gt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> is_zero_row_upt_k <span class="bound">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_row_echelon_form_upt_k_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> zero_i_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_le_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_i_suc <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&gt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_less_zero_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> r zero_i not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&gt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero_below_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  greatest_less_zero_row<span class="main">[</span><span class="operator">OF</span> r _ not_all_zero<span class="main">]</span> not_zero_i r all_zero_below_greatest
    <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_suc_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_i_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> all_zero_below_greatest greatest_less_zero_row<span class="main">[</span><span class="operator">OF</span> r _ not_all_zero<span class="main">]</span> not_zero_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_suc_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> all_zero_below_greatest greatest_less_zero_row<span class="main">[</span><span class="operator">OF</span> r _ not_all_zero<span class="main">]</span> not_zero_suc_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aux not_zero_i_k not_zero_suc_i i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_zero_below_greatest greatest_less_zero_row not_all_zero r rref_upt_condition4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-rref_suc_if_all_rows_not_zero"><span class="command">lemma</span></span> rref_suc_if_all_rows_not_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>linorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_suc_if_zero_below_greatest<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">a</span></span><span class="main">&gt;</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_not_zero not_greater_Greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-greatest_ge_nonzero_row"><span class="command">lemma</span></span> greatest_ge_nonzero_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>linorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Gauss_Jordan-greatest_ge_nonzero_row'"><span class="command">lemma</span></span> greatest_ge_nonzero_row'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span> one<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> linorder<span class="main">,</span> one<span class="main">,</span> plus<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_less_zero_row<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> i not_all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">corollary</span></span> row_greater_greatest_is_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>linorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_ge_nonzero_row assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The proof of its correctness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Gauss_Jordan-Gauss_Jordan_in_ij_1"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_def Let_def mult_row_def interchange_rows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> Anj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LeastI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">,</span> <span class="operator">OF</span> Anj<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-Gauss_Jordan_in_ij_0"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ex <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_unfold<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_row_def interchange_rows_def row_add_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> Gauss_Jordan_in_ij_0'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟶</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms Gauss_Jordan_in_ij_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Gauss_Jordan-Gauss_Jordan_in_ij_preserves_previous_elements"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> exists_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Greatest_plus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_def Let_def interchange_rows_def mult_row_def row_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">last_nonzero_row</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">last_nonzero_row</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">last_nonzero_row</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">last_nonzero_row</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span>  Suc_le'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">last_nonzero_row</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_nonzero_row_def Greatest_plus_1<span class="main">)</span>  
  <span class="keyword1"><span class="command">hence</span></span> zero_row<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="skolem">last_nonzero_row</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_le greatest_ge_nonzero_row last_nonzero_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> A_greatest_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">last_nonzero_row</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def last_nonzero_row_def <span class="keyword1"><span class="command">using</span></span> j_le_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">last_nonzero_row</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">last_nonzero_row</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">last_nonzero_row</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">least_n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">least_n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> exists_m<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">least_n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> LeastI_ex least_n_def n1 n2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">least_n</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> last_nonzero_row_def less_le rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> zero_row <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">least_n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> j_le_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">-</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">*</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">/</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> last_nonzero_row_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> A_greatest_0 <span class="keyword1"><span class="command">unfolding</span></span> last_nonzero_row_def <span class="keyword1"><span class="command">unfolding</span></span> zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">/</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero <span class="keyword1"><span class="command">using</span></span> A_greatest_0 <span class="keyword1"><span class="command">unfolding</span></span> last_nonzero_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-Gauss_Jordan_in_ij_preserves_previous_elements'"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_preserves_previous_elements'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_nk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">n</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_def Let_def mult_row_def interchange_rows_def row_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A_0_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> all_zero is_zero_row_upt_k_def j_le_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> A_least_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero is_zero_row_upt_k_def j_le_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span> <span class="main">-</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">/</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span>
    <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_0_j A_least_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A_least_j A_0_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-is_zero_after_Gauss"><span class="command">lemma</span></span> is_zero_after_Gauss<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_eq_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_is_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_less_zero_row<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> zero_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main"><span class="main">[</span></span><span class="operator">OF</span> r not_zero_m _ not_zero_g j_less_k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> A_ma_k_not_zero greatest_less_ma<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> zero_a j_less_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-all_zero_imp_Gauss_Jordan_column_not_zero_in_row_0"><span class="command">lemma</span></span> all_zero_imp_Gauss_Jordan_column_not_zero_in_row_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> i_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_Gauss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2 
    <span class="keyword1"><span class="command">using</span></span> all_zero Amk_zero least_mod_type <span class="keyword1"><span class="command">unfolding</span></span> from_nat_0 nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Amk_zero least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_not_0 <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B_eq_Gauss
    <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements'<span class="main">[</span><span class="operator">OF</span> all_zero _ Amk_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero is_zero_row_upt_k_def less_SucE to_nat_from_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Here we start to prove that 
      the output of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Gauss</span></span> <span class="free"><span class="free">Jordan</span></span> <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a matrix in reduced row echelon form.›</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_1_part_1"><span class="command">lemma</span></span> condition_1_part_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_column_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="main">0</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'columns</span></span></span> <span class="keyword3"><span class="command">assume</span></span> ja_less_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> ja_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> to_nat <span class="skolem">ja</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> ja_less_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_column_k <span class="keyword1"><span class="command">unfolding</span></span> ja_eq_k from_nat_to_nat_id from_nat_0 <span class="keyword1"><span class="command">using</span></span> least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_1_part_2"><span class="command">lemma</span></span> condition_1_part_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> j_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'columns</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> ja_less_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> from_nat_0 <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements'<span class="main">[</span><span class="operator">OF</span> all_zero True Amk_not_zero<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero True <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> k_eq_ja<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> to_nat <span class="skolem">ja</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ja_less_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> k_eq_ja from_nat_to_nat_id
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> least_mod_type Amk_not_zero
        <span class="keyword1"><span class="command">unfolding</span></span> k_eq_ja from_nat_to_nat_id from_nat_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> from_nat <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_not_zero <span class="keyword1"><span class="command">unfolding</span></span> from_nat_0 <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_1_part_3"><span class="command">lemma</span></span> condition_1_part_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'columns</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> ja_less_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> zero_below_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> zero_ikA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> zero_jkA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_jkA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> k_eq_ja<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> to_nat <span class="skolem">ja</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ja_less_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> GreatestI2<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> not_zero_xkA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">x</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> not_zero_xkA zero_jkA neq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>     
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_below_greatest <span class="keyword1"><span class="command">unfolding</span></span> k_eq_ja from_nat_to_nat_id is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_1_part_4"><span class="command">lemma</span></span> condition_1_part_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> greatest_eq_card nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> rref_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_suc_if_zero_below_greatest<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">a</span></span><span class="main">&gt;</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> greatest_eq_card not_less_eq to_nat_less_card to_nat_mono nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> rref_Suc<span class="main">]</span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_1_part_5"><span class="command">lemma</span></span> condition_1_part_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_not_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'columns</span></span></span> <span class="keyword3"><span class="command">assume</span></span> ja_less_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_Gauss_ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def 
    <span class="keyword1"><span class="command">unfolding</span></span> ia2 Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> greatest_not_card greatest_less_ma A_ma_k_not_zero
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> from_nat_to_nat_greatest nrows_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> zero_ikA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'columns</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suc_not_zero greatest_not_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_less_k <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_eq_Gauss_ij<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> zero_i_suc_k a_less_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> zero_jkA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ja</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suc_not_zero greatest_not_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>       
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_jkA True <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> k_eq_ja<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> to_nat <span class="skolem">ja</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ja_less_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> k_eq_ja from_nat_to_nat_id<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>to_nat <span class="skolem">ja</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma k_eq_ja to_nat_from_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>to_nat <span class="skolem">ja</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> k_eq_ja<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> j_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">hence</span></span> i_le_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_Suc not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_ge_nonzero_row'<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_ikA <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_1"><span class="command">lemma</span></span> condition_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B Gauss_Jordan_column_k_def ia Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> from_nat_to_nat_greatest<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> zero_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="main">0</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_1_part_1<span class="main">[</span><span class="operator">OF</span> zero_k all_zero<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> j_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_less_j least_mod_type not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_1_part_2<span class="main">[</span><span class="operator">OF</span> j_not_0 all_zero Amk_not_zero<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> not_zero_mkA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_1_part_3<span class="main">[</span><span class="operator">OF</span> rref i_less_j not_zero_mkA zero_below_greatest<span class="main">]</span> zero_i_suc_k
    <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  nrows <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_1_part_4<span class="main">[</span><span class="operator">OF</span> rref _ i_less_j not_zero_m greatest_eq_card<span class="main">]</span> zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia nrows_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_not_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_1_part_5<span class="main">[</span><span class="operator">OF</span> rref _ i_less_j not_zero_m greatest_not_card greatest_less_ma A_ma_k_not_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> zero_i_suc_k
    <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-condition_2_part_1"><span class="command">lemma</span></span> condition_2_part_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2 <span class="keyword1"><span class="command">using</span></span> all_zero_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> all_zero_k condition_1_part_1<span class="main">[</span><span class="operator">OF</span> _ all_zero<span class="main">]</span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_2_part_2"><span class="command">lemma</span></span> condition_2_part_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def <span class="keyword1"><span class="command">unfolding</span></span> ia2 Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> Amk_not_zero least_mod_type <span class="keyword1"><span class="command">unfolding</span></span> from_nat_0 nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Amk_not_zero B_eq all_zero condition_1_part_2 from_nat_0 not_zero_i_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> Least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_1 Amk_not_zero least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> not_zero_gauss<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> from_nat <span class="free">k</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_preserves_previous_elements'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> all_zero to_nat_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> y<span class="main"><span class="main">]</span></span> Amk_not_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero to_nat_le<span class="main">[</span><span class="operator">OF</span> y<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_gauss <span class="keyword1"><span class="command">unfolding</span></span> i_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Least_eq <span class="keyword1"><span class="command">unfolding</span></span> i_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Amk_not_zero least_mod_type<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="Gauss_Jordan-condition_2_part_3"><span class="command">lemma</span></span> condition_2_part_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> zero_below_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_Suc' True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_greater_Greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'columns</span></span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> zero_i <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> zero_below_greatest i 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id le_neq_implies_less not_le not_less_eq_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>        
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_le le_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> greatest_ge_nonzero_row'<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> greatest_plus_one_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> to_nat_plus_one_less_card False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> not_is_zero_row_upt_suc<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> zero_below_greatest
        <span class="keyword1"><span class="command">unfolding</span></span> greatest_plus_one_eq_0 <span class="keyword1"><span class="command">using</span></span> least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_2_part_4"><span class="command">lemma</span></span> condition_2_part_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> zero_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> Greatest_is_minus_1 neq_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_plus_one_eq_0<span class="main">[</span><span class="operator">OF</span> greatest_eq_card<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> greatest_eq_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_eq_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref _ <span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> not_zero_m<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_minus_1 <span class="keyword1"><span class="command">unfolding</span></span> greatest_eq_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_2_part_5"><span class="command">lemma</span></span> condition_2_part_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_noteq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span>
  <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_Gauss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> greatest_noteq_card A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> greatest_plus_one_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suc_not_zero greatest_noteq_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> not_zero_iB<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">unfolding</span></span> B_eq_Gauss
      <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ greatest_plus_one_not_zero<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> Gauss_Jordan_i_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_Gauss <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> from_nat_to_nat_id less_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> i_not_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_not_greatest <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_i_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> Gauss_Jordan_i_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_1 <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> Least_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_i_not_0 <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> from_nat <span class="free">k</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> B_eq_Gauss is_zero_row_upt_k_def not_less not_zero_iB to_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_i_1 <span class="keyword1"><span class="command">unfolding</span></span> Least_eq_k <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> Aij_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> least_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Aij_not_0 j_le_k less_trans linorder_cases not_less_Least to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> least_le_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ greatest_plus_one_not_zero j_le_k<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma
      <span class="keyword1"><span class="command">using</span></span> Aij_not_0 False not_le_imp_less not_less_Least <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref False _ greatest_plus_one_not_zero<span class="main">]</span> least_le_k False rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span>  A_ma_k_not_zero B_eq_Gauss greatest_less_ma zero_neq_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Gauss_Jordan_y<span class="main">:</span><span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False 
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> least_le_k less_trans not_le_imp_less to_nat_from_nat to_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_y <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ greatest_plus_one_not_zero True<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Least_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Least_eq <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref False _ greatest_plus_one_not_zero<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> least_le_k A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_2"><span class="command">lemma</span></span> condition_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B Gauss_Jordan_column_k_def ia Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> from_nat_to_nat_greatest from_nat_0<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_zero_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_2_part_1<span class="main">[</span><span class="operator">OF</span> _ all_zero<span class="main">]</span> not_zero_i_suc_k all_zero_k least_mod_type <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_2_part_2<span class="main">[</span><span class="operator">OF</span> _ all_zero Amk_not_zero<span class="main">]</span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_2_part_3<span class="main">[</span><span class="operator">OF</span> rref _ not_zero_m zero_below_greatest<span class="main">]</span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> 
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_2_part_4<span class="main">[</span><span class="operator">OF</span> rref not_zero_m greatest_eq_card<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_noteq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> 
    <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_2_part_5<span class="main">[</span><span class="operator">OF</span> rref _ not_zero_m greatest_noteq_card greatest_less_ma A_ma_k_not_zero<span class="main">]</span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_3_part_1"><span class="command">lemma</span></span> condition_3_part_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2 <span class="keyword1"><span class="command">using</span></span> all_zero_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> all_zero all_zero_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_SucE to_nat_from_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-condition_3_part_2"><span class="command">lemma</span></span> condition_3_part_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_suc_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_notzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_Gauss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2 
    <span class="keyword1"><span class="command">using</span></span> all_zero Amk_notzero least_mod_type <span class="keyword1"><span class="command">unfolding</span></span> from_nat_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero_imp_Gauss_Jordan_column_not_zero_in_row_0<span class="main">[</span><span class="operator">OF</span> all_zero _ Amk_notzero<span class="main">]</span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero_imp_Gauss_Jordan_column_not_zero_in_row_0<span class="main">[</span><span class="operator">OF</span> all_zero _ Amk_notzero<span class="main">]</span> not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-condition_3_part_3"><span class="command">lemma</span></span> condition_3_part_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_suc_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> zero_below_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rref_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_suc_if_zero_below_greatest<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">a</span></span><span class="main">&gt;</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span> <span class="keyword3"><span class="command">assume</span></span> greatest_less_a<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_less_a row_greater_greatest_is_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  le_Suc<span class="main">[</span><span class="operator">OF</span> greatest_less_a<span class="main">]</span> zero_below_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition3<span class="main">[</span><span class="operator">OF</span> rref_suc<span class="main">]</span> i_le not_zero_i_suc_k not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-condition_3_part_4"><span class="command">lemma</span></span> condition_3_part_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_suc_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> greatest_eq_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> greatest_eq_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_eq_minus_1 greatest_eq_card to_nat_plus_one_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> rref_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_suc_if_all_rows_not_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_is_minus_1 greatest_eq_minus_1 greatest_ge_nonzero_row'<span class="main">[</span><span class="operator">OF</span> rref _<span class="main">]</span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition3<span class="main">[</span><span class="operator">OF</span> rref_suc<span class="main">]</span> i_le not_zero_i_suc_k not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_3_part_5"><span class="command">lemma</span></span> condition_3_part_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_suc_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_not_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
  <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_Gauss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def 
    <span class="keyword1"><span class="command">unfolding</span></span> ia2 Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> greatest_not_card greatest_less_ma A_ma_k_not_zero
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> from_nat_to_nat_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> suc_greatest_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 suc_not_zero greatest_not_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> zero_i_plus_one_k_B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">B</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq_Gauss<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_zero_after_Gauss<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True not_zero_m rref greatest_less_ma A_ma_k_not_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> Gauss_Jordan_i_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_Gauss <span class="keyword1"><span class="command">using</span></span> is_zero_row_upt_k_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> i_plus_one_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> i_not_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_less_ma A_ma_k_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_not_greatest <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_i_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> i_eq_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_right_cancel <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> Least_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_Jordan_i_not_0<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_i_plus_one_k_B  <span class="keyword1"><span class="command">unfolding</span></span> i_eq_greatest B_eq_Gauss <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def not_less to_nat_le<span class="main">)</span>   
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_less_zero_row<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> not_zero_m <span class="keyword1"><span class="command">unfolding</span></span> i_eq_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> Aij_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> least_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Aij_not_0 j_le_k less_trans linorder_cases not_less_Least to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_i_A _ suc_greatest_not_zero least_le_k<span class="main">]</span> greatest_less_ma A_ma_k_not_zero
        <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> not_zero_i_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>        
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Gauss_Jordan_y<span class="main">:</span><span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_le least_le_k less_trans to_nat_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_y <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ suc_greatest_not_zero True<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def is_zero_row_upt_k_suc le_less_linear le_less_trans least_le_k not_zero_suc_i_suc_k to_nat_mono' zero_i_plus_one_k_B<span class="main">)</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Least_eq_k <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> False i_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> Aij_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> least_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Aij_not_0 j_le_k less_trans linorder_cases not_less_Least to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Least_i_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_i_A _ suc_greatest_not_zero least_le_k<span class="main">]</span> greatest_less_ma A_ma_k_not_zero
        <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> not_zero_i_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Gauss_Jordan_y<span class="main">:</span><span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_le not_less_iff_gr_or_eq le_less_trans least_le_k to_nat_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_y <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ suc_greatest_not_zero True<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ais_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">s</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> least_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Ais_not_0 s_le_k neq_iff less_trans not_less_Least to_nat_mono<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> Least_i_plus_one_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_i_A _ suc_greatest_not_zero least_le_k<span class="main">]</span> greatest_less_ma A_ma_k_not_zero
        <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Gauss_Jordan_y<span class="main">:</span><span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> le_less_linear least_le_k less_trans to_nat_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_y <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ suc_greatest_not_zero True<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Least_i_plus_one_eq Least_i_eq <span class="keyword1"><span class="command">using</span></span> rref_upt_condition3<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> i_le False not_zero_i_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_3"><span class="command">lemma</span></span> condition_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_suc_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B Gauss_Jordan_column_k_def ia Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> from_nat_to_nat_greatest from_nat_0<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> all_zero_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_3_part_1<span class="main">[</span><span class="operator">OF</span> _ all_zero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> all_zero_k least_mod_type not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Amk_notzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_3_part_2<span class="main">[</span><span class="operator">OF</span> i_le _ _ all_zero Amk_notzero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_3_part_3<span class="main">[</span><span class="operator">OF</span> rref i_le _ _ not_zero_m zero_below_greatest<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_3_part_4<span class="main">[</span><span class="operator">OF</span> rref i_le _ _ not_zero_m greatest_eq_card<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_not_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_3_part_5<span class="main">[</span><span class="operator">OF</span> rref i_le _ _ not_zero_m greatest_not_card greatest_less_ma A_ma_k_not_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k not_zero_suc_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_4_part_1"><span class="command">lemma</span></span> condition_4_part_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_i_suc_k<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2 <span class="keyword1"><span class="command">using</span></span> all_zero_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> B_eq_A all_zero all_zero_k is_zero_row_upt_k_suc not_zero_i_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_4_part_2"><span class="command">lemma</span></span> condition_4_part_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> i_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero_imp_Gauss_Jordan_column_not_zero_in_row_0<span class="main">[</span><span class="operator">OF</span> all_zero _ Amk_not_zero<span class="main">]</span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> least_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i_eq_0 <span class="keyword1"><span class="command">using</span></span> Amk_not_zero Gauss_Jordan_in_ij_1 least_mod_type zero_neq_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Gauss_Jordan_y_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> from_nat <span class="free">k</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> to_nat_y_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements'<span class="main">[</span><span class="operator">OF</span> all_zero to_nat_y_less_k Amk_not_zero<span class="main">]</span> all_zero to_nat_y_less_k
        <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_y_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_eq_k <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i_eq_0 i_not_j Amk_not_zero least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_4_part_3"><span class="command">lemma</span></span> condition_4_part_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> zero_below_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rref_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_suc_if_zero_below_greatest<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> not_zero_m<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> greatest_less_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> row_greater_greatest_is_zero<span class="main">[</span><span class="operator">OF</span> greatest_less_a<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_below_greatest  le_Suc<span class="main">[</span><span class="operator">OF</span> greatest_less_a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4<span class="main">[</span><span class="operator">OF</span> rref_suc<span class="main">]</span> not_zero_i_suc_k i_not_j <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>   

<span class="keyword1" id="Gauss_Jordan-condition_4_part_4"><span class="command">lemma</span></span> condition_4_part_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def Let_def fst_conv snd_conv ia2
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">using</span></span> greatest_eq_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> greatest_eq_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_eq_minus_1 greatest_eq_card to_nat_plus_one_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> rref_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_suc_if_all_rows_not_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_is_minus_1 greatest_eq_minus_1 greatest_ge_nonzero_row'<span class="main">[</span><span class="operator">OF</span> rref _<span class="main">]</span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4<span class="main">[</span><span class="operator">OF</span> rref_suc<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k i_not_j <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-condition_4_part_5"><span class="command">lemma</span></span> condition_4_part_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_not_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> 
  <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ia2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ia <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_Gauss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B Gauss_Jordan_column_k_def 
    <span class="keyword1"><span class="command">unfolding</span></span> ia2 Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> greatest_not_card greatest_less_ma A_ma_k_not_zero
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> from_nat_to_nat_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> suc_greatest_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 suc_not_zero greatest_not_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> zero_i_k_B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_eq_Gauss <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_after_Gauss<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True not_zero_m rref greatest_less_ma A_ma_k_not_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> Gauss_Jordan_i_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq_Gauss <span class="keyword1"><span class="command">using</span></span> is_zero_row_upt_k_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> i_eq_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> i_not_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_less_ma A_ma_k_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_not_greatest <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_i_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">have</span></span> Gauss_Jordan_i_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> i_eq_greatest <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_1 greatest_less_ma A_ma_k_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> Least_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_i_not_0 <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_i_k_B  <span class="keyword1"><span class="command">unfolding</span></span> i_eq_greatest B_eq_Gauss <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def not_less to_nat_le<span class="main">)</span>   
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero Gauss_Jordan_in_ij_0' Least_eq_k greatest_less_ma i_eq_greatest i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ain_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> least_le_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Ain_not_0 neq_iff j_le_k less_trans not_less_Least to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref False _ suc_greatest_not_zero least_le_k<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> greatest_less_ma A_ma_k_not_zero 
        <span class="keyword1"><span class="command">using</span></span> rref_upt_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Gauss_Jordan_y<span class="main">:</span><span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">ka</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> False least_le_k less_trans not_le_imp_less to_nat_from_nat to_nat_le<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_y <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ suc_greatest_not_zero True<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> Gauss_Jordan_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
      <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">[</span><span class="operator">OF</span> rref not_zero_m _ suc_greatest_not_zero least_le_k<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> A_ma_k_not_zero greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Least_eq <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> False Gauss_Jordan_eq_A i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-condition_4"><span class="command">lemma</span></span> condition_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_suc_k<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B Gauss_Jordan_column_k_def ia Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> from_nat_to_nat_greatest from_nat_0<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> all_zero_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_4_part_1<span class="main">[</span><span class="operator">OF</span> _ all_zero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> all_zero_k not_zero_i_suc_k least_mod_type <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_4_part_2<span class="main">[</span><span class="operator">OF</span> _ i_not_j all_zero Amk_not_zero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span>  not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition_4_part_3<span class="main">[</span><span class="operator">OF</span> rref _ i_not_j not_zero_m zero_below_greatest<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  condition_4_part_4<span class="main">[</span><span class="operator">OF</span> rref _ i_not_j not_zero_m greatest_eq_card<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_not_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A_ma_k_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> 
    <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  condition_4_part_5<span class="main">[</span><span class="operator">OF</span> rref _ i_not_j not_zero_m greatest_not_card greatest_less_ma A_ma_k_not_zero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> B ia <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-reduced_row_echelon_form_upt_k_Gauss_Jordan_column_k"><span class="command">lemma</span></span> reduced_row_echelon_form_upt_k_Gauss_Jordan_column_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> ia<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span><span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">ia</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">B</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_row_echelon_form_upt_k_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> is_zero_row_upt_k <span class="bound">j</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_3 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition_4 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-foldl_Gauss_condition_1"><span class="command">lemma</span></span> foldl_Gauss_condition_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">m</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms least_mod_type<span class="main">)</span>


<span class="keyword1" id="Gauss_Jordan-foldl_Gauss_condition_2"><span class="command">lemma</span></span> foldl_Gauss_condition_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_from_nat_k_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'columns</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A0k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Amk_not_zero least_mod_type<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">0</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
    <span class="keyword1"><span class="command">using</span></span> A0k_eq_1 to_nat_from_nat_k_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-foldl_Gauss_condition_3"><span class="command">lemma</span></span> foldl_Gauss_condition_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>           
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">ma</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> to_nat_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Greatest_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_from_nat_k_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'columns</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A0k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Amk_not_zero least_mod_type<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">0</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
    <span class="keyword1"><span class="command">using</span></span> A0k_eq_1 to_nat_from_nat_k_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> y_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> y_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'columns</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">=</span> <span class="free">k</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ y_not_0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> to_nat_from_nat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>  y_not_0 least_mod_type Amk_not_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> j_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> j less_SucE<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_in_ij_preserves_previous_elements'<span class="main">[</span><span class="operator">OF</span> all_zero j_less_k Amk_not_zero<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> all_zero j_less_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-foldl_Gauss_condition_5"><span class="command">lemma</span></span> foldl_Gauss_condition_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_zero_row_upt_k_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> zero_n_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_less_zero_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A zero_n_k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> not_zero_a<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> n_ge_gratest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> A_nk_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero_below_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_n_k A_nk_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-foldl_Gauss_condition_6"><span class="command">lemma</span></span> foldl_Gauss_condition_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_plus_one_eq_0<span class="main">[</span><span class="operator">OF</span> eq_card<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> greatest_k_eq_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_eq_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> GreatestI_ex greatest_k_eq_minus_1 is_zero_row_upt_k_le not_zero_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_is_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_card greatest_k_eq_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-foldl_Gauss_condition_8"><span class="command">lemma</span></span> foldl_Gauss_condition_8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> A_ma_k<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Greatest_plus_one</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Greatest_plus_one</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_from_nat_k_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'columns</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Gauss_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">Greatest_plus_one</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Greatest_plus_one_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Gauss_Jordan_in_ij_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> A_ma_k ma<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="skolem">Greatest_plus_one</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Greatest_plus_one</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"from_nat <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gauss_eq_1 to_nat_from_nat_k_suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-foldl_Gauss_condition_9"><span class="command">lemma</span></span> foldl_Gauss_condition_9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> suc_greatest_not_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_less_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_ma_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  to_nat<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Greatest_plus_one</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Greatest_plus_one</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_from_nat_k_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'columns</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> greatest_plus_one_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Greatest_plus_one</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suc_greatest_not_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Greatest_plus_one_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> suc_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> suc_greatest_not_card<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Suc_eq_plus1 nrows_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> greatest_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Greatest_plus_one</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">Greatest_plus_one</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Greatest_plus_one_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Gauss_Jordan_in_ij_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> greatest_less_ma A_ma_k<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_k_suc
      <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>    
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> not_zero_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">Greatest_plus_one</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span><span class="skolem">Greatest_plus_one</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> y_ge_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≥</span><span class="skolem">Greatest_plus_one</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">Greatest_plus_one</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> y_not_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">Greatest_plus_one</span>"</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_plus_one_not_zero 
          <span class="keyword1"><span class="command">using</span></span> Suc_le' less_le_trans y_ge_greatest <span class="keyword1"><span class="command">unfolding</span></span> Greatest_plus_one_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> zero_row_y_upt_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_greater_Greatest<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Greatest_plus_one_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'columns</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span>from_nat <span class="free">k</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Gauss_Jordan_in_ij_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ y_not_greatest<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ma</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_ma_k <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Greatest_plus_one</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_less_ma <span class="keyword1"><span class="command">unfolding</span></span> Greatest_plus_one_def <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> j_le_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Greatest_plus_one_def
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Gauss_Jordan_in_ij_preserves_previous_elements<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_A <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_m <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_ma_k greatest_less_ma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greatest_plus_one_not_zero <span class="keyword1"><span class="command">unfolding</span></span> Greatest_plus_one_def <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False from_nat_to_nat_id j_le_suc_k less_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_row_y_upt_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
              <span class="keyword1"><span class="command">using</span></span>  False le_imp_less_or_eq from_nat_to_nat_id j_le_suc_k less_Suc_eq_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>          
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="skolem">Greatest_plus_one</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">Greatest_plus_one</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_ge_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> greatest_eq<span class="main">[</span><span class="operator">unfolded</span> Greatest_plus_one_def<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_to_nat_def
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_1
    <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id to_nat_plus_one_less_card
    <span class="keyword1"><span class="command">using</span></span> greatest_plus_one_not_zero<span class="main">[</span><span class="operator">unfolded</span> Greatest_plus_one_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemma is one of most important ones in the verification of the Gauss-Jordan algorithm.
The aim is to prove two statements about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Gauss_Jordan_upt_k_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span> (one about the result is on rref and another about the index).
The reason of doing that way is because both statements need them mutually to be proved.
As the proof is made using induction, two base cases and two induction steps appear.
›</span></span>
<span class="keyword1" id="Gauss_Jordan-rref_and_index_Gauss_Jordan_upt_k"><span class="command">lemma</span></span> rref_and_index_Gauss_Jordan_upt_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> rref_Gauss_Jordan_upt_k<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> snd_Gauss_Jordan_upt_k<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
  snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
    <span class="comment1">― ‹Two base cases, one for each show›</span>
    <span class="comment1">― ‹The first one›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> reduced_row_echelon_form_upt_k_Gauss_Jordan_column_k<span class="main">[</span><span class="operator">OF</span> rref_upt_0<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> is_zero_row_utp_0'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="comment1">― ‹The second base case›</span>
  <span class="keyword1"><span class="command">have</span></span> rw_upt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
    snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw_upt
    <span class="keyword1"><span class="command">unfolding</span></span> foldl.simps
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Let_def from_nat_0 fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> least_mod_type to_nat_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_Jordan_in_ij_1 least_mod_type zero_neq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Gauss_Jordan_in_ij_0 GreatestI_ex least_mod_type<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="comment1">― ‹Now we begin with the proof of the induction step of the first show. We will make use the induction hypothesis of the second show›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span>
    foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
    snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> hyp_rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp_foldl<span class="main">:</span> <span class="quoted"><span class="quoted">"foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
    snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
    Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command">using</span></span> hyp_foldl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command">unfolding</span></span> rw <span class="keyword1"><span class="command">unfolding</span></span> foldl_append <span class="keyword1"><span class="command">unfolding</span></span> foldl.simps <span class="keyword1"><span class="command">unfolding</span></span> rw2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_row_echelon_form_upt_k_Gauss_Jordan_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hyp_rref<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="comment1">― ‹Making use of the same hypotheses of above proof, we begin with the proof of the induction step of the second show.›</span>
  <span class="keyword1"><span class="command">have</span></span> fst_foldl<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    fst <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
    snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp_foldl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
    snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
      snd <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
      <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
      snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ncols_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ncols <span class="free">A</span> <span class="main">=</span> ncols <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A'_def ncols_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> rref_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="skolem">A'</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> hyp_rref <span class="keyword1"><span class="command">unfolding</span></span> A'_def Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
      fst <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
      <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span>
      snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rw<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> foldl_append<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> foldl.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Gauss_Jordan_column_k_def Let_def fst_foldl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> A'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> from_nat_0 from_nat_to_nat_greatest<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> foldl_Gauss_condition_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="skolem">A'</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> foldl_Gauss_condition_2 k ncols_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">ma</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="skolem">A'</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="skolem">A'</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> foldl_Gauss_condition_3  k ncols_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span> "</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_zero_row_upt_k_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> not_zero_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> zero_below_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> foldl_Gauss_condition_5<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A' not_zero_m zero_below_greatest<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="skolem">A'</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nrows <span class="skolem">A'</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> foldl_Gauss_condition_6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="skolem">A'</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> foldl_Gauss_condition_8 <span class="keyword1"><span class="command">using</span></span> k ncols_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span> <span class="skolem">mb</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="skolem">A'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">mb</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="skolem">A'</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_in_ij <span class="skolem">A'</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> foldl_Gauss_condition_9<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_eq<span class="main"><span class="main">]</span></span> rref_A'<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> rref_Gauss_Jordan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'columns</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'columns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_def
    <span class="keyword1"><span class="command">using</span></span> rref_Gauss_Jordan_upt_k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> diff_Suc_1 lessE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-independent_not_zero_rows_rref"><span class="command">lemma</span></span> independent_not_zero_rows_rref<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>ord<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dep<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.dependent <span class="skolem">R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_in_span<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> vec.span <span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec.dependent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> a_in_R <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_eq_row_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span>row <span class="skolem">i</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> a_eq_Ai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">unfolding</span></span> vec_nth_inverse <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> row_i_A_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">i</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_in_R 
  <span class="keyword1"><span class="command">unfolding</span></span> R_def is_zero_row_def is_zero_row_upt_ncols row_def vec_nth_inverse
  <span class="keyword1"><span class="command">unfolding</span></span> vec_lambda_unique zero_vec_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> a_eq_Ai <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">least_n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">least_n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> span_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.span <span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.span_finite<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_rows<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> rows_def R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_in_span
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> imageE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">least_n</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> rref_condition2<span class="main">[</span><span class="operator">OF</span> rref_A<span class="main">]</span> row_i_A_not_zero <span class="keyword1"><span class="command">unfolding</span></span> least_n_def a_eq_Ai <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">least_n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">least_n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">v</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">v</span> <span class="main">$</span> <span class="skolem">least_n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vector_smult_component <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_eq_row_j_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>row <span class="skolem">j</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_eq_row_i_A x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> x_least_is_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">least_n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_condition4<span class="main">[</span><span class="operator">OF</span> rref_A<span class="main">]</span> i_not_j row_i_A_not_zero 
      <span class="keyword1"><span class="command">unfolding</span></span> x_eq_row_j_A least_n_def row_def vec_nth_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">least_n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_least_is_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum.neutral_const <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>







<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Here we start to prove that the transformation from the original matrix to its reduced row echelon form has been carried out by means of elementary operations.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following function eliminates all entries of the j-th column using the non-zero element situated in the position (i,j).
It is introduced to make easier the proof that each Gauss-Jordan step consists in applying suitable elementary operations.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">row_add_iterate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">,</span> uminus<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'n</span> <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_add_iterate</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">else</span> row_add <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">row_add_iterate</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> to_nat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">row_add_iterate</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span>
     <span class="keyword1">else</span> <span class="free">row_add_iterate</span> <span class="main">(</span>row_add <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gauss_Jordan-invertible_row_add_iterate"><span class="command">lemma</span></span> invertible_row_add_iterate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> row_add_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> row_add_iterate <span class="skolem">A</span> <span class="main">0</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True invertible_def matrix_mul_lid<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False invertible_row_add row_add_iterate.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> row_add_mat_1<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>  hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="bound">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> row_add_iterate <span class="bound">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="bound">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Suc_n<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> row_add_iterate <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">**</span> <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> row_add_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span>
      <span class="main">(</span><span class="keyword1">if</span> Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span> <span class="keyword1">then</span> row_add_iterate <span class="skolem">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span>
      <span class="keyword1">else</span> row_add_iterate <span class="main">(</span>row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span>
      <span class="bound">P</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> hyp Suc_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span>
      <span class="main">(</span><span class="keyword1">if</span> Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span> <span class="keyword1">then</span> row_add_iterate <span class="skolem">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span>
      <span class="keyword1">else</span> row_add_iterate <span class="main">(</span>row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span>
      <span class="bound">P</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> P<span class="main">[</span><span class="operator">unfolded</span> A'_def<span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">P</span></span> <span class="main"><span class="main">**</span></span> <span class="main"><span class="main">(</span></span>row_add <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>from_nat <span class="main"><span class="main">(</span></span>Suc <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">i</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="main"><span class="main">$</span></span> from_nat <span class="main"><span class="main">(</span></span>Suc <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">$</span></span> <span class="free"><span class="free">j</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="skolem">P</span> <span class="main">**</span> row_add <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc_n inv_P invertible_mult invertible_row_add to_nat_from_nat_id nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">**</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span>
        <span class="skolem">P</span> <span class="main">**</span> row_add <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> matrix_mul_assoc row_add_mat_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-row_add_iterate_preserves_greater_than_n"><span class="command">lemma</span></span> row_add_iterate_preserves_greater_than_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_add_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> to_nat_0<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"row_add <span class="skolem">A</span> <span class="main">0</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="bound">A</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">&lt;</span> to_nat <span class="free">a</span> <span class="main">⟹</span> row_add_iterate <span class="bound">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> suc_n_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> suc_n_kess_a<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> to_nat <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> row_add_iterate_A<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> row_add_iterate_A <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> row_add_iterate_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp suc_n_less_card suc_n_kess_a <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> from_nat_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_not_refl suc_n_kess_a suc_n_less_card to_nat_from_nat_id nrows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> row_add_iterate_A'<span class="main">[</span><span class="operator">unfolded</span> A'_def<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> from_nat_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-row_add_iterate_preserves_pivot_row"><span class="command">lemma</span></span> row_add_iterate_preserves_pivot_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_add_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le_0_eq least_mod_type row_add_iterate.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> to_nat_eq to_nat_mono'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="bound">A</span> <span class="main">⟹</span> to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> row_add_iterate <span class="bound">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Suc_n_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_less_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> row_add_iterate_preserves_greater_than_n<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Suc_n_less_card True lessI <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> row_add_iterate_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp Suc_n_less_card i_less_suc False <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> from_nat_noteq_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> False Suc_n_less_card from_nat_not_eq <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> row_add_iterate_A'<span class="main">[</span><span class="operator">unfolded</span> A'_def<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> from_nat_noteq_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-row_add_iterate_eq_row_add"><span class="command">lemma</span></span> row_add_iterate_eq_row_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_add_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>row_add <span class="free">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>3<span class="main">)</span> a_not_i to_nat_eq_0 least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="bound">A</span>  <span class="main">⟹</span> to_nat <span class="free">a</span> <span class="main">≤</span> <span class="skolem">n</span> 
    <span class="main">⟹</span> row_add_iterate <span class="bound">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="bound">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="bound">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> suc_n_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a_le_suc_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hyp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_not_i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_lessD suc_n_less_card<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True a_le_suc_n a_not_i le_SucE to_nat_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> Suc_n_not_i<span class="main">=</span>False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span><span class="main">)</span> <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="main">(</span>row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_lessD True order_refl less_imp_le row_add_iterate_preserves_greater_than_n suc_n_less_card to_nat_from_nat nrows_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">A'</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hyp<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_not_i <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suc_n_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False a_le_suc_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> False suc_n_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> False suc_n_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rw3<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> Suc_n_not_i suc_n_less_card <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"row_add_iterate <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rw row_add_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def rw1 rw2 rw3 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-row_add_iterate_eq_Gauss_Jordan_in_ij"><span class="command">lemma</span></span> row_add_iterate_eq_Gauss_Jordan_in_ij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A'</span><span class="main">==</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="free">A'</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword1"><span class="command">have</span></span> interchange_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> interchange_rows_j<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="free">A'</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> 
    mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rw <span class="keyword1"><span class="command">unfolding</span></span> A'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> row_add_iterate_preserves_pivot_row<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> nrows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'m</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">iaa</span>
  <span class="keyword1"><span class="command">have</span></span> interchange_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> interchange_rows_j<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> ia_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">-</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def mult_row_def <span class="keyword1"><span class="command">using</span></span> ia_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="free">A'</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">iaa</span> <span class="main">=</span>
             row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ia</span> <span class="free">i</span>
              <span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span>
             <span class="skolem">ia</span> <span class="main">$</span>
             <span class="skolem">iaa</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rw A' rw
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> row_add_iterate_eq_row_add<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ia</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>nrows <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">j</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">iaa</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> nrows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia_not_i <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ia</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'m</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ia</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-invertible_Gauss_Jordan_column_k"><span class="command">lemma</span></span> invertible_Gauss_Jordan_column_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Let_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_mat_1 matrix_mul_lid<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i_le_m<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Amk_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A_interchange</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A_interchange</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A_mult</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A_mult</span> <span class="main">=</span> mult_row <span class="skolem">A_interchange</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">A_interchange</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> PA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A_interchange</span> <span class="main">=</span> <span class="skolem">P</span><span class="main">**</span><span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> A_interchange_def
    <span class="keyword1"><span class="command">using</span></span> interchange_rows_mat_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> invertible_interchange_rows<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> mult_row <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">A_interchange</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Q_A_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A_mult</span> <span class="main">=</span> <span class="skolem">Q</span><span class="main">**</span><span class="skolem">A_interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_mult_def A_interchange_def Q_def <span class="keyword1"><span class="command">unfolding</span></span> mult_row_mat_1 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> inv_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Q_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_mult_row'<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> A_interchange_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> LeastI2_ex<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_m Amk_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> interchange_rows_i mult_zero_left nonzero_divide_eq_eq zero_neq_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Pa</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_Pa<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Pa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Pa<span class="main">:</span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Pa</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> invertible_row_add_iterate <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> diff_less nrows_def zero_less_card_finite zero_less_one<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Pa</span></span><span class="main"><span class="main">**</span></span><span class="skolem"><span class="skolem">Q</span></span><span class="main"><span class="main">**</span></span><span class="skolem"><span class="skolem">P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="skolem">Pa</span> <span class="main">**</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inv_P inv_Pa inv_Q invertible_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> row_add_iterate <span class="skolem">A_mult</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_eq_Gauss_Jordan_in_ij<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>  A_mult_def A_interchange_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">Pa</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pa <span class="keyword1"><span class="command">unfolding</span></span> PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Q_A_interchange<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">Pa</span> <span class="main">**</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_mul_assoc <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Pa</span> <span class="main">**</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-invertible_Gauss_Jordan_up_to_k"><span class="command">lemma</span></span> invertible_Gauss_Jordan_up_to_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def rw foldl.simps
    <span class="keyword1"><span class="command">using</span></span> invertible_Gauss_Jordan_column_k <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P'<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Gk_eq_P'A<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">P'</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="main">=</span> snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command">unfolding</span></span> rw2 foldl_append foldl.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> prod.collapse<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>foldl Gauss_Jordan_column_k <span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">..&lt;</span></span>Suc <span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> g<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> invertible_Gauss_Jordan_column_k
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">using</span></span> invertible_mult matrix_mul_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-inj_index_independent_rows"><span class="command">lemma</span></span> inj_index_independent_rows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>ord<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="free">x</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">x</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> x_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> not_zero_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">x</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">unfolding</span></span> row_def vec_eq_iff 
    ncols_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> not_zero_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">y</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_x rref_condition2<span class="main">[</span><span class="operator">OF</span> rref_A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_y x_not_y rref_condition4<span class="main">[</span><span class="operator">OF</span> rref_A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Ax Ay <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The final results:›</span></span>

<span class="keyword1" id="Gauss_Jordan-invertible_Gauss_Jordan"><span class="command">lemma</span></span> invertible_Gauss_Jordan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_def <span class="keyword1"><span class="command">using</span></span> invertible_Gauss_Jordan_up_to_k <span class="keyword1"><span class="command">.</span></span>
  
<span class="keyword1" id="Gauss_Jordan-Gauss_Jordan"><span class="command">lemma</span></span> Gauss_Jordan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span> <span class="main">∧</span> reduced_row_echelon_form <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_Gauss_Jordan rref_Gauss_Jordan<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some properties about the rank of a matrix, obtained thanks to the Gauss-Jordan algorithm and
  the reduced row echelon form.›</span></span>  

<span class="keyword1" id="Gauss_Jordan-rref_rank"><span class="command">lemma</span></span> rref_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>ord<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> card <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rank_def row_rank_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.dim_unique<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>row <span class="bound"><span class="bound">i</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">|</span></span> <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> row <span class="bound"><span class="bound">i</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> row_space <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> row_space_def rows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">∈</span> vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vec.span_base<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_space <span class="free">A</span> <span class="main">⊆</span> vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> row_space_def rows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> set_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_rw <span class="keyword1"><span class="command">using</span></span> vec.span_insert_0 <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">⊆</span> vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">⊆</span> vec.span <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> independent_not_zero_rows_rref<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-column_leading_coefficient_component_eq"><span class="command">lemma</span></span> column_leading_coefficient_component_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>ord<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> vx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> vy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> row_b<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">b</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> vb_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b column_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_zero_row_eq_row_zero row_b rref_A rref_condition2 zero_neq_one<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> b_eq_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> b_not_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rref_condition4_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A _ b_not_x<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_row_eq_row_zero row_b<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> vx <span class="keyword1"><span class="command">unfolding</span></span> b column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> b_eq_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> b_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">y</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rref_condition4_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A _ b_not_y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_row_eq_row_zero row_b<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> vy <span class="keyword1"><span class="command">unfolding</span></span> b column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-column_leading_coefficient_component_1"><span class="command">lemma</span></span> column_leading_coefficient_component_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>ord<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> vx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> row_b<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">b</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> vb_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b column_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_zero_row_eq_row_zero row_b rref_A rref_condition2 zero_neq_one<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> b_eq_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b column_def is_zero_row_eq_row_zero row_b rref_A rref_condition4 transpose_row_code transpose_row_def vx<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span><span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
 <span class="keyword1"><span class="command">using</span></span> rref_condition2_explicit<span class="main">[</span><span class="operator">OF</span> rref_A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> row_b
 <span class="keyword1"><span class="command">unfolding</span></span> b column_def is_zero_row_def' 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_zero_row <span class="skolem">b</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
          b_eq_x is_zero_row_eq_row_zero vec_lambda_beta<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-column_leading_coefficient_component_0"><span class="command">lemma</span></span> column_leading_coefficient_component_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>ord<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> vx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> x_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> column_leading_coefficient_component_eq<span class="main">[</span><span class="operator">OF</span> rref_A v vx<span class="main">]</span> x_not_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gauss_Jordan-rref_col_rank"><span class="command">lemma</span></span> rref_col_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col_rank <span class="free">A</span> <span class="main">=</span> card <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> col_rank_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> vec.dim_unique<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>column <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">LEAST</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">$</span></span> <span class="bound"><span class="bound">i</span></span> <span class="main"><span class="main">$</span></span> <span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">|</span></span> <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> row <span class="bound"><span class="bound">i</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> col_space <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> vec.span_base<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> columns_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.independent_if_scalars_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="var">?x</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="var">?x</span><span class="main">}</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> row_j_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">j</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> j_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≠</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">$</span><span class="skolem">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_eq column_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_zero_row_eq_row_zero j_not_i row_j_not_0 rref_A rref_condition4_explicit<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">assume</span></span> eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> xi_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> i is_zero_row_eq_row_zero rref_A rref_condition2_explicit<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_component vector_smult_component <span class="keyword1"><span class="command">..</span></span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="var">?x</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> 
      <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="var">?x</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.remove<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="var">?x</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xi_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"col_space <span class="free">A</span> <span class="main">⊆</span> vec.span <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> col_space_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.span_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>columns <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> 
        <span class="quoted"><span class="quoted"><span class="quoted">"vec.span <span class="main"><span class="main">{</span></span>column <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">LEAST</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">$</span></span> <span class="bound"><span class="bound">i</span></span> <span class="main"><span class="main">$</span></span> <span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">|</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> row <span class="bound"><span class="bound">i</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> vec.span_span<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> columns <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vec.span <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec.span_finite<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span> image_iff bex_UNIV
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vec_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> xi_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> xi_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> row_iA_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> columns_def column_def row_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vec_lambda_unique<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> row_iA_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_zero_row_eq_row_zero row_iA_not_zero rref_A rref_condition2<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> xi_0
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> sum_component vector_smult_component<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.neutral<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="keyword3"><span class="command">assume</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False xa <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xa</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> row_b<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">b</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> vb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b column_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_zero_row_eq_row_zero row_b rref_A rref_condition2 zero_neq_one<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b_eq_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> column_leading_coefficient_component_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A v vb vi<span class="main"><span class="main">]</span></span><span class="main">)</span>     
      <span class="keyword1"><span class="command">have</span></span> the_vi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> vi<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> va<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> column_leading_coefficient_component_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A v va vi<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>     
      <span class="keyword1"><span class="command">have</span></span> vi_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> column_leading_coefficient_component_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A v vi<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="keyword3"><span class="command">assume</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">=</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> row_b<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">y</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xa <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> xa_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xa <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> column_leading_coefficient_component_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_A xa_in_V<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y column_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> LeastI2_ex is_zero_row_def' is_zero_row_eq_row_zero row_b<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Diff_iff b mem_Collect_eq singleton_conv2 xa y<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_eq_i<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xa</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_component vector_smult_component <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>
          <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ v<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vi_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_vi <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>


<span class="keyword1" id="Gauss_Jordan-rref_row_rank"><span class="command">lemma</span></span> rref_row_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>one<span class="main">,</span>plus<span class="main">,</span>ord<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_rank <span class="free">A</span> <span class="main">=</span> card <span class="main">{</span>column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> column <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rref_rank<span class="main">[</span><span class="operator">OF</span> rref_A<span class="main">,</span> <span class="operator">unfolded</span> rank_def<span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">ia</span>
        <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ia<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">ia</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> c_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> row <span class="skolem">i</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> row <span class="skolem">ia</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span>"</span></span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">=</span> row <span class="skolem">ia</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c_eq <span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">unfolding</span></span> row_def vec_nth_inverse
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transpose_row <span class="free">A</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">R</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> transpose_row <span class="free">A</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">R</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_eq column_def row_def transpose_row_def vec_nth_inverse<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">R</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">R</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> transpose_row_def vec_lambda_beta<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="skolem">ia</span> <span class="free">A</span> <span class="main">=</span> False"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ia is_zero_row_eq_row_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">i</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> i is_zero_row_eq_row_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">R</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f1 f2 rref_A rref_condition2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f3 rref_A rref_condition4_explicit <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
         <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ia</span><span class="main">.</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> row <span class="skolem">i</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> row <span class="bound">ia</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_def vec_lambda_eta<span class="main">)</span>
         <span class="main">(</span><span class="operator">metis</span> i is_zero_row_def' is_zero_row_eq_row_zero zero_index<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>row <span class="bound">i</span> <span class="free">A</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> column_def row_def image_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> i row_def vec_lambda_eta<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan-row_rank_eq_col_rank_rref"><span class="command">lemma</span></span> row_rank_eq_col_rank_rref<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_rank <span class="free">A</span> <span class="main">=</span> col_rank <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rref_row_rank<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> rref_col_rank<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan-row_rank_eq_col_rank"><span class="command">lemma</span></span> row_rank_eq_col_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_rank <span class="free">A</span> <span class="main">=</span> col_rank <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span><span class="main">**</span><span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rref_G<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_Gauss_Jordan rref_Gauss_Jordan <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_rank <span class="free">A</span> <span class="main">=</span> row_rank <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> row_space_is_preserved invertible_Gauss_Jordan row_rank_def<span class="main">)</span>
<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"col_rank <span class="free">A</span> <span class="main">=</span> col_rank <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invertible_Gauss_Jordan crk_is_preserved<span class="main">)</span>
<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"col_rank <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row_rank <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> row_rank_eq_col_rank_rref<span class="main">[</span><span class="operator">OF</span> rref_G<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1"><span class="command">theorem</span></span> rank_col_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> col_rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_def row_rank_eq_col_rank <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">theorem</span></span> rank_eq_dim_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> vec.dim <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rank_col_rank col_rank_def col_space_eq' <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">theorem</span></span> rank_eq_dim_col_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> vec.dim <span class="main">(</span>col_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rank_col_rank <span class="keyword1"><span class="command">unfolding</span></span> col_rank_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Gauss_Jordan-rank_transpose"><span class="command">lemma</span></span> rank_transpose<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"rank <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rank_def rank_eq_dim_col_space row_rank_def row_space_eq_col_space_transpose<span class="main">)</span>

<span class="keyword1" id="Gauss_Jordan-rank_le_nrows"><span class="command">lemma</span></span> rank_le_nrows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_dim_col_space nrows_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> top_greatest vec.dim_subset vec_dim_card<span class="main">)</span> 

<span class="keyword1" id="Gauss_Jordan-rank_le_ncols"><span class="command">lemma</span></span> rank_le_ncols<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≤</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rank_def row_rank_def ncols_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> top_greatest vec.dim_subset vec_dim_card<span class="main">)</span>

<span class="keyword1" id="Gauss_Jordan-rank_Gauss_Jordan"><span class="command">lemma</span></span> rank_Gauss_Jordan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> rank <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_Jordan_def invertible_Gauss_Jordan_up_to_k 
      row_rank_eq_col_rank rank_def crk_is_preserved<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Other interesting properties:›</span></span>

<span class="keyword1" id="Gauss_Jordan-A_0_imp_Gauss_Jordan_0"><span class="command">lemma</span></span> A_0_imp_Gauss_Jordan_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> PA<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_Gauss_Jordan <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_add_iff matrix_add_ldistrib<span class="main">)</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-rank_0"><span class="command">lemma</span></span> rank_0<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> rank_def row_rank_def row_space_def rows_def row_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec.dim_span vec.dim_zero_eq' vec_nth_inverse<span class="main">)</span>


<span class="keyword1" id="Gauss_Jordan-rank_greater_zero"><span class="command">lemma</span></span> rank_greater_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"row_space <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> row_space <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_def row_rank_def <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"row_space <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_space_def <span class="keyword1"><span class="command">using</span></span> vec.span_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rows <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> rows <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_space_def <span class="keyword1"><span class="command">using</span></span> vec.span_0_imp_set_empty_or_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rows <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rows_def row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rows_def row_def vec_nth_inverse
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> mem_Collect_eq singleton_iff vec_lambda_unique zero_index<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-Gauss_Jordan_not_0"><span class="command">lemma</span></span> Gauss_Jordan_not_0<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms less_not_refl3 rank_0 rank_Gauss_Jordan rank_greater_zero<span class="main">)</span>

<span class="keyword1" id="Gauss_Jordan-rank_eq_suc_to_nat_greatest"><span class="command">lemma</span></span> rank_eq_suc_to_nat_greatest<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> A_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rref_Gauss_Jordan <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">have</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> Gauss_Jordan_not_0<span class="main">[</span><span class="operator">OF</span> A_not_0<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_eq_iff zero_index<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> card <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> rank_Gauss_Jordan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> rref_rank<span class="main">[</span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≤</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> row <span class="bound"><span class="bound">i</span></span> <span class="main"><span class="main">(</span></span>Gauss_Jordan <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> inj_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
         <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> xy_eq_row<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row <span class="skolem">y</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_condition3_equiv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_Gauss_Jordan True<span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def<span class="main"><span class="keyword3">,</span></span> 
                    <span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref x<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> is_zero_row_def<span class="main"><span class="main">]</span></span> not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">y</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref y<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> is_zero_row_def<span class="main"><span class="main">]</span></span> not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl row_def vec_nth_inverse xy_eq_row<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">hence</span></span> x_ge_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_not_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rref_condition3_equiv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_Gauss_Jordan x_ge_y<span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref x<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> is_zero_row_def<span class="main"><span class="main">]</span></span> not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">y</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref y<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> is_zero_row_def<span class="main"><span class="main">]</span></span> not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl row_def vec_nth_inverse xy_eq_row<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span>
      <span class="keyword3"><span class="command">assume</span></span>  xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> row <span class="skolem">xa</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xa</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">xa</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref xa<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> is_zero_row_def<span class="main"><span class="main">]</span></span> not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>                  
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">xa</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_def is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_nth_inverse zero_index<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_def is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_eq_iff vec_nth_inverse zero_index<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">.</span> row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row <span class="bound">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> to_nat <span class="bound"><span class="bound">i</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on to_nat <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_inj_on subset_inj_on top_greatest<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">`</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>    
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_mono'<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> leD not_le_imp_less to_nat_le<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_le_trans not_le to_nat_less_card<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">xa</span></span><span class="main">≤</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> to_nat <span class="bound">xa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> card_Collect_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan-rank_less_row_i_imp_i_is_zero"><span class="command">lemma</span></span> rank_less_row_i_imp_i_is_zero<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rank_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≥</span> rank <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_0_imp_Gauss_Jordan_0 zero_index<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≥</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rank_less_i <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_suc_to_nat_greatest<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&gt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add.commute add_strict_increasing 
    add_strict_increasing2 le0 lessI neq_iff not_le to_nat_mono<span class="main">)</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_greater_Greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-rank_Gauss_Jordan_eq"><span class="command">lemma</span></span> rank_Gauss_Jordan_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span><span class="main">=</span><span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="keyword1">in</span> card <span class="main">{</span>row <span class="bound">i</span> <span class="bound">A'</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="bound">A'</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> rank_Gauss_Jordan rref_Gauss_Jordan rref_rank<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Lemmas for code generation and rank computation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span> 
  <span class="bound">interchange_A</span> <span class="main">=</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span> 
  <span class="bound">A'</span> <span class="main">=</span> mult_row <span class="bound">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="bound">interchange_A</span><span class="main">$</span><span class="free">i</span><span class="main">$</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">in</span> 
  <span class="main">(</span><span class="main">%</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span><span class="main">=</span><span class="free">i</span> <span class="keyword1">then</span> <span class="bound">A'</span> <span class="main">$</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="bound">A'</span> <span class="bound">s</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="bound">interchange_A</span><span class="main">$</span><span class="bound">s</span><span class="main">$</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Gauss_Jordan-rank_Gauss_Jordan_code"><span class="command">lemma</span></span> rank_Gauss_Jordan_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span><span class="main">=</span><span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="keyword1">in</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> row <span class="bound">a</span> <span class="bound">A'</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> True  rank_0 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_suc_to_nat_greatest<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> Let_def is_zero_row_eq_row_zero <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan-dim_null_space"><span class="command">lemma</span></span> dim_null_space<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'cols</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> rank <span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_implies_diff<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> rank_nullity_theorem_matrices  
  <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_dim_col_space<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> dimension_vector ncols_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan-rank_eq_dim_col_space'"><span class="command">lemma</span></span> rank_eq_dim_col_space'<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>col_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  rank_eq_dim_col_space <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan-dim_left_null_space"><span class="command">lemma</span></span> dim_left_null_space<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>left_null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> rank <span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> left_null_space_eq_null_space_transpose
  <span class="keyword1"><span class="command">unfolding</span></span> dim_null_space <span class="keyword1"><span class="command">unfolding</span></span> rank_transpose <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> rank_col_rank<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> rank_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> row_rank_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> col_rank_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> DIM_cart<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> DIM_real<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Linear_Maps">
<div class="head">
<h1>Theory Linear_Maps</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Linear_Maps.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
    Maintainer: Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Linear Maps›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Linear_Maps
<span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Gauss_Jordan.html">Gauss_Jordan</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real <span class="main">,</span> <span class="main">-</span> <span class="bound">y</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">h</span><span class="main">,</span> <span class="main">-</span> snd <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_derivative_eq_rhs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_derivative_split<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_derivative_Pair<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties about ranks and linear maps›</span></span>

<span class="keyword1" id="Linear_Maps-rank_matrix_dim_range"><span class="command">lemma</span></span> rank_matrix_dim_range<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> lf<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> vec.dim <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> rank_col_rank<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"matrix <span class="free">f</span>"</span></span><span class="main">]</span> col_rank_def
<span class="keyword1"><span class="command">unfolding</span></span> col_space_eq' <span class="keyword1"><span class="command">using</span></span> matrix_works<span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following two lemmas are the demonstration of theorem 2.11 that appears the book "Advanced Linear Algebra" by Steven Roman.›</span></span>

<span class="keyword1" id="Linear_Maps-linear_injective_rank_eq_ncols"><span class="command">lemma</span></span> linear_injective_rank_eq_ncols<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lf<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span> <span class="main">⟷</span> rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> ncols <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> lf<span class="main">:</span> Vector_Spaces.linear <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">using</span></span> lf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lf.linear_injective_ker_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_eq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">=</span> ncols <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.rank_nullity_theorem <span class="keyword1"><span class="command">unfolding</span></span> ncols_def
    <span class="keyword1"><span class="command">using</span></span> rank_matrix_dim_range<span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral lf.linear_axioms vec.dim_UNIV vec.dimension_def vec_dim_card<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> ncols <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ncols_def
    <span class="keyword1"><span class="command">using</span></span> rank_matrix_dim_range<span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span> eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cancel_comm_monoid_add_class.diff_cancel dim_null_space lf ncols_def
        null_space_eq_ker vec.dim_UNIV vec.dimension_def vec_dim_card<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_eq
    <span class="keyword1"><span class="command">using</span></span> lf vec.linear_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.linear_injective_ker_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"matrix <span class="free">f</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-linear_surjective_rank_eq_ncols"><span class="command">lemma</span></span> linear_surjective_rank_eq_ncols<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lf<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"surj <span class="free">f</span> <span class="main">⟷</span> rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> nrows <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> surj<span class="main">:</span> <span class="quoted"><span class="quoted">"surj <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nrows <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec.dim <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj vec_dim_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_matrix_dim_range<span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">=</span> nrows <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">=</span> nrows <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>range <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_matrix_dim_range<span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span> nrows_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"surj <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec.basis_exists independent_is_basis is_basis_def lf
      vec.subspace_UNIV vec.subspace_image
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> col_space_eq' col_space_eq_range vec.span_subspace<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-linear_bij_rank_eq_ncols"><span class="command">lemma</span></span> linear_bij_rank_eq_ncols<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">=&gt;</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lf<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟷</span> rank <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">=</span> ncols <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_def
  <span class="keyword1"><span class="command">using</span></span> lf linear_injective_rank_eq_ncols vec.linear_inj_imp_surj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Invertible linear maps›</span></span>

<span class="keyword1"><span class="command">locale</span></span> invertible_lf <span class="main">=</span> Vector_Spaces.linear <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> id <span class="main">∧</span> <span class="free">f</span> <span class="main">∘</span> <span class="bound">g</span> <span class="main">=</span> id<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Linear_Maps-invertible_lf"><span class="command">lemma</span></span> invertible_lf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> linear <span class="main">(</span><span class="keyword1"><span class="free">(*b)</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">(*a)</span></span><span class="main">)</span> <span class="bound">g</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> id<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="bound">g</span> <span class="main">=</span> id<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> invertible <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def id_def inj_on_def fun_eq_iff<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> linear_exists_left_inverse_on<span class="main">[</span><span class="operator">OF</span> linear_axioms vs1.subspace_UNIV this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    g<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="keyword1"><span class="free">(*b)</span></span> <span class="keyword1"><span class="free">(*a)</span></span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">o</span> <span class="free">f</span> <span class="main">=</span> id"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff id_def module_hom_iff_linear<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span> <span class="main">=</span> id"</span></span>
    <span class="keyword1"><span class="command">using</span></span> invertible
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def fun_eq_iff<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Vector_Spaces.linear<span class="main">)</span> invertible_lf_intro<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> id<span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> id<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1"><span class="free">(*a)</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">(*b)</span></span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Maps-invertible_imp_bijective"><span class="command">lemma</span></span> invertible_imp_bijective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible_lf <span class="free">scaleB</span> <span class="free">scaleC</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> invertible_lf_def invertible_lf_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_comp_iff bij_betw_imp_surj inj_on_imageI2 inj_on_imp_bij_betw inv_id surj_id surj_imp_inj_inv<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-invertible_matrix_imp_invertible_lf"><span class="command">lemma</span></span> invertible_matrix_imp_invertible_lf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">**</span><span class="skolem">B</span><span class="main">=</span>mat <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">**</span><span class="free">A</span><span class="main">=</span>mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_A <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.invertible_lf_intro <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword1"><span class="keyword1">*v</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(*v)</span> <span class="skolem">B</span> <span class="main">∘</span> <span class="keyword1">(*v)</span> <span class="free">A</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> AB BA isomorphism_expand matrix_vector_mul_assoc matrix_vector_mul_lid<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(*v)</span> <span class="free">A</span> <span class="main">∘</span> <span class="keyword1">(*v)</span> <span class="skolem">B</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> AB BA isomorphism_expand matrix_vector_mul_assoc matrix_vector_mul_lid<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-invertible_lf_imp_invertible_matrix"><span class="command">lemma</span></span> invertible_lf_imp_invertible_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_f<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> invertible_lf <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_f <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> linear_g<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span>  <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> id<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">=</span> id<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invertible_f invertible_lf.invertible_lf<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"matrix <span class="skolem"><span class="skolem">g</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix <span class="free">f</span> <span class="main">**</span> matrix <span class="skolem">g</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_eq matrix_vector_mul_assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i.linear_axioms matrix_vector_mul_lid pointfree_idE fg linear_g matrix_vector_mul<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix <span class="skolem">g</span> <span class="main">**</span> matrix <span class="free">f</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹matrix <span class="free">f</span> <span class="main">**</span> matrix <span class="skolem">g</span> <span class="main">=</span> mat <span class="main">1</span>›</span></span> matrix_left_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-invertible_matrix_iff_invertible_lf"><span class="command">lemma</span></span> invertible_matrix_iff_invertible_lf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span> <span class="main">⟷</span> invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invertible_lf_imp_invertible_matrix invertible_matrix_imp_invertible_lf matrix_of_matrix_vector_mul<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-invertible_matrix_iff_invertible_lf'"><span class="command">lemma</span></span> invertible_matrix_iff_invertible_lf'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>  <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> assms invertible_matrix_iff_invertible_lf matrix_vector_mul<span class="main">)</span> 


<span class="keyword1" id="Linear_Maps-invertible_matrix_mult_right_rank"><span class="command">lemma</span></span> invertible_matrix_mult_right_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">A</span><span class="main">**</span><span class="free">Q</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TQ</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">Q</span> <span class="keyword1">*v</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TA</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TAQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TAQ</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main">**</span><span class="free">Q</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="skolem">TQ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix_imp_invertible_lf<span class="main">[</span><span class="operator">OF</span> invertible_Q<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> TQ_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> bij_TQ<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">TQ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_imp_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">TAQ</span> <span class="main">=</span> range <span class="main">(</span><span class="skolem">TA</span> <span class="main">∘</span> <span class="skolem">TQ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> TQ_def TA_def TAQ_def o_def matrix_vector_mul_assoc <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">TA</span> <span class="main">`</span><span class="main">(</span>range <span class="skolem">TQ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fun.set_map <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">TA</span> <span class="main">`</span> <span class="main">(</span>UNIV<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_is_surj<span class="main">[</span><span class="operator">OF</span> bij_TQ<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">TAQ</span> <span class="main">=</span> range <span class="skolem">TA</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_dim_image <span class="keyword1"><span class="command">using</span></span> TAQ_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> TA_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-subspace_image_invertible_mat"><span class="command">lemma</span></span> subspace_image_invertible_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sub_W<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.subspace <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> vec.subspace_image<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-dim_image_invertible_mat"><span class="command">lemma</span></span> dim_image_invertible_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sub_W<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.subspace <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="free">W</span><span class="main">)</span> <span class="main">=</span> vec.dim <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B_in_W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">⊆</span><span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ind_B<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.independent <span class="skolem">B</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> W_in_span_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> vec.span <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> card_B_eq_dim_W<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> vec.dim <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec.basis_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">L</span><span class="main">`</span><span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> finite_B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.indep_card_eq_dim_span<span class="main">[</span><span class="operator">OF</span> ind_B<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">interpret</span></span> L<span class="main">:</span> Vector_Spaces.linear <span class="quoted"><span class="quoted">"<span class="keyword1">(*s)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(*s)</span>"</span></span> <span class="quoted"><span class="skolem">L</span></span>  <span class="keyword1"><span class="command">using</span></span> matrix_vector_mul_linear_gen <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> finite_C<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.indep_card_eq_dim_span<span class="main">[</span><span class="operator">OF</span> ind_B<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> inv_TP<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix_imp_invertible_lf<span class="main">[</span><span class="operator">OF</span> inv_P<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> inj_on_LW<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">L</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_imp_bijective<span class="main">[</span><span class="operator">OF</span> inv_TP<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_def L_def <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> inj_on_LB<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">L</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">using</span></span> B_in_W <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">have</span></span> ind_D<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.independent <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.independent_if_scalars_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_C<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ly_eq_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> C_def L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_on_LB<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">L</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="skolem">L</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">..</span></span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="skolem">L</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L.sum L.scale<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vec.subspace_sum<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sub_W<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_in_W rev_subsetD sub_W vec.subspace_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum rw
      <span class="keyword1"><span class="command">using</span></span> vec.linear_inj_on_iff_eq_0<span class="main">[</span><span class="operator">OF</span> L.linear_axioms sub_W<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> inj_on_LW
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec.scalars_zero_if_independent<span class="main">[</span><span class="operator">OF</span> finite_B ind_B<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">L</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def Ly_eq_x <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span><span class="main">`</span> <span class="free">W</span> <span class="main">⊆</span> vec.span <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> vec.span_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_C<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="keyword3"><span class="command">assume</span></span> xa_in_W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> sum_g<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">xa</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec.span_finite<span class="main">[</span><span class="operator">OF</span> finite_B<span class="main">]</span> W_in_span_B xa_in_W <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="skolem">xa</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">THE</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∈</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">=</span></span><span class="skolem"><span class="skolem">L</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="skolem">xa</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="skolem">L</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L.sum L.scale<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">=</span><span class="skolem">L</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">L</span><span class="main">`</span><span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> sum.reindex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_on_LB<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x_in_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> x_eq_the<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">L</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">L</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">L</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">L</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_in_B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">L</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">L</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_on_LB x_in_B <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="keyword1">*s</span> <span class="skolem">L</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">L</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">L</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="skolem">L</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_eq_the <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">rule</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="skolem">xa</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">L</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">=</span> card <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_image<span class="main">[</span><span class="operator">OF</span> inj_on_LB<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_in_W C_def L.span_image W_in_span_B <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">≡</span> <span class="keyword1">(*v)</span> <span class="free">P</span>›</span></span> card_B_eq_dim_W ind_D sub_W
        vec.indep_card_eq_dim_span vec.span_subspace<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Linear_Maps-invertible_matrix_mult_left_rank"><span class="command">lemma</span></span> invertible_matrix_mult_left_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TP</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TP</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TA</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TPA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TPA</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span>range <span class="main">(</span><span class="keyword1">(*v)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec.subspace_UNIV vec.subspace_image<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>range <span class="skolem">TPA</span><span class="main">)</span> <span class="main">=</span> vec.dim <span class="main">(</span>range <span class="main">(</span><span class="skolem">TP</span> <span class="main">∘</span> <span class="skolem">TA</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> TP_def TA_def TPA_def o_def matrix_vector_mul_assoc <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec.dim <span class="main">(</span>range <span class="skolem">TA</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dim_image_invertible_mat<span class="main">[</span><span class="operator">OF</span> invertible_P sub<span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> TP_def TA_def o_def fun.set_map<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_dim_image TPA_def TA_def <span class="keyword1"><span class="command">.</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> invertible_matrices_mult_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> invertible_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">**</span><span class="free">Q</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_matrix_mult_right_rank<span class="main">[</span><span class="operator">OF</span> invertible_Q<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix_mult_left_rank<span class="main">[</span><span class="operator">OF</span> invertible_P<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1" id="Linear_Maps-invertible_matrix_mult_left_rank'"><span class="command">lemma</span></span> invertible_matrix_mult_left_rank'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B_eq_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">P</span><span class="main">**</span><span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">B</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">B</span> <span class="main">=</span> rank <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_eq_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix_mult_left_rank<span class="main">[</span><span class="operator">OF</span> invertible_P<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-invertible_matrix_mult_right_rank'"><span class="command">lemma</span></span> invertible_matrix_mult_right_rank'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B_eq_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span><span class="main">**</span><span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">B</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_eq_PA invertible_Q invertible_matrix_mult_right_rank<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-invertible_matrices_rank'"><span class="command">lemma</span></span> invertible_matrices_rank'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> invertible_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B_eq_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">**</span><span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">B</span> <span class="main">=</span> rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_eq_PA invertible_P invertible_Q invertible_matrices_mult_rank<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition and properties of the set of a vector›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some definitions:›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the file <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Generalizations.thy›</span></span></span></span> there exists the following definition: 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "cart_basis_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>cart_basis›</span></span></span></span> returns a set which is a basis and it works properly in my development.
  But in this file, I need to know the order of the elements of the basis, because is very important
  for the coordenates of a vector and the matrices of change of bases. So, I have defined a new
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>cart_basis'›</span></span></span></span>, which will be a matrix. The columns of this matrix are the elements of
  the basis.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_of_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_of_vector</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cart_basis'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cart_basis'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> axis <span class="bound">i</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Linear_Maps-cart_basis_eq_set_of_vector_cart_basis'"><span class="command">lemma</span></span> cart_basis_eq_set_of_vector_cart_basis'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"cart_basis <span class="main">=</span> set_of_vector <span class="main">(</span>cart_basis'<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cart_basis_def cart_basis'_def set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Maps-basis_image_linear"><span class="command">lemma</span></span> basis_image_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_lf<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span><span class="free">f</span><span class="main">`</span> <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> independent_is_basis<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> set_of_vector <span class="free">X</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"set_of_vector <span class="free"><span class="free"><span class="free">X</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> invertible_imp_bijective<span class="main"><span class="main">[</span></span><span class="operator">OF</span> invertible_lf<span class="main"><span class="main">]</span></span> bij_def inj_eq inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_X <span class="keyword1"><span class="command">unfolding</span></span> independent_is_basis<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> set_of_vector <span class="free">X</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> Vector_Spaces.linear <span class="quoted"><span class="quoted">"<span class="keyword1">(*s)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(*s)</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_lf <span class="keyword1"><span class="command">unfolding</span></span> invertible_lf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span><span class="free">f</span> <span class="main">`</span> set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> independent_injective_image<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_X <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span>vec.span <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_def injD inj_onI invertible_imp_bijective invertible_lf<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "cart_basis'_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Linear_Maps-set_of_vector_cart_basis'"><span class="command">lemma</span></span> set_of_vector_cart_basis'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set_of_vector cart_basis'<span class="main">)</span> <span class="main">=</span> <span class="main">{</span>axis <span class="bound">i</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def cart_basis'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Maps-cart_basis'_i"><span class="command">lemma</span></span> cart_basis'_i<span class="main">:</span> <span class="quoted"><span class="quoted">"cart_basis' <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> axis <span class="free">i</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cart_basis'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Linear_Maps-finite_set_of_vector"><span class="command">lemma</span></span> finite_set_of_vector<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">using</span></span> finite_Atleast_Atmost_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Linear_Maps-is_basis_cart_basis'"><span class="command">lemma</span></span> is_basis_cart_basis'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector cart_basis'<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cart_basis_eq_set_of_vector_cart_basis'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Miscellaneous.is_basis_def independent_cart_basis span_cart_basis<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-basis_expansion_cart_basis'"><span class="command">lemma</span></span> basis_expansion_cart_basis'<span class="main">:</span><span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">*s</span> cart_basis' <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> UNIV <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cart_basis'_def <span class="keyword1"><span class="command">using</span></span> basis_expansion <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Maps-basis_expansion_unique"><span class="command">lemma</span></span> basis_expansion_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> axis <span class="main">(</span><span class="bound">i</span><span class="main">::</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span> <span class="main">1</span><span class="main">)</span> UNIV <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> basis_expansion<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> univ_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> axis <span class="bound">x</span> <span class="main">1</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> axis <span class="bound">x</span> <span class="main">1</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univ_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> axis <span class="bound">x</span> <span class="main">1</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span>  sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> axis <span class="bound">x</span> <span class="main">1</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> axis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> axis <span class="bound">x</span> <span class="main">1</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Linear_Maps-basis_expansion_cart_basis'_unique"><span class="command">lemma</span></span> basis_expansion_cart_basis'_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>cart_basis' <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> cart_basis' <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> UNIV <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>cart_basis' <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> basis_expansion_unique <span class="keyword1"><span class="command">unfolding</span></span> cart_basis'_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff if_distrib <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_weak_cong<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-basis_expansion_cart_basis'_unique'"><span class="command">lemma</span></span> basis_expansion_cart_basis'_unique'<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> cart_basis' <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> UNIV <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> basis_expansion_unique <span class="keyword1"><span class="command">unfolding</span></span> cart_basis'_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff if_distrib <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_weak_cong<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "is_basis_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Linear_Maps-sum_basis_eq"><span class="command">lemma</span></span> sum_basis_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_basis<span class="main">:</span><span class="quoted"><span class="quoted">"is_basis  <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> card_set_of_vector<span class="main">:</span><span class="quoted"><span class="quoted">"card<span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> independent_is_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="free">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> is_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">have</span></span> fact_1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="free">X</span> <span class="main">=</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_card_imp_inj_on<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_class.finite_UNIV <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> card_set_of_vector <span class="keyword1"><span class="command">using</span></span> fact_1 <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">OF</span> inj<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> o_def<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> fact_1 <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sum_basis_eq2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_basis<span class="main">:</span><span class="quoted"><span class="quoted">"is_basis  <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">($)</span> <span class="free">X</span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> sum_basis_eq<span class="main">[</span><span class="operator">OF</span> is_basis<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Linear_Maps-inj_op_nth"><span class="command">lemma</span></span> inj_op_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fact_1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="free">X</span> <span class="main">=</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> card_set_of_vector<span class="main">:</span><span class="quoted"><span class="quoted">"card<span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> independent_is_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="free">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> is_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_card_imp_inj_on<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_class.finite_UNIV <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>range <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_set_of_vector <span class="keyword1"><span class="command">using</span></span> fact_1 <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-basis_UNIV"><span class="command">lemma</span></span> basis_UNIV<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec.span_finite<span class="main">[</span><span class="operator">OF</span> basis_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_basis<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> is_basis <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> vec.sum_representation_eq exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"vec.representation <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">x</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>set_of_vector <span class="free">X</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="main"><span class="main">($)</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> o_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> fact_1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="free">X</span> <span class="main">=</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> card_set_of_vector<span class="main">:</span><span class="quoted"><span class="quoted">"card<span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> independent_is_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="free">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> is_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_op_nth<span class="main">[</span><span class="operator">OF</span> is_basis<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>set_of_vector <span class="free">X</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">OF</span> inj<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> fact_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-scalars_zero_if_basis"><span class="command">lemma</span></span> scalars_zero_if_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ind_X<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_basis <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> finite_X<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_finite<span class="main">[</span><span class="operator">OF</span> is_basis<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_X <span class="keyword1"><span class="command">unfolding</span></span> vec.independent_explicit <span class="keyword1"><span class="command">using</span></span> finite_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_op_nth<span class="main">[</span><span class="operator">OF</span> is_basis<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="free">X</span> <span class="main">=</span> range <span class="main">(</span><span class="main">($)</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> inj_op_nth<span class="main">[</span><span class="operator">OF</span> is_basis<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> injD the_equality<span class="main">)</span> 
       <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">OF</span> inj<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> rw o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> inj_op_nth<span class="main">[</span><span class="operator">OF</span> is_basis<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> injD the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-basis_combination_unique"><span class="command">lemma</span></span> basis_combination_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">=</span><span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">≠</span><span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> fx_gx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_subtractf<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_diff_left<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sum_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> scalars_zero_if_basis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> basis_X sum_eq_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> fx_gx <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Coordinates of a vector›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definition and properties of the coordinates of a vector (in terms of a particular ordered basis).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">coord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">coord</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">$</span><span class="bound">x</span><span class="main">)</span> UNIV<span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"coord <span class="free"><span class="free">X</span></span> <span class="free"><span class="free">v</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are the coordinates of vector <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">v</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with respect to the basis <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Linear_Maps-bij_coord"><span class="command">lemma</span></span> bij_coord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span>coord <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>coord <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> inj_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> coord_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"coord <span class="free">X</span> <span class="skolem">x</span> <span class="main">=</span> coord <span class="free">X</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
    <span class="keyword1"><span class="command">have</span></span> the_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">fa</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">fa</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ga</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">ga</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ga</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> coord_eq <span class="keyword1"><span class="command">unfolding</span></span> coord_def 
      <span class="keyword1"><span class="command">using</span></span> vec_lambda_inject<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> "</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_f the_g <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'n</span><span class="main">)</span> vec"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> range <span class="main">(</span>coord <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"sum <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">$</span></span><span class="bound"><span class="bound">i</span></span> <span class="keyword1"><span class="keyword1">*s</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">$</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">)</span></span> UNIV"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> coord_def<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">$</span><span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> the_f<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> sum_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> sum_eq <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_f <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> vec_lambda_eta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-linear_coord"><span class="command">lemma</span></span> linear_coord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span>coord <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'n</span><span class="main">)</span> vec"</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"coord <span class="free">X</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> coord <span class="free">X</span> <span class="skolem">x</span> <span class="main">+</span> coord <span class="free">X</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">h</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> the_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">fa</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">fa</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ga</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">ga</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ga</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> the_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">h</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ha</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">ha</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ha</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f g h <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum.distrib<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_left_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> coord_def the_f the_g the_h<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> f g h t_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coord <span class="free">X</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*s</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*s</span> coord <span class="free">X</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*s</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> the_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="skolem">c</span> <span class="keyword1">*s</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">c</span> <span class="keyword1">*s</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">fa</span><span class="main">.</span> <span class="skolem">c</span> <span class="keyword1">*s</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">fa</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span><span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ga</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">ga</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ga</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">c</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vec.scale_sum_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> coord_def the_f the_g<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> t_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Linear_Maps-coord_eq"><span class="command">lemma</span></span> coord_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span><span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> coord_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"coord <span class="free">X</span> <span class="free">v</span> <span class="main">=</span> coord <span class="free">X</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> coord_eq
    <span class="keyword1"><span class="command">unfolding</span></span> coord_eq coord_def vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> the_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span>  f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span>  g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> the_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> fa<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> f fa <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> fa<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> g fa <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> the_eq <span class="keyword1"><span class="command">unfolding</span></span> the_f the_g <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Matrix of change of basis and coordinate matrix of a linear map›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions of matrix of change of basis and matrix of a linear transformation with respect to two bases:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_change_of_basis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_change_of_basis</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>coord <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There exists in the library the definition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, which is the coordinate matrix of a linear map with respect to the standard bases.
      Now we generalise that concept to the coordinate matrix of a linear map with respect to any two bases.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix'</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>coord <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix'_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Linear_Maps-matrix'_eq_matrix"><span class="command">lemma</span></span> matrix'_eq_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> cart_basis_Rn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cart_basis_Rn</span> <span class="main">==</span> <span class="main">(</span>cart_basis'<span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> cart_basis_Rm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">cart_basis_Rm</span> <span class="main">==</span> <span class="main">(</span>cart_basis'<span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="main">(</span><span class="free">cart_basis_Rn</span><span class="main">)</span> <span class="main">(</span><span class="free">cart_basis_Rm</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> matrix <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_def matrix'_def coord_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> basis_Rn<span class="main">:</span><span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">cart_basis_Rn</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_basis_cart_basis' <span class="keyword1"><span class="command">unfolding</span></span> cart_basis_Rn <span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword1"><span class="command">have</span></span> basis_Rm<span class="main">:</span><span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">cart_basis_Rm</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_basis_cart_basis' <span class="keyword1"><span class="command">unfolding</span></span> cart_basis_Rm <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> sum_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">cart_basis_Rn</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_Rm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">cart_basis_Rn</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">cart_basis_Rn</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">cart_basis_Rn</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>  
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ga</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">cart_basis_Rn</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">ga</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> sum_ga<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">cart_basis_Rn</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">ga</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ga</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> basis_combination_unique<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="main">(</span><span class="free">cart_basis_Rm</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_Rm <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">ga</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_g sum_ga <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">cart_basis_Rn</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cart_basis_Rm</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> the_g <span class="keyword1"><span class="command">using</span></span> sum_g <span class="keyword1"><span class="command">unfolding</span></span> cart_basis_Rm cart_basis_Rn cart_basis'_def   <span class="keyword1"><span class="command">using</span></span> basis_expansion_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>axis <span class="skolem">j</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_mult_eq_scaleR <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-matrix'"><span class="command">lemma</span></span> matrix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="free">i</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">Y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix'_def coord_def matrix_mult_sum column_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span>  g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ia</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ia</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">ia</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span>
    <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ia</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ia</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">ia</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">ia</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ia</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ia</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> fa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_combination_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> basis_Y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fa g<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> the_g <span class="keyword1"><span class="command">unfolding</span></span> g<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> matrix'2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">Y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq_f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">Y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix'<span class="main">[</span><span class="operator">OF</span> basis_X basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span>  fxi_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">Y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_f' <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span>  fxi_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">b</span> <span class="bound">j</span> <span class="keyword1">*s</span><span class="main">(</span><span class="free">Y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_f <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> fxi_1 fxi_2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the theorem 2.14 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>
<span class="keyword1" id="Linear_Maps-coord_matrix'"><span class="command">lemma</span></span> coord_matrix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coord <span class="free">Y</span> <span class="main">(</span><span class="free">f</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">X</span> <span class="free">v</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_mult_sum matrix'_def column_def coord_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">interpret</span></span> Vector_Spaces.linear <span class="quoted"><span class="quoted">"<span class="keyword1">(*s)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(*s)</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span>  <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span>  fa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span><span class="main">=</span><span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_combination_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> basis_Y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fa g<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> the_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span><span class="main">=</span><span class="skolem">s</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_combination_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> basis_X<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fa s<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum scale<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="keyword1">*s</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">Y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> UNIV<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix'<span class="main">[</span><span class="operator">OF</span> basis_X basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec.scale_sum_right <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix'_def <span class="keyword1"><span class="command">unfolding</span></span> coord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.swap<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec.scale_sum_left <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span>  the_g the_s t_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span>  <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span>  <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">ia</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">ia</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">ia</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">s</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">fa</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the second part of the theorem 2.15 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>
<span class="keyword1" id="Linear_Maps-matrix'_compose"><span class="command">lemma</span></span> matrix'_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'p</span><span class="main">^</span><span class="tfree">'p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> basis_Z<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> linear_g<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">Z</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix' <span class="free">Y</span> <span class="free">Z</span> <span class="free">g</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'n</span><span class="main">)</span> vec"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> coord <span class="free">X</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_coord<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_pointE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> linear_gf<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Vector_Spaces.linear_compose<span class="main">[</span><span class="operator">OF</span> linear_f linear_g<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">Z</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">a</span> <span class="main">=</span> matrix' <span class="free">X</span> <span class="free">Z</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">X</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coord <span class="free">Z</span> <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coord_matrix'<span class="main">[</span><span class="operator">OF</span> basis_X basis_Z linear_gf<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coord <span class="free">Z</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>matrix' <span class="free">Y</span> <span class="free">Z</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">Y</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coord_matrix'<span class="main">[</span><span class="operator">OF</span> basis_Y basis_Z linear_g<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>matrix' <span class="free">Y</span> <span class="free">Z</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">X</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coord_matrix'<span class="main">[</span><span class="operator">OF</span> basis_X basis_Y linear_f<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>matrix' <span class="free">Y</span> <span class="free">Z</span> <span class="free">g</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">X</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">Z</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">a</span> <span class="main">=</span> matrix' <span class="free">Y</span> <span class="free">Z</span> <span class="free">g</span> <span class="main">**</span> matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span> <span class="keyword1">*v</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Linear_Maps-exists_linear_eq_matrix'"><span class="command">lemma</span></span> exists_linear_eq_matrix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> matrix' <span class="free">X</span> <span class="free">Y</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="bound">f</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">v</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">have</span></span> indep<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> basis_X <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> vec.construct <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> linear_g<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_eq_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec.linear_construct<span class="main">[</span><span class="operator">OF</span> indep<span class="main">]</span> vec.construct_basis<span class="main">[</span><span class="operator">OF</span> indep<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> g_def module_hom_iff_linear
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">Y</span> <span class="skolem">g</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix'2<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_X <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_Y <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">have</span></span> the_k_eq_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">k</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> Xi_Xk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">k</span>"</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Xi_Xk basis_X inj_eq inj_op_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">qed</span></span>      
        <span class="keyword1"><span class="command">have</span></span> Xi_in_X<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">$</span><span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">X</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_eq_g Xi_in_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">k</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="skolem">i</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_k_eq_i <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="skolem">i</span> <span class="keyword1">*s</span>  <span class="free">Y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> linear_g <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Linear_Maps-matrix'_surj"><span class="command">lemma</span></span> matrix'_surj<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"surj <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> surj_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">=</span> matrix' <span class="free">X</span> <span class="free">Y</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exists_linear_eq_matrix'<span class="main">[</span><span class="operator">OF</span> basis_X basis_Y<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> matrix'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix_change_of_basis_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the first part of the theorem 2.12 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>

<span class="keyword1" id="Linear_Maps-matrix_change_of_basis_works"><span class="command">lemma</span></span> matrix_change_of_basis_works<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">X</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>coord <span class="free">Y</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_mult_sum matrix_change_of_basis_def column_def coord_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">x</span><span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">have</span></span> the_f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> fa f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> the_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> fa g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f g <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="main">(</span>sum  <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t</span> <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> UNIV<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">h</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span><span class="main">$</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_UNIV<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> the_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="skolem">h</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">X</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">h</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> f h <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">g</span> <span class="skolem">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_h h <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span>sum  <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> UNIV<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec.scale_sum_right <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="skolem">t</span> <span class="bound">x</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.swap<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec.scale_sum_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">Y</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_f the_g <span class="keyword1"><span class="command">unfolding</span></span> w_def t_def <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Linear_Maps-matrix_change_of_basis_mat_1"><span class="command">lemma</span></span> matrix_change_of_basis_mat_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free">X</span> <span class="free">X</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_change_of_basis_def coord_def mat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="skolem">j</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">j</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">X</span><span class="main">$</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">X</span><span class="main">$</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> add_left_cancel f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span><span class="main">$</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> the_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">fa</span> <span class="bound">x</span> <span class="keyword1">*s</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_combination_unique<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> fa f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_f f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_f f_def <span class="keyword1"><span class="command">using</span></span> i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Relationships between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix'_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix_change_of_basis_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
      This is the theorem 2.16 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>

<span class="keyword1" id="Linear_Maps-matrix'_matrix_change_of_basis"><span class="command">lemma</span></span> matrix'_matrix_change_of_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B'</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">C</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">C'</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_B'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">B'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> basis_C<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_C'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">C'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="free">B'</span> <span class="free">C'</span> <span class="free">f</span> <span class="main">=</span> matrix_change_of_basis <span class="free">C</span> <span class="free">C'</span> <span class="main">**</span> matrix' <span class="free">B</span> <span class="free">C</span> <span class="free">f</span> <span class="main">**</span> matrix_change_of_basis <span class="free">B'</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>coord <span class="free">B'</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_coord<span class="main">[</span><span class="operator">OF</span> basis_B'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_pointE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free">C</span> <span class="free">C'</span> <span class="main">**</span> matrix' <span class="free">B</span> <span class="free">C</span> <span class="free">f</span><span class="main">**</span> matrix_change_of_basis <span class="free">B'</span> <span class="free">B</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">B'</span> <span class="skolem">v</span><span class="main">)</span> 
    <span class="main">=</span> matrix_change_of_basis <span class="free">C</span> <span class="free">C'</span> <span class="main">**</span> matrix' <span class="free">B</span> <span class="free">C</span> <span class="free">f</span> <span class="keyword1">*v</span> <span class="main">(</span>matrix_change_of_basis <span class="free">B'</span> <span class="free">B</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">B'</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc <span class="keyword1"><span class="command">..</span></span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_change_of_basis <span class="free">C</span> <span class="free">C'</span> <span class="main">**</span> matrix' <span class="free">B</span> <span class="free">C</span> <span class="free">f</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">B</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_change_of_basis_works<span class="main">[</span><span class="operator">OF</span> basis_B' basis_B<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_change_of_basis <span class="free">C</span> <span class="free">C'</span> <span class="keyword1">*v</span> <span class="main">(</span>matrix' <span class="free">B</span> <span class="free">C</span> <span class="free">f</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">B</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_change_of_basis <span class="free">C</span> <span class="free">C'</span> <span class="keyword1">*v</span> <span class="main">(</span>coord <span class="free">C</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coord_matrix'<span class="main">[</span><span class="operator">OF</span> basis_B basis_C linear_f<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coord <span class="free">C'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_change_of_basis_works<span class="main">[</span><span class="operator">OF</span> basis_C basis_C'<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix' <span class="free">B'</span> <span class="free">C'</span> <span class="free">f</span> <span class="keyword1">*v</span> coord <span class="free">B'</span> <span class="skolem">v</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> coord_matrix'<span class="main">[</span><span class="operator">OF</span> basis_B' basis_C' linear_f<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" matrix' <span class="free">B'</span> <span class="free">C'</span> <span class="free">f</span> <span class="keyword1">*v</span> <span class="skolem">x</span> <span class="main">=</span> matrix_change_of_basis <span class="free">C</span> <span class="free">C'</span> <span class="main">**</span> matrix' <span class="free">B</span> <span class="free">C</span> <span class="free">f</span> <span class="main">**</span> matrix_change_of_basis <span class="free">B'</span> <span class="free">B</span> <span class="keyword1">*v</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Maps-matrix'_id_eq_matrix_change_of_basis"><span class="command">lemma</span></span> matrix'_id_eq_matrix_change_of_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">Y</span> <span class="main">(</span>id<span class="main">)</span> <span class="main">=</span> matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix'_def matrix_change_of_basis_def <span class="keyword1"><span class="command">unfolding</span></span> id_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Relationships among <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "invertible_lf_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix_change_of_basis_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix'_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "invertible_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the second part of the theorem 2.12 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>

<span class="keyword1" id="Linear_Maps-matrix_inv_matrix_change_of_basis"><span class="command">lemma</span></span> matrix_inv_matrix_change_of_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span> <span class="main">=</span> matrix_inv <span class="main">(</span>matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_inv_unique<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> linear_id<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec.linear_id<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix' <span class="free">Y</span> <span class="free">X</span> id<span class="main">)</span> <span class="main">**</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> id<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix'_id_eq_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> basis_X basis_Y<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix'_id_eq_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> basis_Y basis_X<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix' <span class="free">X</span> <span class="free">X</span> <span class="main">(</span>id <span class="main">∘</span> id<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix'_compose<span class="main">[</span><span class="operator">OF</span> basis_X basis_Y basis_X linear_id linear_id<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_change_of_basis <span class="free">X</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  matrix'_id_eq_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> basis_X basis_X<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> o_def id_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix_change_of_basis_mat_1<span class="main">[</span><span class="operator">OF</span> basis_X<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span> <span class="main">**</span> matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> id<span class="main">)</span> <span class="main">**</span> <span class="main">(</span>matrix' <span class="free">Y</span> <span class="free">X</span> id<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix'_id_eq_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> basis_X basis_Y<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix'_id_eq_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> basis_Y basis_X<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix' <span class="free">Y</span> <span class="free">Y</span> <span class="main">(</span>id <span class="main">∘</span> id<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix'_compose<span class="main">[</span><span class="operator">OF</span> basis_Y basis_X basis_Y linear_id linear_id<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_change_of_basis <span class="free">Y</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  matrix'_id_eq_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> basis_Y basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> o_def id_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix_change_of_basis_mat_1<span class="main">[</span><span class="operator">OF</span> basis_Y<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span> <span class="main">**</span> matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following four lemmas are the proof of the theorem 2.13 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> invertible_matrix_change_of_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basis_X basis_Y invertible_left_inverse vec.linear_id 
    matrix'_id_eq_matrix_change_of_basis matrix'_matrix_change_of_basis 
    matrix_change_of_basis_mat_1<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-invertible_lf_imp_invertible_matrix'"><span class="command">lemma</span></span> invertible_lf_imp_invertible_matrix'<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'b</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> basis_X basis_Y invertible_lf_def invertible_lf_imp_invertible_matrix
    invertible_matrix_change_of_basis invertible_mult is_basis_cart_basis' matrix'_eq_matrix matrix'_matrix_change_of_basis<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-invertible_matrix'_imp_invertible_lf"><span class="command">lemma</span></span> invertible_matrix'_imp_invertible_lf<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_matrix_iff_invertible_lf'<span class="main">[</span><span class="operator">OF</span> linear_f<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> basis_X basis_Y id_o invertible_matrix_change_of_basis 
     invertible_mult is_basis_cart_basis' linear_f vec.linear_id 
    matrix'_compose matrix'_eq_matrix matrix'_id_eq_matrix_change_of_basis matrix'_matrix_change_of_basis<span class="main">)</span>

<span class="keyword1" id="Linear_Maps-invertible_matrix_is_change_of_basis"><span class="command">lemma</span></span> invertible_matrix_is_change_of_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">Y</span><span class="main">.</span> matrix_change_of_basis <span class="bound">Y</span> <span class="free">X</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> matrix_change_of_basis <span class="bound">Y</span> <span class="free">X</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> matrix' <span class="free">X</span> <span class="free">X</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exists_linear_eq_matrix'<span class="main">[</span><span class="operator">OF</span> basis_X basis_X<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>    
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">χ</span></span> <span class="bound"><span class="bound">j</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">X</span></span><span class="main"><span class="main">$</span></span><span class="bound"><span class="bound">j</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_change_of_basis_def P matrix'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
      <span class="keyword1"><span class="command">have</span></span> invertible_f<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible_lf <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix'_imp_invertible_lf<span class="main">[</span><span class="operator">OF</span> _ basis_X linear_f basis_X<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> invertible_P <span class="keyword1"><span class="command">unfolding</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of_vector <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">`</span><span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_of_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">X</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rw <span class="keyword1"><span class="command">using</span></span> basis_image_linear<span class="main">[</span><span class="operator">OF</span> invertible_f basis_X<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="skolem">Z</span>
  <span class="keyword3"><span class="command">assume</span></span> basis_Y<span class="main">:</span><span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="skolem">Z</span> <span class="free">X</span> <span class="main">=</span> matrix_change_of_basis <span class="skolem">Y</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> basis_Z<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">Z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ZY_coord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> coord <span class="free">X</span> <span class="main">(</span><span class="skolem">Z</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> coord <span class="free">X</span> <span class="main">(</span><span class="skolem">Y</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">unfolding</span></span> matrix_change_of_basis_def <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span><span class="main">=</span><span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ZY_coord coord_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> basis_X<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Equivalent Matrices›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next definition follows the one presented in Modern Algebra by Seth Warner.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">equivalent_matrices</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> invertible <span class="bound">Q</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="bound">P</span><span class="main">)</span><span class="main">**</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">**</span><span class="bound">Q</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Linear_Maps-exists_basis"><span class="command">lemma</span></span> exists_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">.</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_basis_cart_basis' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Maps-equivalent_implies_exist_matrix'"><span class="command">lemma</span></span> equivalent_implies_exist_matrix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equivalent<span class="main">:</span> <span class="quoted"><span class="quoted">"equivalent_matrices <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="bound">Y</span> <span class="bound">X'</span> <span class="bound">Y'</span> <span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">.</span> 
  linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="bound">f</span> <span class="main">∧</span> matrix' <span class="bound">X</span> <span class="bound">Y</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> matrix' <span class="bound">X'</span> <span class="bound">Y'</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">X</span><span class="main">)</span> 
  <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y</span><span class="main">)</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">X'</span><span class="main">)</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exists_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exists_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> B_PAQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span><span class="main">**</span><span class="free">A</span><span class="main">**</span><span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inv_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> equivalent <span class="keyword1"><span class="command">unfolding</span></span> equivalent_matrices_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_A<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix' <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">f</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> exists_linear_eq_matrix'<span class="main">[</span><span class="operator">OF</span> X Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X'</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> X'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">X'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span><span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="skolem">X'</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> invertible_matrix_is_change_of_basis<span class="main">[</span><span class="operator">OF</span> inv_Q X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y'</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'m</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">Y'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="skolem">Y'</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> invertible_matrix_is_change_of_basis<span class="main">[</span><span class="operator">OF</span> inv_P Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> matrix_inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="skolem">Y</span> <span class="skolem">Y'</span> <span class="main">=</span> matrix_inv <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> matrix_inv_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> Y' Y<span class="main">]</span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix' <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="skolem">f</span> <span class="main">=</span> matrix_change_of_basis <span class="skolem">Y</span> <span class="skolem">Y'</span> <span class="main">**</span> matrix' <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">f</span> <span class="main">**</span> matrix_change_of_basis <span class="skolem">X'</span> <span class="skolem">X</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> matrix'_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> X X' Y Y' linear_f<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span> <span class="main">**</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_inv_P f_A Q <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_PAQ <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f_A X X' Y Y' linear_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Linear_Maps-exist_matrix'_implies_equivalent"><span class="command">lemma</span></span> exist_matrix'_implies_equivalent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X'</span> <span class="free">Y'</span> <span class="free">f</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> X'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Y'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equivalent_matrices <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> equivalent_matrices_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free"><span class="free">Y'</span></span> <span class="free"><span class="free">Y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free"><span class="free">X'</span></span> <span class="free"><span class="free">X</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free">Y</span> <span class="free">Y'</span> <span class="main">=</span> matrix_inv <span class="main">(</span>matrix_change_of_basis <span class="free">Y'</span> <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix_inv_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> Y' Y<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix_change_of_basis <span class="free">Y'</span> <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> Y' Y<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix_change_of_basis <span class="free">X'</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> X' X<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> matrix' <span class="free">X'</span> <span class="free">Y'</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  matrix_change_of_basis <span class="free">Y</span> <span class="free">Y'</span> <span class="main">**</span> matrix' <span class="free">X</span> <span class="free">Y</span> <span class="free">f</span> <span class="main">**</span> matrix_change_of_basis <span class="free">X'</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix'_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> X X' Y Y' linear_f<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> matrix_inv <span class="main">(</span>matrix_change_of_basis <span class="free">Y'</span> <span class="free">Y</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span> <span class="main">**</span> matrix_change_of_basis <span class="free">X'</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inv <span class="keyword1"><span class="command">unfolding</span></span> A <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the proof of the theorem 2.18 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> equivalent_iff_exist_matrix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equivalent_matrices <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">X</span> <span class="bound">Y</span> <span class="bound">X'</span> <span class="bound">Y'</span> <span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">.</span> 
  linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="bound">f</span> <span class="main">∧</span> matrix' <span class="bound">X</span> <span class="bound">Y</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> matrix' <span class="bound">X'</span> <span class="bound">Y'</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">B</span> 
  <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">X</span><span class="main">)</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y</span><span class="main">)</span> 
  <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">X'</span><span class="main">)</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exist_matrix'_implies_equivalent equivalent_implies_exist_matrix'<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Similar matrices›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">similar_matrices</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">similar_matrices</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">=</span><span class="main">(</span>matrix_inv <span class="bound">P</span><span class="main">)</span><span class="main">**</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">**</span><span class="bound">P</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Linear_Maps-similar_implies_exist_matrix'"><span class="command">lemma</span></span> similar_implies_exist_matrix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> similar<span class="main">:</span> <span class="quoted"><span class="quoted">"similar_matrices <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="bound">Y</span> <span class="bound">f</span><span class="main">.</span> linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="bound">f</span> <span class="main">∧</span> matrix' <span class="bound">X</span> <span class="bound">X</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> matrix' <span class="bound">Y</span> <span class="bound">Y</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">B</span> 
    <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">X</span><span class="main">)</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B_PAP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span><span class="main">**</span><span class="free">A</span><span class="main">**</span><span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> similar <span class="keyword1"><span class="command">unfolding</span></span> similar_matrices_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exists_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix' <span class="skolem">X</span> <span class="skolem">X</span> <span class="skolem">f</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exists_linear_eq_matrix'<span class="main">[</span><span class="operator">OF</span> X X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> matrix_change_of_basis <span class="skolem">Y</span> <span class="skolem">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_matrix_is_change_of_basis<span class="main">[</span><span class="operator">OF</span> inv_P X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
 <span class="keyword1"><span class="command">have</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_inv <span class="skolem">P</span> <span class="main">=</span> matrix_change_of_basis <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> P X Y matrix_inv_matrix_change_of_basis<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span><span class="main">**</span><span class="free">A</span><span class="main">**</span><span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_PAP <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  matrix_change_of_basis <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">**</span> matrix' <span class="skolem">X</span> <span class="skolem">X</span> <span class="skolem">f</span> <span class="main">**</span> <span class="skolem">P</span> "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P' A <span class="keyword1"><span class="command">..</span></span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_change_of_basis <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">**</span> matrix' <span class="skolem">X</span> <span class="skolem">X</span> <span class="skolem">f</span> <span class="main">**</span> matrix_change_of_basis <span class="skolem">Y</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P <span class="keyword1"><span class="command">..</span></span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix' <span class="skolem">Y</span> <span class="skolem">Y</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix'_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> X Y X Y linear_f<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> X Y A linear_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Linear_Maps-exist_matrix'_implies_similar"><span class="command">lemma</span></span> exist_matrix'_implies_similar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> linear_f<span class="main">:</span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix' <span class="free">X</span> <span class="free">X</span> <span class="free">f</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix' <span class="free">Y</span> <span class="free">Y</span> <span class="free">f</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="main">(</span>set_of_vector <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"similar_matrices <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> similar_matrices_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"matrix_change_of_basis <span class="free"><span class="free">Y</span></span> <span class="free"><span class="free">X</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span>matrix' <span class="free">Y</span> <span class="free">Y</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_change_of_basis <span class="free">X</span> <span class="free">Y</span> <span class="main">**</span> matrix' <span class="free">X</span> <span class="free">X</span> <span class="free">f</span> <span class="main">**</span> matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix'_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> X Y X Y linear_f<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  matrix_inv <span class="main">(</span>matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span> <span class="main">**</span> matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A matrix_inv_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> Y X<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> matrix_inv <span class="main">(</span>matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span> <span class="main">**</span> matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix_change_of_basis <span class="free">Y</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_matrix_change_of_basis<span class="main">[</span><span class="operator">OF</span> Y X<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the proof of the theorem 2.19 in the book "Advanced Linear Algebra" by Steven Roman.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> similar_iff_exist_matrix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"similar_matrices <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">X</span> <span class="bound">Y</span> <span class="bound">f</span><span class="main">.</span> linear <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">(*s)</span><span class="main">)</span> <span class="bound">f</span> <span class="main">∧</span> matrix' <span class="bound">X</span> <span class="bound">X</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">A</span> 
    <span class="main">∧</span> matrix' <span class="bound">Y</span> <span class="bound">Y</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">X</span><span class="main">)</span> <span class="main">∧</span> is_basis <span class="main">(</span>set_of_vector <span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exist_matrix'_implies_similar similar_implies_exist_matrix'<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gauss_Jordan_PA">
<div class="head">
<h1>Theory Gauss_Jordan_PA</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Gauss_Jordan_PA.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Obtaining explicitly the invertible matrix which transforms a matrix to its reduced row echelon form›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Gauss_Jordan_PA
<span class="keyword2"><span class="keyword">imports</span></span>
 <a href="Gauss_Jordan.html">Gauss_Jordan</a>
 <a href="../Rank_Nullity_Theorem/Miscellaneous.html">Rank_Nullity_Theorem.Miscellaneous</a>
 <a href="Linear_Maps.html">Linear_Maps</a> <span class="comment1">(*Really, this file is not necessary, but it contains interesting properties about linear maps.*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following algorithm is similar to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
but in this case we will also return the P matrix which makes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">**</span></span> <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. If A is invertible, this matrix P will be the inverse of it.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_in_ij_PA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">,</span> inverse<span class="main">,</span> one<span class="main">,</span> uminus<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'rows</span><span class="main">=&gt;</span><span class="tfree">'cols</span>
  <span class="main">=&gt;</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_in_ij_PA</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">P</span><span class="main">=</span>fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">A</span><span class="main">=</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span>
                                        <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">interchange_A</span> <span class="main">=</span> <span class="main">(</span>interchange_rows <span class="bound">A</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">interchange_P</span> <span class="main">=</span> <span class="main">(</span>interchange_rows <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">P'</span> <span class="main">=</span> mult_row <span class="bound">interchange_P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="bound">interchange_A</span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>
                                        <span class="keyword1">in</span>                                        
                                       <span class="main">(</span>vec_lambda<span class="main">(</span><span class="main">%</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="bound">P'</span> <span class="main">$</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="bound">P'</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="bound">interchange_A</span><span class="main">$</span><span class="bound">s</span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span> Gauss_Jordan_in_ij <span class="bound">A</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_column_k_PA</span>  
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_column_k_PA</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">P</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span>
         <span class="bound">i</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span>
         <span class="bound">A</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span>
         <span class="bound">from_nat_i</span><span class="main">=</span>from_nat <span class="bound">i</span><span class="main">;</span>
         <span class="bound">from_nat_k</span><span class="main">=</span>from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span>
         <span class="keyword1">in</span> 
         <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">from_nat_i</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="bound">from_nat_k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> nrows <span class="bound">A</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">P</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Gauss</span> <span class="main">=</span> Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">(</span><span class="bound">from_nat_i</span><span class="main">)</span> <span class="main">(</span><span class="bound">from_nat_k</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">Gauss</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> snd <span class="bound">Gauss</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_upt_k_PA</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">foldl</span><span class="main">=</span><span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">foldl</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="bound">foldl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_PA</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Gauss_Jordan_upt_k_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas are very important in order to improve the efficience of the code›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define the following function to obtain an efficient code for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_PA <span class="free"><span class="free">A</span></span> <span class="free"><span class="free">i</span></span> <span class="free"><span class="free">j</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_wrapper</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> vec_lambda<span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">$</span><span class="bound">s</span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-Gauss_Jordan_wrapper_code"><span class="command">lemma</span></span> Gauss_Jordan_wrapper_code<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>Gauss_Jordan_wrapper <span class="free">i</span> <span class="free">j</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span><span class="main">=</span><span class="free">i</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="free">A</span> <span class="bound">s</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">B</span><span class="main">$</span><span class="bound">s</span><span class="main">$</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_wrapper_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Gauss_Jordan_PA-Gauss_Jordan_in_ij_PA_def'"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_PA_def'<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_PA <span class="free">A'</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">P</span><span class="main">=</span>fst <span class="free">A'</span><span class="main">;</span> <span class="bound">A</span><span class="main">=</span>snd <span class="free">A'</span><span class="main">;</span>
                                        <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">interchange_A</span> <span class="main">=</span> <span class="main">(</span>interchange_rows <span class="bound">A</span> <span class="free">i</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">A'</span> <span class="main">=</span> mult_row <span class="bound">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="bound">interchange_A</span><span class="main">$</span><span class="free">i</span><span class="main">$</span><span class="free">j</span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">interchange_P</span> <span class="main">=</span> <span class="main">(</span>interchange_rows <span class="bound">P</span> <span class="free">i</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">P'</span> <span class="main">=</span> mult_row <span class="bound">interchange_P</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="bound">interchange_A</span><span class="main">$</span><span class="free">i</span><span class="main">$</span><span class="free">j</span><span class="main">)</span>
                                        <span class="keyword1">in</span>                                       
                                       <span class="main">(</span>Gauss_Jordan_wrapper <span class="free">i</span> <span class="free">j</span> <span class="bound">P'</span> <span class="bound">interchange_A</span><span class="main">,</span> 
                                        Gauss_Jordan_wrapper <span class="free">i</span> <span class="free">j</span> <span class="bound">A'</span> <span class="bound">interchange_A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_PA_def Gauss_Jordan_in_ij_def Let_def Gauss_Jordan_wrapper_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The second component is equal to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1" id="Gauss_Jordan_PA-snd_Gauss_Jordan_in_ij_PA_eq"><span class="command">lemma</span></span> snd_Gauss_Jordan_in_ij_PA_eq<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_PA_def Let_def snd_conv <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-fst_Gauss_Jordan_in_ij_PA"><span class="command">lemma</span></span> fst_Gauss_Jordan_in_ij_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> PB_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">**</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">**</span> <span class="free">B</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_PA_def' Gauss_Jordan_wrapper_def Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2 3 4 5 6 7 8 9 10<span class="main"><span class="main">)</span></span> interchange_rows_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> vec_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">χ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span>
              <span class="keyword1">else</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span> <span class="free">i</span>
              <span class="main">(</span><span class="main">-</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span>
              mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>
<span class="main">**</span> <span class="free">B</span> <span class="main">=</span> mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> PB_A<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> mult_row_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> matrix_mul_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mult_row <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">ia</span> <span class="bound">ja</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ia</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">P</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="bound">ja</span><span class="main">)</span> <span class="free">i</span>
                     <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">1</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span>
                     mult_row <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">ia</span> <span class="bound">ja</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="bound">ia</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="bound">ja</span><span class="main">)</span> <span class="free">i</span>
                     <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> mat <span class="main">1</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_matrix_mult_def
<span class="keyword1"><span class="command">unfolding</span></span> vec_lambda_beta <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_i <span class="keyword1"><span class="command">using</span></span> sum.cong
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> vec_lambda_beta<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="keyword3"><span class="command">assume</span></span> ia_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">χ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span>
             <span class="bound">s</span> <span class="keyword1">else</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span>
             <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span>
<span class="main">(</span><span class="main">(</span><span class="keyword1">χ</span> <span class="bound">s</span><span class="main">.</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span>
             <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> row_matrix_matrix_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> ia_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ia</span> <span class="free">i</span>
     <span class="main">(</span><span class="main">-</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="keyword1">v*</span> <span class="free">B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> row_matrix_matrix_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ia</span> <span class="free">i</span>
             <span class="main">(</span><span class="main">-</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> PB_A<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> mult_row_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> row_add_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_mul_assoc
<span class="keyword1"><span class="command">unfolding</span></span> row_matrix_matrix_mult <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">χ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span>
        <span class="keyword1">else</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span> <span class="free">i</span>
              <span class="main">(</span><span class="main">-</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span>
  row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ia</span> <span class="free">i</span>
   <span class="main">(</span><span class="main">-</span> <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_column_k_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1" id="Gauss_Jordan_PA-fst_Gauss_Jordan_column_k"><span class="command">lemma</span></span> fst_Gauss_Jordan_column_k<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gauss_Jordan_PA-fst_Gauss_Jordan_column_k_PA"><span class="command">lemma</span></span> fst_Gauss_Jordan_column_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> PB_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">**</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">**</span> <span class="free">B</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_PA_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def
<span class="keyword1"><span class="command">unfolding</span></span> fst_conv snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms fst_Gauss_Jordan_in_ij_PA<span class="main">)</span>

<span class="keyword1" id="Gauss_Jordan_PA-snd_snd_Gauss_Jordan_column_k_PA_eq"><span class="command">lemma</span></span> snd_snd_Gauss_Jordan_column_k_PA_eq<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_PA_def Gauss_Jordan_column_k_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def snd_conv fst_conv <span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_in_ij_PA_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gauss_Jordan_PA-fst_snd_Gauss_Jordan_column_k_PA_eq"><span class="command">lemma</span></span> fst_snd_Gauss_Jordan_column_k_PA_eq<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_PA_def Gauss_Jordan_column_k_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def snd_conv fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_upt_k_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-fst_Gauss_Jordan_upt_k_PA"><span class="command">lemma</span></span> fst_Gauss_Jordan_upt_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv snd_conv
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> snd_snd_Gauss_Jordan_column_k_PA_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_Gauss_Jordan_column_k_PA matrix_mul_lid snd_snd_Gauss_Jordan_column_k_PA_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv snd_conv
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw <span class="keyword1"><span class="command">unfolding</span></span> foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">[</span><span class="operator">unfolded</span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv snd_conv<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_Gauss_Jordan_column_k_PA prod.collapse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-snd_foldl_Gauss_Jordan_column_k_eq"><span class="command">lemma</span></span> snd_foldl_Gauss_Jordan_column_k_eq<span class="main">:</span>
<span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps fst_snd_Gauss_Jordan_column_k_PA_eq snd_snd_Gauss_Jordan_column_k_PA_eq surjective_pairing<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-snd_Gauss_Jordan_upt_k_PA"><span class="command">lemma</span></span> snd_Gauss_Jordan_upt_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Gauss_Jordan_upt_k_def Let_def
<span class="keyword1"><span class="command">using</span></span> snd_foldl_Gauss_Jordan_column_k_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-fst_Gauss_Jordan_PA"><span class="command">lemma</span></span> fst_Gauss_Jordan_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_def <span class="keyword1"><span class="command">using</span></span> fst_Gauss_Jordan_upt_k_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Gauss_Jordan_PA-Gauss_Jordan_PA_eq"><span class="command">lemma</span></span> Gauss_Jordan_PA_eq<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_Jordan_PA_def Gauss_Jordan_def snd_Gauss_Jordan_upt_k_PA<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proving that the transformation has been carried out by means of elementary operations›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This function is very similar to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"row_add_iterate"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> one. It allows us to prove that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"fst <span class="main"><span class="main">(</span></span>Gauss_Jordan_PA <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an invertible matrix.
Concretly, it has been defined to demonstrate that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"fst <span class="main"><span class="main">(</span></span>Gauss_Jordan_PA <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has been obtained by means of elementary operations applied to the identity matrix›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">row_add_iterate_PA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">,</span> uminus<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'n</span> <span class="main">=&gt;</span> 
    <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_add_iterate_PA</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>row_add <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">,</span> row_add <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">row_add_iterate_PA</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> to_nat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">row_add_iterate_PA</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span>
                  <span class="keyword1">else</span> <span class="free">row_add_iterate_PA</span> <span class="main">(</span><span class="main">(</span>row_add <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>row_add <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-fst_row_add_iterate_PA_preserves_greater_than_n"><span class="command">lemma</span></span> fst_row_add_iterate_PA_preserves_greater_than_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">P</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> to_nat_0<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"row_add <span class="skolem">P</span> <span class="main">0</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> row_add_iterate_A<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> row_add_iterate_A <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> row_add <span class="skolem">P</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> row_add_iterate_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span><span class="skolem">A'</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> from_nat_not_a<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_not_refl Suc.prems to_nat_from_nat_id nrows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> row_add_iterate_A'<span class="main">[</span><span class="operator">unfolded</span> A'_def P'_def<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> from_nat_not_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan_PA-snd_row_add_iterate_PA_eq_row_add_iterate"><span class="command">lemma</span></span> snd_row_add_iterate_PA_eq_row_add_iterate<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>  <span class="main">=</span> row_add_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps row_add_iterate.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps row_add_iterate.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-row_add_iterate_PA_preserves_pivot_row"><span class="command">lemma</span></span> row_add_iterate_PA_preserves_pivot_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">P</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fst_conv le_0_eq row_add_iterate_PA.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> to_nat_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fst_row_add_iterate_PA_preserves_greater_than_n<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc_lessD<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> row_add <span class="skolem">P</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> from_nat_noteq_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> False Suc.prems<span class="main">(</span>1<span class="main">)</span> from_nat_not_eq <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="skolem">A'</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps <span class="keyword1"><span class="command">unfolding</span></span> if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> hyp<span class="main">[</span><span class="operator">unfolded</span> A'_def P'_def<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> from_nat_noteq_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan_PA-fst_row_add_iterate_PA_eq_row_add"><span class="command">lemma</span></span> fst_row_add_iterate_PA_eq_row_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>row_add <span class="free">P</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> a_not_i fst_conv le_0_eq row_add_iterate_PA.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> to_nat_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_not_i<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc_lessD<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> True a_not_i le_SucE to_nat_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> Suc_n_not_i<span class="main">=</span>False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span><span class="main">)</span> 
<span class="keyword3"><span class="command">case</span></span> True
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">P</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_lessD True order_refl less_imp_le fst_row_add_iterate_PA_preserves_greater_than_n Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> to_nat_from_nat nrows_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> row_add <span class="skolem">P</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span><span class="skolem">A'</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">P'</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False Suc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> P'_def row_add_def <span class="keyword1"><span class="command">using</span></span> False Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> A'_def row_add_def <span class="keyword1"><span class="command">using</span></span> False Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rw3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> P'_def row_add_def <span class="keyword1"><span class="command">using</span></span> False Suc.prems Suc_n_not_i <span class="keyword1"><span class="command">unfolding</span></span> nrows_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> row_add <span class="skolem">P</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_not_P<span class="main">[</span><span class="operator">OF</span> Suc_n_not_i<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> rw<span class="main">[</span><span class="operator">unfolded</span> P'_def A'_def<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> A'_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> P'_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">unfolding</span></span> rw1 rw2 rw3 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="Gauss_Jordan_PA-fst_row_add_iterate_PA_eq_fst_Gauss_Jordan_in_ij_PA"><span class="command">lemma</span></span> fst_row_add_iterate_PA_eq_fst_Gauss_Jordan_in_ij_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'rows</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'cols</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A'</span><span class="main">==</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span><span class="main">==</span> mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P'</span><span class="main">,</span><span class="free">A'</span><span class="main">)</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>  <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_PA_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
<span class="keyword1"><span class="command">have</span></span> interchange_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> interchange_rows_j<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P'</span><span class="main">,</span> <span class="free">A'</span><span class="main">)</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span>
         mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> A' P' interchange_rw
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> row_add_iterate_PA_preserves_pivot_row<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> nrows_def<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred leD not_less_eq_eq to_nat_less_card zero_less_card_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">iaa</span>
 <span class="keyword1"><span class="command">have</span></span> interchange_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> interchange_rows_j<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> ia_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">-</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def mult_row_def <span class="keyword1"><span class="command">using</span></span> ia_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P'</span><span class="main">,</span> <span class="free">A'</span><span class="main">)</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">iaa</span> 
    <span class="main">=</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ia</span> <span class="free">i</span>
    <span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">iaa</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> interchange_rw <span class="keyword1"><span class="command">unfolding</span></span> A' P' <span class="keyword1"><span class="command">unfolding</span></span> rw
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fst_row_add_iterate_PA_eq_row_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> nrows_def<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia_not_i <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_less_card_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ia</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred leD not_less_eq_eq to_nat_less_card zero_less_card_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan_PA-invertible_fst_row_add_iterate_PA"><span class="command">lemma</span></span> invertible_fst_row_add_iterate_PA<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n inv_P
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> row_add_iterate_PA.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"0.prems"</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> i_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_add <span class="skolem">P</span> <span class="main">0</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> row_add <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="main">0</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">**</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_mat_1 <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>row_add <span class="skolem">P</span> <span class="main">0</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> row_add_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_row_add<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> i_not_0 <span class="quoted">"0.prems"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> row_add_iterate_PA.simps if_not_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Suc.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> nrows_def<span class="main">)</span>
             <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>row_add <span class="skolem">P</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> row_add_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_row_add<span class="main">)</span>
                   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False Suc.prems<span class="main">(</span>1<span class="main">)</span> from_nat_not_eq <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan_PA-invertible_fst_Gauss_Jordan_in_ij_PA"><span class="command">lemma</span></span> invertible_fst_Gauss_Jordan_in_ij_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> fst_row_add_iterate_PA_eq_fst_Gauss_Jordan_in_ij_PA<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_fst_row_add_iterate_PA<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def<span class="main"><span class="keyword3">,</span></span> 
<span class="operator">subst</span> interchange_rows_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult_row_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_mult<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>mult_row <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_mult_row'<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> LeastI_ex not_all_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inverse_eq_divide<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> nonzero_imp_inverse_nonzero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_interchange_rows<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inv_P<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan_PA-invertible_fst_Gauss_Jordan_column_k_PA"><span class="command">lemma</span></span> invertible_fst_Gauss_Jordan_column_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_column_k_PA_def Let_def snd_conv fst_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_P<span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
<span class="keyword3"><span class="command">assume</span></span> i_less_m<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Amk_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_fst_Gauss_Jordan_in_ij_PA<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inv_P<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> i_less_m Amk_not_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-invertible_fst_Gauss_Jordan_upt_k_PA"><span class="command">lemma</span></span> invertible_fst_Gauss_Jordan_upt_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_fst_Gauss_Jordan_column_k_PA invertible_mat_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> list_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> f_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> list_rw <span class="keyword1"><span class="command">unfolding</span></span> foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command">using</span></span> invertible_fst_Gauss_Jordan_column_k_PA
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Gauss_Jordan_upt_k_PA_def Suc.hyps fst_conv prod.collapse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_PA-invertible_fst_Gauss_Jordan_PA"><span class="command">lemma</span></span> invertible_fst_Gauss_Jordan_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_PA_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_fst_Gauss_Jordan_upt_k_PA<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">P_Gauss_Jordan</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Determinants2">
<div class="head">
<h1>Theory Determinants2</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Determinants2.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Computing determinants of matrices using the Gauss Jordan algorithm›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Determinants2
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Gauss_Jordan_PA.html">Gauss_Jordan_PA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some previous properties›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Relationships between determinants and elementary row operations›</span></span>

<span class="keyword1" id="Determinants2-det_interchange_rows"><span class="command">lemma</span></span> det_interchange_rows<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">a</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>Fun.swap <span class="free">i</span> <span class="free">j</span> id<span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def Fun.swap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"det<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">a</span><span class="main">.</span> <span class="free">A</span><span class="main">$</span><span class="main">(</span>Fun.swap <span class="free">i</span> <span class="free">j</span> id<span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span>sign <span class="main">(</span>Fun.swap <span class="free">i</span> <span class="free">j</span> id<span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_permute_rows<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Fun.swap <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="free"><span class="free"><span class="free">j</span></span></span> id"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_swap_id<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_swap_id <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> det_interchange_different_rows<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_interchange_rows <span class="keyword1"><span class="command">using</span></span> i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> det_interchange_same_rows<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i_eq_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_interchange_rows <span class="keyword1"><span class="command">using</span></span> i_eq_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Determinants2-det_mult_row"><span class="command">lemma</span></span> det_mult_row<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> A_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">A</span><span class="main">$</span><span class="free">a</span> <span class="keyword1">else</span> <span class="free">A</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mult_row <span class="free">A</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="keyword1">*s</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"det<span class="main">(</span>mult_row <span class="free">A</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> det<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="keyword1">*s</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">k</span> <span class="main">*</span> det<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">A</span><span class="main">$</span><span class="free">a</span> <span class="keyword1">else</span> <span class="free">A</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_row_mul <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_rw <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*The name det_row_add is already used in the Determinants.thy file of the standard library*)</span>
<span class="keyword1" id="Determinants2-det_row_add'"><span class="command">lemma</span></span> det_row_add'<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>row_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> row <span class="free">i</span> <span class="free">A</span> <span class="main">+</span> <span class="free">q</span> <span class="keyword1">*s</span> row <span class="free">j</span> <span class="free">A</span> <span class="keyword1">else</span> row <span class="bound">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> row_add_def row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"det<span class="main">(</span>row_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> det<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> row <span class="free">i</span> <span class="free">A</span> <span class="main">+</span> <span class="free">q</span> <span class="keyword1">*s</span> row <span class="free">j</span> <span class="free">A</span> <span class="keyword1">else</span> row <span class="bound">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_row_operation<span class="main">[</span><span class="operator">OF</span> i_not_j<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Relationships between determinants and elementary column operations›</span></span>

<span class="keyword1" id="Determinants2-det_interchange_columns"><span class="command">lemma</span></span> det_interchange_columns<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">$</span> <span class="main">(</span>Fun.swap <span class="free">i</span> <span class="free">j</span> id<span class="main">)</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> interchange_columns_def Fun.swap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"det<span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">$</span> <span class="main">(</span>Fun.swap <span class="free">i</span> <span class="free">j</span> id<span class="main">)</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span>sign <span class="main">(</span>Fun.swap <span class="free">i</span> <span class="free">j</span> id<span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_permute_columns<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Fun.swap <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="free"><span class="free"><span class="free">j</span></span></span> id"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_swap_id<span class="main">)</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_swap_id <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> det_interchange_different_columns<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_interchange_columns <span class="keyword1"><span class="command">using</span></span> i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> det_interchange_same_columns<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i_eq_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_interchange_columns <span class="keyword1"><span class="command">using</span></span> i_eq_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Determinants2-det_mult_columns"><span class="command">lemma</span></span> det_mult_columns<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>mult_column <span class="free">A</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_column <span class="free">A</span> <span class="free">a</span> <span class="free">k</span> <span class="main">=</span> transpose <span class="main">(</span>mult_row <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> transpose_def mult_row_def mult_column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>mult_column <span class="free">A</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>transpose <span class="main">(</span>mult_row <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="main">(</span>mult_row <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">a</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_transpose <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> det <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_mult_row <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_transpose <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Determinants2-det_column_add"><span class="command">lemma</span></span> det_column_add<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>column_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>column_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>transpose <span class="main">(</span>row_add <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> transpose_def column_add_def row_add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>column_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>transpose <span class="main">(</span>row_add <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="main">(</span>row_add <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_transpose <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_row_add'<span class="main">[</span><span class="operator">OF</span> i_not_j<span class="main">]</span> det_transpose <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proving that the determinant can be computed by means of the Gauss Jordan algorithm›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Previous properties›</span></span>

<span class="keyword1" id="Determinants2-det_row_add_iterate_upt_n"><span class="command">lemma</span></span> det_row_add_iterate_upt_n<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>row_add_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps <span class="keyword1"><span class="command">using</span></span> det_row_add'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate.simps
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>row_add_iterate <span class="skolem">A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">assume</span></span> Suc_n_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">≠</span> to_nat <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>row_add_iterate <span class="main">(</span>row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> 
<span class="main">=</span> det <span class="main">(</span>row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> nrows_def<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_row_add'<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Suc_n_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>row_add_iterate <span class="main">(</span>row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> det_row_add_iterate<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>row_add_iterate <span class="free">A</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> det_row_add_iterate_upt_n diff_less neq0_conv nrows_not_0 zero_less_one<span class="main">)</span>



<span class="keyword1" id="Determinants2-det_Gauss_Jordan_in_ij"><span class="command">lemma</span></span> det_Gauss_Jordan_in_ij<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A'</span><span class="main">==</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A'</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> nrows_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows <span class="free">A'</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_add_iterate <span class="free">A'</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span>  <span class="main">=</span>  Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> row_add_iterate_eq_Gauss_Jordan_in_ij  <span class="keyword1"><span class="command">unfolding</span></span> A' <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>row_add_iterate <span class="free">A'</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="free">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_row_add_iterate<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A'</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> nrows_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants2-det_Gauss_Jordan_in_ij_1"><span class="command">lemma</span></span> det_Gauss_Jordan_in_ij_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A'</span><span class="main">==</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="free">i</span><span class="main">$</span><span class="free">j</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A'</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> det_Gauss_Jordan_in_ij <span class="keyword1"><span class="command">unfolding</span></span> A' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="free">i</span><span class="main">$</span><span class="free">j</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A' det_mult_row <span class="keyword1"><span class="command">unfolding</span></span> i det_interchange_rows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants2-det_Gauss_Jordan_in_ij_2"><span class="command">lemma</span></span> det_Gauss_Jordan_in_ij_2<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span>"</span></span>
<span class="keyword2"><span class="keyword">defines</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A'</span><span class="main">==</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A'</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> det_Gauss_Jordan_in_ij <span class="keyword1"><span class="command">unfolding</span></span> A' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">A</span><span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span><span class="free">j</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A' det_mult_row <span class="keyword1"><span class="command">unfolding</span></span> det_interchange_rows <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following definitions allow the computation of the determinant of a matrix using the Gauss-Jordan algorithm. In the first component the determinant of each transformation
is accumulated and the second component contains the matrix transformed into a reduced row echelon form matrix›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_in_ij_det_P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">,</span> inverse<span class="main">,</span> one<span class="main">,</span> uminus<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">=&gt;</span> <span class="tfree">'n</span><span class="main">=&gt;</span><span class="tfree">'m</span><span class="main">=&gt;</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_in_ij_det_P</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">,</span> Gauss_Jordan_in_ij <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_column_k_det_P</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_column_k_det_P</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">let</span> <span class="bound">det_P</span><span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">i</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">A</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">from_nat_i</span> <span class="main">=</span> from_nat <span class="bound">i</span><span class="main">;</span> <span class="bound">from_nat_k</span> <span class="main">=</span> from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span>
 <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">from_nat_i</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="bound">from_nat_k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> nrows <span class="bound">A</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">det_P</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">gauss</span> <span class="main">=</span> Gauss_Jordan_in_ij_det_P <span class="bound">A</span> <span class="main">(</span><span class="bound">from_nat_i</span><span class="main">)</span> <span class="main">(</span><span class="bound">from_nat_k</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">gauss</span> <span class="main">*</span> <span class="bound">det_P</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> snd <span class="bound">gauss</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_upt_k_det_P</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_upt_k_det_P</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">foldl</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">foldl</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="bound">foldl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_det_P</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_det_P</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Gauss_Jordan_upt_k_det_P <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is an equivalent definition created to achieve a more efficient computation.›</span></span>
<span class="keyword1" id="Determinants2-Gauss_Jordan_in_ij_det_P_code"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_det_P_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
         <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="bound">n</span><span class="main">;</span>
         <span class="bound">A'</span> <span class="main">=</span> mult_row <span class="bound">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">interchange_A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> Gauss_Jordan_wrapper <span class="free">i</span> <span class="free">j</span> <span class="bound">A'</span> <span class="bound">interchange_A</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_det_P_def Gauss_Jordan_in_ij_def Gauss_Jordan_wrapper_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Determinants2-det_Gauss_Jordan_in_ij_det_P"><span class="command">lemma</span></span> det_Gauss_Jordan_in_ij_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span>  <span class="main">=</span> det <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_det_P_def Let_def fst_conv snd_conv
<span class="keyword1"><span class="command">using</span></span> det_Gauss_Jordan_in_ij_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> det_Gauss_Jordan_in_ij_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Determinants2-det_Gauss_Jordan_column_k_det_P"><span class="command">lemma</span></span> det_Gauss_Jordan_column_k_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">det_P</span> <span class="main">*</span> det <span class="free">B</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">det_P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">B</span> <span class="main">=</span> det <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">det_P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_column_k_det_P_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
<span class="keyword3"><span class="command">assume</span></span> i_not_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i_less_m<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Amk_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">det_P</span> <span class="main">*</span> det <span class="free">B</span> <span class="main">=</span>
        det <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult.assoc det 
        <span class="keyword1"><span class="command">unfolding</span></span> det_Gauss_Jordan_in_ij_det_P <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants2-det_Gauss_Jordan_upt_k_det_P"><span class="command">lemma</span></span> det_Gauss_Jordan_upt_k_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span> <span class="main">=</span> det <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Let_def <span class="keyword1"><span class="command">unfolding</span></span> fst_conv snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>det_Gauss_Jordan_column_k_det_P<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> fold_expand<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> 
<span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  snd <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Let_def 
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append List.foldl.simps fst_conv snd_conv
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> fold_expand<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> det_Gauss_Jordan_column_k_det_P<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Gauss_Jordan_upt_k_det_P_def Let_def fst_conv snd_conv<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants2-det_Gauss_Jordan_det_P"><span class="command">lemma</span></span> det_Gauss_Jordan_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span> <span class="main">=</span> det <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> det_Gauss_Jordan_upt_k_det_P <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_det_P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upper_triangular_upt_k</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper_triangular_upt_k</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span><span class="bound">i</span> <span class="main">∧</span> to_nat <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upper_triangular</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper_triangular</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span><span class="bound">i</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Determinants2-upper_triangular_upt_imp_upper_triangular"><span class="command">lemma</span></span> upper_triangular_upt_imp_upper_triangular<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"upper_triangular_upt_k <span class="free">A</span> <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def upper_triangular_def nrows_def
<span class="keyword1"><span class="command">using</span></span> to_nat_less_card<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Determinants2-rref_imp_upper_triagular_upt"><span class="command">lemma</span></span> rref_imp_upper_triagular_upt<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
<span class="keyword3"><span class="command">assume</span></span> j_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_less_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def <span class="keyword1"><span class="command">using</span></span> j_less_i True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> j_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_less_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> rref_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rref_implies_rref_upt<span class="main">)</span>
 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id j_eq_k<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> zero_i_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="skolem">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Suc.hyps leD le_less_linear less_imp_le j_eq_k j_less_i le_trans to_nat_mono' upper_triangular_upt_k_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> not_zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> j_eq_k lessI to_nat_from_nat<span class="main">)</span>      
      <span class="keyword1"><span class="command">have</span></span> Least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
           <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
           <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> from_nat <span class="skolem">k</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_def not_le_imp_less to_nat_le zero_i_k<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> i_not_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> from_nat <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl from_nat_to_nat_id j_eq_k j_less_i<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4_explicit<span class="main">[</span><span class="operator">OF</span> rref_suc not_zero_i_suc_k i_not_k<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Least_eq 
      <span class="keyword1"><span class="command">using</span></span> rref_upt_condition1_explicit<span class="main">[</span><span class="operator">OF</span> rref_suc<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> leD not_le_imp_less is_zero_row_upt_k_def is_zero_row_upt_k_suc j_eq_k j_less_i not_zero_i_suc_k to_nat_from_nat to_nat_mono'<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Determinants2-rref_imp_upper_triagular"><span class="command">lemma</span></span> rref_imp_upper_triagular<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rref_imp_upper_triagular_upt upper_triangular_upt_imp_upper_triangular<span class="main">)</span>


<span class="keyword1" id="Determinants2-det_Gauss_Jordan"><span class="command">lemma</span></span> det_Gauss_Jordan<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> det_upperdiagonal rref_imp_upper_triagular<span class="main">[</span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Determinants2-snd_Gauss_Jordan_in_ij_det_P_is_snd_Gauss_Jordan_in_ij_PA"><span class="command">lemma</span></span> snd_Gauss_Jordan_in_ij_det_P_is_snd_Gauss_Jordan_in_ij_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_det_P_def Gauss_Jordan_in_ij_PA_def 
<span class="keyword1"><span class="command">unfolding</span></span>  Gauss_Jordan_in_ij_def Let_def snd_conv fst_conv <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1" id="Determinants2-snd_Gauss_Jordan_column_k_det_P_is_snd_Gauss_Jordan_column_k_PA"><span class="command">lemma</span></span> snd_Gauss_Jordan_column_k_det_P_is_snd_Gauss_Jordan_column_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_PA_def Let_def snd_conv <span class="keyword1"><span class="command">unfolding</span></span> fst_conv
<span class="keyword1"><span class="command">using</span></span> snd_Gauss_Jordan_in_ij_det_P_is_snd_Gauss_Jordan_in_ij_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Determinants2-det_fst_row_add_iterate_PA"><span class="command">lemma</span></span> det_fst_row_add_iterate_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> det <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps <span class="keyword1"><span class="command">using</span></span> det_row_add'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>nrows <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False 
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> row_add <span class="skolem">P</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span> nrows <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="skolem">A'</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_iterate_PA.simps if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> P'_def A'_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">[</span><span class="operator">OF</span> n2<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_row_add'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Determinants2-det_fst_Gauss_Jordan_in_ij_PA_eq_fst_Gauss_Jordan_in_ij_det_P"><span class="command">lemma</span></span> det_fst_Gauss_Jordan_in_ij_PA_eq_fst_Gauss_Jordan_in_ij_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> det <span class="free">P</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>row_add_iterate_PA <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span><span class="skolem">A'</span><span class="main">)</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_row_add_iterate_PA_eq_fst_Gauss_Jordan_in_ij_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> A'_def P'_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> det <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_fst_row_add_iterate_PA<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def<span class="main">)</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> det <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> P'_def <span class="keyword1"><span class="command">unfolding</span></span> True<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> interchange_same_rows <span class="keyword1"><span class="command">unfolding</span></span> det_mult_row <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> P'_def <span class="keyword1"><span class="command">unfolding</span></span> det_mult_row <span class="keyword1"><span class="command">unfolding</span></span> det_interchange_different_rows<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> det <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_det_P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants2-det_fst_Gauss_Jordan_column_k_PA_eq_fst_Gauss_Jordan_column_k_det_P"><span class="command">lemma</span></span> det_fst_Gauss_Jordan_column_k_PA_eq_fst_Gauss_Jordan_column_k_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span>det <span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_PA_def Let_def snd_conv fst_conv
<span class="keyword1"><span class="command">using</span></span> det_fst_Gauss_Jordan_in_ij_PA_eq_fst_Gauss_Jordan_in_ij_det_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Determinants2-fst_snd_Gauss_Jordan_column_k_det_P_eq_fst_snd_Gauss_Jordan_column_k_PA"><span class="command">lemma</span></span> fst_snd_Gauss_Jordan_column_k_det_P_eq_fst_snd_Gauss_Jordan_column_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_PA_def Let_def snd_conv fst_conv
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The way of proving the following lemma is very similar to the demonstration of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "rref_and_index_Gauss_Jordan_upt_k"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Determinants2-foldl_Gauss_Jordan_column_k_det_P"><span class="command">lemma</span></span> foldl_Gauss_Jordan_column_k_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> det_fst_Gauss_Jordan_upt_k_PA_eq_fst_Gauss_Jordan_upt_k_det_P<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> snd_Gauss_Jordan_upt_k_det_P_is_snd_Gauss_Jordan_upt_k_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> fst_snd_foldl_Gauss_det_P_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_PA_def Let_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> det_fst_Gauss_Jordan_column_k_PA_eq_fst_Gauss_Jordan_column_k_det_P det_I<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_PA_def Let_def snd_conv
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> snd_Gauss_Jordan_column_k_det_P_is_snd_Gauss_Jordan_column_k_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_PA_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">using</span></span> fst_snd_Gauss_Jordan_column_k_det_P_eq_fst_snd_Gauss_Jordan_column_k_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
<span class="keyword3"><span class="command">assume</span></span> hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp3<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> list_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> det_mat_nn<span class="main">:</span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> det_I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> f_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">,</span> snd<span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> g_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">g</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span><span class="main">,</span> snd<span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> fst_snd<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> hyp3 <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_PA_def Let_def fst_conv snd_conv <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> snd_snd<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> hyp2 <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_PA_def Let_def fst_conv snd_conv <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> fst_det<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">f</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> hyp1 <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_PA_def Let_def fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
        fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def  
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
<span class="keyword1"><span class="command">unfolding</span></span> f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> g_rw<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_snd snd_snd fst_det
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_fst_Gauss_Jordan_column_k_PA_eq_fst_Gauss_Jordan_column_k_det_P<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def  
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
<span class="keyword1"><span class="command">unfolding</span></span> f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> g_rw<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_snd snd_snd fst_det
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_snd prod.collapse snd_Gauss_Jordan_column_k_det_P_is_snd_Gauss_Jordan_column_k_PA snd_eqD snd_snd<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def  
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
<span class="keyword1"><span class="command">unfolding</span></span> f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> g_rw<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_snd snd_snd fst_det <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fst_snd_Gauss_Jordan_column_k_det_P_eq_fst_snd_Gauss_Jordan_column_k_PA<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Determinants2-snd_Gauss_Jordan_det_P_is_Gauss_Jordan"><span class="command">lemma</span></span> snd_Gauss_Jordan_det_P_is_Gauss_Jordan<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_det_P_def Gauss_Jordan_def <span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_upt_k_det_P_is_snd_Gauss_Jordan_upt_k_PA 
snd_Gauss_Jordan_upt_k_PA <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1" id="Determinants2-det_snd_Gauss_Jordan_det_P"><span class="command">lemma</span></span> det_snd_Gauss_Jordan_det_P<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_det_P_is_Gauss_Jordan det_Gauss_Jordan <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1" id="Determinants2-det_fst_Gauss_Jordan_PA_eq_fst_Gauss_Jordan_det_P"><span class="command">lemma</span></span> det_fst_Gauss_Jordan_PA_eq_fst_Gauss_Jordan_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_det_P_def Gauss_Jordan_PA_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> det_fst_Gauss_Jordan_upt_k_PA_eq_fst_Gauss_Jordan_upt_k_det_P<span class="main">)</span>


<span class="keyword1" id="Determinants2-fst_Gauss_Jordan_det_P_not_0"><span class="command">lemma</span></span> fst_Gauss_Jordan_det_P_not_0<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> det_fst_Gauss_Jordan_PA_eq_fst_Gauss_Jordan_det_P 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> det_I det_mul invertible_fst_Gauss_Jordan_PA matrix_inv_right mult_zero_left zero_neq_one<span class="main">)</span>


<span class="keyword1" id="Determinants2-det_code_equation"><span class="command">lemma</span></span> det_code_equation<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> Gauss_Jordan_det_P <span class="free">A</span> <span class="keyword1">in</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>snd <span class="main">(</span><span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span><span class="main">/</span><span class="main">(</span>fst <span class="main">(</span><span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">using</span></span> det_Gauss_Jordan_det_P<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> det_snd_Gauss_Jordan_det_P
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_Gauss_Jordan_det_P_not_0 nonzero_eq_divide_eq <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Inverse">
<div class="head">
<h1>Theory Inverse</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Inverse.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Inverse of a matrix using the Gauss Jordan algorithm›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Inverse
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Gauss_Jordan_PA.html">Gauss_Jordan_PA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Several properties›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties about Gauss Jordan algorithm, reduced row echelon form, rank, identity matrix and invertibility›</span></span>

<span class="keyword1" id="Inverse-rref_id_implies_invertible"><span class="command">lemma</span></span> rref_id_implies_invertible<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> Gauss_mat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> PA<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_Gauss_Jordan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_mul_lid <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="skolem">P</span> <span class="main">**</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P invertible_def matrix_inv_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PA assms calculation matrix_eq matrix_vector_mul_assoc matrix_vector_mul_lid<span class="main">)</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span> <span class="main">**</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Gauss_mat_1 <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_mul_rid <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword1"><span class="command">using</span></span> matrix_inv_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the following case, nrows is equivalent to ncols due to we are working with a square matrix›</span></span>
<span class="keyword1" id="Inverse-full_rank_implies_invertible"><span class="command">lemma</span></span> full_rank_implies_invertible<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rank_n<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_left_inverse<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main"><span class="main">]</span></span> matrix_left_invertible_ker<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
<span class="keyword3"><span class="command">assume</span></span> Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> rank_eq_card_n<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rank_n <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dim_null_space <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_card_n dimension_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"null_space <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_eq <span class="keyword1"><span class="command">using</span></span> Ax null_space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> null_space_def <span class="keyword1"><span class="command">using</span></span> Ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Inverse-invertible_implies_full_rank"><span class="command">lemma</span></span> invertible_implies_full_rank<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inv_A <span class="keyword1"><span class="command">unfolding</span></span>  invertible_left_inverse<span class="main">[</span><span class="operator">unfolded</span> matrix_left_invertible_ker<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> null_space_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> null_space_def <span class="keyword1"><span class="command">using</span></span> matrix_vector_mult_0_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> dim_null_space<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec.dim_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> null_space_eq_0 vec.dim_def vec.dim_zero_eq'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rank_nullity_theorem_matrices<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> dim_null_space rank_eq_dim_col_space nrows_def
    <span class="keyword1"><span class="command">unfolding</span></span> col_space_eq <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">id_upt_k</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span> one<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">⇒</span> nat <span class="main">=&gt;</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">id_upt_k</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> to_nat <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Inverse-id_upt_nrows_mat_1"><span class="command">lemma</span></span> id_upt_nrows_mat_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"id_upt_k <span class="free">A</span> <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mat_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vector</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> id_upt_k_def nrows_def
<span class="keyword1"><span class="command">using</span></span> to_nat_less_card<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Computing the inverse of a matrix using the Gauss Jordan algorithm›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This lemma is essential to demonstrate that the Gauss Jordan form of an invertible matrix is the identity. 
  The proof is made by induction and it is explained in 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "http://www.unirioja.es/cu/jodivaso/Isabelle/Gauss-Jordan-2013-2-Generalized/Demonstration_invertible.pdf"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Inverse-id_upt_k_Gauss_Jordan"><span class="command">lemma</span></span> id_upt_k_Gauss_Jordan<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"id_upt_k <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
<span class="keyword1"><span class="command">note</span></span> id_k<span class="main">=</span>Suc.hyps
<span class="keyword1"><span class="command">have</span></span> rref_k<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> rref_implies_rref_upt<span class="main">[</span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> rref_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> rref_implies_rref_upt<span class="main">[</span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> inv_gj<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_A invertible_Gauss_Jordan invertible_mult<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"id_upt_k <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> id_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
<span class="keyword3"><span class="command">assume</span></span> j_less_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span>
<span class="comment1">― ‹First of all we prove a property which will be useful later›</span>
<span class="keyword1"><span class="command">have</span></span> greatest_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> to_nat <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main">)</span>
<span class="keyword3"><span class="command">assume</span></span> j_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> j_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_le' diff_add_cancel j_eq_k j_not_zero to_nat_mono<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">j</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
               <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_minus_1 <span class="keyword1"><span class="command">.</span></span>
               <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> id_k <span class="keyword1"><span class="command">unfolding</span></span> id_upt_k_def <span class="keyword1"><span class="command">using</span></span> j_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
            <span class="keyword3"><span class="command">assume</span></span> not_zero_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">a</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">hence</span></span> a_greater_i_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">b</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span>
                    <span class="keyword1"><span class="command">have</span></span> Least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
                        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a id_k id_upt_k_def zero_neq_one<span class="main">)</span>
                        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> a not_less_iff_gr_or_eq id_k id_upt_k_def less_trans not_less to_nat_mono<span class="main">)</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> a id_k <span class="keyword1"><span class="command">unfolding</span></span> id_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> from_nat <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a from_nat_to_nat_id j_eq_k not_less_iff_gr_or_eq to_nat_le<span class="main">)</span>
                       <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_eq_k to_nat_from_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                       <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_greater_i_minus_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_add_cancel le_Suc<span class="main">)</span>
                       <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4<span class="main">[</span><span class="operator">OF</span> rref_k<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword3"><span class="command">show</span></span> Gauss_jj_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
<span class="comment1">― ‹In case that j be zero, the result is trivial›</span>
<span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rref_first_element<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rref_Gauss_Jordan<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"column <span class="main">0</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> det_zero_column inv_gj invertible_det_nz<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> j_not_zero <span class="main">=</span> False
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> id_k <span class="keyword1"><span class="command">unfolding</span></span> id_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  <span class="comment1">― ‹Easy due to the inductive hypothesis›</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> j_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_less_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> j_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_le' diff_add_cancel j_eq_k j_not_zero to_nat_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_prop<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j_not_zero j_eq_k<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> zero_j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_le greatest_ge_nonzero_row j_eq_k j_minus_1 to_nat_mono'<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">note</span></span> gauss_jj_not_0 <span class="main">=</span> False
                <span class="keyword3"><span class="command">assume</span></span> gauss_jj_not_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
                     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gauss_jj_not_0 <span class="keyword1"><span class="command">.</span></span>
                     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less_linear is_zero_row_upt_k_def j_eq_k to_nat_mono zero_j_k<span class="main">)</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gauss_jj_not_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">― ‹Contradiction with the second condition of rref›</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gauss_jj_not_0 is_zero_row_upt_k_def j_eq_k lessI rref_suc_k rref_upt_condition2<span class="main">)</span>             
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">note</span></span> gauss_jj_0 <span class="main">=</span> True
                  <span class="keyword1"><span class="command">have</span></span> zero_j_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_j_k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> gauss_jj_0 j_eq_k to_nat_from_nat<span class="main">)</span>                  
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">**</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> mat <span class="main">1</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹This will be a contradiction›</span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_left_invertible_independent_columns<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> 
                        <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">i</span></span> <span class="main"><span class="main">&lt;</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword1"><span class="keyword1">then</span></span> column <span class="skolem"><span class="skolem">j</span></span> <span class="main"><span class="main">(</span></span>Gauss_Jordan <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">$</span></span> <span class="bound"><span class="bound">i</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">=</span></span><span class="skolem"><span class="skolem">j</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="keyword1">then</span> column <span class="skolem">j</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>                        
                        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> vec_eq_iff sum_component<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                          <span class="comment1">― ‹We write the column j in a linear combination of the previous ones, which is a contradiction (the matrix wouldn't be invertible)›</span>
                            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="keyword1">then</span> column <span class="skolem">j</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
                            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
                            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">*</span> column <span class="bound">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> UNIV <span class="main">=</span> <span class="main">0</span>"</span></span>
                              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span><span class="main">)</span>
                              <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> i_less_j <span class="main">=</span> True
                              <span class="keyword1"><span class="command">have</span></span> sum_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">j</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
                                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.remove<span class="main">)</span>
                                   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_code <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                                   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                                <span class="keyword1"><span class="command">qed</span></span>                                
                              <span class="keyword1"><span class="command">have</span></span> sum_g0<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
                                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
                                <span class="keyword3"><span class="command">assume</span></span> a_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> column_a_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"column <span class="skolem">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> id_k <span class="keyword1"><span class="command">unfolding</span></span> id_upt_k_def <span class="keyword1"><span class="command">using</span></span> a_less_j j_eq_k <span class="keyword1"><span class="command">using</span></span> i_less_j a_not_i to_nat_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"column <span class="skolem">j</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> column_a_not_zero <span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="comment1">― ‹Contradiction›</span>
                                <span class="keyword1"><span class="command">qed</span></span>
                              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> UNIV <span class="main">=</span> <span class="var">?g</span> <span class="skolem">i</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.remove<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
                              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">i</span> <span class="main">+</span> <span class="var">?g</span> <span class="skolem">j</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">i</span> <span class="main">+</span> <span class="var">?g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_g0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> column_def 
                                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> id_k id_upt_k_def j_eq_k to_nat_mono<span class="main">)</span>
                              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
                              <span class="keyword1"><span class="command">next</span></span>
                              <span class="keyword3"><span class="command">case</span></span> False
                              <span class="keyword1"><span class="command">have</span></span> zero_i_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
                                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False zero_j_suc_k linorder_cases rref_suc_k rref_upt_condition1<span class="main">)</span>
                              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>              
                                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"column <span class="skolem">j</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
                                    <span class="keyword1"><span class="command">using</span></span> zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> column_def is_zero_row_upt_k_def
                                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> j_eq_k lessI vec_lambda_beta<span class="main">)</span>
                                  <span class="keyword1"><span class="command">next</span></span>
                                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
                                  <span class="keyword3"><span class="command">assume</span></span> a_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> column_a_i<span class="main">:</span> <span class="quoted"><span class="quoted">"column <span class="skolem">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_i_suc_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
                                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> a_less_j j_eq_k less_SucI to_nat_mono<span class="main">)</span>
                                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"column <span class="skolem">j</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> column_a_i <span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>                                  
                        <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="keyword1">then</span> column <span class="skolem">j</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False j_eq_k neg_equal_0_iff_equal to_nat_mono zero_neq_one<span class="main">)</span>
                    <span class="keyword1"><span class="command">qed</span></span>                    
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> inv_gj <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span> 
                   <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
                    <span class="keyword3"><span class="command">assume</span></span> i_less_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="comment1">― ‹This result is proved making use of the 4th condition of rref›</span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
                        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> id_k i_not_j <span class="keyword1"><span class="command">unfolding</span></span> id_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">― ‹Easy due to the inductive hypothesis›</span>
                        <span class="keyword1"><span class="command">next</span></span>
                        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> i_or_j_ge_k <span class="main">=</span> False
                        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
                          <span class="keyword3"><span class="command">case</span></span> True
                          <span class="keyword1"><span class="command">hence</span></span> j_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_or_j_ge_k j_less_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="keyword1"><span class="command">have</span></span> j_noteq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True j_eq_k less_nat_zero_code to_nat_0<span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> j_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_le' diff_add_cancel j_eq_k j_noteq_0 to_nat_mono<span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_prop<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j_noteq_0 j_eq_k<span class="main"><span class="main">]</span></span><span class="main">)</span>
                          <span class="keyword1"><span class="command">hence</span></span> zero_j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> 
                            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> less_linear less_asym j_eq_k j_minus_1 not_greater_Greatest to_nat_mono<span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> Least_eq_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
                            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
                               <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_jj_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                               <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> 
                               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True le_cases from_nat_to_nat_id i_or_j_ge_k is_zero_row_upt_k_def j_less_suc less_Suc_eq_le less_le to_nat_le zero_j_k<span class="main">)</span>
                            <span class="keyword1"><span class="command">qed</span></span>
                          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_jj_1 j_less_suc zero_neq_one<span class="main">)</span>                          
                          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4<span class="main">[</span><span class="operator">OF</span> rref_suc_k<span class="main">]</span> i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">next</span></span>
                          <span class="keyword3"><span class="command">case</span></span> False
                          <span class="keyword1"><span class="command">hence</span></span> i_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹to_nat <span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>›</span></span> less_SucE<span class="main">)</span>
                          <span class="keyword1"><span class="command">hence</span></span> j_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_not_j j_less_suc less_SucE to_nat_from_nat<span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
                            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
                               <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_jj_1 zero_neq_one<span class="main">)</span>
                               <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
                                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_cases id_k id_upt_k_def j_less_k less_trans not_less to_nat_mono<span class="main">)</span>
                            <span class="keyword1"><span class="command">qed</span></span>
                          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="skolem">k</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Gauss_jj_1 is_zero_row_upt_k_def j_less_k zero_neq_one<span class="main">)</span>
                          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> rref_upt_condition4<span class="main">[</span><span class="operator">OF</span> rref_k<span class="main">]</span> i_not_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                         <span class="keyword1"><span class="command">qed</span></span>
                         <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Inverse-invertible_implies_rref_id"><span class="command">lemma</span></span> invertible_implies_rref_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> id_upt_k_Gauss_Jordan<span class="main">[</span><span class="operator">OF</span> inv_A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"nrows <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> id_upt_nrows_mat_1
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1" id="Inverse-matrix_inv_Gauss"><span class="command">lemma</span></span> matrix_inv_Gauss<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Gauss_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">=</span> <span class="free">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">A</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_inv_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> some1_equality<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">A'</span><span class="main">.</span> <span class="free">A</span> <span class="main">**</span> <span class="bound">A'</span> <span class="main">=</span> mat <span class="main">1</span> <span class="main">∧</span> <span class="bound">A'</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_A invertible_def matrix_inv_unique matrix_left_right_inverse<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> <span class="free">P</span> <span class="main">=</span> mat <span class="main">1</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_eq inv_A invertible_implies_rref_id matrix_left_right_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Inverse-matrix_inv_Gauss_Jordan_PA"><span class="command">lemma</span></span> matrix_inv_Gauss_Jordan_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">A</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_Jordan_PA_eq fst_Gauss_Jordan_PA inv_A matrix_inv_Gauss<span class="main">)</span>


<span class="keyword1" id="Inverse-invertible_eq_full_rank"><span class="command">lemma</span></span> invertible_eq_full_rank<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span> <span class="main">=</span> <span class="main">(</span>rank <span class="free">A</span> <span class="main">=</span> nrows <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> full_rank_implies_invertible invertible_implies_full_rank<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse_matrix</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> invertible <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span> Some <span class="main">(</span>matrix_inv <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1" id="Inverse-the_inverse_matrix"><span class="command">lemma</span></span> the_inverse_matrix<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>inverse_matrix <span class="free">A</span><span class="main">)</span> <span class="main">=</span> P_Gauss_Jordan <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_Gauss_Jordan_def assms inverse_matrix_def matrix_inv_Gauss_Jordan_PA option.sel<span class="main">)</span>

<span class="keyword1" id="Inverse-inverse_matrix"><span class="command">lemma</span></span> inverse_matrix<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse_matrix <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> invertible <span class="free">A</span> <span class="keyword1">then</span> Some <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse_matrix_def option.sel the_inverse_matrix<span class="main">)</span>

<span class="keyword1" id="Inverse-inverse_matrix_code"><span class="command">lemma</span></span> inverse_matrix_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse_matrix <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span> <span class="main">=</span> Gauss_Jordan_PA <span class="free">A</span><span class="main">;</span>
                                <span class="bound">rank_A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> row <span class="bound">a</span> <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">in</span> 
                                <span class="keyword1">if</span> nrows <span class="free">A</span> <span class="main">=</span> <span class="bound">rank_A</span> <span class="keyword1">then</span> Some <span class="main">(</span>fst<span class="main">(</span><span class="bound">GJ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> inverse_matrix
<span class="keyword1"><span class="command">unfolding</span></span> invertible_eq_full_rank
<span class="keyword1"><span class="command">unfolding</span></span> rank_Gauss_Jordan_code
<span class="keyword1"><span class="command">unfolding</span></span> P_Gauss_Jordan_def
<span class="keyword1"><span class="command">unfolding</span></span> Let_def Gauss_Jordan_PA_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword2"><span class="keyword">end</span></span>



</pre>
</div><div id="Bases_Of_Fundamental_Subspaces">
<div class="head">
<h1>Theory Bases_Of_Fundamental_Subspaces</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Bases_Of_Fundamental_Subspaces.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Bases of the four fundamental subspaces›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Bases_Of_Fundamental_Subspaces
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Gauss_Jordan_PA.html">Gauss_Jordan_PA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Computation of the bases of the fundamental subspaces›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_null_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="main">(</span>transpose <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">≥</span> rank <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_row_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_col_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="main">(</span>transpose <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="main">(</span>transpose <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_left_null_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">≥</span> rank <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Relatioships amongst the bases›</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_null_space_eq_basis_left_null_space_transpose"><span class="command">lemma</span></span> basis_null_space_eq_basis_left_null_space_transpose<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"basis_null_space <span class="free">A</span> <span class="main">=</span> basis_left_null_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_null_space_def
<span class="keyword1"><span class="command">unfolding</span></span> basis_left_null_space_def
<span class="keyword1"><span class="command">unfolding</span></span> rank_transpose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_null_space_transpose_eq_basis_left_null_space"><span class="command">lemma</span></span> basis_null_space_transpose_eq_basis_left_null_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_null_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> basis_left_null_space <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpose_transpose basis_null_space_eq_basis_left_null_space_transpose<span class="main">)</span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_col_space_eq_basis_row_space_transpose"><span class="command">lemma</span></span> basis_col_space_eq_basis_row_space_transpose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"basis_col_space <span class="free">A</span> <span class="main">=</span> basis_row_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_col_space_def basis_row_space_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Code equations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Code equations to make more efficient the computations.›</span></span>
<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_null_space_code"><span class="command">lemma</span></span> basis_null_space_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_null_space <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span> <span class="main">=</span> Gauss_Jordan_PA <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">;</span> 
                                                               <span class="bound">rank_A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> row <span class="bound">a</span> <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> 
                                                               <span class="keyword1">in</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>fst <span class="bound">GJ</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">≥</span> <span class="bound">rank_A</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_null_space_def Let_def P_Gauss_Jordan_def
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq
<span class="keyword1"><span class="command">unfolding</span></span> rank_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> rank_Gauss_Jordan_code<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"transpose <span class="free">A</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Let_def
<span class="keyword1"><span class="command">unfolding</span></span> transpose_zero <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_row_space_code"><span class="command">lemma</span></span> basis_row_space_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_row_space <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> Gauss_Jordan <span class="free">A</span> <span class="keyword1">in</span> <span class="main">{</span>row <span class="bound">i</span> <span class="bound">A'</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="bound">A'</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_row_space_def Let_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_col_space_code"><span class="command">lemma</span></span> basis_col_space_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_col_space <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> Gauss_Jordan <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">{</span>row <span class="bound">i</span> <span class="bound">A'</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="bound">A'</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_col_space_def Let_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_left_null_space_code"><span class="command">lemma</span></span> basis_left_null_space_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_left_null_space <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span> <span class="main">=</span> Gauss_Jordan_PA <span class="free">A</span><span class="main">;</span> 
                                                               <span class="bound">rank_A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> row <span class="bound">a</span> <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
                                                               <span class="keyword1">in</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>fst <span class="bound">GJ</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">≥</span> <span class="bound">rank_A</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_left_null_space_def Let_def P_Gauss_Jordan_def
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq
<span class="keyword1"><span class="command">unfolding</span></span> rank_Gauss_Jordan_code<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Let_def
<span class="keyword1"><span class="command">unfolding</span></span> transpose_zero <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Demonstrations that they are bases›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We prove that we have obtained a basis for each subspace›</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-independent_basis_left_null_space"><span class="command">lemma</span></span> independent_basis_left_null_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_left_null_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> vec.independent_mono<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>rows <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_Gauss_Jordan_def det_dependent_rows invertible_det_nz invertible_fst_Gauss_Jordan_PA<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span>rows <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-card_basis_left_null_space_eq_dim"><span class="command">lemma</span></span> card_basis_left_null_space_eq_dim<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> vec.dim <span class="main">(</span>left_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> row <span class="main">(</span>from_nat <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>rank <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">≥</span> rank <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> basis_left_null_space_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">{..&lt;</span><span class="main">(</span>vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?f</span> <span class="main">{..&lt;</span><span class="main">(</span>vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dimension_vector<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>from_nat <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row <span class="main">(</span>from_nat <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> x_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>          
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_identical_rows<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ eq<span class="main"><span class="main">]</span></span><span class="main">)</span>          
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_not_y x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">≠</span> from_nat <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> from_nat_eq_imp_eq less_diff_conv x y<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_Gauss_Jordan_def invertible_fst_Gauss_Jordan_PA<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">unfolding</span></span> invertible_det_nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
       <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span>  <span class="main">`</span> <span class="main">{..&lt;</span><span class="main">(</span>vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="bound">i</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def dimension_vector<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le_add2 less_diff_conv to_nat_from_nat_id<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span>
        <span class="keyword3"><span class="command">assume</span></span> rank_le_i<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="skolem">i</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span><span class="main">}</span><span class="main">.</span> row <span class="skolem">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row <span class="main">(</span>from_nat <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>to_nat <span class="skolem"><span class="skolem">i</span></span> <span class="main"><span class="main">-</span></span> rank <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="skolem">i</span> <span class="main">-</span> rank <span class="free">A</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rank_le_i from_nat_to_nat_id le_add_diff_inverse2<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="skolem">i</span> <span class="main">-</span> rank <span class="free">A</span> <span class="main">+</span> rank <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">-</span> rank <span class="free">A</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rank_le_i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_less_mono lessThan_def mem_Collect_eq to_nat_less_card<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> card_lessThan <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec.dim <span class="main">(</span>null_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dim_null_space rank_transpose <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec.dim <span class="main">(</span>left_null_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> left_null_space_eq_null_space_transpose <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_left_null_space_in_left_null_space"><span class="command">lemma</span></span> basis_left_null_space_in_left_null_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_left_null_space <span class="free">A</span> <span class="main">⊆</span> left_null_space <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_left_null_space_def left_null_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> rank_le_i<span class="main">:</span> <span class="quoted"><span class="quoted">" rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_def vec_nth_inverse <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_matrix_matrix_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_Gauss_Jordan_def Gauss_Jordan_PA_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> fst_Gauss_Jordan_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rank_less_row_i_imp_i_is_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rank_le_i<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-left_null_space_subset_span_basis"><span class="command">lemma</span></span> left_null_space_subset_span_basis<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"left_null_space <span class="free">A</span> <span class="main">⊆</span> vec.span <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.card_ge_dim_independent<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"basis_left_null_space <span class="free">A</span> <span class="main">⊆</span> left_null_space <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_left_null_space_in_left_null_space<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> independent_basis_left_null_space<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>left_null_space <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpose_vector<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_basis_left_null_space_eq_dim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> basis_left_null_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
       left_null_space <span class="free">A</span> <span class="main">=</span> vec.span <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basis_left_null_space_in_left_null_space independent_basis_left_null_space 
  left_null_space_subset_span_basis vec.span_subspace subspace_left_null_space<span class="main">)</span>


<span class="keyword1"><span class="command">corollary</span></span> basis_null_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_null_space <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
       null_space <span class="free">A</span> <span class="main">=</span> vec.span <span class="main">(</span>basis_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_null_space_eq_basis_left_null_space_transpose
<span class="keyword1"><span class="command">unfolding</span></span> null_space_eq_left_null_space_transpose
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_left_null_space<span class="main">)</span>


<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_row_space_subset_row_space"><span class="command">lemma</span></span> basis_row_space_subset_row_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_row_space <span class="free">A</span> <span class="main">⊆</span> row_space <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_row_space <span class="free">A</span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> basis_row_space_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> row_space <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> row_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> vec.span <span class="main">(</span>rows <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rows_def vec.span_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row_space <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> fst_Gauss_Jordan_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> row_space_is_preserved<span class="main"><span class="main">[</span></span><span class="operator">OF</span> invertible_fst_Gauss_Jordan_PA<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-row_space_subset_span_basis_row_space"><span class="command">lemma</span></span> row_space_subset_span_basis_row_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_space <span class="free">A</span> <span class="main">⊆</span> vec.span <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.card_ge_dim_independent<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"basis_row_space <span class="free">A</span> <span class="main">⊆</span> row_space <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_row_space_subset_row_space<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> basis_row_space_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> independent_not_zero_rows_rref<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>row_space <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_row_space_def
<span class="keyword1"><span class="command">using</span></span> rref_rank<span class="main">[</span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> row_rank_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rank_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rank_Gauss_Jordan<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Bases_Of_Fundamental_Subspaces-basis_row_space"><span class="command">lemma</span></span> basis_row_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span>
  <span class="main">∧</span> vec.span <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row_space <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> basis_row_space_def <span class="keyword1"><span class="command">using</span></span> independent_not_zero_rows_rref<span class="main">[</span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.span <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row_space <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.span_subspace<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"basis_row_space <span class="free">A</span> <span class="main">⊆</span> row_space <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_row_space_subset_row_space<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_space <span class="free">A</span> <span class="main">⊆</span> vec.span <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> row_space_subset_span_basis_row_space<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span>row_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subspace_row_space<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">corollary</span></span> basis_col_space<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span>basis_col_space <span class="free">A</span><span class="main">)</span>
  <span class="main">∧</span> vec.span <span class="main">(</span>basis_col_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> col_space <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> col_space_eq_row_space_transpose basis_col_space_eq_basis_row_space_transpose
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_row_space<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="System_Of_Equations">
<div class="head">
<h1>Theory System_Of_Equations</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      System_Of_Equations.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Solving systems of equations using the Gauss Jordan algorithm›</span></span>

<span class="keyword1"><span class="command">theory</span></span> System_Of_Equations
<span class="keyword2"><span class="keyword">imports</span></span>
 <a href="Gauss_Jordan_PA.html">Gauss_Jordan_PA</a>
 <a href="Bases_Of_Fundamental_Subspaces.html">Bases_Of_Fundamental_Subspaces</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Given a system of equations <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span> <span class="keyword1"><span class="keyword1">*v</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the following function returns the pair <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">P</span></span> <span class="main"><span class="main">**</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">P</span></span> <span class="keyword1"><span class="keyword1">*v</span></span> <span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where P is the matrix
      which states <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">**</span></span> <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. That matrix is computed by means of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solve_system</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> 
  <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">solve_system</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> Gauss_Jordan_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>snd <span class="bound">A'</span><span class="main">,</span> <span class="main">(</span>fst <span class="bound">A'</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_solution</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_solution</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">*v</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Relationship between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">is_solution_def</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">solve_system_def</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="System_Of_Equations-is_solution_imp_solve_system"><span class="command">lemma</span></span> is_solution_imp_solve_system<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xAb<span class="main">:</span><span class="quoted"><span class="quoted">"is_solution <span class="free">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="free">x</span> <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="keyword1">*v</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xAb <span class="keyword1"><span class="command">unfolding</span></span> is_solution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc
    <span class="keyword1"><span class="command">unfolding</span></span> fst_Gauss_Jordan_PA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="free">x</span> <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_solution_def solve_system_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="System_Of_Equations-solve_system_imp_is_solution"><span class="command">lemma</span></span> solve_system_imp_is_solution<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xAb<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="free">x</span> <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="free">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> xAb <span class="keyword1"><span class="command">unfolding</span></span> is_solution_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> solve_system_def Let_def fst_conv snd_conv <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> fst_Gauss_Jordan_PA <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> matrix_inv <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"matrix_inv <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_inv_left<span class="main">[</span><span class="operator">OF</span> invertible_fst_Gauss_Jordan_PA<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_lid <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_solution_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="System_Of_Equations-is_solution_solve_system"><span class="command">lemma</span></span> is_solution_solve_system<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="free">x</span> <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> is_solution <span class="free">x</span> <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> solve_system_imp_is_solution is_solution_imp_solve_system <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Consistent and inconsistent systems of equations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consistent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">consistent</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inconsistent</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inconsistent</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>consistent <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations-inconsistent"><span class="command">lemma</span></span> inconsistent<span class="main">:</span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inconsistent_def consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following function will be use to solve consistent systems which are already in the reduced row echelon form.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solve_consistent_rref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">solve_consistent_rref</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations-solve_consistent_rref_code"><span class="command">lemma</span></span> solve_consistent_rref_code<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>solve_consistent_rref <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> solve_consistent_rref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="System_Of_Equations-rank_ge_imp_is_solution"><span class="command">lemma</span></span> rank_ge_imp_is_solution<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
                                            <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="main">(</span>solve_consistent_rref <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="main">(</span>solve_consistent_rref <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_solution_def solve_consistent_rref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> matrix_vector_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
        <span class="keyword1">then</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> rank_A_eq_0<span class="main">:</span><span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rank_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> ex_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_eq_iff zero_index<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> con <span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> ex_a<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> rank_A_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_0_imp_Gauss_Jordan_0<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> A_not_zero<span class="main">=</span>False
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">not_zero_positions_row_a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not_zero_positions_row_a</span> <span class="main">=</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zero_positions_row_a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zero_positions_row_a</span> <span class="main">=</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="skolem">not_zero_positions_row_a</span> <span class="main">∪</span> <span class="skolem">zero_positions_row_a</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> zero_positions_row_a_def not_zero_positions_row_a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">not_zero_positions_row_a</span> <span class="main">∩</span> <span class="skolem">zero_positions_row_a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> zero_positions_row_a_def not_zero_positions_row_a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> sum_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum <span class="var">?f</span> <span class="skolem">zero_positions_row_a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> zero_positions_row_a_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'cols</span> set<span class="main">)</span><span class="main">=</span>sum <span class="var">?f</span> <span class="main">(</span><span class="skolem">not_zero_positions_row_a</span> <span class="main">∪</span> <span class="skolem">zero_positions_row_a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> UNIV_rw <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="skolem">not_zero_positions_row_a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>sum <span class="var">?f</span> <span class="skolem">zero_positions_row_a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ disj<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="skolem">not_zero_positions_row_a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">not_zero_positions_row_a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> zero_row_a<span class="main">=</span>True    
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> rank_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_not_zero less_not_refl3 rank_Gauss_Jordan rank_greater_zero<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> greatest_less_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> greatest_less_zero_row<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> rref_Gauss_Jordan <span class="keyword1"><span class="command">unfolding</span></span> reduced_row_echelon_form_def <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Collect_empty_eq is_zero_row_upt_ncols not_zero_positions_row_a_def zero_row_a<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Gauss_Jordan_not_0 is_zero_row_upt_ncols vec_eq_iff zero_index<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> to_nat <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">hence</span></span> rank_le_to_nat_a<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_suc_to_nat_greatest<span class="main">[</span><span class="operator">OF</span> A_not_zero<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> to_nat <span class="skolem">a</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> con <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> rank_le_to_nat_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_le to_nat_mono'<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_greater_Greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero_row_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>    
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> not_empty<span class="main">=</span>False
        <span class="keyword1"><span class="command">have</span></span> not_zero_positions_row_a_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">not_zero_positions_row_a</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">not_zero_positions_row_a</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> not_zero_positions_row_a_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Collect_cong False LeastI_ex bot_set_def empty_iff insert_Diff_single insert_absorb insert_is_Un mem_Collect_eq not_zero_positions_row_a_def<span class="main">)</span>  
        <span class="keyword1"><span class="command">have</span></span> sum_zero'<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span><span class="skolem">not_zero_positions_row_a</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_zero_row_def' rref_Gauss_Jordan rref_condition4_explicit zero_neq_one<span class="main">)</span>    
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span><span class="skolem">not_zero_positions_row_a</span><span class="main">)</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="skolem">not_zero_positions_row_a</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> not_zero_positions_row_a_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_zero' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> A_least_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> empty_Collect_eq is_zero_row_def' not_empty not_zero_positions_row_a_def rref_Gauss_Jordan rref_condition2_explicit<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_least_eq_1 <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation is_zero_row_def' rref_Gauss_Jordan rref_condition4_explicit zero_neq_one<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>    
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="skolem">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False rref_Gauss_Jordan rref_condition2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> IntI disj empty_iff insert_compr insert_is_Un is_zero_row_def' mem_Collect_eq not_zero_positions_row_a_rw zero_positions_row_a_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> if_not_P<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> is_solution_solve_system<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> solve_system_def Let_def snd_conv fst_conv <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq P_Gauss_Jordan_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rank_ge_imp_consistent<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rank_ge_imp_is_solution assms <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="System_Of_Equations-inconsistent_imp_rank_less"><span class="command">lemma</span></span> inconsistent_imp_rank_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rank <span class="free">A</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rank_ge_imp_consistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> inc <span class="keyword1"><span class="command">unfolding</span></span> inconsistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="System_Of_Equations-rank_less_imp_inconsistent"><span class="command">lemma</span></span> rank_less_imp_inconsistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inconsistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ex_solution<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inconsistent_def consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="skolem">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> is_solution_solve<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="skolem">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_solution_solve_system
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_Jordan_PA_eq P_Gauss_Jordan_def fst_conv snd_conv solve_system_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> rank_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rank_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> exists_not_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> inc <span class="keyword1"><span class="command">unfolding</span></span> inconsistent
      <span class="keyword1"><span class="command">using</span></span> to_nat_plus_1_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹is_solution <span class="skolem">x</span> <span class="free">A</span> <span class="free">b</span>›</span></span> exists_not_0 is_solution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> j_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> rank_less_greatest_i<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">&lt;</span> to_nat <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inc <span class="keyword1"><span class="command">unfolding</span></span> i_def inconsistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> rank_eq_greatest_A<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> to_nat <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rank_eq_suc_to_nat_greatest<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> to_nat <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> to_nat <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> not_le to_nat_mono'<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> is_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> j_def j_less_i not_greater_Greatest<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_vector_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_zero_i <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">x</span> <span class="main">=</span> P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_solution_def is_solution_solve <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> i_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> GreatestI_ex<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inc <span class="keyword1"><span class="command">unfolding</span></span> i_def inconsistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> consistent_imp_rank_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rank_less_imp_inconsistent <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inconsistent_def not_less<span class="main">)</span>

<span class="keyword1" id="System_Of_Equations-inconsistent_eq_rank_less"><span class="command">lemma</span></span> inconsistent_eq_rank_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>rank <span class="free">A</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
                                            <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inconsistent_imp_rank_less rank_less_imp_inconsistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="System_Of_Equations-consistent_eq_rank_ge"><span class="command">lemma</span></span> consistent_eq_rank_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>rank <span class="free">A</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
                                            <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> consistent_imp_rank_ge rank_ge_imp_consistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">corollary</span></span> consistent_imp_is_solution<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="main">(</span>solve_consistent_rref <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rank_ge_imp_is_solution<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> consistent_eq_rank_ge<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">corollary</span></span> consistent_imp_is_solution'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="main">(</span>solve_consistent_rref <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> consistent_imp_is_solution<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> solve_system_def Let_def snd_conv fst_conv
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq P_Gauss_Jordan_def <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Code equations optimized using Lets›</span></span>

<span class="keyword1" id="System_Of_Equations-inconsistent_eq_rank_less_code"><span class="command">lemma</span></span> inconsistent_eq_rank_less_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ_P</span><span class="main">=</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">;</span> 
                                <span class="bound">P_mult_b</span> <span class="main">=</span> <span class="main">(</span>fst<span class="main">(</span><span class="bound">GJ_P</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span><span class="main">;</span>
                                <span class="bound">rank_A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> row <span class="bound">a</span> <span class="main">(</span>snd <span class="bound">GJ_P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>  <span class="keyword1">in</span> <span class="main">(</span><span class="bound">rank_A</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">P_mult_b</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
                                            <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">P_mult_b</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> inconsistent_eq_rank_less Let_def rank_Gauss_Jordan_code
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq P_Gauss_Jordan_def <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1" id="System_Of_Equations-consistent_eq_rank_ge_code"><span class="command">lemma</span></span> consistent_eq_rank_ge_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ_P</span><span class="main">=</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">;</span> 
                              <span class="bound">P_mult_b</span> <span class="main">=</span> <span class="main">(</span>fst<span class="main">(</span><span class="bound">GJ_P</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">)</span><span class="main">;</span>
                              <span class="bound">rank_A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> row <span class="bound">a</span> <span class="main">(</span>snd <span class="bound">GJ_P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span><span class="bound">rank_A</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">P_mult_b</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
                                            <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">P_mult_b</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> consistent_eq_rank_ge Let_def rank_Gauss_Jordan_code
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq P_Gauss_Jordan_def <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Solution set of a system of equations. Dependent and independent systems.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solution_set</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">solution_set</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="System_Of_Equations-null_space_eq_solution_set"><span class="command">lemma</span></span> null_space_eq_solution_set<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"null_space <span class="free">A</span> <span class="main">=</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> null_space_def solution_set_def is_solution_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">corollary</span></span> dim_solution_set_homogeneous_eq_dim_null_space<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> vec.dim <span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> null_space_eq_solution_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="System_Of_Equations-zero_is_solution_homogeneous_system"><span class="command">lemma</span></span> zero_is_solution_homogeneous_system<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> solution_set_def is_solution_def
<span class="keyword1"><span class="command">using</span></span> matrix_vector_mult_0_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="System_Of_Equations-homogeneous_solution_set_subspace"><span class="command">lemma</span></span> homogeneous_solution_set_subspace<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> subspace_null_space<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> null_space_eq_solution_set <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1" id="System_Of_Equations-solution_set_rel"><span class="command">lemma</span></span> solution_set_rel<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="free">p</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">+</span> <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> set_plus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ba</span>
<span class="keyword3"><span class="command">assume</span></span> ba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ba</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="skolem">ba</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">ba</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_right_distrib <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p ba <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def is_solution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">+</span> <span class="skolem">ba</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def is_solution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
<span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">p</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_diff_cancel diff_add_cancel matrix_vector_right_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x p <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def is_solution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">p</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def is_solution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="System_Of_Equations-independent_and_consistent_imp_uniqueness_solution"><span class="command">lemma</span></span> independent_and_consistent_imp_uniqueness_solution<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> dim_0<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="skolem">p</span> <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> con <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> solution_set_0<span class="main">:</span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_eq<span class="main">[</span><span class="operator">OF</span> dim_0<span class="main">]</span> zero_is_solution_homogeneous_system <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="skolem">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="skolem">y</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">+</span> <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solution_set_rel<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solution_set_0 set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> mem_Collect_eq singleton_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*TODO: Maybe move. Until Isabelle2013-2 this lemma was part of the library.*)</span>
<span class="keyword1" id="System_Of_Equations-card_1_exists"><span class="command">lemma</span></span> card_1_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> One_nat_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> card_eq_SucD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ex1E<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> singleton_iff     
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> as<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> as<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="free">s</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">using</span></span> card.insert_remove <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
 

<span class="keyword1"><span class="command">corollary</span></span> independent_and_consistent_imp_card_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> dim_0<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>solution_set <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> independent_and_consistent_imp_uniqueness_solution<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def 
<span class="keyword1"><span class="command">using</span></span> card_1_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="System_Of_Equations-uniqueness_solution_imp_independent"><span class="command">lemma</span></span> uniqueness_solution_imp_independent<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> ex1_sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="skolem">x</span> <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex1_sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> solution_set_homogeneous_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> not_zero_set<span class="main">:</span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> homogeneous_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff zero_is_solution_homogeneous_system<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_set homogeneous_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> solution_set <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def <span class="keyword1"><span class="command">using</span></span> x ex1_sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">+</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solution_set_rel<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> add_left_cancel monoid_add_class.add.right_neutral empty_iff insert_iff set_plus_intro y y_not_0<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_eq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> uniqueness_solution_eq_independent_and_consistent<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>consistent <span class="free">A</span> <span class="free">b</span> <span class="main">∧</span> vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> independent_and_consistent_imp_uniqueness_solution uniqueness_solution_imp_independent consistent_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1" id="System_Of_Equations-consistent_homogeneous"><span class="command">lemma</span></span> consistent_homogeneous<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> consistent_def is_solution_def <span class="keyword1"><span class="command">using</span></span> matrix_vector_mult_0_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="System_Of_Equations-dim_solution_set_0"><span class="command">lemma</span></span> dim_solution_set_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> homogeneous_solution_set_subspace vec.dim_zero_subspace_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We have to impose the restriction <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semiring_char_0›</span></span></span></span> in the following lemma,
because it may not hold over a general field (for instance, in Z2 there is a finite number of elements, so the solution
set can't be infinite.›</span></span>

<span class="keyword1" id="System_Of_Equations-dim_solution_set_not_zero_imp_infinite_solutions_homogeneous"><span class="command">lemma</span></span> dim_solution_set_not_zero_imp_infinite_solutions_homogeneous<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span> semiring_char_0<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> dim_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_subspace_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span>"</span></span><span class="main">]</span> dim_not_zero
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> vec.dim_zero_eq'<span class="main">)</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.subspace_0<span class="main">[</span><span class="operator">OF</span> homogeneous_solution_set_subspace<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> infinite_iff_countable_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> x_not_0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">f</span> <span class="main">⊆</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> homogeneous_solution_set_subspace <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> vec.subspace_def image_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="System_Of_Equations-infinite_solutions_homogeneous_imp_dim_solution_set_not_zero"><span class="command">lemma</span></span> infinite_solutions_homogeneous_imp_dim_solution_set_not_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_solution_set_0 finite.simps gr0I i<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> infinite_solution_set_homogeneous_eq<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>semiring_char_0<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> infinite_solutions_homogeneous_imp_dim_solution_set_not_zero
<span class="keyword1"><span class="command">using</span></span> dim_solution_set_not_zero_imp_infinite_solutions_homogeneous <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1"><span class="command">corollary</span></span> infinite_solution_set_homogeneous_eq'<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>semiring_char_0<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> infinite_solution_set_homogeneous_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> INFM_iff_infinite <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="System_Of_Equations-infinite_solution_set_imp_consistent"><span class="command">lemma</span></span> infinite_solution_set_imp_consistent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>solution_set <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> infinite_imp_nonempty <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solution_set_def consistent_def<span class="main">)</span>

<span class="keyword1" id="System_Of_Equations-dim_solution_set_not_zero_imp_infinite_solutions_no_homogeneous"><span class="command">lemma</span></span> dim_solution_set_not_zero_imp_infinite_solutions_no_homogeneous<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span> semiring_char_0<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> dim_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>solution_set <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.dim_zero_subspace_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="main">0</span>"</span></span><span class="main">]</span> dim_not_0
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> vec.dim_zero_eq'<span class="main">)</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec.subspace_0<span class="main">[</span><span class="operator">OF</span> homogeneous_solution_set_subspace<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="skolem">y</span> <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> con <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">(</span>of_nat <span class="bound">n</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> infinite_iff_countable_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> x_not_0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">f</span> <span class="main">⊆</span> solution_set <span class="free">A</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> solution_set_rel<span class="main">[</span><span class="operator">OF</span> y<span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> homogeneous_solution_set_subspace <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> vec.subspace_def image_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="System_Of_Equations-infinite_solutions_no_homogeneous_imp_dim_solution_set_not_zero_imp"><span class="command">lemma</span></span> infinite_solutions_no_homogeneous_imp_dim_solution_set_not_zero_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>solution_set <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i independent_and_consistent_imp_card_1 infinite_solution_set_imp_consistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">corollary</span></span> infinite_solution_set_no_homogeneous_eq<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span> semiring_char_0<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>solution_set <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>consistent <span class="free">A</span> <span class="free">b</span> <span class="main">∧</span> vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> dim_solution_set_not_zero_imp_infinite_solutions_no_homogeneous
<span class="keyword1"><span class="command">using</span></span> infinite_solutions_no_homogeneous_imp_dim_solution_set_not_zero_imp
<span class="keyword1"><span class="command">using</span></span> infinite_solution_set_imp_consistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">corollary</span></span> infinite_solution_set_no_homogeneous_eq'<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span> semiring_char_0<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">x</span><span class="main">.</span> is_solution <span class="bound">x</span> <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>consistent <span class="free">A</span> <span class="free">b</span> <span class="main">∧</span> vec.dim <span class="main">(</span>solution_set <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> infinite_solution_set_no_homogeneous_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> INFM_iff_infinite <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">independent_and_consistent</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span>consistent <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> vec.dim <span class="main">(</span>solution_set <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dependent_and_consistent</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span>consistent <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> vec.dim <span class="main">(</span>solution_set <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Solving systems of linear equations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following function will solve any system of linear equations. Given a matrix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span> and a vector <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>, 
Firstly it makes use of the funcion <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"solve_system"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to transform the original matrix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span> and the vector <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span> 
into another ones in reduced row echelon form. Then, that system will have the same solution than the original one but it is easier to be solved.
So we make use of the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"solve_consistent_rref"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to obtain one solution of the system.

We will prove that any solution of the system can be rewritten as a linear combination of elements of a basis of the null space plus a particular solution of the system.
So the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">solve</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will return an option type, depending on the consistency of the system:
\begin{itemize}
\item If the system is consistent (so there exists at least one solution), the function will return the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Some›</span></span></span></span> of a pair.
      In the first component of that pair will be one solution of the system and the second one will be a basis of the null space of the matrix. Hence:
    \begin{enumerate}
        \item If the system is consistent and independent (so there exists one and only one solution), the pair will consist of the solution and the empty set (this empty set is 
              the basis of the null space).
        \item If the system is consistent and dependent (so there exists more than one solution, maybe an infinite number), 
              the pair will consist of one particular solution and a basis of the null space (which will not be the empty set).
    \end{enumerate}
\item If the system is inconsistent (so there exists no solution), the function will return <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>None›</span></span></span></span>.
\end{itemize}
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">solve</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> consistent <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> 
    Some <span class="main">(</span>solve_consistent_rref <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> basis_null_space <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> 
    <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations-solve_code"><span class="command">lemma</span></span> solve_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solve <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ_P</span><span class="main">=</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">;</span> 
                        <span class="bound">P_times_b</span><span class="main">=</span>fst<span class="main">(</span><span class="bound">GJ_P</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span><span class="main">;</span>
                        <span class="bound">rank_A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> row <span class="bound">a</span> <span class="main">(</span>snd <span class="bound">GJ_P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span>
                        <span class="bound">consistent_Ab</span> <span class="main">=</span> <span class="main">(</span><span class="bound">rank_A</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">P_times_b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">P_times_b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                        <span class="bound">GJ_transpose</span> <span class="main">=</span> Gauss_Jordan_PA <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">;</span> 
                        <span class="bound">basis</span> <span class="main">=</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>fst <span class="bound">GJ_transpose</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">≥</span> <span class="bound">rank_A</span><span class="main">}</span>
                        <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">consistent_Ab</span> <span class="keyword1">then</span> Some <span class="main">(</span>solve_consistent_rref <span class="main">(</span>snd <span class="bound">GJ_P</span><span class="main">)</span> <span class="bound">P_times_b</span><span class="main">,</span><span class="bound">basis</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def solve_def
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_eq_rank_ge_code<span class="main">[</span><span class="operator">unfolded</span> Let_def<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_null_space_def Let_def
  <span class="keyword1"><span class="command">unfolding</span></span> P_Gauss_Jordan_def
  <span class="keyword1"><span class="command">unfolding</span></span> rank_Gauss_Jordan_code Let_def Gauss_Jordan_PA_eq
  <span class="keyword1"><span class="command">unfolding</span></span> solve_system_def Let_def fst_conv snd_conv
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="System_Of_Equations-consistent_imp_is_solution_solve"><span class="command">lemma</span></span> consistent_imp_is_solution_solve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_solution <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> solve_def <span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> con<span class="main">]</span> fst_conv <span class="keyword1"><span class="command">using</span></span> consistent_imp_is_solution'<span class="main">[</span><span class="operator">OF</span> con<span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> consistent_eq_solution_solve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> is_solution <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consistent_def consistent_imp_is_solution_solve<span class="main">)</span>

<span class="keyword1" id="System_Of_Equations-inconsistent_imp_solve_eq_none"><span class="command">lemma</span></span> inconsistent_imp_solve_eq_none<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solve <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_def <span class="keyword1"><span class="command">unfolding</span></span> if_not_P<span class="main">[</span><span class="operator">OF</span> con<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> inconsistent_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">corollary</span></span> inconsistent_eq_solve_eq_none<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> solve_def <span class="keyword1"><span class="command">unfolding</span></span> inconsistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We demonstrate that all solutions of a system of linear equations can be expressed as a linear combination of the basis of the null space plus a particular solution
obtained. The basis and the particular solution are obtained by means of the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"solve <span class="free"><span class="free">A</span></span> <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="System_Of_Equations-solution_set_rel_solve"><span class="command">lemma</span></span> solution_set_rel_solve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">+</span> vec.span <span class="main">(</span>snd <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"is_solution <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consistent_imp_is_solution_solve<span class="main">[</span><span class="operator">OF</span> con<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">+</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> solution_set_rel<span class="main">[</span><span class="operator">OF</span> s<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">+</span> vec.span <span class="main">(</span>snd <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def solve_def <span class="keyword1"><span class="command">unfolding</span></span> if_P<span class="main">[</span><span class="operator">OF</span> con<span class="main">]</span> snd_conv fst_conv 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> vec.span <span class="main">(</span>basis_null_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> null_space_eq_solution_set<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> basis_null_space<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> vec.span <span class="main">(</span>basis_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> solution_set <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> null_space_eq_solution_set<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> basis_null_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"solution_set <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">+</span> vec.span <span class="main">(</span>snd <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="System_Of_Equations-is_solution_eq_in_span_solve"><span class="command">lemma</span></span> is_solution_eq_in_span_solve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_solution <span class="free">x</span> <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">+</span> vec.span <span class="main">(</span>snd <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> solution_set_rel_solve<span class="main">[</span><span class="operator">OF</span> con<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> solution_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Z2">
<div class="head">
<h1>Theory Code_Z2</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Z2.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Code Generation for Z2›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Z2
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Z2.html">HOL-Library.Z2</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Implementation for the field of integer numbers module 2.
Experimentally we have checked that the implementation by means of booleans is the fastest one.›</span></span>

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>bit"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>bit<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">type_constructor</span></span> bit <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Bool.bool"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>bit"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"false"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>bit"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"true"</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">type_constructor</span></span> bit <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Bool"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>bit"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"False"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>bit"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"True"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">class_instance</span></span> bit <span class="main">::</span> <span class="quoted">"HOL.equal"</span> <span class="main">=&gt;</span> <span class="main">(</span>Haskell<span class="main">)</span> - <span class="comment1">(*This is necessary. See the tutorial on code generation, page 29*)</span>


<span class="comment1">(*Other possible serialisation to Integers with arbitrary precision (performance is similar in PolyML, 
  worse in MLton and Haskell):*)</span>
<span class="comment1">(*
code_printing
  type_constructor bit ⇀ (SML) "IntInf.int"
 | constant "0::bit" ⇀ (SML) "0"
 | constant "1::bit" ⇀ (SML) "1"
 | constant "(+) :: bit =&gt; bit =&gt; bit" ⇀ (SML) "IntInf.rem ((IntInf.+ ((_), (_))), 2)"
 | constant "( * ) :: bit =&gt; bit =&gt; bit" ⇀ (SML) "IntInf.* ((_), (_))"
 | constant "(/) :: bit =&gt; bit =&gt; bit" ⇀ (SML) "IntInf.* ((_), (_))"
*)</span>
<span class="comment1">(*
code_printing
  type_constructor bit ⇀ (Haskell) "Integer"
 | constant "0::bit" ⇀ (Haskell) "0"
 | constant "1::bit" ⇀ (Haskell) "1"
 | constant "(+) :: bit =&gt; bit =&gt; bit" ⇀ (Haskell) "Prelude.rem ((_) + (_))  2"
 | constant "( * ) :: bit =&gt; bit =&gt; bit" ⇀ (Haskell) "(_) * (_)"
 | constant "(/) :: bit =&gt; bit =&gt; bit" ⇀ (Haskell) "(_) * (_)"
 | class_instance bit :: "HOL.equal" =&gt; (Haskell) - (*This is necessary. See the tutorial on code generation, page 29*)
*)</span>


<span class="comment1">(*Other possible serialisation to Integers with finite precision (performance is worse):*)</span>
<span class="comment1">(*
code_printing
  type_constructor bit ⇀ (SML) "Int.int"
 | constant "0::bit" ⇀ (SML) "0"
 | constant "1::bit" ⇀ (SML) "1"
 | constant "(+) :: bit =&gt; bit =&gt; bit" ⇀ (SML) "Int.rem ((Int.+ ((_), (_))), 2)"
 | constant "( * ) :: bit =&gt; bit =&gt; bit" ⇀ (SML) "Int.* ((_), (_))"
 | constant "(/) :: bit =&gt; bit =&gt; bit" ⇀ (SML) "Int.* ((_), (_))"
*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Examples_Gauss_Jordan_Abstract">
<div class="head">
<h1>Theory Examples_Gauss_Jordan_Abstract</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Examples_Gauss_Jordan_Abstract.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Examples of computations over abstract matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Examples_Gauss_Jordan_Abstract
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Determinants2.html">Determinants2</a>
  <a href="Inverse.html">Inverse</a>
  <a href="System_Of_Equations.html">System_Of_Equations</a>
  <a href="Code_Z2.html">Code_Z2</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Transforming a list of lists to an abstract matrix›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions to transform a matrix to a list of list and vice versa›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_to_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">}</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_to_list</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">($)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>enum_class.enum<span class="main">::</span><span class="tfree">'n</span> list<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_to_list_of_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">}</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_to_list_of_list</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> map <span class="main">(</span>vec_to_list<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">($)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>enum_class.enum<span class="main">::</span><span class="tfree">'m</span> list<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This definition should be equivalent to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vector_def›</span></span></span></span> (in suitable types)›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_to_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">,</span> mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_to_vec</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>list_to_vec <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_to_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_of_list_to_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">,</span> mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">,</span> mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_of_list_to_matrix</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> list_to_vec <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>list_of_list_to_matrix <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> list_to_vec <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_of_list_to_matrix_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Examples›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following three lemmas are presented in both this file and in the 
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Examples_Gauss_Jordan_IArrays›</span></span></span></span> one. They allow a more convenient printing of rational and
real numbers after evaluation. They have already been added to the repository version of Isabelle, 
so after Isabelle2014 they should be removed from here.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_post</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"int_of_integer <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_abbrev</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>of_rat <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_post</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>of_rat <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> numeral <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> numeral <span class="free">k</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>of_rat <span class="main">(</span><span class="main">-</span> <span class="main">(</span>numeral <span class="free">k</span> <span class="main">/</span> numeral <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> numeral <span class="free">k</span> <span class="main">/</span> numeral <span class="free">l</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_divide of_rat_minus<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Ranks and dimensions›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on computing ranks, dimensions of row space, null space and col space and the Gauss Jordan algorithm›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>Gauss_Jordan <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>Gauss_Jordan <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">7</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>rat<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>Gauss_Jordan <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>bit<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reduced_row_echelon_form_upt_k <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>Gauss_Jordan <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span>Complex <span class="main">1</span> <span class="main">1</span><span class="main">,</span>Complex <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span>Complex <span class="numeral">2</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>Complex <span class="main">1</span> <span class="numeral">3</span><span class="main">,</span> Complex <span class="numeral">7</span> <span class="numeral">3</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>complex<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">DIM</span><span class="main">(</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec.dimension <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span>bit<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec.dimension <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span>real<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*value "complex_over_reals.dimension"*)</span>
<span class="comment1">(*value "vector_space_over_itself.dimension (TYPE(real))"*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">DIM</span><span class="main">(</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"row_rank <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>row_space <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"col_rank <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>col_space <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>null_space <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span>Complex <span class="main">1</span> <span class="main">1</span><span class="main">,</span>Complex <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span>Complex <span class="numeral">2</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>Complex <span class="main">1</span> <span class="numeral">3</span><span class="main">,</span> Complex <span class="numeral">7</span> <span class="numeral">3</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>complex<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Inverse of a matrix›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on computing the inverse of matrices›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">7</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span>
                    <span class="keyword1">in</span> matrix_to_list_of_list <span class="main">(</span>P_Gauss_Jordan <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">7</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span> <span class="keyword1">in</span> 
              matrix_to_list_of_list <span class="main">(</span><span class="bound">A</span> <span class="main">**</span> <span class="main">(</span>P_Gauss_Jordan <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">7</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span>
                    <span class="keyword1">in</span> <span class="main">(</span>inverse_matrix <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">7</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span>
                    <span class="keyword1">in</span> matrix_to_list_of_list <span class="main">(</span>the <span class="main">(</span>inverse_matrix <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span> <span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">7</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span>
                    <span class="keyword1">in</span> <span class="main">(</span>inverse_matrix <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span>Complex <span class="main">1</span> <span class="main">1</span><span class="main">,</span>Complex <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span>Complex <span class="main">1</span> <span class="main">1</span><span class="main">,</span>Complex <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> Complex <span class="numeral">8</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span>Complex <span class="numeral">2</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>Complex <span class="main">1</span> <span class="numeral">3</span><span class="main">,</span> Complex <span class="numeral">7</span> <span class="numeral">3</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>complex<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>
                    <span class="keyword1">in</span> matrix_to_list_of_list <span class="main">(</span>the <span class="main">(</span>inverse_matrix <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Determinant of a matrix›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on computing determinants of matrices›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> list_of_list_to_matrix<span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">13</span><span class="main">,</span><span class="numeral">11</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">5</span> <span class="keyword1">in</span> det <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">47</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>rat<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Bases of the fundamental subspaces›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on computing basis for null space, row space, column space and left null space›</span></span>
<span class="comment1">(*Null_space basis:*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="comment1">(*Row_space basis*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
    <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_row_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_row_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="comment1">(*Col_space basis*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
    <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_col_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_col_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="comment1">(*Left_null_space basis*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
    <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_left_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_left_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Consistency and inconsistency›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on checking the consistency/inconsistency of a system of equations›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"independent_and_consistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"consistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"inconsistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"dependent_and_consistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"independent_and_consistent <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Solving systems of linear equations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on solving linear systems.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">print_result_solve</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_result_solve</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> None <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>vec_to_list <span class="main">(</span>fst <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> vec_to_list<span class="main">`</span> <span class="main">(</span>snd <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>
                  <span class="keyword1">in</span> <span class="main">(</span>print_result_solve <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>
                  <span class="keyword1">in</span> <span class="main">(</span>print_result_solve <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">11</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">13</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">;</span> 
                  <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">)</span>
                  <span class="keyword1">in</span> <span class="main">(</span>print_result_solve <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">;</span> 
                  <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>
                  <span class="keyword1">in</span> <span class="main">(</span>print_result_solve <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">;</span> 
                  <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="numeral">24</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
                  <span class="keyword1">in</span> <span class="main">(</span>print_result_solve <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IArray_Addenda">
<div class="head">
<h1>Theory IArray_Addenda</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      IArray_Addenda.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
    Maintainer: Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹IArrays Addenda›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IArray_Addenda
  <span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Library/IArray.html">HOL-Library.IArray</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some previous instances›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> iarray <span class="main">::</span> <span class="main">(</span><span class="quoted">plus</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">plus_iarray</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray <span class="main">⇒</span> <span class="tfree">'a</span> iarray <span class="main">⇒</span> <span class="tfree">'a</span> iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span>  IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">n</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">!!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> iarray <span class="main">::</span> <span class="main">(</span><span class="quoted">minus</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">minus_iarray</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray <span class="main">⇒</span> <span class="tfree">'a</span> iarray <span class="main">⇒</span> <span class="tfree">'a</span> iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">minus_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span>  IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">n</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">!!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some previous definitions and properties for IArrays›</span></span>

<span class="comment1">(*
fun find :: "('a =&gt; bool) =&gt; 'a iarray =&gt; 'a option"
  where "find f (IArray as) = List.find f as"
hide_const (open) find

primrec findi_acc_list :: "(nat × 'a =&gt; bool) =&gt; 'a list =&gt; nat =&gt; (nat × 'a) option" where
  "findi_acc_list _ [] aux = None" |
  "findi_acc_list P (x#xs) aux = (if P (aux,x) then Some (aux,x) else findi_acc_list P xs (Suc aux))"

definition "findi_list P x = findi_acc_list P x 0"

fun findi :: "(nat × 'a ⇒ bool) =&gt; 'a iarray =&gt; (nat × 'a) option"
  where "findi f (IArray as) = findi_list f as"
hide_const (open) findi

fun foldl :: "(('a × 'b) ⇒ 'b) =&gt; 'b =&gt; 'a iarray =&gt;'b"
  where "foldl f a (IArray as) = List.foldl (λx y. f (y,x)) a as"
hide_const (open) foldl

fun filter :: "('a ⇒ bool) =&gt; 'a iarray =&gt; 'a iarray"
  where "filter f (IArray as) = IArray (List.filter f as)"
hide_const (open) filter
*)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Code generation›</span></span>

<span class="comment1">(*
code_printing
  constant "IArray_Addenda.find"  ⇀ (SML) "Vector.find"
| constant "IArray_Addenda.findi" ⇀ (SML) "Vector.findi"
| constant "IArray_Addenda.foldl" ⇀ (SML) "Vector.foldl"
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Matrix_To_IArray">
<div class="head">
<h1>Theory Matrix_To_IArray</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Matrix_To_IArray.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Matrices as nested IArrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Matrix_To_IArray
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Rank_Nullity_Theorem/Mod_Type.html">Rank_Nullity_Theorem.Mod_Type</a>
  <a href="Elementary_Operations.html">Elementary_Operations</a>
  <a href="IArray_Addenda.html">IArray_Addenda</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Isomorphism between matrices implemented by vecs and matrices implemented by iarrays›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Isomorphism between vec and iarray›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_to_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span> iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_to_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iarray_to_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iarray_to_vec</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*
definition iarray_to_vec_option :: "'a iarray ⇒ ('a^'n::{mod_type}) option"
where "iarray_to_vec_option A = (if (IArray.length A) = CARD('n)
                                    then Some (χ i::'n. A!!(to_nat i)) 
                                    else None)"
*)</span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_nth"><span class="command">lemma</span></span> vec_to_iarray_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def <span class="keyword1"><span class="command">using</span></span> of_fun_nth<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_nth'"><span class="command">lemma</span></span> vec_to_iarray_nth'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def <span class="keyword1"><span class="command">unfolding</span></span> of_fun_nth<span class="main">[</span><span class="operator">OF</span> to_nat_less_card<span class="main">]</span> from_nat_to_nat_id <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-iarray_to_vec_nth"><span class="command">lemma</span></span> iarray_to_vec_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iarray_to_vec <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> iarray_to_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_morph"><span class="command">lemma</span></span> vec_to_iarray_morph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_to_iarray <span class="free">A</span> <span class="main">=</span> vec_to_iarray <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_eq_iff vec_to_iarray_nth'<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-inj_vec_to_iarray"><span class="command">lemma</span></span> inj_vec_to_iarray<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj vec_to_iarray"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vec_to_iarray_morph <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Matrix_To_IArray-iarray_to_vec_vec_to_iarray"><span class="command">lemma</span></span> iarray_to_vec_vec_to_iarray<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iarray_to_vec <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">=</span><span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> vec_to_iarray_def iarray_to_vec_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> to_nat <span class="skolem">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_iarray_to_vec"><span class="command">lemma</span></span> vec_to_iarray_iarray_to_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> length_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"IArray.length <span class="free">A</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>iarray_to_vec <span class="free">A</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> vec_to_iarray_def iarray_to_vec_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> IArray <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iarray.exhaust<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> IArray.list_of <span class="free">A</span> <span class="main">!</span> to_nat <span class="main">(</span>from_nat <span class="bound">i</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> xs iarray.inject list_eq_iff_nth_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_eq <span class="keyword1"><span class="command">unfolding</span></span> xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">!</span> to_nat <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-length_vec_to_iarray"><span class="command">lemma</span></span> length_vec_to_iarray<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IArray.length <span class="main">(</span>vec_to_iarray <span class="free">xa</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Isomorphism between matrix and nested iarrays›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_to_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_to_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IArray <span class="main">(</span>map <span class="main">(</span>vec_to_iarray <span class="main">∘</span> <span class="main">(</span><span class="main">($)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>from_nat<span class="main">::</span>nat<span class="main">=&gt;</span><span class="tfree">'m</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'m</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iarray_to_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray iarray <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iarray_to_matrix</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_morph"><span class="command">lemma</span></span> matrix_to_iarray_morph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span> <span class="main">=</span> matrix_to_iarray <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">unfolding</span></span> forall_from_nat_rw<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span><span class="free">B</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id vec_eq_iff vec_to_iarray_morph<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_eq_of_fun"><span class="command">lemma</span></span> matrix_to_iarray_eq_of_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vec_eq_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n_eq_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span>IArray.length <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="free">A</span> <span class="main">=</span> IArray.of_fun <span class="free">f</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> IArray.of_fun_def matrix_to_iarray_def iarray.inject list_eq_iff_nth_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_eq_length <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> i_less_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_eq_f  <span class="keyword1"><span class="command">using</span></span> i_less_n
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-map_vec_to_iarray_rw"><span class="command">lemma</span></span> map_vec_to_iarray_rw<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> to_nat <span class="free">i</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> i_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> to_nat <span class="free">i</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> from_nat <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_nth"><span class="command">lemma</span></span> matrix_to_iarray_nth<span class="main">:</span>
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> to_nat <span class="free">i</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def <span class="keyword1"><span class="command">using</span></span> vec_to_iarray_nth' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_To_IArray-vec_matrix"><span class="command">lemma</span></span> vec_matrix<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Matrix_To_IArray-iarray_to_matrix_matrix_to_iarray"><span class="command">lemma</span></span> iarray_to_matrix_matrix_to_iarray<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iarray_to_matrix <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">=</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def iarray_to_matrix_def o_def  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> IArray.sub_def vec_to_iarray_nth'<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition of operations over matrices implemented by iarrays›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>times<span class="main">}</span> iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">n</span><span class="main">)</span> <span class="main">(</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_iarray</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">column_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray  <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">column_iarray</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">m</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">(</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nrows_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nrows_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ncols_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ncols_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IArray.length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rows_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span>row_iarray <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">columns_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span>column_iarray <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tabulate2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tabulate2</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> IArray.of_fun <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">transpose_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">transpose_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span>  tabulate2 <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">b</span><span class="main">!!</span><span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_matrix_mult_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>times<span class="main">,</span> comm_monoid_add<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">**i</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">**i</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">i</span><span class="main">)</span><span class="main">!!</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">!!</span><span class="bound">k</span><span class="main">)</span><span class="main">!!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_vector_mult_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*iv</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">*iv</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">i</span><span class="main">)</span><span class="main">!!</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">!!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vector_matrix_mult_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span> iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">v*i</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">v*i</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">i</span><span class="main">)</span><span class="main">!!</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">!!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_iarray</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> tabulate2 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_zero_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span> iarray <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_zero_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IArray.all <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties of previous definitions›</span></span>
<span class="keyword1" id="Matrix_To_IArray-is_zero_iarray_eq_iff"><span class="command">lemma</span></span> is_zero_iarray_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_to_iarray_def is_zero_iarray_def Option.is_none_def find_None_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_to_iarray_def is_zero_iarray_def Option.is_none_def find_None_iff vec_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> mod_type_class.from_nat <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> eq_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-mult_iarray_works"><span class="command">lemma</span></span> mult_iarray_works<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span>IArray.length <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult_iarray <span class="free">A</span> <span class="free">q</span> <span class="main">!!</span> <span class="free">a</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="free">A</span><span class="main">!!</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_iarray_def
  <span class="keyword1"><span class="command">unfolding</span></span> IArray.of_fun_def <span class="keyword1"><span class="command">unfolding</span></span> sub_def
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Matrix_To_IArray-length_eq_card_rows"><span class="command">lemma</span></span> length_eq_card_rows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IArray.length <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_To_IArray-nrows_eq_card_rows"><span class="command">lemma</span></span> nrows_eq_card_rows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def length_eq_card_rows <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Matrix_To_IArray-length_eq_card_columns"><span class="command">lemma</span></span> length_eq_card_columns<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IArray.length <span class="main">(</span>matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'columns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def vec_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Matrix_To_IArray-ncols_eq_card_columns"><span class="command">lemma</span></span> ncols_eq_card_columns<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'columns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ncols_iarray_def length_eq_card_columns <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_nrows"><span class="command">lemma</span></span> matrix_to_iarray_nrows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">=</span> nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_def nrows_eq_card_rows <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_ncols"><span class="command">lemma</span></span> matrix_to_iarray_ncols<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ncols <span class="free">A</span> <span class="main">=</span> ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ncols_def ncols_eq_card_columns <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_row"><span class="command">lemma</span></span> vec_to_iarray_row<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row <span class="free">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row_iarray <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> row_def row_iarray_def vec_to_iarray_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> IArray.sub_def IArray.of_fun_def vec_matrix vec_to_iarray_def<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_row'"><span class="command">lemma</span></span> vec_to_iarray_row'<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row <span class="free">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> row_def vec_to_iarray_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> IArray.sub_def IArray.of_fun_def vec_matrix vec_to_iarray_def<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_column"><span class="command">lemma</span></span> vec_to_iarray_column<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>column <span class="free">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> column_iarray <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> column_def vec_to_iarray_def column_iarray_def length_eq_card_rows
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> IArray.sub_def from_nat_not_eq vec_matrix vec_to_iarray_nth'<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_column'"><span class="command">lemma</span></span> vec_to_iarray_column'<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_iarray <span class="main">(</span>column <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>column_iarray <span class="free">k</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Matrix_To_IArray-column_iarray_nth"><span class="command">lemma</span></span> column_iarray_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows_iarray <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"column_iarray <span class="free">j</span> <span class="free">A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"column_iarray <span class="free">j</span> <span class="free">A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">!!</span> <span class="bound">m</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="free">A</span><span class="main">]</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> column_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">!!</span> <span class="bound">m</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="free">A</span><span class="main">]</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i nth_map <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">!!</span> <span class="bound">m</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nth_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"IArray.length <span class="free">A</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_rows"><span class="command">lemma</span></span> vec_to_iarray_rows<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray<span class="main">`</span> <span class="main">(</span>rows <span class="free">A</span><span class="main">)</span> <span class="main">=</span> rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rows_def <span class="keyword1"><span class="command">unfolding</span></span> rows_iarray_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_to_iarray_row to_nat_less_card nrows_eq_card_rows<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> from_nat_not_eq vec_to_iarray_row<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_columns"><span class="command">lemma</span></span> vec_to_iarray_columns<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray<span class="main">`</span> <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span> <span class="main">=</span> columns_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">unfolding</span></span> columns_iarray_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_eq_card_columns to_nat_less_card vec_to_iarray_column<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> from_nat_not_eq vec_to_iarray_column<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition of elementary operations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interchange_rows_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">interchange_rows_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">n</span><span class="main">)</span> <span class="main">(</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_row_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>times<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_row_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> mult_iarray <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">n</span><span class="main">)</span> <span class="main">(</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_add_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span> times<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_add_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> mult_iarray <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!!</span><span class="bound">n</span><span class="main">)</span> <span class="main">(</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interchange_columns_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">interchange_columns_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>  tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_column_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>times<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_column_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">j</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">column_add_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span> times<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">column_add_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Code generator›</span></span>

<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_plus"><span class="command">lemma</span></span> vec_to_iarray_plus<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>vec_to_iarray <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def
  <span class="keyword1"><span class="command">unfolding</span></span> plus_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_plus"><span class="command">lemma</span></span> matrix_to_iarray_plus<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>matrix_to_iarray <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_iarray_def vec_to_iarray_plus<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_mat"><span class="command">lemma</span></span> matrix_to_iarray_mat<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>mat <span class="free">k</span> <span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> mat_iarray <span class="free">k</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def vec_to_iarray_def mat_def mat_iarray_def tabulate2_def
  <span class="keyword1"><span class="command">using</span></span> from_nat_eq_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_transpose"><span class="command">lemma</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def transpose_def transpose_iarray_def 
    o_def tabulate2_def nrows_iarray_def ncols_iarray_def vec_to_iarray_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_matrix_matrix_mult"><span class="command">lemma</span></span> matrix_to_iarray_matrix_matrix_mult<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="keyword1">**i</span> <span class="main">(</span>matrix_to_iarray <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def matrix_matrix_mult_iarray_def matrix_matrix_mult_def 
  <span class="keyword1"><span class="command">unfolding</span></span> o_def tabulate2_def nrows_iarray_def ncols_iarray_def vec_to_iarray_def
  <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat<span class="main">::</span>nat<span class="main">=&gt;</span><span class="tfree">'m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> bij_from_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_matrix_matrix_mult"><span class="command">lemma</span></span> vec_to_iarray_matrix_matrix_mult<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="keyword1">*iv</span> <span class="main">(</span>vec_to_iarray <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mult_iarray_def matrix_vector_mult_def 
  <span class="keyword1"><span class="command">unfolding</span></span> o_def tabulate2_def nrows_iarray_def ncols_iarray_def matrix_to_iarray_def vec_to_iarray_def
  <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat<span class="main">::</span>nat<span class="main">=&gt;</span><span class="tfree">'m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> bij_from_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1" id="Matrix_To_IArray-vec_to_iarray_vector_matrix_mult"><span class="command">lemma</span></span> vec_to_iarray_vector_matrix_mult<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span><span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_to_iarray <span class="free">x</span><span class="main">)</span> <span class="keyword1">v*i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vector_matrix_mult_def vector_matrix_mult_iarray_def 
  <span class="keyword1"><span class="command">unfolding</span></span> o_def tabulate2_def nrows_iarray_def ncols_iarray_def matrix_to_iarray_def vec_to_iarray_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'n</span> set<span class="main">)</span> <span class="main">=</span> from_nat <span class="main">`</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> bij_from_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> from_nat <span class="skolem">xa</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">i</span> <span class="main">$</span> from_nat <span class="skolem">xa</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat<span class="main">::</span>nat<span class="main">=&gt;</span><span class="tfree">'n</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">using</span></span> bij_from_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_interchange_rows"><span class="command">lemma</span></span> matrix_to_iarray_interchange_rows<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_to_iarray_def interchange_rows_iarray_def o_def map_vec_to_iarray_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> to_nat <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> to_nat <span class="free">i</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="main">$</span> from_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> interchange_rows_preserves to_nat_from_nat_id x_less_card x_not_i x_not_j<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_mult_row"><span class="command">lemma</span></span> matrix_to_iarray_mult_row<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mult_row_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def mult_row_iarray_def o_def
  <span class="keyword1"><span class="command">unfolding</span></span> mult_iarray_def vec_to_iarray_def mult_row_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> i_contr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> to_nat <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'columns</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> to_nat <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">i</span> <span class="main">$</span> from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">i</span> <span class="main">$</span> from_nat <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_contr <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_row_add"><span class="command">lemma</span></span> matrix_to_iarray_row_add<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>row_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> row_add_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_to_iarray_def row_add_iarray_def o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">+</span> mult_iarray <span class="main">(</span>vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_iarray_def vec_to_iarray_def <span class="keyword1"><span class="command">unfolding</span></span> plus_iarray_def row_add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="keyword3"><span class="command">assume</span></span> ia_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">≠</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ia_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">have</span></span> from_nat_ia_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> from_nat <span class="skolem">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">ia</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="skolem">ia</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span><span class="main">=</span>to_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id ia_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">using</span></span> ia_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span> <span class="main">$</span> from_nat <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">ia</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ia_not_i
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_morph<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> row_add_def <span class="keyword1"><span class="command">using</span></span> from_nat_ia_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">vector</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_interchange_columns"><span class="command">lemma</span></span> matrix_to_iarray_interchange_columns<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>interchange_columns <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> interchange_columns_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> interchange_columns_def interchange_columns_iarray_def o_def tabulate2_def
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows ncols_eq_card_columns 
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def vec_to_iarray_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id to_nat_less_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="main">]</span></span> to_nat_less_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_mult_columns"><span class="command">lemma</span></span> matrix_to_iarray_mult_columns<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>mult_column <span class="free">A</span> <span class="free">i</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mult_column_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_column_def mult_column_iarray_def o_def tabulate2_def
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows ncols_eq_card_columns 
  <span class="keyword1"><span class="command">unfolding</span></span>  matrix_to_iarray_def o_def vec_to_iarray_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id<span class="main">)</span>

<span class="keyword1" id="Matrix_To_IArray-matrix_to_iarray_column_add"><span class="command">lemma</span></span> matrix_to_iarray_column_add<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>column_add <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> column_add_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> column_add_def column_add_iarray_def o_def tabulate2_def
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows ncols_eq_card_columns 
  <span class="keyword1"><span class="command">unfolding</span></span>  matrix_to_iarray_def o_def vec_to_iarray_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_from_nat_id to_nat_less_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="main">]</span></span> to_nat_less_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gauss_Jordan_IArrays">
<div class="head">
<h1>Theory Gauss_Jordan_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Gauss_Jordan_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Gauss Jordan algorithm over nested IArrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Gauss_Jordan_IArrays
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Matrix_To_IArray.html">Matrix_To_IArray</a>
  <a href="Gauss_Jordan.html">Gauss_Jordan</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions and functions to compute the Gauss-Jordan algorithm over matrices represented as nested iarrays›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">least_non_zero_position_of_vector_from_index</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> the <span class="main">(</span>List.find <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">..&lt;</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">least_non_zero_position_of_vector</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vector_all_zero_from_index</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span> iarray<span class="main">)</span> <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vector_all_zero_from_index</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i</span><span class="main">=</span>fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span> <span class="keyword1">in</span> IArray.all <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">A</span><span class="main">!!</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>IArray <span class="main">[</span><span class="bound">i</span><span class="main">..&lt;</span><span class="main">(</span>IArray.length <span class="bound">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_in_ij_iarrays</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span> iarray iarray "</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_in_ij_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">;</span>
  <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">n</span><span class="main">;</span> 
  <span class="bound">A'</span> <span class="main">=</span> mult_row_iarray <span class="bound">interchange_A</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="bound">interchange_A</span><span class="main">!!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">!!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> 
  <span class="keyword1">in</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="bound">A'</span> <span class="main">!!</span> <span class="bound">s</span> <span class="keyword1">else</span> row_add_iarray <span class="bound">A'</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="bound">s</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">!!</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_column_k_iarrays</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray<span class="main">)</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'a</span> iarray iarray<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_column_k_iarrays</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">i</span><span class="main">=</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
  <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>vector_all_zero_from_index <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span>column_iarray <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>nrows_iarray <span class="bound">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">,</span> <span class="main">(</span>Gauss_Jordan_in_ij_iarrays <span class="bound">A</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_upt_k_iarrays</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_upt_k_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_iarrays</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Gauss_Jordan_upt_k_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proving the equivalence between Gauss-Jordan algorithm over nested iarrays and over nested vecs (abstract matrices).›</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-vector_all_zero_from_index_eq"><span class="command">lemma</span></span> vector_all_zero_from_index_eq<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span> vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_all_zero_from_index_def Let_def Option.is_none_def find_None_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span>length <span class="main">(</span>IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_le_x<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_le_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> x_length <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i_le_from_nat_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> from_nat <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> from_nat_mono'<span class="main">[</span><span class="operator">OF</span> i_le_x x_le_card<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> Axk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="skolem">x</span> <span class="main">=</span> vec_to_iarray <span class="free">A</span> <span class="main">!!</span> to_nat <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> x_le_card<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_nth' <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Axk <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">" IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> IArray.sub_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> zero_assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>mod_type_class.to_nat <span class="free">i</span><span class="main">..&lt;</span>length <span class="main">(</span>IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> i_le_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span>length <span class="main">(</span>IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> mod_type_class.to_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟶</span> IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_i_le_m<span class="main">:</span><span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> to_nat <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_mono'<span class="main">[</span><span class="operator">OF</span> i_le_m<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> m_le_length<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">m</span> <span class="main">&lt;</span> IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def <span class="keyword1"><span class="command">using</span></span> to_nat_less_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">=</span> vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_nth' <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero to_nat_i_le_m m_le_length <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IArray.sub_def IArray.length_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-matrix_vector_all_zero_from_index"><span class="command">lemma</span></span> matrix_vector_all_zero_from_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Gauss_Jordan_IArrays-vec_to_iarray_least_non_zero_position_of_vector_from_index"><span class="command">lemma</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span>  vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"least_non_zero_position_of_vector_from_index <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> List.find <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> Some <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> IArray.sub_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> IArray.length_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"List.find <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> None"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">[</span>mod_type_class.to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span> vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> find_None_iff <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_all_zero <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> IArray.length_def IArray.sub_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> length_vec_to_iarray<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> to_nat_less_card to_nat_mono' vec_to_iarray_nth'<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"List.find <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ia</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    ia_less_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span><span class="main">&lt;</span>length <span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    not_eq_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span><span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">ja</span></span><span class="main">&lt;</span><span class="skolem">ia</span><span class="main">.</span> <span class="main">¬</span> vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span><span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="bound">ja</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> find_Some_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">have</span></span> not_eq_zero'<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_eq_zero <span class="keyword1"><span class="command">unfolding</span></span> a_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_less_a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  ia_less_length length_upt nth_upt a_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_eq ia_less_length <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_nth'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_eq_zero' <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> a_less_card<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> from_nat <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_less_card from_nat_mono' from_nat_to_nat_id i_less_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">x</span>  <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> Axj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_le_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>   
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> from_nat <span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> x_less_from_nat_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> from_nat <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ja</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">=</span> <span class="main">(</span>to_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> to_nat_x_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> ja_less_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&lt;</span> IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ja_def vec_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">ja</span> <span class="main">=</span> to_nat <span class="free">i</span> <span class="main">+</span> <span class="skolem">ja</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_upt<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> vec_to_iarray_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_diff_inverse diff_add_zero ja_def not_less_iff_gr_or_eq to_nat_less_card<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> i_plus_ja<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ja_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_le_x to_nat_mono'<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> list_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>to_nat <span class="free">i</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">ja</span> <span class="main">=</span> to_nat <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span><span class="main">&lt;</span><span class="skolem">ia</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> to_nat <span class="free">i</span> <span class="main">+</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_eq 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_upt<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ia_less_length length_upt less_diff_conv add.commute<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_plus_ja add_less_cancel_right add.commute to_nat_le x_less_from_nat_a<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> least <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_nth' <span class="keyword1"><span class="command">.</span></span>  
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Axj <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> a_less_card<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_non_zero_position_of_vector_from_index_def <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"least_non_zero_position_of_vector_from_index <span class="main">(</span>vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index<span class="main">[</span><span class="operator">OF</span> not_all_zero<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">corollary</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index''<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">j</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>row <span class="free">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"least_non_zero_position_of_vector_from_index <span class="main">(</span>vec_to_iarray <span class="main">(</span>row <span class="free">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index<span class="main">[</span><span class="operator">OF</span> not_all_zero<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1" id="Gauss_Jordan_IArrays-matrix_to_iarray_Gauss_Jordan_in_ij"><span class="command">lemma</span></span> matrix_to_iarray_Gauss_Jordan_in_ij<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Gauss_Jordan_in_ij <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_in_ij_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_def Gauss_Jordan_in_ij_iarrays_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_eq_of_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> IArray.sub_def IArray.length_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span>
    mult_row_iarray
     <span class="main">(</span>interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
       <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
           <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">i</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main">[</span><span class="operator">OF</span> not_all_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_interchange_rows<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mult_row<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_i
    <span class="keyword1"><span class="command">unfolding</span></span> vec_matrix <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray
          <span class="main">(</span>row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ia</span> <span class="free">i</span>
            <span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span>
         row_add_iarray
          <span class="main">(</span>mult_row_iarray
            <span class="main">(</span>interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
              <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
            <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
                  <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span>
                 to_nat <span class="free">i</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>to_nat <span class="skolem">ia</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
          <span class="main">(</span><span class="main">-</span> interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
              <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span>
             to_nat <span class="skolem">ia</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="skolem">ia</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main">[</span><span class="operator">OF</span> not_all_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_interchange_rows<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mult_row<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_i
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_row_add<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_matrix <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span>
    IArray.length <span class="main">(</span>matrix_to_iarray
    <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span>
    <span class="keyword1">else</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span> <span class="free">i</span>
    <span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> length_eq_card_rows nrows_eq_card_rows <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan_IArrays-matrix_to_iarray_Gauss_Jordan_column_k_1"><span class="command">lemma</span></span> matrix_to_iarray_Gauss_Jordan_column_k_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Let_def Gauss_Jordan_column_k_iarrays_def fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">unfolded</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> matrix_vector_all_zero_from_index<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'rows</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'columns</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_Gauss_Jordan_in_ij    
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_all_zero_from_index <span class="main">(</span>nrows <span class="free">A</span><span class="main">,</span> column_iarray <span class="free">k</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def  snd_conv fst_conv
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_def column_iarray_def
  <span class="keyword1"><span class="command">unfolding</span></span> length_eq_card_rows <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_none_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> i False
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_iarrays_def Gauss_Jordan_column_k_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-matrix_to_iarray_Gauss_Jordan_column_k_2"><span class="command">lemma</span></span> matrix_to_iarray_Gauss_Jordan_column_k_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Let_def Gauss_Jordan_column_k_iarrays_def fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">unfolded</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'rows</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'columns</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_Gauss_Jordan_in_ij<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'rows</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'columns</span>"</span></span><span class="main">]</span>    
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Let_def Gauss_Jordan_column_k_iarrays_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_to_iarray_nrows<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Due to the assumptions presented in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix_to_iarray_Gauss_Jordan_column_k_2"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, the following lemma must have three shows.
The proof style is similar to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "rref_and_index_Gauss_Jordan_upt_k"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-foldl_Gauss_Jordan_column_k_eq"><span class="command">lemma</span></span> foldl_Gauss_Jordan_column_k_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> matrix_to_iarray_Gauss_Jordan_upt_k<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fst_foldl_Gauss_Jordan_column_k_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fst_foldl_Gauss_Jordan_column_k_less<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def Gauss_Jordan_upt_k_iarrays_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> k le0 less_nat_zero_code matrix_to_iarray_Gauss_Jordan_column_k_2 neq0_conv<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def Gauss_Jordan_upt_k_iarrays_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> gr_implies_not0 k le0 matrix_to_iarray_Gauss_Jordan_column_k_1 neq0_conv<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gauss_Jordan_column_k_def Let_def size1 nrows_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> matrix_to_iarray <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Suc_k_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp3<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> hyp1_unfolded<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hyp1 <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def Gauss_Jordan_upt_k_iarrays_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> upt_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fold_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fold_rw'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> upt_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw'<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> hyp2 <span class="keyword1"><span class="command">unfolding</span></span> hyp1_unfolded<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_Gauss_Jordan_column_k_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">k</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>snd <span class="main"><span class="main">(</span></span>foldl Gauss_Jordan_column_k <span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">..&lt;</span></span>Suc <span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> Suc_k_less_card <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp3 <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Gauss_Jordan_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_def Gauss_Jordan_upt_k_iarrays_def  upt_rw foldl_append  List.foldl.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw'<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> hyp2 hyp1_unfolded<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_Gauss_Jordan_column_k_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> ncols_def nrows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'columns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k_less_card <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp3 <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldl Gauss_Jordan_column_k <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> upt_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw'<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Let_def
    <span class="keyword1"><span class="command">using</span></span> hyp3 le_antisym not_less_eq_eq <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Gauss_Jordan_IArrays-matrix_to_iarray_Gauss_Jordan"><span class="command">lemma</span></span> matrix_to_iarray_Gauss_Jordan<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_iarrays_def ncols_iarray_def <span class="keyword1"><span class="command">unfolding</span></span> length_eq_card_columns
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gauss_Jordan_def matrix_to_iarray_Gauss_Jordan_upt_k ncols_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Implementation over IArrays of the computation of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"rank"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of a matrix›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rank_iarray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rank_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">nrows</span> <span class="main">=</span> <span class="main">(</span>IArray.length <span class="bound">A'</span><span class="main">)</span> <span class="keyword1">in</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">nrows</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_iarray <span class="main">(</span><span class="bound">A'</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proving the equivalence between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"rank"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"rank_iarray"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹First of all, some code equations are removed to allow the execution of Gauss-Jordan algorithm using iarrays›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> card'_code<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> rank_Gauss_Jordan_code<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>


<span class="keyword1" id="Gauss_Jordan_IArrays-rank_eq_card_iarrays"><span class="command">lemma</span></span> rank_eq_card_iarrays<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> card <span class="main">{</span>vec_to_iarray <span class="main">(</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="main">(</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> rank_Gauss_Jordan_eq Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"vec_to_iarray"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on vec_to_iarray <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_vec_to_iarray <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ia</span><span class="main">.</span> vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span>row <span class="bound">ia</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="main">(</span>row <span class="bound">ia</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> is_zero_iarray_eq_iff <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> not_zero_iarray<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> vec_to_iarray <span class="main">`</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_zero_iarray  is_zero_iarray_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan_IArrays-rank_eq_card_iarrays'"><span class="command">lemma</span></span> rank_eq_card_iarrays'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span> card <span class="main">{</span>row_iarray <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span> <span class="bound">A'</span> <span class="main">|</span><span class="bound">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="main">(</span><span class="bound">A'</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_card_iarrays vec_to_iarray_row'  matrix_to_iarray_Gauss_Jordan row_iarray_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-rank_eq_card_iarrays_code"><span class="command">lemma</span></span> rank_eq_card_iarrays_code<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span> card <span class="main">{</span><span class="bound">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="main">(</span><span class="bound">A'</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> rank_eq_card_iarrays' Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> row_iarray <span class="main"><span class="main">(</span></span>to_nat <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>Gauss_Jordan_iarrays <span class="main"><span class="main">(</span></span>matrix_to_iarray <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">unfold</span> bij_betw_def inj_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> IArray.sub_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_iarray <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_iarray <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"row_iarray <span class="main">(</span>to_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> row_iarray <span class="main">(</span>to_nat <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq matrix_to_iarray_Gauss_Jordan row_iarray_def vec_matrix vec_to_iarray_morph<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> not_zero_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">y</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  is_zero_iarray_eq_iff is_zero_row_def' matrix_to_iarray_Gauss_Jordan vec_eq_iff vec_matrix x zero_index<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">x</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y_in<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">y</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span>row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">.</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> is_zero_iarray_eq_iff matrix_to_iarray_Gauss_Jordan mem_Collect_eq vec_to_iarray_row' x y<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_index_independent_rows<span class="main">[</span><span class="operator">OF</span> _ x_in eq'<span class="main">]</span> rref_Gauss_Jordan <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Code equations for computing the rank over nested iarrays and the dimensions of the elementary subspaces›</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-rank_iarrays_code"><span class="command">lemma</span></span> rank_iarrays_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rank_iarray <span class="free">A</span> <span class="main">=</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>IArray.list_of <span class="main">(</span>Gauss_Jordan_iarrays <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> A_eq_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Gauss_Jordan_iarrays <span class="free">A</span><span class="main">)</span> <span class="main">=</span> IArray <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iarray.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_iarray <span class="free">A</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>IArray.length <span class="main">(</span>Gauss_Jordan_iarrays <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_iarray <span class="main">(</span><span class="main">(</span>Gauss_Jordan_iarrays <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_iarray_def Let_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>IArray.list_of <span class="main">(</span>Gauss_Jordan_iarrays <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A_eq_xs <span class="keyword1"><span class="command">using</span></span> length_filter_conv_card<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-matrix_to_iarray_rank"><span class="command">lemma</span></span> matrix_to_iarray_rank<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">=</span> rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_card_iarrays_code rank_iarray_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">unfolding</span></span> IArray.length_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> IArray.sub_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inj_onI to_nat_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span>  matrix_to_iarray_Gauss_Jordan<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> length_eq_card_rows
  <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gauss_Jordan_IArrays-dim_null_space_iarray"><span class="command">lemma</span></span> dim_null_space_iarray<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">-</span> rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dim_null_space ncols_eq_card_columns matrix_to_iarray_rank dimension_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Gauss_Jordan_IArrays-dim_col_space_iarray"><span class="command">lemma</span></span> dim_col_space_iarray<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>col_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_dim_col_space<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>  matrix_to_iarray_rank <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-dim_row_space_iarray"><span class="command">lemma</span></span> dim_row_space_iarray<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>row_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> row_rank_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rank_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> matrix_to_iarray_rank <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan_IArrays-dim_left_null_space_space_iarray"><span class="command">lemma</span></span> dim_left_null_space_space_iarray<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>left_null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">-</span> rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dim_left_null_space nrows_eq_card_rows matrix_to_iarray_rank dimension_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gauss_Jordan_PA_IArrays">
<div class="head">
<h1>Theory Gauss_Jordan_PA_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Gauss_Jordan_PA_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Obtaining explicitly the invertible matrix which transforms a matrix to its reduced row echelon form over nested iarrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Gauss_Jordan_PA_IArrays
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Gauss_Jordan_PA.html">Gauss_Jordan_PA</a>
  <a href="Gauss_Jordan_IArrays.html">Gauss_Jordan_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_in_ij_iarrays_PA</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">let</span>  <span class="bound">P</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">A</span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">n</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">;</span> <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows_iarray <span class="bound">A</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">n</span><span class="main">;</span>
 <span class="bound">interchange_P</span> <span class="main">=</span> interchange_rows_iarray <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">n</span><span class="main">;</span> <span class="bound">P'</span> <span class="main">=</span> mult_row_iarray <span class="bound">interchange_P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>
 <span class="keyword1">in</span> <span class="main">(</span>IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="bound">P'</span> <span class="main">!!</span> <span class="bound">s</span> <span class="keyword1">else</span> row_add_iarray <span class="bound">P'</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">-</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="bound">s</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">!!</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="bound">A</span><span class="main">)</span><span class="main">,</span> Gauss_Jordan_in_ij_iarrays <span class="bound">A</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_column_k_iarrays_PA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">×</span> nat <span class="main">×</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray<span class="main">)</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> iarray iarray <span class="main">×</span> nat <span class="main">×</span> <span class="tfree">'a</span> iarray iarray<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_column_k_iarrays_PA</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">P</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">i</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">A</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span> <span class="keyword1">in</span> 
  <span class="keyword1">if</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span>column_iarray <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>nrows_iarray <span class="bound">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">i</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">Gauss</span> <span class="main">=</span> Gauss_Jordan_in_ij_iarrays_PA <span class="main">(</span><span class="bound">P</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>
    <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">Gauss</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> snd <span class="bound">Gauss</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_upt_k_iarrays_PA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">×</span> <span class="tfree">'a</span> iarray iarray<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_upt_k_iarrays_PA</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">foldl</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">foldl</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="bound">foldl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gauss_Jordan_iarrays_PA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> iarray iarray <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> iarray iarray  <span class="main">×</span> <span class="tfree">'a</span> iarray iarray<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_iarrays_PA</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Gauss_Jordan_upt_k_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_iarrays_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-Gauss_Jordan_in_ij_iarrays_PA_def'"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_iarrays_PA_def'<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
<span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_iarrays_PA <span class="free">A'</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">let</span>  <span class="bound">P</span> <span class="main">=</span> fst <span class="free">A'</span><span class="main">;</span> <span class="bound">A</span> <span class="main">=</span> snd <span class="free">A'</span><span class="main">;</span> <span class="bound">n</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="free">j</span> <span class="bound">A</span><span class="main">)</span> <span class="free">i</span><span class="main">;</span> 
  <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows_iarray <span class="bound">A</span> <span class="free">i</span> <span class="bound">n</span><span class="main">;</span> <span class="bound">A'</span> <span class="main">=</span> mult_row_iarray <span class="bound">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">interchange_P</span> <span class="main">=</span> interchange_rows_iarray <span class="bound">P</span> <span class="free">i</span> <span class="bound">n</span><span class="main">;</span> <span class="bound">P'</span> <span class="main">=</span> mult_row_iarray <span class="bound">interchange_P</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span>
 <span class="keyword1">in</span> <span class="main">(</span>IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">P'</span> <span class="main">!!</span> <span class="bound">s</span> <span class="keyword1">else</span> row_add_iarray <span class="bound">P'</span> <span class="bound">s</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="bound">s</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="bound">A</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">A'</span> <span class="main">!!</span> <span class="bound">s</span> <span class="keyword1">else</span> row_add_iarray <span class="bound">A'</span> <span class="bound">s</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="bound">s</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_iarrays_PA_def Gauss_Jordan_in_ij_iarrays_def Let_def <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1" id="Gauss_Jordan_PA_IArrays-snd_Gauss_Jordan_in_ij_iarrays_PA"><span class="command">lemma</span></span> snd_Gauss_Jordan_in_ij_iarrays_PA<span class="main">:</span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_in_ij_iarrays_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_in_ij_iarrays <span class="free">A</span> <span class="free">i</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_iarrays_PA_def Gauss_Jordan_in_ij_iarrays_def Let_def snd_conv <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-matrix_to_iarray_snd_Gauss_Jordan_in_ij_iarrays_PA"><span class="command">lemma</span></span> matrix_to_iarray_snd_Gauss_Jordan_in_ij_iarrays_PA<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_in_ij_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">P</span><span class="main">,</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms matrix_to_iarray_Gauss_Jordan_in_ij snd_Gauss_Jordan_in_ij_PA_eq snd_Gauss_Jordan_in_ij_iarrays_PA<span class="main">)</span>


<span class="keyword1" id="Gauss_Jordan_PA_IArrays-matrix_to_iarray_fst_Gauss_Jordan_in_ij_iarrays_PA"><span class="command">lemma</span></span> matrix_to_iarray_fst_Gauss_Jordan_in_ij_iarrays_PA<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_in_ij_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_in_ij_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">P</span><span class="main">,</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Gauss_Jordan_in_ij_PA_def Gauss_Jordan_in_ij_iarrays_PA_def Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_eq_of_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> IArray.length_def IArray.sub_def<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span>
    mult_row_iarray <span class="main">(</span>interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">P</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
       <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
     <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
           <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">i</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main">[</span><span class="operator">OF</span> not_all_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_interchange_rows<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mult_row<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_i
    <span class="keyword1"><span class="command">unfolding</span></span> vec_matrix <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ia</span> <span class="free">i</span>
            <span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span><span class="main">)</span> <span class="main">=</span>
         row_add_iarray <span class="main">(</span>mult_row_iarray <span class="main">(</span>interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">P</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
              <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
            <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
                  <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span>
                 to_nat <span class="free">i</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="skolem">ia</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
          <span class="main">(</span><span class="main">-</span> interchange_rows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>
              <span class="main">(</span>least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span>
             to_nat <span class="skolem">ia</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="skolem">ia</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main">[</span><span class="operator">OF</span> not_all_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_interchange_rows<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mult_row<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth
    <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_i
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_row_add<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_matrix <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> IArray.length <span class="main">(</span>matrix_to_iarray
       <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span>
             <span class="keyword1">else</span> row_add <span class="main">(</span>mult_row <span class="main">(</span>interchange_rows <span class="free">P</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span> <span class="free">i</span>
             <span class="main">(</span><span class="main">-</span> interchange_rows <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> length_eq_card_rows nrows_eq_card_rows <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_column_k_iarrays_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-matrix_to_iarray_fst_Gauss_Jordan_column_k_PA"><span class="command">lemma</span></span> matrix_to_iarray_fst_Gauss_Jordan_column_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">P</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_PA_def Gauss_Jordan_column_k_iarrays_PA_def Let_def
<span class="keyword1"><span class="command">unfolding</span></span> snd_conv fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_fst_Gauss_Jordan_in_ij_iarrays_PA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_snd_Gauss_Jordan_in_ij_iarrays_PA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span> <span class="quoted"><span class="free">A</span></span>  <span class="quoted"><span class="free">P</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column'<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword1"><span class="command">hence</span></span> i_eq_nrows<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_PA_def Gauss_Jordan_column_k_iarrays_PA_def Let_def
<span class="keyword1"><span class="command">unfolding</span></span> snd_conv fst_conv <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan_PA_IArrays-matrix_to_iarray_snd_Gauss_Jordan_column_k_PA"><span class="command">lemma</span></span> matrix_to_iarray_snd_Gauss_Jordan_column_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">P</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_Gauss_Jordan_column_k_1<span class="main">[</span><span class="operator">OF</span> k i<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Gauss_Jordan_column_k_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_PA_def Gauss_Jordan_column_k_iarrays_PA_def snd_conv fst_conv Let_def
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_in_ij_iarrays_PA
<span class="keyword1"><span class="command">unfolding</span></span> snd_if_conv
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_in_ij_PA_eq
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-matrix_to_iarray_third_Gauss_Jordan_column_k_PA"><span class="command">lemma</span></span> matrix_to_iarray_third_Gauss_Jordan_column_k_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">P</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_Gauss_Jordan_column_k_2<span class="main">[</span><span class="operator">OF</span> k i<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_def Gauss_Jordan_column_k_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_PA_def Gauss_Jordan_column_k_iarrays_PA_def snd_conv fst_conv Let_def
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_in_ij_iarrays_PA
<span class="keyword1"><span class="command">unfolding</span></span> snd_if_conv snd_Gauss_Jordan_in_ij_PA_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_upt_k_iarrays_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> matrix_to_iarray_fst_Gauss_Jordan_upt_k_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> matrix_to_iarray_snd_Gauss_Jordan_upt_k_PA<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">assume</span></span> zero_less_ncols<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Gauss_Jordan_upt_k_iarrays_PA_def Let_def fst_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mat<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_fst_Gauss_Jordan_column_k_PA<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_ncols<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Gauss_Jordan_upt_k_iarrays_PA_def Let_def fst_conv snd_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mat<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_third_Gauss_Jordan_column_k_PA<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_ncols<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mat<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_snd_Gauss_Jordan_column_k_PA<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_ncols<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_snd_Gauss_Jordan_column_k_PA_eq fst_Gauss_Jordan_column_k<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> Suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">hence</span></span> hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp3<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp4<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">have</span></span> suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> A'_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">have</span></span> fst_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> fst <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A'_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp1<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Gauss_Jordan_upt_k_PA_def Gauss_Jordan_upt_k_iarrays_PA_def Let_def fst_conv<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> fst_snd_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A'_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp3<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Gauss_Jordan_upt_k_PA_def Gauss_Jordan_upt_k_iarrays_PA_def <span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> snd_snd_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> A'_def B_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyp2<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Gauss_Jordan_upt_k_PA_def Gauss_Jordan_upt_k_iarrays_PA_def Let_def fst_conv snd_conv<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def fst_conv <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">,</span>fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_fst_Gauss_Jordan_column_k_PA<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp4 <span class="keyword1"><span class="command">unfolding</span></span> nrows_def A'_def <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>  
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  fst <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>fst <span class="skolem">B</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_A' fst_snd_A' snd_snd_A' <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_iarrays_PA_def Let_def fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_PA <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_PA_def Let_def snd_conv <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">,</span>fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_third_Gauss_Jordan_column_k_PA<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp4 <span class="keyword1"><span class="command">unfolding</span></span> nrows_def A'_def <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>  
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>fst <span class="skolem">B</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_A' fst_snd_A' snd_snd_A' <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_iarrays_PA_def Let_def fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_PA <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">,</span>fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="main">(</span>fst <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span>fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">,</span> matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_snd_Gauss_Jordan_column_k_PA<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp4 <span class="keyword1"><span class="command">unfolding</span></span> nrows_def A'_def <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>fst <span class="skolem">B</span><span class="main">,</span>fst <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_A' fst_snd_A' snd_snd_A' <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span>mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mat<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_PA <span class="main">(</span>mat <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snd_foldl_Gauss_Jordan_column_k_eq Suc_k fst_foldl_Gauss_Jordan_column_k_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_iarrays_PA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-matrix_to_iarray_fst_Gauss_Jordan_PA"><span class="command">lemma</span></span> matrix_to_iarray_fst_Gauss_Jordan_PA<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_def Gauss_Jordan_iarrays_PA_def 
  <span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_fst_Gauss_Jordan_upt_k_PA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ncols <span class="free">A</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def ncols_eq_card_columns<span class="main">)</span>



<span class="keyword1" id="Gauss_Jordan_PA_IArrays-matrix_to_iarray_snd_Gauss_Jordan_PA"><span class="command">lemma</span></span> matrix_to_iarray_snd_Gauss_Jordan_PA<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_def Gauss_Jordan_iarrays_PA_def 
  <span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_snd_Gauss_Jordan_upt_k_PA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ncols <span class="free">A</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def ncols_eq_card_columns<span class="main">)</span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-Gauss_Jordan_iarrays_PA_mult"><span class="command">lemma</span></span> Gauss_Jordan_iarrays_PA_mult<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">**i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fst_Gauss_Jordan_PA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_snd_Gauss_Jordan_PA matrix_to_iarray_matrix_matrix_mult matrix_to_iarray_fst_Gauss_Jordan_PA <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Gauss_Jordan_PA_IArrays-snd_snd_Gauss_Jordan_column_k_iarrays_PA_eq"><span class="command">lemma</span></span> snd_snd_Gauss_Jordan_column_k_iarrays_PA_eq<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_iarrays_PA_def Gauss_Jordan_column_k_iarrays_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def snd_conv fst_conv <span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_in_ij_iarrays_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Gauss_Jordan_PA_IArrays-fst_snd_Gauss_Jordan_column_k_iarrays_PA_eq"><span class="command">lemma</span></span> fst_snd_Gauss_Jordan_column_k_iarrays_PA_eq<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_iarrays_PA_def Gauss_Jordan_column_k_iarrays_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def snd_conv fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Gauss_Jordan_PA_IArrays-foldl_Gauss_Jordan_column_k_iarrays_eq"><span class="command">lemma</span></span> foldl_Gauss_Jordan_column_k_iarrays_eq<span class="main">:</span>
<span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl Gauss_Jordan_column_k_iarrays_PA <span class="main">(</span><span class="free">B</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_iarrays <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> suc_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps fst_snd_Gauss_Jordan_column_k_iarrays_PA_eq snd_snd_Gauss_Jordan_column_k_iarrays_PA_eq surjective_pairing<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-snd_Gauss_Jordan_upt_k_iarrays_PA"><span class="command">lemma</span></span> snd_Gauss_Jordan_upt_k_iarrays_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_upt_k_iarrays_PA <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan_upt_k_iarrays <span class="free">A</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_iarrays_PA_def Gauss_Jordan_upt_k_iarrays_def Let_def
<span class="keyword1"><span class="command">using</span></span> foldl_Gauss_Jordan_column_k_iarrays_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"mat_iarray <span class="main">1</span> <span class="main">(</span>nrows_iarray <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Gauss_Jordan_PA_IArrays-snd_Gauss_Jordan_iarrays_PA_eq"><span class="command">lemma</span></span> snd_Gauss_Jordan_iarrays_PA_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Gauss_Jordan_iarrays <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_iarrays_def Gauss_Jordan_iarrays_PA_def
<span class="keyword1"><span class="command">using</span></span> snd_Gauss_Jordan_upt_k_iarrays_PA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Bases_Of_Fundamental_Subspaces_IArrays">
<div class="head">
<h1>Theory Bases_Of_Fundamental_Subspaces_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Bases_Of_Fundamental_Subspaces_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Bases of the four fundamental subspaces over IArrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Bases_Of_Fundamental_Subspaces_IArrays
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Bases_Of_Fundamental_Subspaces.html">Bases_Of_Fundamental_Subspaces</a>
  <a href="Gauss_Jordan_PA_IArrays.html">Gauss_Jordan_PA_IArrays</a>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Computation of bases of the fundamental subspaces using IArrays›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We have made the definitions as efficient as possible.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_left_null_space_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
  <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span>
          <span class="bound">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span>
          <span class="keyword1">in</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row_iarray <span class="bound">i</span> <span class="main">(</span>fst <span class="bound">GJ</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="bound">rank_A</span><span class="main">)</span><span class="main">..&lt;</span><span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_null_space_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>
    <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span><span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">;</span>
          <span class="bound">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span>
          <span class="keyword1">in</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row_iarray <span class="bound">i</span> <span class="main">(</span>fst <span class="bound">GJ</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="bound">rank_A</span><span class="main">)</span><span class="main">..&lt;</span><span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_row_space_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span><span class="main">=</span> Gauss_Jordan_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span>
       <span class="bound">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span><span class="bound">GJ</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span>
       <span class="keyword1">in</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row_iarray <span class="bound">i</span> <span class="main">(</span><span class="bound">GJ</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">rank_A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_col_space_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> basis_row_space_iarrays <span class="main">(</span>transpose_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas make easier the proofs of equivalence between abstract versions and concrete versions.
      They are false if we remove <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>matrix_to_iarray›</span></span></span></span>›</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces_IArrays-basis_null_space_iarrays_eq"><span class="command">lemma</span></span> basis_null_space_iarrays_eq<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_null_space_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> 
  <span class="main">=</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row_iarray <span class="bound">i</span> <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span>rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">..&lt;</span><span class="main">(</span>ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_null_space_iarrays_def Let_def
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_rank<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> rank_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_rank
<span class="keyword1"><span class="command">unfolding</span></span> rank_iarrays_code
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_iarrays_PA_eq <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces_IArrays-basis_row_space_iarrays_eq"><span class="command">lemma</span></span> basis_row_space_iarrays_eq<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_row_space_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row_iarray <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_row_space_iarrays_def Let_def rank_iarrays_code <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces_IArrays-basis_left_null_space_iarrays_eq"><span class="command">lemma</span></span> basis_left_null_space_iarrays_eq<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_left_null_space_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> basis_null_space_iarrays <span class="main">(</span>transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_left_null_space_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> basis_null_space_iarrays_def Let_def
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> transpose_transpose
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_ncols<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> ncols_transpose
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Code equations›</span></span>

<span class="keyword1" id="Bases_Of_Fundamental_Subspaces_IArrays-vec_to_iarray_basis_null_space"><span class="command">lemma</span></span> vec_to_iarray_basis_null_space<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"vec_to_iarray<span class="main">`</span> <span class="main">(</span>basis_null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> basis_null_space_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_null_space_def basis_null_space_iarrays_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span>
<span class="keyword3"><span class="command">assume</span></span> rank_le_i<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="skolem">i</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">..&lt;</span>ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">.</span>
vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> row_iarray <span class="bound">x</span> <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat <span class="skolem"><span class="skolem">i</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span>rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">..&lt;</span>ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_ncols<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> rank_le_i to_nat_less_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_rank ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> row_iarray <span class="main">(</span>to_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_fst_Gauss_Jordan_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> P_Gauss_Jordan_def
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_row <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> rank_le_i<span class="main">:</span> <span class="quoted"><span class="quoted">"rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> i_less_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">hence</span></span> i_less_card<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'cols</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_ncols<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> row <span class="bound">i</span> <span class="main">(</span>P_Gauss_Jordan <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
            row_iarray <span class="skolem">i</span> <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"row <span class="main"><span class="main">(</span></span>from_nat <span class="skolem"><span class="skolem">i</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>P_Gauss_Jordan <span class="main"><span class="main">(</span></span>transpose <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ia</span><span class="main">.</span> row <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> row <span class="bound">ia</span> <span class="main">(</span>P_Gauss_Jordan <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         rank <span class="free">A</span> <span class="main">≤</span> to_nat <span class="bound">ia</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"from_nat <span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_le_i to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_card<span class="main"><span class="main">]</span></span> matrix_to_iarray_rank<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_iarray <span class="skolem">i</span> <span class="main">(</span>fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    vec_to_iarray <span class="main">(</span>row <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>P_Gauss_Jordan <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_fst_Gauss_Jordan_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> P_Gauss_Jordan_def
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_row to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> i_less_card<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> vec_to_iarray_basis_left_null_space<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray<span class="main">`</span> <span class="main">(</span>basis_left_null_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> basis_left_null_space_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_left_null_space <span class="free">A</span> <span class="main">=</span> basis_null_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpose_transpose basis_null_space_eq_basis_left_null_space_transpose<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rw <span class="keyword1"><span class="command">unfolding</span></span> basis_left_null_space_iarrays_eq
<span class="keyword1"><span class="command">using</span></span> vec_to_iarray_basis_null_space<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"transpose <span class="free">A</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Bases_Of_Fundamental_Subspaces_IArrays-vec_to_iarray_basis_row_space"><span class="command">lemma</span></span> vec_to_iarray_basis_row_space<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"vec_to_iarray<span class="main">`</span> <span class="main">(</span>basis_row_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> basis_row_space_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_row_space_def basis_row_space_iarrays_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
<span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> row_iarray <span class="bound">x</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat <span class="skolem"><span class="skolem">i</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> row_iarray <span class="main">(</span>to_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_row matrix_to_iarray_Gauss_Jordan <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> matrix_to_iarray_rank<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> i iarray_to_vec_vec_to_iarray not_less rank_less_row_i_imp_i_is_zero row_iarray_def vec_matrix vec_to_iarray_row<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
<span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> rank_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">hence</span></span> i_less_rank<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> rank <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_rank <span class="keyword1"><span class="command">.</span></span>  
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> row <span class="bound">i</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> row_iarray <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"row <span class="main"><span class="main">(</span></span>from_nat <span class="skolem"><span class="skolem">i</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>Gauss_Jordan <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form_upt_k <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rref_Gauss_Jordan rref_implies_rref_upt<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> A_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_less_rank <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code rank_0<span class="main">)</span>
 <span class="keyword1"><span class="command">hence</span></span> Gauss_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Gauss_Jordan_not_0<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">a</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_less_rank <span class="keyword1"><span class="command">unfolding</span></span> rank_eq_suc_to_nat_greatest<span class="main">[</span><span class="operator">OF</span> A_not_0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leD not_le_imp_less to_nat_le<span class="main">)</span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="main">(</span>ncols <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Gauss_not_0 <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_eq_iff zero_index<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">have</span></span> i_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_less_rank rank_le_nrows<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ia</span><span class="main">.</span> row <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">=</span> row <span class="bound">ia</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> row <span class="bound">ia</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"from_nat <span class="skolem"><span class="skolem">i</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> not_zero_i <span class="keyword1"><span class="command">unfolding</span></span> row_def is_zero_row_def' vec_nth_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row_iarray <span class="skolem">i</span> <span class="main">(</span>Gauss_Jordan_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vec_to_iarray <span class="main">(</span>row <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Gauss_Jordan <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_Gauss_Jordan<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> vec_to_iarray_row to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> i_less_card<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> vec_to_iarray_basis_col_space<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"vec_to_iarray<span class="main">`</span> <span class="main">(</span>basis_col_space <span class="free">A</span><span class="main">)</span> <span class="main">=</span> basis_col_space_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> basis_col_space_eq_basis_row_space_transpose basis_col_space_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_basis_row_space <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="System_Of_Equations_IArrays">
<div class="head">
<h1>Theory System_Of_Equations_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      System_Of_Equations_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Solving systems of equations using the Gauss Jordan algorithm over nested IArrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> System_Of_Equations_IArrays
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="System_Of_Equations.html">System_Of_Equations</a>
  <a href="Bases_Of_Fundamental_Subspaces_IArrays.html">Bases_Of_Fundamental_Subspaces_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Previous definitions and properties›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">greatest_not_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span> iarray <span class="main">=&gt;</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">greatest_not_zero</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> the <span class="main">(</span>List.find <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations_IArrays-vec_to_iarray_exists"><span class="command">lemma</span></span> vec_to_iarray_exists<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> IArray.exists <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> IArray.exists_def length_vec_to_iarray<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> IArray.sub_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> Ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"to_nat <span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> vec_to_iarray_nth'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ab to_nat_less_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ab_vec<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"from_nat <span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Ab_vec vec_to_iarray_nth<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> vec_to_iarray_exists'<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> IArray.exists <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>IArray <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_to_iarray_exists Option.is_none_def find_None_iff<span class="main">)</span>

<span class="keyword1" id="System_Of_Equations_IArrays-not_is_zero_iarray_eq_iff"><span class="command">lemma</span></span> not_is_zero_iarray_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> is_zero_iarray <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> is_zero_iarray_eq_iff vec_eq_iff zero_index<span class="main">)</span>

<span class="keyword1" id="System_Of_Equations_IArrays-vec_to_iarray_greatest_not_zero"><span class="command">lemma</span></span> vec_to_iarray_greatest_not_zero<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ex_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"greatest_not_zero <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>List.find <span class="var">?P</span> <span class="var">?xs</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> find_None_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> IArray.list_of <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ex_b 
    <span class="keyword1"><span class="command">unfolding</span></span> set_rev <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> IArray.length_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> IArray.sub_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> length_vec_to_iarray<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> to_nat_less_card vec_to_iarray_nth'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>List.find <span class="var">?P</span> <span class="var">?xs</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ia</span></span> <span class="keyword2"><span class="keyword">where</span></span> ia_less_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span><span class="main">&lt;</span>length <span class="var">?xs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> P_xs_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="var">?xs</span><span class="main">!</span><span class="skolem">ia</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="var">?xs</span><span class="main">!</span><span class="skolem">ia</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">ia</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?P</span> <span class="main">(</span><span class="var">?xs</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> find_Some_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">have</span></span> ia_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia_less_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_zero length_rev length_upt length_vec_to_iarray<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> ia_less_length'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia_less_length <span class="keyword1"><span class="command">unfolding</span></span> length_rev <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> a_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_eq <span class="keyword1"><span class="command">unfolding</span></span> rev_nth<span class="main">[</span><span class="operator">OF</span> ia_less_length'<span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> nth_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ia</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_less length_upt length_vec_to_iarray minus_nat.diff_0 plus_nat.add_0 zero_less_Suc zero_less_card_finite<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">b</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vec_to_iarray_nth<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> a_less_card<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> P_xs_ia <span class="keyword1"><span class="command">unfolding</span></span> a_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> from_nat <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> from_nat <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> y_greater_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> from_nat <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> y_greater_a'<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">&gt;</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_greater_a <span class="keyword1"><span class="command">using</span></span> to_nat_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_less_card<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="var">?xs</span> <span class="main">!</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_eq <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ia</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_nth<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ia_less_length'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ia</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nth_upt<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ia_less_length' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ia</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ia</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> ia_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">=</span> length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_Suc Suc_eq_plus1_left diff_diff_cancel less_imp_le ia_less_length length_rev<span class="main">)</span>      
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ja</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">=</span> length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> to_nat <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ja_less_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&lt;</span> length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ja_def 
        <span class="keyword1"><span class="command">using</span></span> ia_eq ia_less_length' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> suc_i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">≥</span>Suc <span class="main">(</span>to_nat <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def  <span class="keyword1"><span class="command">using</span></span> to_nat_less_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs</span> <span class="main">!</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ja</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rev_nth<span class="main">[</span><span class="operator">OF</span> ja_less_length<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ja</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nth_upt<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> IArray.length_def<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ja_def     
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_Suc_less ia_less_length' length_upt less_nat_zero_code minus_nat.diff_0 neq0_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> Suc <span class="skolem">ja</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ja_def <span class="keyword1"><span class="command">using</span></span> suc_i_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> xs_ja_eq_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?xs</span> <span class="main">!</span> <span class="skolem">ja</span> <span class="main">=</span> to_nat <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> ja_less_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&lt;</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ja_def ia_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> IArray.length_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_leI suc_i_le diff_less_mono2 le_imp_less_Suc less_le_trans y_greater_a'<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span><span class="var">?xs</span> <span class="main">!</span> <span class="skolem">ja</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec_to_iarray_nth'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> xs_ja_eq_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Ay <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> greatest_not_zero_def a <span class="keyword1"><span class="command">unfolding</span></span> to_nat_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> a_less_card<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Consistency and inconsistency›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">consistent_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span><span class="main">=</span>Gauss_Jordan_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span> 
                                           <span class="bound">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span><span class="main">;</span>
                                           <span class="bound">P_mult_b</span> <span class="main">=</span> fst<span class="main">(</span><span class="bound">GJ</span><span class="main">)</span> <span class="keyword1">*iv</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
                                           <span class="keyword1">in</span> <span class="main">(</span><span class="bound">rank_A</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">if</span>  <span class="main">(</span><span class="main">¬</span> is_zero_iarray <span class="bound">P_mult_b</span><span class="main">)</span> 
                                           <span class="keyword1">then</span> <span class="main">(</span>greatest_not_zero <span class="bound">P_mult_b</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inconsistent_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> consistent_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations_IArrays-matrix_to_iarray_consistent"><span class="command">lemma</span></span> matrix_to_iarray_consistent<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> consistent_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> consistent_eq_rank_ge_code
<span class="keyword1"><span class="command">unfolding</span></span> consistent_iarrays_def Let_def
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq
<span class="keyword1"><span class="command">unfolding</span></span> rank_Gauss_Jordan_code<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">unfolded</span> Let_def<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_iarrays_PA_eq
<span class="keyword1"><span class="command">unfolding</span></span> rank_iarrays_code<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_rank
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_fst_Gauss_Jordan_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_matrix_matrix_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> not_is_zero_iarray_eq_iff
<span class="keyword1"><span class="command">using</span></span> vec_to_iarray_greatest_not_zero<span class="main">[</span><span class="operator">unfolded</span> not_is_zero_iarray_eq_iff<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="System_Of_Equations_IArrays-matrix_to_iarray_inconsistent"><span class="command">lemma</span></span> matrix_to_iarray_inconsistent<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inconsistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> inconsistent_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> inconsistent_def inconsistent_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_consistent <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">solve_consistent_rref_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> 
  <span class="main">=</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span>IArray.exists <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span>least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">!!</span> <span class="main">(</span>least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="System_Of_Equations_IArrays-exists_solve_consistent_rref"><span class="command">lemma</span></span> exists_solve_consistent_rref<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span>IArray.exists <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>
  <span class="main">∧</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span><span class="main">=</span>least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="bound">i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
<span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> Aij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"IArray.exists <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="bound">i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>IArray <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> IArray.exists_def find_Some_iff
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat <span class="skolem"><span class="skolem">i</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> IArray.sub_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">i</span> <span class="main">&lt;</span> nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> nrows_def <span class="keyword1"><span class="command">using</span></span> to_nat_less_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span><span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> least_mod_type<span class="main">)</span>
         <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'cols</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec_to_iarray_least_non_zero_position_of_vector_from_index''<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'cols</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span>to_nat <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'cols</span><span class="main">)</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>row <span class="skolem">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'cols</span>"</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">i</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> row_def vec_nth_inverse <span class="keyword1"><span class="command">using</span></span> Aij least_mod_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="main">(</span>to_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_row least_non_zero_position_of_vector_def
          <span class="keyword1"><span class="command">unfolding</span></span> to_nat_0 <span class="keyword1"><span class="command">..</span></span>
         <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="main">(</span>to_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> mod_type_class.to_nat <span class="skolem">i</span> <span class="main">!!</span> mod_type_class.to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth <span class="keyword1"><span class="command">using</span></span> Aij <span class="keyword1"><span class="command">.</span></span>
         <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">assume</span></span> ex_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"IArray.exists <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="bound">i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>IArray <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> List.find <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="bound">i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> Some <span class="bound">y</span>"</span></span>
         <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> IArray.length_def IArray.sub_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> find_None_iff<span class="main">)</span>
         <span class="keyword3"><span class="command">assume</span></span><span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span>
            matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">x</span> <span class="main">!!</span> mod_type_class.to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> mod_type_class.to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="bound">x</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ex_eq <span class="keyword1"><span class="command">unfolding</span></span> IArray.exists_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"List.find <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="bound">i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> Some <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_less_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
     Aij_1<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> j_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  y_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">ja</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="bound">ja</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span>
                to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="bound">ja</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> find_Some_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"from_nat <span class="skolem"><span class="skolem">i</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nth_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> i_less_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> i_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_less_length <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def matrix_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> A_ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Aij_1 <span class="keyword1"><span class="command">unfolding</span></span> i_rw <span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> i_less_card<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>row_iarray <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_eq <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>row_iarray <span class="skolem">i</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> least_non_zero_position_of_vector_def i_rw <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>vec_to_iarray <span class="main">(</span>row <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'cols</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_row
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> i_less_card<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_0 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec_to_iarray_least_non_zero_position_of_vector_from_index''<span class="main">)</span>
           <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span>to_nat <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'cols</span><span class="main">)</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>row <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> A_ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iarray_to_vec_vec_to_iarray least_mod_type vec_matrix vec_to_iarray_row' zero_neq_one<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_eq <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
     

<span class="keyword1" id="System_Of_Equations_IArrays-to_nat_the_solve_consistent_rref"><span class="command">lemma</span></span> to_nat_the_solve_consistent_rref<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> Aij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    least_non_zero_position_of_vector <span class="main">(</span>vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_non_zero_position_of_vector_def to_nat_0 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span>to_nat <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> column_def <span class="keyword1"><span class="command">using</span></span> Aij least_mod_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_eq_least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Aij zero_neq_one<span class="main">)</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Aij is_zero_row_def' j order_refl rref rref_condition4 zero_neq_one<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">have</span></span> the_eq_least_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="main">(</span>least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">A</span> <span class="main">$</span> from_nat <span class="main">(</span>least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> least_eq from_nat_to_nat_id i_eq_least<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> Aij <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> from_nat <span class="main">(</span>least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> least_eq from_nat_to_nat_id
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Aij a i_eq_least is_zero_row_def' j rref rref_condition4_explicit zero_neq_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span>from_nat <span class="main">(</span>least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> the_eq_least_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>least_non_zero_position_of_vector <span class="main">(</span>column_iarray <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> to_nat_from_nat_id<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> least_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_less_card<span class="main">)</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_eq from_nat_to_nat_id <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_eq <span class="keyword1"><span class="command">.</span></span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_eq from_nat_to_nat_id <span class="keyword1"><span class="command">unfolding</span></span> to_nat_eq <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="System_Of_Equations_IArrays-iarray_exhaust2"><span class="command">lemma</span></span> iarray_exhaust2<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>IArray.list_of <span class="free">xs</span> <span class="main">=</span> IArray.list_of <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iarray.exhaust list_of.simps<span class="main">)</span>


<span class="keyword1" id="System_Of_Equations_IArrays-vec_to_iarray_solve_consistent_rref"><span class="command">lemma</span></span> vec_to_iarray_solve_consistent_rref<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>solve_consistent_rref <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> solve_consistent_rref_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> iarray_exhaust2 list_eq_iff_nth_eq IArray.length_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> IArray.sub_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"IArray.length <span class="main">(</span>vec_to_iarray <span class="main">(</span>solve_consistent_rref <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> IArray.length <span class="main">(</span>solve_consistent_rref_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> solve_consistent_rref_def solve_consistent_rref_iarrays_def 
  <span class="keyword1"><span class="command">unfolding</span></span> ncols_iarray_def matrix_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_to_iarray_def<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>IArray.length <span class="main">(</span>vec_to_iarray <span class="main">(</span>solve_consistent_rref <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> vec_to_iarray <span class="main">(</span>solve_consistent_rref <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">=</span> solve_consistent_rref_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> IArray.length <span class="main">(</span>vec_to_iarray <span class="main">(</span>solve_consistent_rref <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">hence</span></span> i_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'cols</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">hence</span></span> i_less_ncols<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span>ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_eq_card_columns <span class="keyword1"><span class="command">.</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>solve_consistent_rref <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">!!</span> <span class="skolem">i</span> <span class="main">=</span> solve_consistent_rref_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span> <span class="main">!!</span> <span class="skolem">i</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_nth<span class="main">[</span><span class="operator">OF</span> i_less_card<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> solve_consistent_rref_def
<span class="keyword1"><span class="command">unfolding</span></span> vec_lambda_beta
<span class="keyword1"><span class="command">unfolding</span></span> solve_consistent_rref_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> of_fun_nth<span class="main">[</span><span class="operator">OF</span> i_less_ncols<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> exists_solve_consistent_rref<span class="main">[</span><span class="operator">OF</span> rref<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">i</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">,</span> <span class="operator">unfolded</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_card<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> to_nat_the_solve_consistent_rref<span class="main">[</span><span class="operator">OF</span> rref<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">i</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">,</span> <span class="operator">unfolded</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_card<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> vec_to_iarray_nth' <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Independence and dependence›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">independent_and_consistent_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span> 
      <span class="bound">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span><span class="main">;</span>
      <span class="bound">P_mult_b</span> <span class="main">=</span> fst <span class="bound">GJ</span> <span class="keyword1">*iv</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
      <span class="bound">consistent_A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> is_zero_iarray <span class="bound">P_mult_b</span> <span class="keyword1">then</span> greatest_not_zero <span class="bound">P_mult_b</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">rank_A</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">dim_solution_set</span> <span class="main">=</span> ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="bound">rank_A</span>
      <span class="keyword1">in</span> <span class="bound">consistent_A</span> <span class="main">∧</span> <span class="bound">dim_solution_set</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dependent_and_consistent_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span> 
      <span class="bound">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span><span class="main">;</span>
      <span class="bound">P_mult_b</span> <span class="main">=</span> fst <span class="bound">GJ</span> <span class="keyword1">*iv</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
      <span class="bound">consistent_A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> is_zero_iarray <span class="bound">P_mult_b</span> <span class="keyword1">then</span> greatest_not_zero <span class="bound">P_mult_b</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">rank_A</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">dim_solution_set</span> <span class="main">=</span> ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="bound">rank_A</span>
      <span class="keyword1">in</span> <span class="bound">consistent_A</span> <span class="main">∧</span> <span class="bound">dim_solution_set</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations_IArrays-matrix_to_iarray_independent_and_consistent"><span class="command">lemma</span></span> matrix_to_iarray_independent_and_consistent<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent_and_consistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> independent_and_consistent_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> independent_and_consistent_def
<span class="keyword1"><span class="command">unfolding</span></span> independent_and_consistent_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> dim_solution_set_homogeneous_eq_dim_null_space
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_consistent
<span class="keyword1"><span class="command">unfolding</span></span> consistent_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> dim_null_space_iarray
<span class="keyword1"><span class="command">unfolding</span></span> rank_iarrays_code
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_iarrays_PA_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1" id="System_Of_Equations_IArrays-matrix_to_iarray_dependent_and_consistent"><span class="command">lemma</span></span> matrix_to_iarray_dependent_and_consistent<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dependent_and_consistent <span class="free">A</span> <span class="free">b</span> <span class="main">=</span> dependent_and_consistent_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> dependent_and_consistent_def
<span class="keyword1"><span class="command">unfolding</span></span> dependent_and_consistent_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> dim_solution_set_homogeneous_eq_dim_null_space
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_consistent
<span class="keyword1"><span class="command">unfolding</span></span> consistent_iarrays_def
<span class="keyword1"><span class="command">unfolding</span></span> dim_null_space_iarray
<span class="keyword1"><span class="command">unfolding</span></span> rank_iarrays_code
<span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_iarrays_PA_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Solve a system of equations over nested IArrays›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">solve_system_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>snd <span class="bound">A'</span><span class="main">,</span> fst <span class="bound">A'</span> <span class="keyword1">*iv</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations_IArrays-matrix_to_iarray_fst_solve_system"><span class="command">lemma</span></span> matrix_to_iarray_fst_solve_system<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>solve_system_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> solve_system_def solve_system_iarrays_def Let_def fst_conv
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_to_iarray_snd_Gauss_Jordan_PA<span class="main">)</span>

<span class="keyword1" id="System_Of_Equations_IArrays-vec_to_iarray_snd_solve_system"><span class="command">lemma</span></span> vec_to_iarray_snd_solve_system<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>solve_system_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> solve_system_def solve_system_iarrays_def Let_def snd_conv
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_to_iarray_fst_Gauss_Jordan_PA vec_to_iarray_matrix_matrix_mult<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">solve_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">GJ_P</span><span class="main">=</span>Gauss_Jordan_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span> 
                        <span class="bound">P_mult_b</span> <span class="main">=</span> fst <span class="bound">GJ_P</span> <span class="keyword1">*iv</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
                        <span class="bound">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">GJ_P</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span><span class="main">;</span>
                        <span class="bound">consistent_Ab</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> is_zero_iarray <span class="bound">P_mult_b</span> <span class="keyword1">then</span> greatest_not_zero <span class="bound">P_mult_b</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">rank_A</span><span class="main">;</span>
                        <span class="bound">GJ_transpose</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">;</span>
                        <span class="bound">basis</span> <span class="main">=</span>  set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row_iarray <span class="bound">i</span> <span class="main">(</span>fst <span class="bound">GJ_transpose</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="bound">rank_A</span><span class="main">..&lt;</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span>
                        <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">consistent_Ab</span> <span class="keyword1">then</span> Some <span class="main">(</span>solve_consistent_rref_iarrays <span class="main">(</span>snd <span class="bound">GJ_P</span><span class="main">)</span> <span class="bound">P_mult_b</span><span class="main">,</span><span class="bound">basis</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pair_vec_vecset</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Option.is_none <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>vec_to_iarray <span class="main">(</span>fst <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> vec_to_iarray<span class="main">`</span> <span class="main">(</span>snd <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="System_Of_Equations_IArrays-pair_vec_vecset_solve"><span class="command">lemma</span></span> pair_vec_vecset_solve<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_vec_vecset <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> solve_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> pair_vec_vecset_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">assume</span></span> none_solve_Ab<span class="main">:</span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">=</span> solve_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">GJ_P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GJ_P</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P_mult_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P_mult_b</span> <span class="main">=</span> fst <span class="skolem">GJ_P</span> <span class="keyword1">*iv</span> vec_to_iarray <span class="free">b</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rank_A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="skolem">GJ_P</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> consistent <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> none_solve_Ab <span class="keyword1"><span class="command">unfolding</span></span> solve_def <span class="keyword1"><span class="command">unfolding</span></span> Option.is_none_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> consistent_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_consistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> is_zero_iarray <span class="skolem">P_mult_b</span> <span class="keyword1">then</span> greatest_not_zero <span class="skolem">P_mult_b</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">rank_A</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> GJ_P_def P_mult_b_def rank_A_def
        <span class="keyword1"><span class="command">using</span></span> consistent_iarrays_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_iarrays_def Let_def <span class="keyword1"><span class="command">unfolding</span></span> GJ_P_def P_mult_b_def rank_A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">assume</span></span> not_none<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Some <span class="main">(</span>vec_to_iarray <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> vec_to_iarray <span class="main">`</span> snd <span class="main">(</span>the <span class="main">(</span>solve <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> solve_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">GJ_P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GJ_P</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P_mult_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P_mult_b</span> <span class="main">=</span> fst <span class="skolem">GJ_P</span> <span class="keyword1">*iv</span> vec_to_iarray <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rank_A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rank_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="skolem">GJ_P</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">GJ_transpose</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GJ_transpose</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="main">(</span>transpose_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">basis</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">basis</span> <span class="main">=</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row_iarray <span class="bound">i</span> <span class="main">(</span>fst <span class="skolem">GJ_transpose</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="skolem">rank_A</span><span class="main">..&lt;</span>ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P_mult_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P_mult_b</span> <span class="main">=</span> fst <span class="skolem">GJ_P</span> <span class="keyword1">*iv</span> vec_to_iarray <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> consistent_Ab<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_none <span class="keyword1"><span class="command">unfolding</span></span> solve_def <span class="keyword1"><span class="command">unfolding</span></span> Option.is_none_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"consistent_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_consistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> is_zero_iarray <span class="skolem">P_mult_b</span> <span class="keyword1">then</span> greatest_not_zero <span class="skolem">P_mult_b</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">rank_A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> GJ_P_def P_mult_b_def rank_A_def
      <span class="keyword1"><span class="command">using</span></span> consistent_iarrays_def <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> solve_iarrays_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"solve_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>solve_consistent_rref_iarrays <span class="main">(</span>snd <span class="skolem">GJ_P</span><span class="main">)</span> <span class="skolem">P_mult_b</span><span class="main">,</span> <span class="skolem">basis</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> solve_iarrays_def Let_def P_mult_b_def GJ_P_def rank_A_def basis_def GJ_transpose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> snd_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">`</span> basis_null_space <span class="free">A</span> <span class="main">=</span> <span class="skolem">basis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> basis_def GJ_transpose_def rank_A_def GJ_P_def
       <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_basis_null_space <span class="keyword1"><span class="command">unfolding</span></span> basis_null_space_iarrays_def Let_def
       <span class="keyword1"><span class="command">unfolding</span></span> snd_Gauss_Jordan_iarrays_PA_eq
       <span class="keyword1"><span class="command">unfolding</span></span> rank_iarrays_code<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
       <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
       <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_rank<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
       <span class="keyword1"><span class="command">unfolding</span></span> rank_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> fst_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span>solve_consistent_rref <span class="main">(</span>fst <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>solve_system <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> solve_consistent_rref_iarrays <span class="main">(</span>snd <span class="skolem">GJ_P</span><span class="main">)</span> <span class="skolem">P_mult_b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_to_iarray_solve_consistent_rref<span class="main">[</span><span class="operator">OF</span> rref_Gauss_Jordan<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_PA <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">b</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> solve_system_def Let_def fst_conv
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> GJ_P_def P_mult_b_def
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_matrix_matrix_mult
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_fst_Gauss_Jordan_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_snd_Gauss_Jordan_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_iarrays_rw
    <span class="keyword1"><span class="command">unfolding</span></span> solve_def if_P<span class="main">[</span><span class="operator">OF</span> consistent_Ab<span class="main">]</span> option.sel fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> fst_rw snd_rw <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Determinants_IArrays">
<div class="head">
<h1>Theory Determinants_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Determinants_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Computing determinants of matrices using the Gauss Jordan algorithm over nested IArrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Determinants_IArrays
<span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Determinants2.html">Determinants2</a>
    <a href="Gauss_Jordan_IArrays.html">Gauss_Jordan_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_in_ij_det_P_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> 
  <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">n</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">,</span> Gauss_Jordan_in_ij_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_column_k_det_P_iarrays</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">det_P</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> <span class="bound">i</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">A</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span>
 <span class="keyword1">in</span> <span class="keyword1">if</span> vector_all_zero_from_index <span class="main">(</span><span class="bound">i</span><span class="main">,</span> column_iarray <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> nrows_iarray <span class="bound">A</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">det_P</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">gauss</span> <span class="main">=</span> Gauss_Jordan_in_ij_det_P_iarrays <span class="bound">A</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">gauss</span> <span class="main">*</span> <span class="bound">det_P</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> snd <span class="bound">gauss</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_upt_k_det_P_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">foldl</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span> <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">foldl</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="bound">foldl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gauss_Jordan_det_P_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Gauss_Jordan_upt_k_det_P_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A more efficient equation for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_det_P_iarrays <span class="free"><span class="free">A</span></span> <span class="free"><span class="free">i</span></span> <span class="free"><span class="free">j</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Determinants_IArrays-Gauss_Jordan_in_ij_det_P_iarrays_code"><span class="command">lemma</span></span> Gauss_Jordan_in_ij_det_P_iarrays_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Gauss_Jordan_in_ij_det_P_iarrays <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> 
    <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="main">(</span>column_iarray <span class="free">j</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">;</span>
           <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows_iarray <span class="free">A</span> <span class="free">i</span> <span class="bound">n</span><span class="main">;</span>
           <span class="bound">A'</span> <span class="main">=</span> mult_row_iarray <span class="bound">interchange_A</span> <span class="free">i</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span>
       <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">j</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">A</span> <span class="main">!!</span> <span class="bound">n</span> <span class="main">!!</span> <span class="free">j</span><span class="main">,</span> IArray.of_fun <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">A'</span> <span class="main">!!</span> <span class="bound">s</span> <span class="keyword1">else</span> row_add_iarray <span class="bound">A'</span> <span class="bound">s</span> <span class="free">i</span> <span class="main">(</span><span class="main">-</span> <span class="bound">interchange_A</span> <span class="main">!!</span> <span class="bound">s</span> <span class="main">!!</span> <span class="free">j</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_det_P_iarrays_def Gauss_Jordan_in_ij_iarrays_def Let_def <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_fst_Gauss_Jordan_in_ij_det_P"><span class="command">lemma</span></span> matrix_to_iarray_fst_Gauss_Jordan_in_ij_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ex_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> least_n_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"least_non_zero_position_of_vector_from_index <span class="main">(</span>vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> matrix_vector_all_zero_from_index<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ex_n<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_det_P_def Gauss_Jordan_in_ij_det_P_iarrays_def Let_def fst_conv
 <span class="keyword1"><span class="command">unfolding</span></span>  least_n_eq<span class="main">[</span><span class="operator">unfolded</span> vec_to_iarray_column<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> matrix_to_iarray_fst_Gauss_Jordan_in_ij_det_P'<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_in_ij_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_fst_Gauss_Jordan_in_ij_det_P assms <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_snd_Gauss_Jordan_in_ij_det_P"><span class="command">lemma</span></span> matrix_to_iarray_snd_Gauss_Jordan_in_ij_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ex_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_in_ij_det_P <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_in_ij_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_in_ij_det_P_def Gauss_Jordan_in_ij_det_P_iarrays_def Let_def snd_conv
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_Gauss_Jordan_in_ij<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_vector_all_zero_from_index<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ex_n<span class="main">)</span>


<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_fst_Gauss_Jordan_column_k_det_P"><span class="command">lemma</span></span> matrix_to_iarray_fst_Gauss_Jordan_column_k_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_det_P_iarrays_def Let_def snd_conv fst_conv 
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows matrix_vector_all_zero_from_index
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_fst_Gauss_Jordan_in_ij_det_P'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_det_P_iarrays_def Let_def snd_conv fst_conv <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_fst_snd_Gauss_Jordan_column_k_det_P"><span class="command">lemma</span></span> matrix_to_iarray_fst_snd_Gauss_Jordan_column_k_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_det_P_iarrays_def Let_def snd_conv fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows matrix_vector_all_zero_from_index
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_det_P_iarrays_def Let_def snd_conv fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows matrix_vector_all_zero_from_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_snd_snd_Gauss_Jordan_column_k_det_P"><span class="command">lemma</span></span> matrix_to_iarray_snd_snd_Gauss_Jordan_column_k_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_det_P_iarrays_def Let_def fst_conv snd_conv 
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows matrix_vector_all_zero_from_index
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_snd_Gauss_Jordan_in_ij_det_P<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> matrix_vector_all_zero_from_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_column_k_det_P_def Gauss_Jordan_column_k_det_P_iarrays_def Let_def fst_conv snd_conv 
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows matrix_vector_all_zero_from_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants_IArrays-fst_snd_Gauss_Jordan_column_k_det_P_le_nrows"><span class="command">lemma</span></span> fst_snd_Gauss_Jordan_column_k_det_P_le_nrows<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fst_snd_Gauss_Jordan_column_k_det_P_eq_fst_snd_Gauss_Jordan_column_k_PA<span class="main">[</span><span class="operator">unfolded</span> fst_snd_Gauss_Jordan_column_k_PA_eq<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fst_Gauss_Jordan_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The proof of the following theorem is very similar to the ones of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>foldl_Gauss_Jordan_column_k_eq›</span></span></span></span>, 
      <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rref_and_index_Gauss_Jordan_upt_k›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>foldl_Gauss_Jordan_column_k_det_P›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> matrix_to_iarray_fst_Gauss_Jordan_upt_k_det_P<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> matrix_to_iarray_snd_Gauss_Jordan_upt_k_det_P<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def fst_conv
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_fst_Gauss_Jordan_column_k_det_P<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def fst_conv snd_conv
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_snd_snd_Gauss_Jordan_column_k_det_P<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def fst_conv snd_conv
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fst_snd_Gauss_Jordan_column_k_det_P_le_nrows<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def fst_conv snd_conv
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_fst_snd_Gauss_Jordan_column_k_det_P<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
<span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Suc_k_less_ncols<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">hence</span></span> hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp3<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hyp4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">have</span></span> list_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
<span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> foldl Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> f_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> g_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">g</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> fst_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">g</span> <span class="main">=</span> fst <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> hyp1<span class="main">[</span><span class="operator">unfolded</span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def fst_conv<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">have</span></span> fst_snd_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> hyp4 <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> snd_snd_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> hyp2<span class="main">[</span><span class="operator">unfolded</span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def snd_conv<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">have</span></span> fst_snd_f_le_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> hyp3 <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">have</span></span> Suc_k_less_ncols'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> Suc_k_less_ncols <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def fst_conv
<span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append
<span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
<span class="keyword1"><span class="command">unfolding</span></span> f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> g_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> fst_rw fst_snd_rw snd_snd_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_fst_Gauss_Jordan_column_k_det_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fst_snd_f_le_nrows Suc_k_less_ncols'<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_upt_k_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_upt_k_det_P_def Gauss_Jordan_upt_k_det_P_iarrays_def Let_def snd_conv
<span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append
<span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
<span class="keyword1"><span class="command">unfolding</span></span> f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> g_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> fst_rw fst_snd_rw snd_snd_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_snd_snd_Gauss_Jordan_column_k_det_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fst_snd_f_le_nrows Suc_k_less_ncols'<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append List.foldl.simps
<span class="keyword1"><span class="command">unfolding</span></span> f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> fst_snd_Gauss_Jordan_column_k_det_P_le_nrows<span class="main">[</span><span class="operator">OF</span> fst_snd_f_le_nrows<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl Gauss_Jordan_column_k_det_P <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append List.foldl.simps
<span class="keyword1"><span class="command">unfolding</span></span> f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> g_rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> fst_rw fst_snd_rw snd_snd_rw<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> matrix_to_iarray_fst_snd_Gauss_Jordan_column_k_det_P<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> fst_snd_f_le_nrows Suc_k_less_ncols'<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_fst_Gauss_Jordan_det_P"><span class="command">lemma</span></span> matrix_to_iarray_fst_Gauss_Jordan_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_det_P_def Gauss_Jordan_det_P_iarrays_def
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_fst_Gauss_Jordan_upt_k_det_P
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_less matrix_to_iarray_ncols ncols_not_0 neq0_conv zero_less_one<span class="main">)</span>

<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_snd_Gauss_Jordan_det_P"><span class="command">lemma</span></span> matrix_to_iarray_snd_Gauss_Jordan_det_P<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_det_P_def Gauss_Jordan_det_P_iarrays_def
<span class="keyword1"><span class="command">using</span></span> matrix_to_iarray_snd_Gauss_Jordan_upt_k_det_P
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_less matrix_to_iarray_ncols ncols_not_0 neq0_conv zero_less_one<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Code equations›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">det_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> Gauss_Jordan_det_P_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">in</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">A'</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span> <span class="main">/</span> fst <span class="bound">A'</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Determinants_IArrays-matrix_to_iarray_det"><span class="command">lemma</span></span> matrix_to_iarray_det<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> det_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>Gauss_Jordan_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_fst_Gauss_Jordan_det_P <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map <span class="var">?f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> prod <span class="var">?f</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> distinct_upt prod.distinct_set_conv_list<span class="main">)</span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat<span class="main"><span class="main">::</span></span><span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'n</span></span><span class="main"><span class="main">=&gt;</span></span>nat<span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>to_nat<span class="main">::</span><span class="main">(</span><span class="tfree">'n</span><span class="main">=&gt;</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_mono_imp_inj_on strict_mono_to_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> range <span class="main">(</span>to_nat<span class="main">::</span><span class="tfree">'n</span><span class="main">=&gt;</span>nat<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def 
    <span class="keyword1"><span class="command">unfolding</span></span> atLeast0LessThan atLeast_upt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Gauss_Jordan_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="skolem">x</span> <span class="main">!!</span> to_nat <span class="skolem">x</span> <span class="main">=</span> snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_snd_Gauss_Jordan_det_P<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> snd <span class="main">(</span>Gauss_Jordan_det_P <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> 
  <span class="main">=</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>Gauss_Jordan_det_P_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> det_code_equation det_iarrays_def Let_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Inverse_IArrays">
<div class="head">
<h1>Theory Inverse_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Inverse_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Inverse of a matrix using the Gauss Jordan algorithm over nested IArrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Inverse_IArrays
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Inverse.html">Inverse</a>
  <a href="Gauss_Jordan_PA_IArrays.html">Gauss_Jordan_PA_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">invertible_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span>rank_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse_matrix_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> invertible_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span> Some<span class="main">(</span>fst<span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_to_iarray_option</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≠</span> None <span class="keyword1">then</span> Some <span class="main">(</span>matrix_to_iarray <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some lemmas and code generation›</span></span>
<span class="keyword1" id="Inverse_IArrays-matrix_inv_Gauss_Jordan_iarrays_PA"><span class="command">lemma</span></span> matrix_inv_Gauss_Jordan_iarrays_PA<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>matrix_inv <span class="free">A</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_A matrix_inv_Gauss_Jordan_PA matrix_to_iarray_fst_Gauss_Jordan_PA<span class="main">)</span>

<span class="keyword1" id="Inverse_IArrays-matrix_to_iarray_invertible"><span class="command">lemma</span></span> matrix_to_iarray_invertible<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span> <span class="main">=</span> invertible_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> invertible_iarray_def invertible_eq_full_rank<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> matrix_to_iarray_rank matrix_to_iarray_nrows <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Inverse_IArrays-matrix_to_iarray_option_inverse_matrix"><span class="command">lemma</span></span> matrix_to_iarray_option_inverse_matrix<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray_option <span class="main">(</span>inverse_matrix <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inverse_matrix_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> inverse_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">assume</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray_option <span class="main">(</span>Some <span class="main">(</span>matrix_inv <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inverse_matrix_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_option_def <span class="keyword1"><span class="command">unfolding</span></span> inverse_matrix_iarray_def <span class="keyword1"><span class="command">using</span></span> inv_A <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_invertible
<span class="keyword1"><span class="command">using</span></span> matrix_inv_Gauss_Jordan_iarrays_PA<span class="main">[</span><span class="operator">OF</span> inv_A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">assume</span></span> not_inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> invertible <span class="free">A</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray_option None <span class="main">=</span> inverse_matrix_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_option_def inverse_matrix_iarray_def
<span class="keyword1"><span class="command">using</span></span> not_inv_A <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_invertible <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Inverse_IArrays-matrix_to_iarray_option_inverse_matrix_code"><span class="command">lemma</span></span> matrix_to_iarray_option_inverse_matrix_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray_option <span class="main">(</span>inverse_matrix <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">matrix_to_iarray_A</span> <span class="main">=</span> matrix_to_iarray <span class="free">A</span><span class="main">;</span> <span class="bound">GJ</span> <span class="main">=</span> Gauss_Jordan_iarrays_PA <span class="bound">matrix_to_iarray_A</span>
  <span class="keyword1">in</span> <span class="keyword1">if</span> nrows_iarray <span class="bound">matrix_to_iarray_A</span> <span class="main">=</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">GJ</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span> <span class="keyword1">then</span> Some <span class="main">(</span>fst <span class="bound">GJ</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_option_inverse_matrix
<span class="keyword1"><span class="command">unfolding</span></span> inverse_matrix_iarray_def
<span class="keyword1"><span class="command">unfolding</span></span> invertible_iarray_def
<span class="keyword1"><span class="command">unfolding</span></span> rank_iarrays_code
<span class="keyword1"><span class="command">unfolding</span></span> Let_def
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_snd_Gauss_Jordan_PA<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> Gauss_Jordan_PA_eq
<span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_Gauss_Jordan <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>


<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse_matrix_iarray <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>Gauss_Jordan_iarrays_PA <span class="free">A</span><span class="main">)</span><span class="main">;</span> <span class="bound">nrows</span> <span class="main">=</span> IArray.length <span class="free">A</span> <span class="keyword1">in</span> 
                                <span class="main">(</span><span class="keyword1">if</span> length <span class="main">[</span><span class="bound">x</span><span class="main">←</span>IArray.list_of <span class="main">(</span>snd <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> is_zero_iarray <span class="bound">x</span><span class="main">]</span> <span class="main">=</span> <span class="bound">nrows</span> 
                                <span class="keyword1">then</span> Some <span class="main">(</span>fst <span class="bound">A'</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> inverse_matrix_iarray_def invertible_iarray_def rank_iarrays_code Let_def
<span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def snd_Gauss_Jordan_iarrays_PA_eq <span class="keyword1"><span class="command">..</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Examples_Gauss_Jordan_IArrays">
<div class="head">
<h1>Theory Examples_Gauss_Jordan_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Examples_Gauss_Jordan_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Examples of computations over matrices represented as nested IArrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Examples_Gauss_Jordan_IArrays
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="System_Of_Equations_IArrays.html">System_Of_Equations_IArrays</a>
  <a href="Determinants_IArrays.html">Determinants_IArrays</a>
  <a href="Inverse_IArrays.html">Inverse_IArrays</a>
  <a href="Code_Z2.html">Code_Z2</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="comment1">(*"HOL-Library.Code_Real_Approx_By_Float"*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Transformations between nested lists nested IArrays›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iarray_of_iarray_to_list_of_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iarray iarray <span class="main">=&gt;</span> <span class="tfree">'a</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iarray_of_iarray_to_list_of_list</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> map IArray.list_of <span class="main">(</span>map <span class="main">(</span><span class="main">(!!)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>IArray.length <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following definitions are also in the file <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Examples_on_Gauss_Jordan_Abstract›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions to transform a matrix to a list of list and vice versa›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_to_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">}</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_to_list</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">($)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>enum_class.enum<span class="main">::</span><span class="tfree">'n</span> list<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_to_list_of_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> enum<span class="main">}</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_to_list_of_list</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> map <span class="main">(</span>vec_to_list<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">($)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>enum_class.enum<span class="main">::</span><span class="tfree">'m</span> list<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This definition should be equivalent to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vector_def›</span></span></span></span> (in suitable types)›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_to_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>enum<span class="main">,</span> mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_to_vec</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>list_to_vec <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_to_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_of_list_to_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>enum<span class="main">,</span> mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>enum<span class="main">,</span> mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_of_list_to_matrix</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> list_to_vec <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>list_of_list_to_matrix <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> list_to_vec <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>to_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_of_list_to_matrix_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Examples›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following three lemmas are presented in both this file and in the 
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Examples_Gauss_Jordan_Abstract›</span></span></span></span> one. They allow a more convenient printing of rational and
real numbers after evaluation. They have already been added to the repository version of Isabelle, 
so after Isabelle2014 they should be removed from here.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_post</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"int_of_integer <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_abbrev</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>of_rat <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_post</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>of_rat <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> numeral <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> numeral <span class="free">k</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>of_rat <span class="main">(</span><span class="main">-</span> <span class="main">(</span>numeral <span class="free">k</span> <span class="main">/</span> numeral <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> numeral <span class="free">k</span> <span class="main">/</span> numeral <span class="free">l</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_divide of_rat_minus<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹From here on, we do the computations in two ways. The first one consists of executing the abstract functions (which internally will execute the ones over iarrays).
The second one runs directly the functions over iarrays.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Ranks, dimensions and Gauss Jordan algorithm›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the following examples, the theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>matrix_to_iarray_rank›</span></span></span></span> (which is the file <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Gauss_Jordan_IArrays›</span></span></span></span> 
  and it is a code unfold theorem) assures that the computation will be carried out using the iarrays representation.›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>col_space <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec.dim <span class="main">(</span>null_space <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>rat<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"rank_iarray <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>rat<span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span> 
<span class="comment1">(*Identical matrices with coefficients in Z2 and R could have different rank in each field:*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"rank_iarray <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"rank_iarray <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>bit<span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on computing the Gauss Jordan algorithm.›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"iarray_of_iarray_to_list_of_list <span class="main">(</span>matrix_to_iarray <span class="main">(</span>Gauss_Jordan <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span>Complex <span class="main">1</span> <span class="main">1</span><span class="main">,</span>Complex <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span>Complex <span class="numeral">2</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>Complex <span class="main">1</span> <span class="numeral">3</span><span class="main">,</span> Complex <span class="numeral">7</span> <span class="numeral">3</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>complex<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"iarray_of_iarray_to_list_of_list <span class="main">(</span>Gauss_Jordan_iarrays<span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span>Complex <span class="main">1</span> <span class="main">1</span><span class="main">,</span>Complex <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>Complex <span class="main">0</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span>Complex <span class="numeral">2</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>Complex <span class="main">1</span> <span class="numeral">3</span><span class="main">,</span>Complex <span class="numeral">7</span> <span class="numeral">3</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Inverse of a matrix›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on inverting matrices›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_result_some_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> None <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>iarray_of_iarray_to_list_of_list <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">7</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span>
                    <span class="keyword1">in</span> print_result_some_iarrays <span class="main">(</span>matrix_to_iarray_option <span class="main">(</span>inverse_matrix <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span><span class="main">=</span><span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>
                    <span class="keyword1">in</span> print_result_some_iarrays <span class="main">(</span>inverse_matrix_iarray <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Determinant of a matrix›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on computing determinants of matrices›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">47</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>rat<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">13</span><span class="main">,</span><span class="numeral">11</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>rat<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det_iarrays <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">13</span><span class="main">,</span><span class="numeral">11</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det_iarrays <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">286</span><span class="main">,</span><span class="numeral">662</span><span class="main">,</span><span class="numeral">263</span><span class="main">,</span><span class="numeral">246</span><span class="main">,</span><span class="numeral">642</span><span class="main">,</span><span class="numeral">656</span><span class="main">,</span><span class="numeral">351</span><span class="main">,</span><span class="numeral">454</span><span class="main">,</span><span class="numeral">339</span><span class="main">,</span><span class="numeral">848</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">307</span><span class="main">,</span><span class="numeral">489</span><span class="main">,</span><span class="numeral">667</span><span class="main">,</span><span class="numeral">908</span><span class="main">,</span><span class="numeral">103</span><span class="main">,</span><span class="numeral">47</span><span class="main">,</span><span class="numeral">120</span><span class="main">,</span><span class="numeral">133</span><span class="main">,</span><span class="numeral">85</span><span class="main">,</span><span class="numeral">834</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">69</span><span class="main">,</span><span class="numeral">732</span><span class="main">,</span><span class="numeral">285</span><span class="main">,</span><span class="numeral">147</span><span class="main">,</span><span class="numeral">527</span><span class="main">,</span><span class="numeral">655</span><span class="main">,</span><span class="numeral">732</span><span class="main">,</span><span class="numeral">661</span><span class="main">,</span><span class="numeral">846</span><span class="main">,</span><span class="numeral">202</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">463</span><span class="main">,</span><span class="numeral">855</span><span class="main">,</span><span class="numeral">78</span><span class="main">,</span><span class="numeral">338</span><span class="main">,</span><span class="numeral">786</span><span class="main">,</span><span class="numeral">954</span><span class="main">,</span><span class="numeral">593</span><span class="main">,</span><span class="numeral">550</span><span class="main">,</span><span class="numeral">913</span><span class="main">,</span><span class="numeral">378</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">90</span><span class="main">,</span><span class="numeral">926</span><span class="main">,</span><span class="numeral">201</span><span class="main">,</span><span class="numeral">362</span><span class="main">,</span><span class="numeral">985</span><span class="main">,</span><span class="numeral">341</span><span class="main">,</span><span class="numeral">540</span><span class="main">,</span><span class="numeral">912</span><span class="main">,</span><span class="numeral">494</span><span class="main">,</span><span class="numeral">427</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">384</span><span class="main">,</span><span class="numeral">511</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">627</span><span class="main">,</span><span class="numeral">131</span><span class="main">,</span><span class="numeral">620</span><span class="main">,</span><span class="numeral">987</span><span class="main">,</span><span class="numeral">996</span><span class="main">,</span><span class="numeral">445</span><span class="main">,</span><span class="numeral">216</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">385</span><span class="main">,</span><span class="numeral">538</span><span class="main">,</span><span class="numeral">362</span><span class="main">,</span><span class="numeral">643</span><span class="main">,</span><span class="numeral">567</span><span class="main">,</span><span class="numeral">804</span><span class="main">,</span><span class="numeral">499</span><span class="main">,</span><span class="numeral">914</span><span class="main">,</span><span class="numeral">332</span><span class="main">,</span><span class="numeral">512</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">879</span><span class="main">,</span><span class="numeral">159</span><span class="main">,</span><span class="numeral">312</span><span class="main">,</span><span class="numeral">187</span><span class="main">,</span><span class="numeral">827</span><span class="main">,</span><span class="numeral">503</span><span class="main">,</span><span class="numeral">823</span><span class="main">,</span><span class="numeral">893</span><span class="main">,</span><span class="numeral">139</span><span class="main">,</span><span class="numeral">546</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">800</span><span class="main">,</span><span class="numeral">376</span><span class="main">,</span><span class="numeral">331</span><span class="main">,</span><span class="numeral">363</span><span class="main">,</span><span class="numeral">840</span><span class="main">,</span><span class="numeral">737</span><span class="main">,</span><span class="numeral">911</span><span class="main">,</span><span class="numeral">886</span><span class="main">,</span><span class="numeral">456</span><span class="main">,</span><span class="numeral">848</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">900</span><span class="main">,</span><span class="numeral">737</span><span class="main">,</span><span class="numeral">280</span><span class="main">,</span><span class="numeral">370</span><span class="main">,</span><span class="numeral">121</span><span class="main">,</span><span class="numeral">195</span><span class="main">,</span><span class="numeral">958</span><span class="main">,</span><span class="numeral">862</span><span class="main">,</span><span class="numeral">957</span><span class="main">,</span><span class="numeral">754</span><span class="main">::</span>real<span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Bases of the fundamental subspaces›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on computing basis for null space, row space, column space and left null space.›</span></span>
<span class="comment1">(*Null_space basis:*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> 
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_null_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_null_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="comment1">(*Row_space basis*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
    <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_row_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_row_space <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> 
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_row_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_row_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="comment1">(*Col_space basis*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
    <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_col_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_col_space <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> 
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_col_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_col_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="comment1">(*Left_null_space basis*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
    <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_left_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span> 
  <span class="keyword1">in</span> vec_to_list<span class="main">`</span> <span class="main">(</span>basis_left_null_space <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">15</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">18</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> 
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_left_null_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>
  <span class="keyword1">in</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>basis_left_null_space_iarrays <span class="bound">A</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Consistency and inconsistency›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on checking the consistency/inconsistency of a system of equations. The theorems <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>matrix_to_iarray_independent_and_consistent›</span></span></span></span> and 
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>matrix_to_iarray_dependent_and_consistent›</span></span></span></span> which are code theorems and they are in the file <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>System_Of_Equations_IArrays›</span></span></span></span>
assure the execution using the iarrays representation.›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"independent_and_consistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"consistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"inconsistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">5</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"dependent_and_consistent <span class="main">(</span>list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"independent_and_consistent <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>list_to_vec<span class="main">(</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Solving systems of linear equations›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples on solving linear systems.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_result_system_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> None <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>IArray.list_of <span class="main">(</span>fst <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> IArray.list_of<span class="main">`</span> <span class="main">(</span>snd <span class="main">(</span>the <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">result</span> <span class="main">=</span> pair_vec_vecset <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span>
                  <span class="keyword1">in</span> print_result_system_iarrays <span class="main">(</span><span class="bound">result</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">11</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">13</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">5</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">result</span> <span class="main">=</span> pair_vec_vecset <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span>
                  <span class="keyword1">in</span> print_result_system_iarrays <span class="main">(</span><span class="bound">result</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span><span class="main">=</span><span class="main">(</span>list_to_vec <span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">::</span>real<span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">result</span> <span class="main">=</span> pair_vec_vecset <span class="main">(</span>solve <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span>
                  <span class="keyword1">in</span> print_result_system_iarrays <span class="main">(</span><span class="bound">result</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span><span class="main">=</span><span class="main">(</span>IArray<span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">result</span> <span class="main">=</span> <span class="main">(</span>solve_iarrays <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span>
                  <span class="keyword1">in</span> print_result_system_iarrays <span class="main">(</span><span class="bound">result</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">11</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">13</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span><span class="main">=</span><span class="main">(</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">result</span> <span class="main">=</span> <span class="main">(</span>solve_iarrays <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span>
                  <span class="keyword1">in</span> print_result_system_iarrays <span class="main">(</span><span class="bound">result</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">9</span><span class="main">::</span>real<span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">::</span>real<span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span><span class="main">=</span><span class="main">(</span>IArray<span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">result</span> <span class="main">=</span> <span class="main">(</span>solve_iarrays <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span>
                  <span class="keyword1">in</span> print_result_system_iarrays <span class="main">(</span><span class="bound">result</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">export_code</span></span>
  <span class="quoted"><span class="quoted">rank_iarray</span></span>
  <span class="quoted"><span class="quoted">inverse_matrix_iarray</span></span>
  <span class="quoted"><span class="quoted">det_iarrays</span></span>
  <span class="quoted"><span class="quoted">consistent_iarrays</span></span>
  <span class="quoted"><span class="quoted">inconsistent_iarrays</span></span>
  <span class="quoted"><span class="quoted">independent_and_consistent_iarrays</span></span>
  <span class="quoted"><span class="quoted">dependent_and_consistent_iarrays</span></span>
  <span class="quoted"><span class="quoted">basis_left_null_space_iarrays</span></span>
  <span class="quoted"><span class="quoted">basis_null_space_iarrays</span></span>
  <span class="quoted"><span class="quoted">basis_col_space_iarrays</span></span>
  <span class="quoted"><span class="quoted">basis_row_space_iarrays</span></span>
  <span class="quoted"><span class="quoted">solve_iarrays</span></span>
  <span class="keyword2"><span class="keyword">in</span></span> SML
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Generation_IArrays">
<div class="head">
<h1>Theory Code_Generation_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Generation_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Exporting code to SML and Haskell›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Generation_IArrays
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Examples_Gauss_Jordan_IArrays.html">Examples_Gauss_Jordan_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Exporting code›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following two equations are necessary to execute code. If we don't remove them from code unfold, the exported code
will not work (there exist problems with the number 1 and number 0. Those problems appear when the HMA library is imported).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_unfold</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> real_of_rat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_unfold</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> real_of_rat <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_z2</span> <span class="main">=</span> IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span> IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">::</span>bit<span class="main">]</span><span class="main">,</span> IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">::</span>bit<span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_rat</span> <span class="main">=</span> IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> IArray<span class="main">[</span><span class="numeral">5.7</span><span class="main">,</span><span class="numeral">22</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span> IArray<span class="main">[</span><span class="numeral">41</span><span class="main">,</span><span class="main">-</span><span class="numeral">58</span><span class="main">/</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">78</span><span class="main">::</span>rat<span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">matrix_real</span> <span class="main">=</span> IArray<span class="main">[</span>IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span> IArray<span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_rat</span> <span class="main">=</span> IArray<span class="main">[</span><span class="numeral">21</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">7</span><span class="main">::</span>rat<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_result_Gauss</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> iarray_of_iarray_to_list_of_list <span class="main">(</span>Gauss_Jordan_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_rank</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> rank_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_det</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> det_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_result_z2</span> <span class="main">=</span> print_result_Gauss <span class="main">(</span>matrix_z2<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_result_rat</span> <span class="main">=</span> print_result_Gauss <span class="main">(</span>matrix_rat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_result_real</span> <span class="main">=</span> print_result_Gauss <span class="main">(</span>matrix_real<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_rank_z2</span> <span class="main">=</span> print_rank <span class="main">(</span>matrix_z2<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_rank_rat</span> <span class="main">=</span> print_rank <span class="main">(</span>matrix_rat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_rank_real</span> <span class="main">=</span> print_rank <span class="main">(</span>matrix_real<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_det_rat</span> <span class="main">=</span> print_det <span class="main">(</span>matrix_rat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_det_real</span> <span class="main">=</span> print_det <span class="main">(</span>matrix_real<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_inverse</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> inverse_matrix_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_inverse_real</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> print_inverse <span class="main">(</span>matrix_real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_inverse_rat</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> print_inverse <span class="main">(</span>matrix_rat<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_system</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> print_result_system_iarrays <span class="main">(</span>solve_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_system_rat</span> <span class="main">=</span> print_result_system_iarrays <span class="main">(</span>solve_iarrays matrix_rat vec_rat<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Mathematica bug›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Varona et al \cite{VA} detected that the commercial software <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Mathematica®›</span></span></span></span>, 
in its versions 8.0, 9.0 and 9.0.1, was computing erroneously determinants of matrices 
of big integers, even for small dimensions  (in their work they present an example of a 
matrix of dimension <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>14 × 14›</span></span></span></span>). The situation is
such that even the same determinant, computed twice, produces two different and wrong results.

Here we reproduce that example. The computation of the determinant is correctly carried out by
the exported code from this formalization, in both SML and Haskell.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">powersMatrix</span> <span class="main">=</span> 
IArray<span class="main">[</span>
IArray<span class="main">[</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">123</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">152</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">185</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">220</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">397</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">449</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">503</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">563</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">979</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">1059</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">1143</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">1229</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">1319</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">1412</span><span class="main">)</span><span class="main">::</span>rat<span class="main">]</span><span class="main">]</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basicMatrix</span> <span class="main">=</span> 
IArray<span class="main">[</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">32</span><span class="main">,</span> <span class="numeral">69</span><span class="main">,</span> <span class="numeral">89</span><span class="main">,</span><span class="main">-</span><span class="numeral">60</span><span class="main">,</span><span class="main">-</span><span class="numeral">83</span><span class="main">,</span><span class="main">-</span><span class="numeral">22</span><span class="main">,</span><span class="main">-</span><span class="numeral">14</span><span class="main">,</span><span class="main">-</span><span class="numeral">58</span><span class="main">,</span><span class="numeral">85</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="main">-</span><span class="numeral">65</span><span class="main">,</span><span class="main">-</span><span class="numeral">30</span><span class="main">,</span><span class="main">-</span><span class="numeral">86</span><span class="main">,</span><span class="main">-</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">99</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span> <span class="numeral">57</span><span class="main">,</span> <span class="numeral">47</span><span class="main">,</span><span class="main">-</span><span class="numeral">42</span><span class="main">,</span><span class="main">-</span><span class="numeral">48</span><span class="main">,</span><span class="main">-</span><span class="numeral">65</span><span class="main">,</span> <span class="numeral">25</span><span class="main">,</span> <span class="numeral">50</span><span class="main">,</span><span class="main">-</span><span class="numeral">70</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">90</span><span class="main">,</span> <span class="numeral">31</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">78</span><span class="main">,</span> <span class="numeral">38</span><span class="main">,</span> <span class="numeral">12</span><span class="main">,</span> <span class="numeral">64</span><span class="main">,</span><span class="main">-</span><span class="numeral">67</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">52</span><span class="main">,</span><span class="main">-</span><span class="numeral">65</span><span class="main">,</span> <span class="numeral">19</span><span class="main">,</span> <span class="numeral">71</span><span class="main">,</span> <span class="numeral">38</span><span class="main">,</span><span class="main">-</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">51</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">93</span><span class="main">,</span> <span class="numeral">30</span><span class="main">,</span> <span class="numeral">89</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">13</span><span class="main">,</span> <span class="numeral">48</span><span class="main">,</span><span class="main">-</span><span class="numeral">73</span><span class="main">,</span> <span class="numeral">93</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span><span class="main">-</span><span class="numeral">97</span><span class="main">,</span><span class="main">-</span><span class="numeral">49</span><span class="main">,</span> <span class="numeral">61</span><span class="main">,</span><span class="main">-</span><span class="numeral">25</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">54</span><span class="main">,</span><span class="main">-</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">54</span><span class="main">,</span><span class="main">-</span><span class="numeral">53</span><span class="main">,</span><span class="main">-</span><span class="numeral">52</span><span class="main">,</span> <span class="numeral">64</span><span class="main">,</span> <span class="numeral">19</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">81</span><span class="main">,</span><span class="main">-</span><span class="numeral">72</span><span class="main">,</span><span class="main">-</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">50</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="numeral">81</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">65</span><span class="main">,</span><span class="main">-</span><span class="numeral">58</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">57</span><span class="main">,</span> <span class="numeral">19</span><span class="main">,</span> <span class="numeral">77</span><span class="main">,</span> <span class="numeral">76</span><span class="main">,</span><span class="main">-</span><span class="numeral">57</span><span class="main">,</span><span class="main">-</span><span class="numeral">80</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">93</span><span class="main">,</span><span class="main">-</span><span class="numeral">85</span><span class="main">,</span> <span class="numeral">67</span><span class="main">,</span> <span class="numeral">58</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">29</span><span class="main">,</span><span class="main">-</span><span class="numeral">58</span><span class="main">,</span> <span class="numeral">47</span><span class="main">,</span> <span class="numeral">87</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">6</span><span class="main">,</span><span class="main">-</span><span class="numeral">81</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">98</span><span class="main">,</span> <span class="numeral">86</span><span class="main">,</span><span class="main">-</span><span class="numeral">98</span><span class="main">,</span> <span class="numeral">51</span><span class="main">,</span><span class="main">-</span><span class="numeral">62</span><span class="main">,</span><span class="main">-</span><span class="numeral">66</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">93</span><span class="main">,</span><span class="main">-</span><span class="numeral">77</span><span class="main">,</span> <span class="numeral">16</span><span class="main">,</span><span class="main">-</span><span class="numeral">64</span><span class="main">,</span> <span class="numeral">48</span><span class="main">,</span> <span class="numeral">84</span><span class="main">,</span> <span class="numeral">97</span><span class="main">,</span> <span class="numeral">75</span><span class="main">,</span> <span class="numeral">89</span><span class="main">,</span> <span class="numeral">63</span><span class="main">,</span> <span class="numeral">34</span><span class="main">,</span><span class="main">-</span><span class="numeral">98</span><span class="main">,</span><span class="main">-</span><span class="numeral">94</span><span class="main">,</span> <span class="numeral">19</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">45</span><span class="main">,</span><span class="main">-</span><span class="numeral">99</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span><span class="main">-</span><span class="numeral">57</span><span class="main">,</span> <span class="numeral">32</span><span class="main">,</span> <span class="numeral">60</span><span class="main">,</span> <span class="numeral">74</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">69</span><span class="main">,</span> <span class="numeral">98</span><span class="main">,</span><span class="main">-</span><span class="numeral">40</span><span class="main">,</span><span class="main">-</span><span class="numeral">69</span><span class="main">,</span><span class="main">-</span><span class="numeral">28</span><span class="main">,</span><span class="main">-</span><span class="numeral">26</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">51</span><span class="main">,</span><span class="main">-</span><span class="numeral">99</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">48</span><span class="main">,</span> <span class="numeral">71</span><span class="main">,</span><span class="main">-</span><span class="numeral">81</span><span class="main">,</span><span class="main">-</span><span class="numeral">32</span><span class="main">,</span> <span class="numeral">78</span><span class="main">,</span> <span class="numeral">27</span><span class="main">,</span><span class="main">-</span><span class="numeral">28</span><span class="main">,</span><span class="main">-</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">94</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">72</span><span class="main">,</span><span class="main">-</span><span class="numeral">74</span><span class="main">,</span> <span class="numeral">86</span><span class="main">,</span> <span class="numeral">79</span><span class="main">,</span><span class="main">-</span><span class="numeral">58</span><span class="main">,</span><span class="main">-</span><span class="numeral">89</span><span class="main">,</span> <span class="numeral">80</span><span class="main">,</span> <span class="numeral">70</span><span class="main">,</span> <span class="numeral">55</span><span class="main">,</span><span class="main">-</span><span class="numeral">49</span><span class="main">,</span> <span class="numeral">51</span><span class="main">,</span><span class="main">-</span><span class="numeral">42</span><span class="main">,</span> <span class="numeral">66</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">72</span><span class="main">,</span> <span class="numeral">53</span><span class="main">,</span> <span class="numeral">49</span><span class="main">,</span><span class="main">-</span><span class="numeral">46</span><span class="main">,</span> <span class="numeral">17</span><span class="main">,</span><span class="main">-</span><span class="numeral">22</span><span class="main">,</span><span class="main">-</span><span class="numeral">48</span><span class="main">,</span><span class="main">-</span><span class="numeral">40</span><span class="main">,</span><span class="main">-</span><span class="numeral">28</span><span class="main">,</span><span class="main">-</span><span class="numeral">85</span><span class="main">,</span> <span class="numeral">88</span><span class="main">,</span><span class="main">-</span><span class="numeral">30</span><span class="main">,</span> <span class="numeral">74</span><span class="main">,</span> <span class="numeral">32</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">92</span><span class="main">,</span><span class="main">-</span><span class="numeral">22</span><span class="main">,</span><span class="main">-</span><span class="numeral">90</span><span class="main">,</span> <span class="numeral">67</span><span class="main">,</span><span class="main">-</span><span class="numeral">25</span><span class="main">,</span><span class="main">-</span><span class="numeral">28</span><span class="main">,</span><span class="main">-</span><span class="numeral">91</span><span class="main">,</span><span class="main">-</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">32</span><span class="main">,</span><span class="main">-</span><span class="numeral">41</span><span class="main">,</span> <span class="numeral">10</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">85</span><span class="main">,</span> <span class="numeral">21</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">47</span><span class="main">,</span><span class="main">-</span><span class="numeral">73</span><span class="main">,</span><span class="main">-</span><span class="numeral">30</span><span class="main">,</span><span class="main">-</span><span class="numeral">60</span><span class="main">,</span> <span class="numeral">99</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span><span class="main">-</span><span class="numeral">86</span><span class="main">,</span><span class="main">-</span><span class="numeral">70</span><span class="main">,</span> <span class="numeral">84</span><span class="main">,</span> <span class="numeral">55</span><span class="main">,</span> <span class="numeral">19</span><span class="main">,</span> <span class="numeral">69</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span><span class="main">-</span><span class="numeral">84</span><span class="main">::</span>rat<span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">smallMatrix</span><span class="main">=</span>
IArray<span class="main">[</span>
IArray<span class="main">[</span><span class="numeral">528</span><span class="main">,</span> <span class="numeral">853</span><span class="main">,</span><span class="main">-</span><span class="numeral">547</span><span class="main">,</span><span class="main">-</span><span class="numeral">323</span><span class="main">,</span> <span class="numeral">393</span><span class="main">,</span><span class="main">-</span><span class="numeral">916</span><span class="main">,</span><span class="main">-</span><span class="numeral">11</span><span class="main">,</span><span class="main">-</span><span class="numeral">976</span><span class="main">,</span> <span class="numeral">279</span><span class="main">,</span><span class="main">-</span><span class="numeral">665</span><span class="main">,</span> <span class="numeral">906</span><span class="main">,</span><span class="main">-</span><span class="numeral">277</span><span class="main">,</span> <span class="numeral">103</span><span class="main">,</span><span class="main">-</span><span class="numeral">485</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">878</span><span class="main">,</span> <span class="numeral">910</span><span class="main">,</span><span class="main">-</span><span class="numeral">306</span><span class="main">,</span><span class="main">-</span><span class="numeral">260</span><span class="main">,</span> <span class="numeral">575</span><span class="main">,</span><span class="main">-</span><span class="numeral">765</span><span class="main">,</span><span class="main">-</span><span class="numeral">32</span><span class="main">,</span> <span class="numeral">94</span><span class="main">,</span> <span class="numeral">254</span><span class="main">,</span> <span class="numeral">276</span><span class="main">,</span><span class="main">-</span><span class="numeral">156</span><span class="main">,</span> <span class="numeral">625</span><span class="main">,</span><span class="main">-</span><span class="numeral">8</span><span class="main">,</span><span class="main">-</span><span class="numeral">566</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">357</span><span class="main">,</span> <span class="numeral">451</span><span class="main">,</span><span class="main">-</span><span class="numeral">475</span><span class="main">,</span> <span class="numeral">327</span><span class="main">,</span><span class="main">-</span><span class="numeral">84</span><span class="main">,</span> <span class="numeral">237</span><span class="main">,</span> <span class="numeral">647</span><span class="main">,</span> <span class="numeral">505</span><span class="main">,</span><span class="main">-</span><span class="numeral">137</span><span class="main">,</span> <span class="numeral">363</span><span class="main">,</span><span class="main">-</span><span class="numeral">808</span><span class="main">,</span> <span class="numeral">332</span><span class="main">,</span> <span class="numeral">222</span><span class="main">,</span><span class="main">-</span><span class="numeral">998</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">76</span><span class="main">,</span> <span class="numeral">26</span><span class="main">,</span><span class="main">-</span><span class="numeral">778</span><span class="main">,</span> <span class="numeral">505</span><span class="main">,</span> <span class="numeral">942</span><span class="main">,</span><span class="main">-</span><span class="numeral">561</span><span class="main">,</span><span class="main">-</span><span class="numeral">350</span><span class="main">,</span> <span class="numeral">698</span><span class="main">,</span><span class="main">-</span><span class="numeral">532</span><span class="main">,</span><span class="main">-</span><span class="numeral">507</span><span class="main">,</span><span class="main">-</span><span class="numeral">78</span><span class="main">,</span><span class="main">-</span><span class="numeral">758</span><span class="main">,</span> <span class="numeral">346</span><span class="main">,</span><span class="main">-</span><span class="numeral">545</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">358</span><span class="main">,</span> <span class="numeral">18</span><span class="main">,</span><span class="main">-</span><span class="numeral">229</span><span class="main">,</span><span class="main">-</span><span class="numeral">880</span><span class="main">,</span><span class="main">-</span><span class="numeral">955</span><span class="main">,</span><span class="main">-</span><span class="numeral">346</span><span class="main">,</span> <span class="numeral">550</span><span class="main">,</span><span class="main">-</span><span class="numeral">958</span><span class="main">,</span> <span class="numeral">867</span><span class="main">,</span><span class="main">-</span><span class="numeral">541</span><span class="main">,</span><span class="main">-</span><span class="numeral">962</span><span class="main">,</span> <span class="numeral">646</span><span class="main">,</span> <span class="numeral">932</span><span class="main">,</span> <span class="numeral">168</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">192</span><span class="main">,</span> <span class="numeral">233</span><span class="main">,</span> <span class="numeral">620</span><span class="main">,</span><span class="numeral">955</span><span class="main">,</span><span class="main">-</span><span class="numeral">877</span><span class="main">,</span> <span class="numeral">281</span><span class="main">,</span> <span class="numeral">357</span><span class="main">,</span><span class="main">-</span><span class="numeral">226</span><span class="main">,</span><span class="main">-</span><span class="numeral">820</span><span class="main">,</span> <span class="numeral">513</span><span class="main">,</span><span class="main">-</span><span class="numeral">882</span><span class="main">,</span> <span class="numeral">536</span><span class="main">,</span><span class="main">-</span><span class="numeral">237</span><span class="main">,</span> <span class="numeral">877</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">234</span><span class="main">,</span><span class="main">-</span><span class="numeral">71</span><span class="main">,</span><span class="main">-</span><span class="numeral">831</span><span class="main">,</span> <span class="numeral">880</span><span class="main">,</span><span class="main">-</span><span class="numeral">135</span><span class="main">,</span><span class="main">-</span><span class="numeral">249</span><span class="main">,</span><span class="main">-</span><span class="numeral">427</span><span class="main">,</span> <span class="numeral">737</span><span class="main">,</span> <span class="numeral">664</span><span class="main">,</span> <span class="numeral">298</span><span class="main">,</span><span class="main">-</span><span class="numeral">552</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">712</span><span class="main">,</span><span class="main">-</span><span class="numeral">691</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">80</span><span class="main">,</span> <span class="numeral">748</span><span class="main">,</span> <span class="numeral">684</span><span class="main">,</span> <span class="numeral">332</span><span class="main">,</span> <span class="numeral">730</span><span class="main">,</span><span class="main">-</span><span class="numeral">111</span><span class="main">,</span><span class="main">-</span><span class="numeral">643</span><span class="main">,</span> <span class="numeral">102</span><span class="main">,</span><span class="main">-</span><span class="numeral">242</span><span class="main">,</span><span class="main">-</span><span class="numeral">82</span><span class="main">,</span><span class="main">-</span><span class="numeral">28</span><span class="main">,</span> <span class="numeral">585</span><span class="main">,</span> <span class="numeral">207</span><span class="main">,</span><span class="main">-</span><span class="numeral">986</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">967</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">494</span><span class="main">,</span> <span class="numeral">633</span><span class="main">,</span> <span class="numeral">891</span><span class="main">,</span><span class="main">-</span><span class="numeral">907</span><span class="main">,</span><span class="main">-</span><span class="numeral">586</span><span class="main">,</span> <span class="numeral">129</span><span class="main">,</span> <span class="numeral">688</span><span class="main">,</span> <span class="numeral">150</span><span class="main">,</span><span class="main">-</span><span class="numeral">501</span><span class="main">,</span><span class="main">-</span><span class="numeral">298</span><span class="main">,</span> <span class="numeral">704</span><span class="main">,</span><span class="main">-</span><span class="numeral">68</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">406</span><span class="main">,</span><span class="main">-</span><span class="numeral">944</span><span class="main">,</span><span class="main">-</span><span class="numeral">533</span><span class="main">,</span><span class="main">-</span><span class="numeral">827</span><span class="main">,</span> <span class="numeral">615</span><span class="main">,</span> <span class="numeral">907</span><span class="main">,</span><span class="main">-</span><span class="numeral">443</span><span class="main">,</span><span class="main">-</span><span class="numeral">350</span><span class="main">,</span> <span class="numeral">700</span><span class="main">,</span><span class="main">-</span><span class="numeral">878</span><span class="main">,</span> <span class="numeral">706</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span><span class="numeral">800</span><span class="main">,</span> <span class="numeral">120</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">33</span><span class="main">,</span><span class="main">-</span><span class="numeral">328</span><span class="main">,</span><span class="main">-</span><span class="numeral">543</span><span class="main">,</span> <span class="numeral">583</span><span class="main">,</span><span class="main">-</span><span class="numeral">443</span><span class="main">,</span><span class="main">-</span><span class="numeral">635</span><span class="main">,</span><span class="numeral">904</span><span class="main">,</span><span class="main">-</span><span class="numeral">745</span><span class="main">,</span><span class="main">-</span><span class="numeral">398</span><span class="main">,</span><span class="main">-</span><span class="numeral">110</span><span class="main">,</span> <span class="numeral">751</span><span class="main">,</span> <span class="numeral">660</span><span class="main">,</span> <span class="numeral">474</span><span class="main">,</span> <span class="numeral">255</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">537</span><span class="main">,</span><span class="main">-</span><span class="numeral">311</span><span class="main">,</span> <span class="numeral">829</span><span class="main">,</span> <span class="numeral">28</span><span class="main">,</span> <span class="numeral">175</span><span class="main">,</span> <span class="numeral">182</span><span class="main">,</span><span class="main">-</span><span class="numeral">930</span><span class="main">,</span> <span class="numeral">258</span><span class="main">,</span><span class="main">-</span><span class="numeral">808</span><span class="main">,</span><span class="main">-</span><span class="numeral">399</span><span class="main">,</span><span class="main">-</span><span class="numeral">43</span><span class="main">,</span><span class="main">-</span><span class="numeral">68</span><span class="main">,</span><span class="main">-</span><span class="numeral">553</span><span class="main">,</span> <span class="numeral">421</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="main">-</span><span class="numeral">373</span><span class="main">,</span><span class="main">-</span><span class="numeral">447</span><span class="main">,</span><span class="main">-</span><span class="numeral">252</span><span class="main">,</span><span class="main">-</span><span class="numeral">619</span><span class="main">,</span><span class="main">-</span><span class="numeral">418</span><span class="main">,</span> <span class="numeral">764</span><span class="main">,</span> <span class="numeral">994</span><span class="main">,</span><span class="main">-</span><span class="numeral">543</span><span class="main">,</span><span class="main">-</span><span class="numeral">37</span><span class="main">,</span><span class="main">-</span><span class="numeral">845</span><span class="main">,</span> <span class="numeral">30</span><span class="main">,</span><span class="main">-</span><span class="numeral">704</span><span class="main">,</span> <span class="numeral">147</span><span class="main">,</span><span class="main">-</span><span class="numeral">534</span><span class="main">]</span><span class="main">,</span>
IArray<span class="main">[</span><span class="numeral">638</span><span class="main">,</span><span class="main">-</span><span class="numeral">33</span><span class="main">,</span> <span class="numeral">932</span><span class="main">,</span><span class="main">-</span><span class="numeral">335</span><span class="main">,</span><span class="main">-</span><span class="numeral">75</span><span class="main">,</span><span class="main">-</span><span class="numeral">676</span><span class="main">,</span><span class="main">-</span><span class="numeral">934</span><span class="main">,</span> <span class="numeral">239</span><span class="main">,</span> <span class="numeral">210</span><span class="main">,</span> <span class="numeral">665</span><span class="main">,</span> <span class="numeral">414</span><span class="main">,</span><span class="main">-</span><span class="numeral">803</span><span class="main">,</span> <span class="numeral">564</span><span class="main">,</span><span class="main">-</span><span class="numeral">805</span><span class="main">::</span>rat<span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bigMatrix</span><span class="main">=</span><span class="main">(</span>basicMatrix <span class="keyword1">**i</span> powersMatrix<span class="main">)</span> <span class="main">+</span> smallMatrix"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Generation_IArrays_SML">
<div class="head">
<h1>Theory Code_Generation_IArrays_SML</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Generation_IArrays_SML.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Exporting code to SML›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Generation_IArrays_SML
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Real_Approx_By_Float.html">HOL-Library.Code_Real_Approx_By_Float</a>"</span>
  <a href="Code_Generation_IArrays.html">Code_Generation_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some serializations of gcd and abs in SML. Since gcd is not part of the standard SML library,
we have serialized it to the corresponding operation in PolyML and MLton.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">includes</span></span> integer.lifting
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> gcd_integer <span class="main">::</span> <span class="quoted"><span class="quoted">"integer <span class="main">=&gt;</span> integer <span class="main">=&gt;</span> integer"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">::</span> int <span class="main">=&gt;</span> int <span class="main">=&gt;</span> int"</span></span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1" id="Code_Generation_IArrays_SML-gcd_integer_code"><span class="command">lemma</span></span> gcd_integer_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"gcd_integer <span class="free">l</span> <span class="free">k</span> <span class="main">=</span> <span class="main">¦</span><span class="keyword1">if</span> <span class="free">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>integer<span class="main">)</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="keyword1">else</span> gcd_integer <span class="free">l</span> <span class="main">(</span><span class="main">¦</span><span class="free">k</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="main">¦</span><span class="free">l</span><span class="main">¦</span><span class="main">)</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> gcd_code_int <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd.commute<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">code_printing</span></span>
 <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">::</span> integer <span class="main">=&gt;</span> <span class="main">_</span>"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"IntInf.abs"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"gcd_integer <span class="main">::</span> integer <span class="main">=&gt;</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">_</span>"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"(PolyML.IntInf.gcd ((_),(_)))"</span> <span class="comment1">(*Only for Poly/ML*)</span>
 <span class="comment1">(* | constant "gcd_integer :: integer =&gt; _ =&gt; _" ⇀ (SML) "(MLton.IntInf.gcd ((_),(_)))"*)</span> <span class="comment1">(*Only for MLton*)</span>

<span class="keyword1" id="Code_Generation_IArrays_SML-gcd_code"><span class="command">lemma</span></span> gcd_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> int_of_integer <span class="main">(</span>gcd_integer <span class="main">(</span>of_int <span class="free">a</span><span class="main">)</span> <span class="main">(</span>of_int <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd_integer.abs_eq int_of_integer_integer_of_int integer_of_int_eq_of_int<span class="main">)</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">::</span> real <span class="main">=&gt;</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.abs"</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">::</span> real <span class="main">⇒</span> real"</span></span><span class="main">]</span><span class="main">]</span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There are several ways to serialize div and mod. The following ones are four examples of it:›</span></span>

<span class="comment1">(*The times are obtained after computing the rref of a 100x100 rational matrix.*)</span>

<span class="comment1">(* 21.484 seconds*)</span>
<span class="comment1">(*
code_printing
constant "divmod_integer :: integer =&gt; _ =&gt; _" ⇀ (SML) "(IntInf.divMod ((_),(_)))"
*)</span>

<span class="comment1">(*19.04 seconds*)</span>
<span class="comment1">(*
code_printing
constant "(div) :: integer =&gt; _ =&gt; _" ⇀ (SML) "(IntInf.div ((_), (_)))"
| constant "(mod) :: integer =&gt; _ =&gt; _" ⇀ (SML) "(IntInf.mod ((_), (_)))"
*)</span>

<span class="comment1">(*18.832 seconds*)</span>
<span class="comment1">(*
code_printing
constant "(div) :: integer =&gt; _ =&gt; _" ⇀ (SML) "(IntInf.quot ((_), (_)))"
| constant "(mod) :: integer =&gt; _ =&gt; _" ⇀ (SML) "(IntInf.rem ((_), (_)))"
*)</span>

<span class="comment1">(*18.792 seconds*)</span>
<span class="comment1">(*
code_printing
constant "divmod_integer :: integer =&gt; _ =&gt; _" ⇀ (SML) "(IntInf.quotRem ((_),(_)))"
*)</span>

<span class="comment1">(*Thus, the best option for our development is:*)</span>

<span class="keyword1"><span class="command">code_printing</span></span>
<span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"divmod_integer <span class="main">::</span> integer <span class="main">=&gt;</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">_</span>"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"(IntInf.quotRem ((_),(_)))"</span>

<span class="keyword1"><span class="command">export_code</span></span>
  <span class="quoted"><span class="quoted">print_rank_real</span></span>
  <span class="quoted"><span class="quoted">print_rank_rat</span></span>
  <span class="quoted"><span class="quoted">print_rank_z2</span></span>
  <span class="quoted"><span class="quoted">print_rank</span></span>
  <span class="quoted"><span class="quoted">print_result_real</span></span>
  <span class="quoted"><span class="quoted">print_result_rat</span></span>
  <span class="quoted"><span class="quoted">print_result_z2</span></span>
  <span class="quoted"><span class="quoted">print_result_Gauss</span></span>
  <span class="quoted"><span class="quoted">print_det_rat</span></span>
  <span class="quoted"><span class="quoted">print_det_real</span></span>
  <span class="quoted"><span class="quoted">print_det</span></span>
  <span class="quoted"><span class="quoted">print_inverse_real</span></span>
  <span class="quoted"><span class="quoted">print_inverse_rat</span></span>
  <span class="quoted"><span class="quoted">print_inverse</span></span>
  <span class="quoted"><span class="quoted">print_system_rat</span></span>
  <span class="quoted"><span class="quoted">print_system</span></span>
  <span class="keyword2"><span class="keyword">in</span></span> SML <span class="keyword2"><span class="keyword">module_name</span></span> <span class="quoted">"Gauss_SML"</span> <span class="comment1">(*file "Gauss_SML.sml"*)</span>
  
<span class="comment1">(* For the Mathematica bug:*)</span>

<span class="comment1">(*
export_code
  print_rank_real
  print_rank_rat
  print_rank_z2
  print_rank
  print_result_real
  print_result_rat
  print_result_z2
  print_result_Gauss
  print_det_rat 
  print_det_real
  print_det
  print_inverse_real
  print_inverse_rat
  print_inverse
  print_system_rat
  print_system

  bigMatrix
  in SML module_name "Gauss_SML" file "Gauss_SML.sml"
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Real_Approx_By_Float_Haskell">
<div class="head">
<h1>Theory Code_Real_Approx_By_Float_Haskell</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Real_Approx_By_Float_Haskell.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Serialization of real numbers in Haskell›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Real_Approx_By_Float_Haskell
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Real_Approx_By_Float.html">HOL-Library.Code_Real_Approx_By_Float</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\textbf{WARNING} This theory implements mathematical reals by machine
reals in Haskell, in a similar way to the work done in the theory <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Code_Real_Approx_By_Float_Haskell›</span></span></span></span>.
This is inconsistent.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Implementation of real numbers in Haskell›</span></span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">type_constructor</span></span> real <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.Double"</span> <span class="comment1">(*Double precission*)</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"0.0"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> real"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"1.0"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"real_of_integer"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.fromIntegral (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">class_instance</span></span> real <span class="main">::</span> <span class="quoted">"HOL.equal"</span> <span class="main">=&gt;</span> <span class="main">(</span>Haskell<span class="main">)</span> - <span class="comment1">(*This is necessary. See the tutorial on code generation, page 29*)</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"HOL.equal <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) == (_)"</span>
  <span class="main">|</span>  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> bool"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"_ &lt; _"</span>
  <span class="main">|</span>  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> bool"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"_ &lt;= _"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) + (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(-)</span> <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) - (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) * (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(/)</span> <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">" (_) '/ (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"uminus <span class="main">::</span> real <span class="main">=&gt;</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.negate"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">::</span> real <span class="main">=&gt;</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.sqrt"</span> 
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">Code_Real_Approx_By_Float.real_exp</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.exp"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">ln</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.log"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">cos</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.cos"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">sin</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.sin"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">tan</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.tan"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">pi</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.pi"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">arctan</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.atan"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">arccos</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.acos"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">arcsin</span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.asin"</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas have to be removed from the code generator in order to be able to execute <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(&lt;)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(≤)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">declare</span></span> real_less_code<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> real_less_eq_code<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Rational">
<div class="head">
<h1>Theory Code_Rational</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Rational.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Code Generation for rational numbers in Haskell›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Rational
<span class="keyword2"><span class="keyword">imports</span></span>

  <span class="comment1">(*VERY IMPORTANT! When code is exported, the order of the imports is very important.
  In this case, I have to import here the following three theories.
  They allow the computation of the Gauss-Jordan algorithm in Haskell*)</span>
  
  <a href="Code_Real_Approx_By_Float_Haskell.html">Code_Real_Approx_By_Float_Haskell</a>
  <a href="Code_Generation_IArrays.html">Code_Generation_IArrays</a>
    
  <span class="comment1">(*These theories are necessary for the serialisation:*)</span>
  <a href="../../HOL/HOL/Rat.html">HOL.Rat</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Int.html">HOL-Library.Code_Target_Int</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Serializations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>code_printing code_module›</span></span></span></span> module is the usual way to import libraries 
in Haskell. In this case, we rebind some functions from Data.Ratio. 
See <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2013-June/msg00007.html"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> Rational <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span>
 <span class="quoted">‹module Rational(fract, numerator, denominator) where

  import qualified Data.Ratio
  import Data.Ratio(numerator, denominator)

  fract (a, b) = a Data.Ratio.% b›</span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">includes</span></span> integer.lifting
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> Frct_integer <span class="main">::</span> <span class="quoted"><span class="quoted">"integer <span class="main">×</span> integer <span class="main">=&gt;</span> rat"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Frct <span class="main">::</span> int <span class="main">×</span> int <span class="main">=&gt;</span> rat"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">consts</span></span> Foo<span class="main">::</span><span class="quoted">rat</span>
<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">Foo</span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">includes</span></span> integer.lifting
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"Frct <span class="free">a</span> <span class="main">=</span> Frct_integer <span class="main">(</span><span class="main">(</span>of_int <span class="main">(</span>fst <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>of_int <span class="main">(</span>snd <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"Rat.of_int <span class="free">a</span> <span class="main">=</span> Frct_integer <span class="main">(</span>of_int <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fract_of_int_eq Rat.of_int_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">numerator</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">=&gt;</span> int"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">numerator</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">denominator</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">=&gt;</span> int"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">denominator</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> snd <span class="main">(</span>quotient_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> numerator_integer <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">=&gt;</span> integer"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"numerator"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> denominator_integer <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">=&gt;</span> integer"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"denominator"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"inverse <span class="free">x</span> <span class="main">=</span> Frct_integer <span class="main">(</span>denominator_integer <span class="free">x</span><span class="main">,</span> numerator_integer <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_eq_divide numerator_def denominator_def quotient_of_Fract One_rat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Code_Rational-quotient_of_num_den"><span class="command">lemma</span></span> quotient_of_num_den<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>numerator <span class="free">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>denominator <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> numerator_def denominator_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>int_of_integer <span class="main">(</span>numerator_integer <span class="free">x</span><span class="main">)</span><span class="main">,</span> int_of_integer<span class="main">(</span>denominator_integer <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_of_num_den<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">type_constructor</span></span> rat <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.Rational"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">class_instance</span></span> rat <span class="main">::</span> <span class="quoted">"HOL.equal"</span> <span class="main">=&gt;</span> <span class="main">(</span>Haskell<span class="main">)</span> -
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> rat"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(Prelude.toRational (0::Integer))"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> rat"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(Prelude.toRational (1::Integer))"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"Frct_integer"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Rational.fract (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"numerator_integer"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Rational.numerator (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"denominator_integer"</span></span> <span class="main">⇀</span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Rational.denominator (_)"</span>  
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"HOL.equal <span class="main">::</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) == (_)"</span>
  <span class="main">|</span>  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">::</span> rat <span class="main">=&gt;</span> rat <span class="main">=&gt;</span> bool"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"_ &lt; _"</span>
  <span class="main">|</span>  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">::</span> rat <span class="main">=&gt;</span> rat <span class="main">=&gt;</span> bool"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"_ &lt;= _"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) + (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(-)</span> <span class="main">::</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) - (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="main">::</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"(_) * (_)"</span>
  <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(/)</span> <span class="main">::</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">" (_) '/ (_)"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"uminus <span class="main">::</span> rat <span class="main">=&gt;</span> rat"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"Prelude.negate"</span>

<span class="comment1">(*
definition "test1 = (3::rat)"
definition "test2 = (3/9::rat)"
definition "test3 = (3/8 + 8/7::rat)"
definition "test4 = (3/8 - 8/7::rat)"
definition "test5 = (3/8 * 8/7::rat)"
definition "test6 = (3/8 / 8/7::rat)"
definition "test7 = (34 &lt; (53 :: rat))"
definition "test8 = (34 &lt;= (53 :: rat))"
definition "test9 = (inverse (8/5::rat))"
definition "test10 = quotient_of (8/3::rat)"
export_code
  test1
  test2
  test3
  test4
  test5
  test6
  test7
  test8
  test9
  test10
  in Haskell
  module_name "Rational_Haskell"
  file "haskell"
*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Generation_IArrays_Haskell">
<div class="head">
<h1>Theory Code_Generation_IArrays_Haskell</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Code_Generation_IArrays_Haskell.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Exporting code to Haskell›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Generation_IArrays_Haskell
<span class="keyword2"><span class="keyword">imports</span></span>    
  <a href="Code_Rational.html">Code_Rational</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">export_code</span></span>
  <span class="quoted"><span class="quoted">print_rank_real</span></span>
  <span class="quoted"><span class="quoted">print_rank_rat</span></span>
  <span class="quoted"><span class="quoted">print_rank_z2</span></span>
  <span class="quoted"><span class="quoted">print_rank</span></span>
  <span class="quoted"><span class="quoted">print_result_real</span></span>
  <span class="quoted"><span class="quoted">print_result_rat</span></span>
  <span class="quoted"><span class="quoted">print_result_z2</span></span>
  <span class="quoted"><span class="quoted">print_result_Gauss</span></span>
  <span class="quoted"><span class="quoted">print_det_rat</span></span> 
  <span class="quoted"><span class="quoted">print_det_real</span></span>
  <span class="quoted"><span class="quoted">print_det</span></span>
  <span class="quoted"><span class="quoted">print_inverse_real</span></span>
  <span class="quoted"><span class="quoted">print_inverse_rat</span></span>
  <span class="quoted"><span class="quoted">print_inverse</span></span>
  <span class="quoted"><span class="quoted">print_system_rat</span></span>
  <span class="quoted"><span class="quoted">print_system</span></span>
  <span class="keyword2"><span class="keyword">in</span></span> Haskell
  <span class="keyword2"><span class="keyword">module_name</span></span> <span class="quoted">"Gauss_Haskell"</span> <span class="comment1">(*file "haskell"*)</span>


<span class="comment1">(* For the Mathematica bug:*)</span>

<span class="comment1">(*
export_code
  print_rank_real
  print_rank_rat
  print_rank_z2
  print_rank
  print_result_real
  print_result_rat
  print_result_z2
  print_result_Gauss
  print_det_rat 
  print_det_real
  print_det
  print_inverse_real
  print_inverse_rat
  print_inverse

  bigMatrix
  in Haskell
  module_name "Gauss_Haskell"
  file "haskell"*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>