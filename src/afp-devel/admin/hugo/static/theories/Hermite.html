<div id="Hermite">
<div class="head">
<h1>Theory Hermite</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Hermite.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Hermite Normal Form›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Hermite
  <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Echelon_Form/Echelon_Form_Inverse.html">Echelon_Form.Echelon_Form_Inverse</a>
  <a href="../Echelon_Form/Examples_Echelon_Form_Abstract.html">Echelon_Form.Examples_Echelon_Form_Abstract</a>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Euclidean_Algorithm.html">HOL-Computational_Algebra.Euclidean_Algorithm</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some previous properties›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Rings›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> bezout_ring_div<span class="main">)</span> euclidean_ring
<span class="keyword1"><span class="command">proof</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Polynomials›</span></span>

<span class="keyword1" id="Hermite-coeff_dvd_poly"><span class="command">lemma</span></span> coeff_dvd_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>coeff <span class="free">a</span> <span class="main">(</span>degree <span class="free">a</span><span class="main">)</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span> poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_unit_triv one_dvd<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-poly_dvd_antisym2"><span class="command">lemma</span></span> poly_dvd_antisym2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dvd1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dvd2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="main">[:</span>coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">:]</span> <span class="main">=</span> <span class="free">q</span> <span class="keyword1">div</span> <span class="main">[:</span>coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span><span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd1 dvd_0_left_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False dvd2 dvd_0_left_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> degree<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order_antisym dvd_imp_degree_le<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> degree a <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> smult <span class="skolem">aa</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">aa</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">:]</span> <span class="keyword1">dvd</span> smult <span class="skolem">aa</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> coeff_dvd_poly coeff_smult degree_smult_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="main">[:</span>coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">:]</span> <span class="main">=</span> smult <span class="skolem">aa</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="skolem">aa</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False coeff_dvd_poly dvd_div_div_eq_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Units›</span></span>

<span class="keyword1" id="Hermite-unit_prod"><span class="command">lemma</span></span> unit_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_unit <span class="main">(</span><span class="free">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">U</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">*</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_unit_mult_iff insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Upper triangular matrices›</span></span>

<span class="keyword1" id="Hermite-is_unit_diagonal"><span class="command">lemma</span></span> is_unit_diagonal<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span> algebraic_semidom<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> det_U<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>det <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_unit <span class="main">(</span><span class="free">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> UNIV<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> det_U  det_upperdiagonal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span> U 
    <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> is_unit <span class="main">(</span><span class="free">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unit_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-upper_triangular_mult"><span class="command">lemma</span></span> upper_triangular_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular <span class="main">(</span><span class="free">A</span><span class="main">**</span><span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> upper_triangular_def matrix_matrix_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ji <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B ji <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-upper_triangular_adjugate"><span class="command">lemma</span></span> upper_triangular_adjugate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">,</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>wellorder<span class="main">,</span> finite<span class="main">}</span><span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'n</span><span class="main">)</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular <span class="main">(</span>adjugate <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cofactor_def upper_triangular_def adjugate_def transpose_def cofactorM_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span> <span class="keyword3"><span class="command">assume</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>minorM <span class="free">A</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> minorM_eq det_sq_matrix_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> from_vec_to_vec det_minor_row
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Square_Matrix.det_upperdiagonal<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upd_row.rep_eq from_vec.rep_eq row_def axis_def upper_triangular_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-upper_triangular_inverse"><span class="command">lemma</span></span> upper_triangular_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_semiring<span class="main">,</span>comm_ring_1<span class="main">}</span><span class="main">,</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>wellorder<span class="main">,</span> finite<span class="main">}</span><span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'n</span><span class="main">)</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular <span class="main">(</span>matrix_inv <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> upper_triangular_adjugate<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_imp_matrix_inv<span class="main">[</span><span class="operator">OF</span> inv_A<span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_scalar_mult_def upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Hermite-upper_triangular_mult_diagonal"><span class="command">lemma</span></span> upper_triangular_mult_diagonal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">,</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>wellorder<span class="main">,</span> finite<span class="main">}</span><span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'n</span><span class="main">)</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">**</span><span class="free">B</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">(</span>insert <span class="free">i</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> sum_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="free">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">**</span><span class="free">B</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_matrix_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>insert <span class="free">i</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹More properties of mod type›</span></span>

<span class="keyword1" id="Hermite-add_left_neutral"><span class="command">lemma</span></span> add_left_neutral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'n</span><span class="main">::</span>mod_type"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_left_cancel monoid_add_class.add.right_neutral<span class="main">)</span>

<span class="keyword1" id="Hermite-from_nat_1"><span class="command">lemma</span></span> from_nat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> from_nat_def o_def Abs'_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_1 Rep_mod of_nat_1 one_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Div and Mod›</span></span>

<span class="keyword1" id="Hermite-dvd_minus_eq_mod"><span class="command">lemma</span></span> dvd_minus_eq_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms dvd_div_mult_self<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute diff_add_cancel mod_mult_self1<span class="main">)</span>

<span class="keyword1" id="Hermite-eq_mod_dvd_minus"><span class="command">lemma</span></span> eq_mod_dvd_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_dvd_iff<span class="main">)</span>

<span class="keyword1" id="Hermite-dvd_cong_not_eq_mod"><span class="command">lemma</span></span> dvd_cong_not_eq_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">xb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> <span class="free">xa</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">-</span> <span class="free">xb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">xb</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> diff_add_cancel dvdE mod_mod_trivial  mod_mult_self4<span class="main">)</span>

<span class="keyword1" id="Hermite-diff_mod_cong_0"><span class="command">lemma</span></span> diff_mod_cong_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">xb</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="quoted"><span class="quoted">" <span class="free">c</span> <span class="keyword1">dvd</span> <span class="free">xa</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">-</span> <span class="free">xb</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms dvd_cong_not_eq_mod mod_mod_trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Hermite-cong_diff_mod"><span class="command">lemma</span></span> cong_diff_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">≠</span> <span class="free">xb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> <span class="free">xa</span> <span class="main">-</span> <span class="free">xb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="free">xa</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">≠</span> <span class="free">xb</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms diff_eq_diff_eq diff_numeral_special<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> dvd_0_left dvd_minus_eq_mod<span class="main">)</span>

<span class="keyword1" id="Hermite-exists_k_mod"><span class="command">lemma</span></span> exists_k_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute diff_add_cancel diff_minus_eq_add
      mult_div_mod_eq mult.commute mult_minus_left<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Units, associated and congruent relations›</span></span>

<span class="keyword1"><span class="command">context</span></span> semiring_1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Units</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">context</span></span> ring_1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cong</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span>bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cong</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Hermite-cong_eq"><span class="command">lemma</span></span> cong_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"cong <span class="free">a</span> <span class="free">c</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ring_1_class.cong_def dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> normalization_semidom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Hermite-Units_eq"><span class="command">lemma</span></span> Units_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Units <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">dvd</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Units_def dvd_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Hermite-normalize_Units"><span class="command">lemma</span></span> normalize_Units<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Units <span class="main">⟹</span> normalize <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> is_unit_normalize<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Units_eq<span class="main">)</span>

<span class="keyword1" id="Hermite-associated_eq"><span class="command">lemma</span></span> associated_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>normalize <span class="free">a</span> <span class="main">=</span> normalize <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">∈</span>Units<span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">u</span><span class="main">*</span><span class="free">b</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="free">a</span> <span class="main">=</span> normalize <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">∈</span>Units<span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">u</span><span class="main">*</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span>unit_factor <span class="free">a</span> <span class="keyword1">div</span> unit_factor <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_not_zero normalize_0 normalize_mult_unit_factor mult.left_commute 
           unit_div_mult_self unit_factor_is_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit_factor <span class="free">a</span> <span class="keyword1">div</span> unit_factor <span class="free">b</span> <span class="main">∈</span> Units"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Units_eq unit_div<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> A normalize_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> normalize_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Units_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normalize_Units Units_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> unique_euclidean_ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">associated_rel</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> normalize <span class="bound">a</span> <span class="main">=</span> normalize <span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Hermite-equiv_associated"><span class="command">lemma</span></span> equiv_associated<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equiv UNIV associated_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> associated_rel_def equiv_def refl_on_def sym_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">congruent_rel</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> cong <span class="bound">a</span> <span class="bound">c</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Hermite-relf_congruent_rel"><span class="command">lemma</span></span> relf_congruent_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"refl <span class="main">(</span>congruent_rel <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def congruent_rel_def 
  <span class="keyword1"><span class="command">unfolding</span></span> cong_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mult_zero_right<span class="main">)</span>

<span class="keyword1" id="Hermite-sym_congruent_rel"><span class="command">lemma</span></span> sym_congruent_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>congruent_rel <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_def congruent_rel_def <span class="keyword1"><span class="command">unfolding</span></span> cong_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_commute add_minus_cancel diff_conv_add_uminus 
    minus_mult_commute mult.left_commute mult_1_left<span class="main">)</span>

<span class="keyword1" id="Hermite-trans_congruent_rel"><span class="command">lemma</span></span> trans_congruent_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>congruent_rel <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> trans_def congruent_rel_def <span class="keyword1"><span class="command">unfolding</span></span> cong_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_assoc diff_add_cancel 
    diff_conv_add_uminus distrib_left<span class="main">)</span>

<span class="keyword1" id="Hermite-equiv_congruent"><span class="command">lemma</span></span> equiv_congruent<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv UNIV <span class="main">(</span>congruent_rel <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> equiv_def 
  <span class="keyword1"><span class="command">using</span></span> relf_congruent_rel sym_congruent_rel trans_congruent_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Associates and residues functions›</span></span>

<span class="keyword1"><span class="command">context</span></span> normalization_semidom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ass_function</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ass_function</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> 
  <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> normalize <span class="bound">a</span> <span class="main">=</span> normalize <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> normalize <span class="bound">a</span> <span class="main">≠</span> normalize <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>range <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Complete_set_non_associates</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> 
  <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ass_function <span class="bound">f</span> <span class="main">∧</span> <span class="bound">f</span><span class="main">`</span>UNIV <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main">(</span>pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> normalize <span class="bound">a</span> <span class="main">≠</span> normalize <span class="bound">b</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> ring_1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">res_function</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">res_function</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> cong <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">c</span> <span class="bound">b</span><span class="main">)</span> 
  <span class="main">∧</span> pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">¬</span> cong <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">)</span> <span class="main">(</span>range <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">k</span><span class="main">*</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Complete_set_residues</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> 
  <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> res_function <span class="bound">f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">¬</span> cong <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">c</span><span class="main">`</span>UNIV<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">c</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">c</span><span class="main">`</span>UNIV<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Hermite-ass_function_Complete_set_non_associates"><span class="command">lemma</span></span> ass_function_Complete_set_non_associates<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Complete_set_non_associates <span class="main">(</span><span class="free">f</span><span class="main">`</span>UNIV<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Complete_set_non_associates_def ass_function_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> ass_function_def <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Hermite-in_Ass_not_associated"><span class="command">lemma</span></span> in_Ass_not_associated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Ass_S<span class="main">:</span> <span class="quoted"><span class="quoted">"Complete_set_non_associates <span class="free">S</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">x</span> <span class="main">≠</span> normalize <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Complete_set_non_associates_def pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Hermite-ass_function_0"><span class="command">lemma</span></span> ass_function_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ass</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ass_function_def pairwise_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> normalize_eq_0_iff<span class="main">)</span>

<span class="keyword1" id="Hermite-ass_function_0'"><span class="command">lemma</span></span> ass_function_0'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ass</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ass</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> r <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="free">ass</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ass_function_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> associatedD2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">ass</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> * ** <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_div_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Hermite-res_function_Complete_set_residues"><span class="command">lemma</span></span> res_function_Complete_set_residues<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Complete_set_residues <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">c</span><span class="main">)</span><span class="main">`</span>UNIV<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Complete_set_residues_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> res_function_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Hermite-in_Res_not_congruent"><span class="command">lemma</span></span> in_Res_not_congruent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> res_g<span class="main">:</span> <span class="quoted"><span class="quoted">"Complete_set_residues <span class="free">g</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">g</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> cong <span class="free">x</span> <span class="free">y</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> Complete_set_residues_def 
  <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Concrete instances in Euclidean rings›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ass_function_euclidean</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>normalization_euclidean_semiring<span class="main">,</span> euclidean_ring<span class="main">}</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">res_function_euclidean</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hermite-ass_function_euclidean"><span class="command">lemma</span></span> ass_function_euclidean<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function ass_function_euclidean"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ass_function_def image_def ass_function_euclidean_def pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Hermite-res_function_euclidean"><span class="command">lemma</span></span> res_function_euclidean<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"res_function <span class="main">(</span>res_function_euclidean <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> unique_euclidean_ring <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def res_function_def cong_eq image_def res_function_euclidean_def dvd_minus_eq_mod<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_cong_not_eq_mod eq_mod_dvd_minus diff_mod_cong_0 cong_diff_mod exists_k_mod<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Concrete case of the integer ring›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ass_function_int</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> abs <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="Hermite-ass_function_int"><span class="command">lemma</span></span> ass_function_int<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function_int <span class="main">=</span> ass_function_euclidean"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ass_function_int_def ass_function_euclidean_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Hermite-ass_function_int_UNIV"><span class="command">lemma</span></span> ass_function_int_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ass_function_int<span class="main">`</span> UNIV<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≥</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ass_function_int_def image_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> abs_of_nonneg<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition of Hermite Normal Form›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
It is worth noting that there is not a single definition of Hermite Normal Form
in the literature. For instance, some authors restrict their definitions to the case 
of square nonsingular matrices. Other authors just work with integer matrices.
Furthermore, given a matrix $A$ its Hermite Normal Form $H$ can be defined to be upper triangular 
or lower triangular. In addition, the transformation from $A$ to $H$ can be made by means of 
elementary row operations or elementary column operations. In our case, we will work as general as 
possible, so our input will be any matrix (including nonsquare ones). The output will be an upper
triangular matrix obtained by means of elementary row operations.

Hence, given a complete set of nonassociates and a complete set of residues, 
$H$ is said to be in Hermite Normal Form if:

\begin{enumerate}
\item H is in Echelon Form
\item The first nonzero element of a nonzero row belongs to the complete set of nonassociates
\item Let $h$ be the first nonzero element of a nonzero row. Then each element above $h$
  belongs to the corresponding complete set of residues of $h$
\end{enumerate}

A matrix $H$ is the Hermite Normal Form of a matrix $A$ if:
\begin{enumerate}
\item There exists an invertible matrix $P$ such that $A = PH$
\item H is in Hermite Normal Form
\end{enumerate}

The Hermite Normal Form is usually applied to integer matrices. As we have already said, there is no
one single definition of it, so some authors impose different conditions. In the particular
case of integer matrices, leading coefficients (the first nonzero element of a nonzero row)
are usually required to be positive, but it is also possible to impose them to be negative 
since we would only have to multiply by $-1$.

In the case of the elements $h_{ik}$ above a leading coefficient $h_{ij}$, 
some authors demand $0 \leq h_{ik} &lt; h_{ij}$, 
other ones impose the conditions $h_{ik} \leq 0$ and \mbox{$\mid h_{ik} \mid &lt; h_{ij}$}, and other ones
$- \frac{h_{ij}}{2} &lt; h_{ik} \leq \frac{h_{ij}}{2}$. More different options are also possible.

All the possibilities can be represented selecting a complete set of nonassociates and a 
complete set of residues. The algorithm to compute the Hermite Normal Form will be 
parameterised by functions which obtain the appropriate leading coefficient and the 
suitable elements above them. We can execute the algorithm with different functions to get 
exactly which Hermite Normal Form we want. Once we fix such a complete set of nonassociates 
and the corresponding complete set of residues, the Hermite Normal Form is unique.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon form up to row k›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We present the definition of echelon form up to a row k (not included).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form_upt_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span>
  <span class="main">(</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> is_zero_row <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> to_nat <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> to_nat <span class="bound">j</span> <span class="main">&lt;</span>  <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>

<span class="keyword1" id="Hermite-echelon_form_upt_row_condition1_explicit"><span class="command">lemma</span></span> echelon_form_upt_row_condition1_explicit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_row <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="free">i</span> <span class="main">∧</span> to_nat <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Hermite-echelon_form_upt_row_condition1_explicit'"><span class="command">lemma</span></span> echelon_form_upt_row_condition1_explicit'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_row <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span><span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="free">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-echelon_form_upt_row_condition1_explicit_neg"><span class="command">lemma</span></span> echelon_form_upt_row_condition1_explicit_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_row <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ia_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">ia</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ia_i i less_trans to_nat_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-echelon_form_upt_row_condition2_explicit"><span class="command">lemma</span></span> echelon_form_upt_row_condition2_explicit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_row <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Hermite-echelon_form_upt_row_intro"><span class="command">lemma</span></span> echelon_form_upt_row_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">j</span> <span class="main">∧</span> to_nat <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> to_nat <span class="bound">j</span> <span class="main">&lt;</span>  <span class="free">k</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_row <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hermite-echelon_form_echelon_form_upt_row"><span class="command">lemma</span></span> echelon_form_echelon_form_upt_row<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span> <span class="main">=</span> echelon_form_upt_row <span class="free">A</span> <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_less_card echelon_form_def echelon_form_upt_row_def ncols_def nrows_def 
      echelon_form_upt_k_def is_zero_row_upt_k_def is_zero_row_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Hermite Normal Form up to row k›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Predicate to check if a matrix is in Hermite Normal form up to row k (not included).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_upt_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">associates</span></span></span> <span class="free"><span class="bound"><span class="entity">residues</span></span></span> <span class="main">=</span> 
  <span class="main">(</span>
    Complete_set_non_associates <span class="free"><span class="bound"><span class="entity">associates</span></span></span> <span class="main">∧</span>
    Complete_set_residues <span class="free"><span class="bound"><span class="entity">residues</span></span></span> <span class="main">∧</span>
    echelon_form_upt_row <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">associates</span></span></span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> to_nat <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">residues</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The definition of Hermite Normal Form is now introduced:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Hermite</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">}</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> 
   <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'c</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> vec <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Hermite</span> <span class="free"><span class="bound"><span class="entity">associates</span></span></span> <span class="free"><span class="bound"><span class="entity">residues</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span>
  Complete_set_non_associates <span class="free"><span class="bound"><span class="entity">associates</span></span></span> 
  <span class="main">∧</span> <span class="main">(</span>Complete_set_residues <span class="free"><span class="bound"><span class="entity">residues</span></span></span><span class="main">)</span> 
  <span class="main">∧</span> echelon_form <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">associates</span></span></span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span><span class="bound">i</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">residues</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>

<span class="keyword1" id="Hermite-Hermite_Hermite_upt_row"><span class="command">lemma</span></span> Hermite_Hermite_upt_row<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="main">=</span> Hermite_upt_row <span class="free">A</span> <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_def Hermite_upt_row_def to_nat_less_card is_zero_row_def 
    nrows_def ncols_def echelon_form_echelon_form_upt_row<span class="main">)</span>

<span class="keyword1" id="Hermite-Hermite_intro"><span class="command">lemma</span></span> Hermite_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Complete_set_non_associates <span class="free">associates</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Complete_set_residues <span class="free">residues</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span> "</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">associates</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span><span class="bound">i</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">residues</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite <span class="free">associates</span> <span class="free">residues</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Hermite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition of an algorithm to compute the Hermite Normal Form›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The algorithm is parameterised by three functions:

\begin{itemize}
  \item The function that computes de B\'ezout identity (necessary to compute the echelon form).
  \item The function that given an element, it returns its representative element in the associated equivalent class,
        which will be an element in the complete set of nonassociates.
  \item The function that given two elements $a$ and $b$, it returns its representative 
        element in the congruent equivalent class of $b$, which will be an element in the complete set of residues of $b$.
\end{itemize}


›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Hermite_reduce_above</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring<span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span>mod_type<span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span>mod_type<span class="main">⇒</span>nat
    <span class="main">⇒</span><span class="tfree">'rows</span><span class="main">⇒</span><span class="tfree">'cols</span><span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span>mod_type<span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span>mod_type"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_reduce_above</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span>  <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_reduce_above</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i'</span><span class="main">=</span><span class="main">(</span><span class="main">(</span>from_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">;</span> 
    <span class="bound">Aij</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span>
    <span class="bound">Ai'j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i'</span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span>
    <span class="keyword1">in</span> 
    <span class="free">Hermite_reduce_above</span> <span class="main">(</span>row_add <span class="free"><span class="bound"><span class="entity">A</span></span></span>  <span class="bound">i'</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="bound">Aij</span> <span class="main">(</span><span class="bound">Ai'j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">Ai'j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="bound">Aij</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_of_row_i</span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> is_zero_row <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
     <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
  <span class="keyword1">else</span>
    <span class="keyword1">let</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="bound">Aij</span><span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">;</span>
    <span class="bound">A'</span> <span class="main">=</span> mult_row <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="bound">Aij</span><span class="main">)</span> <span class="keyword1">div</span> <span class="bound">Aij</span><span class="main">)</span>
    <span class="keyword1">in</span> Hermite_reduce_above <span class="bound">A'</span> <span class="main">(</span>to_nat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_of_upt_row_i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="main">=</span> foldl <span class="main">(</span>Hermite_of_row_i <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>map from_nat <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span><span class="main">=</span> echelon_form_of <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="keyword1">in</span> Hermite_of_upt_row_i <span class="bound">A'</span> <span class="main">(</span>nrows <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proving the correctness of the algorithm›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The proof›</span></span>

<span class="keyword1" id="Hermite-Hermite_reduce_above_preserves"><span class="command">lemma</span></span> Hermite_reduce_above_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≤</span>to_nat <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_reduce_above <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def row_add_def<span class="main">)</span>
  <span class="main">(</span><span class="operator">metis</span> Suc_le_eq from_nat_mono from_nat_to_nat_id less_irrefl to_nat_less_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Hermite_reduce_above_works"><span class="command">lemma</span></span> Hermite_reduce_above_works<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> to_nat <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_reduce_above <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> 
         <span class="main">=</span> row_add <span class="free">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="free">i</span><span class="main">$</span><span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="free">a</span><span class="main">$</span><span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="free">a</span><span class="main">$</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">A</span><span class="main">$</span><span class="free">i</span><span class="main">$</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> n a
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span>
    <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> from_nat <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc_le_eq less_trans to_nat_less_card<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> a_less_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> Hermite_reduce_above <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def A'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row_add <span class="skolem">A'</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _  a_less_n<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc_leD<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row_add <span class="skolem">A</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> row_add_def A'_def
      <span class="keyword1"><span class="command">using</span></span> a_less_n Suc.prems n to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> n<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> a_eq_fn_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> from_nat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> Hermite_reduce_above <span class="skolem">A'</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def A'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A'_def a_eq_fn_n <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_row_preserves_below"><span class="command">lemma</span></span> Hermite_of_row_preserves_below<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> i_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_of_row_i_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main">)</span> 
     <span class="main">(</span><span class="operator">metis</span> i_a not_le not_less_iff_gr_or_eq to_nat_mono'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult_row_def <span class="keyword1"><span class="command">using</span></span> i_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_row_preserves_previous_cols"><span class="command">lemma</span></span> Hermite_of_row_preserves_previous_cols<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&lt;</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_of_row_i_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Aib<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> b not_less_Least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≥</span><span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> True to_nat_mono'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aib <span class="keyword1"><span class="command">unfolding</span></span> mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"row_add <span class="var">?M</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="var">?M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">(</span><span class="var">?M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_works<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ia to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia Aib <span class="keyword1"><span class="command">unfolding</span></span> row_add_def mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-echelon_form_Hermite_of_condition1"><span class="command">lemma</span></span> echelon_form_Hermite_of_condition1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">res</span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_ia_H<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">ia</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ia_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">j</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">ia</span> <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> zero_jA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True e echelon_form_condition1 ia_j<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e echelon_form_condition1 neq_iff not_zero_iA zero_jA<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> H 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> dual_order.strict_iff_order ij to_nat_mono'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_jA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> not_zero_ia_A<span class="main">=</span>False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A_ia_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def is_zero_row_upt_k_def not_zero_ia_A<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">ia</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True to_nat_mono'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">using</span></span> A_ia_n ass_function_0'<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> not_zero_ia_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_ia_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"row_add <span class="free">M</span> <span class="free">ia</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="main">-</span> <span class="free">M</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ia_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">&lt;</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n</span><span class="main">&lt;</span><span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e ia_less_i not_zero_ia_A not_zero_iA<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> A_im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> nm not_less_Least<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_works<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ia_less_i to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ia_less_i A_im A_ia_n <span class="keyword1"><span class="command">unfolding</span></span> row_add_def M mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> not_zero_ia_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_ia_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-row_zero_A_imp_row_zero_H"><span class="command">lemma</span></span> row_zero_A_imp_row_zero_H<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">res</span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_j_A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">j</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> 
  <span class="keyword1"><span class="command">have</span></span> A_ja<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> zero_j_A 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span><span class="free">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True to_nat_mono'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">using</span></span> True A_ja <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"row_add <span class="free">M</span> <span class="free">j</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">-</span> <span class="free">M</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="skolem">a</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_works<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ji to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ji A_ja not_zero_iA e echelon_form_condition1 zero_j_A 
      <span class="keyword1"><span class="command">unfolding</span></span> row_add_def M mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Hermite-Hermite_reduce_above_Least_eq_le"><span class="command">lemma</span></span> Hermite_reduce_above_Least_eq_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">res</span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">ia</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_ia_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">using</span></span> i_ia <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span> "</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> H
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="main">(</span><span class="operator">metis</span> i_ia dual_order.strict_iff_order to_nat_mono'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_ia_H<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> A_ia_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main">)</span> 
  <span class="main">(</span><span class="operator">metis</span> i_ia dual_order.strict_iff_order to_nat_mono'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">using</span></span> i_ia A_ia_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_reduce_above_Least_eq"><span class="command">lemma</span></span> Hermite_reduce_above_Least_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">res</span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_iA<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> H 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>            
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ain ass_function_0'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> H_iy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>            
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Aiy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> H 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Aiy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> H_iy <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Hermite_reduce_above_Least_eq_ge"><span class="command">lemma</span></span> Hermite_reduce_above_Least_eq_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">res</span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_ia_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_ia_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ia_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?least_H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?least_A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ain</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"row_add <span class="free">M</span> <span class="free">ia</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">-</span> <span class="free">M</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A_ia_least_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_ia_A<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> H_ia_least_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_H</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_ia_H<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A_i_least_ia_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e echelon_form_condition1 echelon_form_condition2_explicit 
        ia_less_i not_zero_iA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_less_Least <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> H_ia_least_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>                              
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_A</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_works<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ia_less_i to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia_less_i <span class="keyword1"><span class="command">unfolding</span></span> row_add_def M mult_row_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_i_least_ia_0 A_ia_least_A<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> least_H_le_least_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?least_H</span> <span class="main">≤</span> <span class="var">?least_A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> not_less not_less_Least<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A_i_least_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?least_H</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e echelon_form_condition1 echelon_form_condition2_explicit 
        ia_less_i not_zero_iA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_less_Least least_H_le_least_A 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> dual_order.strict_trans2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_H</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> ia_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia_less_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_H</span> <span class="main">=</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_H</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_works<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ia_less_i to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H_ia_least_H<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> R_ia_least_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_H</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="var">?least_H</span> <span class="main">+</span> <span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?Ain</span> <span class="main">*</span> <span class="var">?Ain</span><span class="main">)</span> 
      <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
      <span class="keyword1">div</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?Ain</span> <span class="main">*</span> <span class="var">?Ain</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?Ain</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?least_H</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ia_not_i <span class="keyword1"><span class="command">unfolding</span></span> row_add_def M mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ia_less_i A_i_least_H <span class="keyword1"><span class="command">unfolding</span></span> row_add_def M mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> least_A_le_least_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?least_A</span> <span class="main">≤</span> <span class="var">?least_H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> Least_le<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> least_A_le_least_H least_H_le_least_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Hermite_reduce_above_Least"><span class="command">lemma</span></span> Hermite_reduce_above_Least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">res</span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
  <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_ia_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_ia_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">&lt;</span><span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> H M 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e not_zero_iA not_zero_ia_A _ True<span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">metis</span> H M not_zero_ia_H<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> i_le_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span><span class="free">ia</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">=</span><span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> True H M 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> a not_zero_iA<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> i_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">ia</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_ia <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H M 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq_le<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> i_ia<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> H M not_zero_ia_H<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-echelon_form_Hermite_of_condition2"><span class="command">lemma</span></span> echelon_form_Hermite_of_condition2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">res</span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ia_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_ia_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_j_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">j</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_iA<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_j_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> row_zero_A_imp_row_zero_H<span class="main">[</span><span class="operator">OF</span> e not_zero_iA<span class="main">]</span> not_zero_j_H 
    <span class="keyword1"><span class="command">unfolding</span></span> H M <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_ia_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">ia</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> row_zero_A_imp_row_zero_H<span class="main">[</span><span class="operator">OF</span> e not_zero_iA<span class="main">]</span> not_zero_ia_H 
    <span class="keyword1"><span class="command">unfolding</span></span> H M <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> Least_le_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e ia_less_j not_zero_ia_A not_zero_j_A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">ia</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True ia_less_j less_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Least_A_ia_H_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H M      
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> H M not_zero_ia_H<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> Least_A_ia_H_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H M      
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ij<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> H M not_zero_j_H<span class="main">)</span>      
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Least_le_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> ia_le_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">≤</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="free">ia</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> Hermite_reduce_above_Least_eq<span class="main">[</span><span class="operator">OF</span> a not_zero_iA<span class="main">]</span> Least_le_A 
        <span class="keyword1"><span class="command">using</span></span> Hermite_reduce_above_Least_eq_le<span class="main">[</span><span class="operator">OF</span> ia_less_j<span class="main">]</span> 
        <span class="keyword1"><span class="command">using</span></span> not_zero_j_H <span class="keyword1"><span class="command">unfolding</span></span> H M <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> ia_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ia</span><span class="main">&lt;</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ia_le_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> Least_H_ia_A_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> H M 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e not_zero_iA not_zero_ia_A _ ia_less_i<span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="main">(</span><span class="operator">metis</span> H M not_zero_ia_H<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> H M 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e not_zero_iA not_zero_j_A _ True<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">metis</span> H M not_zero_j_H<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_H_ia_A_ia Least_le_A<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> j_ge_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≥</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span><span class="free">i</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> H M 
            <span class="keyword1"><span class="command">using</span></span> Hermite_reduce_above_Least_eq True a not_zero_iA <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_H_ia_A_ia Least_le_A<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> j_sg_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_ge_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> H M
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq_le<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> j_sg_i<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="main">(</span><span class="operator">metis</span> H M not_zero_j_H<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_H_ia_A_ia Least_le_A<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-echelon_form_Hermite_of_row"><span class="command">lemma</span></span> echelon_form_Hermite_of_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_of_row_i_def Let_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="skolem">ia</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="skolem">j</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> echelon_form_condition1<span class="main">[</span><span class="operator">OF</span> e<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">ia</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">j</span> <span class="free">A</span>"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> echelon_form_condition2<span class="main">[</span><span class="operator">OF</span> e<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="skolem">ia</span> <span class="main">(</span>Hermite_reduce_above 
    <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="skolem">j</span> <span class="main">(</span>Hermite_reduce_above 
    <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> echelon_form_Hermite_of_condition1<span class="main">[</span><span class="operator">OF</span> e a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_reduce_above <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
    <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">ia</span> <span class="var">?H</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">j</span> <span class="var">?H</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> echelon_form_Hermite_of_condition2<span class="main">[</span><span class="operator">OF</span> e a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-echelon_form_fold_Hermite_of_row_i"><span class="command">lemma</span></span> echelon_form_fold_Hermite_of_row_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>foldl <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>map from_nat <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> echelon_form_Hermite_of_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a r Suc.hyps<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-echelon_form_Hermite_of_upt_row_i"><span class="command">lemma</span></span> echelon_form_Hermite_of_upt_row_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def 
  <span class="keyword1"><span class="command">using</span></span> echelon_form_fold_Hermite_of_row_i assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Hermite-echelon_form_Hermite_of"><span class="command">lemma</span></span> echelon_form_Hermite_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_def Hermite_of_upt_row_i_def Let_def nrows_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_fold_Hermite_of_row_i<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_echelon_form_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span> a r<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Hermite-in_ass_Hermite_of_row"><span class="command">lemma</span></span> in_ass_Hermite_of_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def <span class="keyword1"><span class="command">using</span></span> not_zero_i_A 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ain</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Ain</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_i_A<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a not_zero_i_A<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?Ain</span> <span class="main">*</span> <span class="var">?Ain</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_row_def least_eq<span class="main">[</span><span class="operator">unfolded</span> mult_row_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ass</span> <span class="var">?Ain</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_div_mult_self<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ain</span> <span class="keyword1">dvd</span> <span class="free">ass</span> <span class="var">?Ain</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> ass_function_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associatedD2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Hermite_of_upt_row_preserves_below"><span class="command">lemma</span></span> Hermite_of_upt_row_preserves_below<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span><span class="main">≥</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_of_upt_row_i_def<span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">metis</span> Hermite_of_upt_row_i_def Hermite_of_row_preserves_below Suc.hyps Suc.prems 
      Suc_leD Suc_le_eq from_nat_mono from_nat_to_nat_id to_nat_less_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-not_zero_Hermite_reduce_above"><span class="command">lemma</span></span> not_zero_Hermite_reduce_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ass</span> <span class="free">i</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">≡</span><span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_a_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">a</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> to_nat <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">a</span> <span class="main">(</span>Hermite_reduce_above <span class="free">M</span> <span class="free">n</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_reduce_above <span class="free">M</span> <span class="free">n</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Aan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI not_zero_a_A is_zero_row_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Aim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI not_zero_i_A is_zero_row_def'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≤</span>to_nat <span class="free">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Hermite_reduce_above_preserves True<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M mult_row_def <span class="keyword1"><span class="command">using</span></span> ass_function_0'<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> Aan <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"row_add <span class="free">M</span> <span class="free">a</span> <span class="free">i</span>
      <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="main">-</span> <span class="free">M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> a_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
    <span class="keyword1"><span class="command">have</span></span> ai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False dual_order.trans n nat_less_le not_less_iff_gr_or_eq to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?m</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e ai not_zero_a_A not_zero_i_A<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> not_less_Least<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False n<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_works<span class="main"><span class="main">[</span></span><span class="operator">OF</span> n a_n<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_not_i Aan Ain <span class="keyword1"><span class="command">unfolding</span></span> row_add_def M mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Hermite-Least_Hermite_of_row_i"><span class="command">lemma</span></span> Least_Hermite_of_row_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def  <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e a i i<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">rule</span> not_zero_Hermite_reduce_above<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i i e a<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Least_Hermite_of_row_i2"><span class="command">lemma</span></span> Least_Hermite_of_row_i2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">k</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"mult_row <span class="free">A</span> <span class="free">k</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">k</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">k</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">k</span><span class="main">)</span> <span class="free">k</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">k</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def  <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e a k i<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a e i k not_zero_Hermite_reduce_above<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_row_i_works"><span class="command">lemma</span></span> Hermite_of_row_i_works<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">A</span> <span class="free">ass</span>
  <span class="keyword2"><span class="keyword">defines</span></span> n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> 
  row_add <span class="free">M</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> 
  <span class="main">-</span> <span class="free">M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="free">n</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def Let_def M n <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>   row_add <span class="free">M</span> <span class="free">a</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> 
    <span class="main">-</span> <span class="free">M</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_works<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ai to_nat_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_row_i_works2"><span class="command">lemma</span></span> Hermite_of_row_i_works2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">A</span> <span class="free">ass</span>
  <span class="keyword2"><span class="keyword">defines</span></span> n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> <span class="main">(</span>mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="free">M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="free">n</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="var">?H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def Let_def M n <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_reduce_above_preserves<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Hermite-Hermite_of_upt_row_preserves_nonzero_rows_ge"><span class="command">lemma</span></span> Hermite_of_upt_row_preserves_nonzero_rows_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">≥</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI i is_zero_row_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_preserves_below<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI i is_zero_row_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="Hermite-Hermite_of_upt_row_i_Least_ge"><span class="command">lemma</span></span> Hermite_of_upt_row_i_Least_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">≥</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI i is_zero_row_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_preserves_below<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI i is_zero_row_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Hermite_of_upt_row_preserves_below H i2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_upt_row_i_Least"><span class="command">lemma</span></span> Hermite_of_upt_row_i_Least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">≥</span><span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Hermite_of_upt_row_i_Least_ge iA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> i_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e iA k
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≤</span>nrows <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span>nrows <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> foldl <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="skolem">A</span> <span class="main">(</span>map from_nat <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> A'_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="skolem">A'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_Hermite_of_upt_row_i<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ a r<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> i_fn_k<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True from_nat_to_nat_id<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> not_zero_i_A'<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="skolem">A'</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_preserves_nonzero_rows_ge<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems True<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">...</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> i_fn_k 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_Hermite_of_row_i<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_i_A' e a<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_i_Least_ge<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True Suc.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> i_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> i_less_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k2 nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Hermite_of_upt_row_i_def Hermite_of_row_i_def A'_def Let_def <span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems k<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> not_zero_i_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> e False i_less_k2 echelon_form_condition1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">...</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_Hermite_of_row_i2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_i_A' False e a<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems k<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Hermite_of_upt_row_preserves_nonzero_rows"><span class="command">lemma</span></span> Hermite_of_upt_row_preserves_nonzero_rows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI i is_zero_row_def'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">≥</span><span class="free">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Hermite_of_upt_row_preserves_nonzero_rows_ge i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> i_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i k
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> k_nrows2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> foldl <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>map from_nat <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> A'_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> least_A'_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_i_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ e a r<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k_nrows Suc.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="skolem">A'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a e echelon_form_Hermite_of_upt_row_i r<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"mult_row <span class="skolem">A'</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> fn_k_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> not_zero_i_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> A'_def2<span class="main">)</span> 
        <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_preserves_nonzero_rows_ge<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True Suc.prems<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> A'_i_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_i_A'<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span>
          Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fn_k_i 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_row_i_works2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_i_A'<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> A'_i_l <span class="keyword1"><span class="command">unfolding</span></span> mult_row_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  ass_function_0'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span>  least_A'_A<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> i_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_antisym<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> i_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span> from_nat <span class="skolem">k</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> i_k Suc.prems
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k_nrows2 nrows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> not_zero_i_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_k Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> k_nrows<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_A'_A<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' not_zero_i_A'<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> Akn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e i_k2 not_zero_i_A' False<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span>  least_A'_A not_less_Least<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"mult_row <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span>
            <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="keyword1">div</span>
            <span class="skolem">A'</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span>
            Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row_add <span class="main">(</span>mult_row <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span>
            <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A'</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span>
            <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="var">?M</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="main">(</span><span class="var">?M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="main">-</span> <span class="var">?M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?M</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="var">?m</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_row_i_works<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_k2 False<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_k2 Ain Akn <span class="keyword1"><span class="command">unfolding</span></span> row_add_def mult_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Hermite_of_upt_row_i_def Hermite_of_row_i_def A'_def Let_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_i_A' <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_upt_row_i_in_range"><span class="command">lemma</span></span> Hermite_of_upt_row_i_in_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">&lt;</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> k not_zero_i_A k2
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> foldl <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>map from_nat <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A'_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> mult_row <span class="skolem">A'</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="skolem">A'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Hermite_of_upt_row_preserves_nonzero_rows<span class="main">[</span><span class="operator">OF</span> not_zero_i_A e a r k<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> A'_def Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> e_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A'_def a e echelon_form_fold_Hermite_of_row_i r<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_Hermite_of_row_i<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_A' e_A' a<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> least_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_i_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_i_A e a r k<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> fn_k_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True from_nat_to_nat_id<span class="main">)</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A'_def fn_k_i<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> least_eq least_eq2 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_ass_Hermite_of_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a r not_zero_A'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> i_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> i_less_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k2 nrows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Hermite_of_upt_row_i_def Hermite_of_row_i_def A'_def Let_def <span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps not_zero_i_A k i_less_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False          
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_row_preserves_previous_cols<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ False e_A'<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> mod_type_class.from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> least_eq2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e_A' i_less_k2 not_zero_A' False<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def <span class="keyword1"><span class="command">using</span></span> Suc.prems Suc.hyps 
        <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">using</span></span> i_less_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Hermite-Hermite_of_upt_row_preserves_zero_rows_ge"><span class="command">lemma</span></span> Hermite_of_upt_row_preserves_zero_rows_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ik<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">≥</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_def'<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Hermite_of_upt_row_preserves_below ik<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Hermite_of_upt_row_preserves_zero_rows"><span class="command">lemma</span></span> Hermite_of_upt_row_preserves_zero_rows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">≥</span><span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_preserves_zero_rows_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i k True<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> i_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> k i_k
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> foldl <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>map from_nat <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> A'_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> fn_k_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True from_nat_to_nat_id<span class="main">)</span>    
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A'_def fn_k_i<span class="main">)</span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_preserves_zero_rows_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' A'_def2 Hermite_of_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> i_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> i_less_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k2 nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps i_less_k k<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Hermite_of_upt_row_i_def Hermite_of_row_i_def A'_def Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps i_less_k k<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> echelon_form_condition1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A'_def2 False e a r echelon_form_Hermite_of_upt_row_i i_less_k2<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_preserves_zero_rows"><span class="command">lemma</span></span> Hermite_of_preserves_zero_rows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_preserves_zero_rows<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i echelon_form_echelon_form_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span> a r<span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def<span class="main">)</span>

<span class="keyword1" id="Hermite-Hermite_of_Least"><span class="command">lemma</span></span> Hermite_of_Least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> non_zero_i_eA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Hermite_of_preserves_zero_rows<span class="main">[</span><span class="operator">OF</span> _ a r b<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_echelon_form_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_i_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> non_zero_i_eA e a r<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-in_associates_Hermite_of"><span class="command">lemma</span></span> in_associates_Hermite_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> non_zero_i_eA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Hermite_of_preserves_zero_rows<span class="main">[</span><span class="operator">OF</span> _ a r b<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_echelon_form_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i a r b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> least
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_i_in_range<span class="main"><span class="main">[</span></span><span class="operator">OF</span> non_zero_i_eA e a r<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_less_card nrows_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_of_row_i_range_res"><span class="command">lemma</span></span> Hermite_of_row_i_range_res<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
  <span class="main">∈</span> range <span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"row_add <span class="skolem">M</span> <span class="free">j</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> 
    <span class="main">-</span> <span class="skolem">M</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Hii<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_row_i_works2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_i_A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="var">?n</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_row_i_works<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ji not_zero_i_A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span> <span class="bound">ba</span><span class="main">.</span> <span class="main">∃</span><span class="bound">bb</span><span class="main">.</span> <span class="bound">ba</span> <span class="main">+</span> <span class="bound">bb</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">res</span> <span class="bound">b</span> <span class="bound">ba</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> res_function_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rw <span class="keyword1"><span class="command">unfolding</span></span> image_def Hii row_add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> add_diff_cancel_left' nonzero_mult_div_cancel_left mult.commute mult_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-Hermite_of_upt_row_i_in_range_res"><span class="command">lemma</span></span> Hermite_of_upt_row_i_in_range_res<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_zero_i_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">&lt;</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
  <span class="main">∈</span> range <span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> k not_zero_i_A k2
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> foldl <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>map from_nat <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A'_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> mult_row <span class="skolem">A'</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="skolem">A'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Hermite_of_upt_row_preserves_nonzero_rows<span class="main">[</span><span class="operator">OF</span> not_zero_i_A e a r k<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> A'_def Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> e_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A'_def a e echelon_form_fold_Hermite_of_row_i r<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_Hermite_of_row_i<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_A' e_A' a<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> least_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A'_def2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_i_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_zero_i_A e a r k<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> fn_k_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True from_nat_to_nat_id<span class="main">)</span>    
    <span class="keyword1"><span class="command">have</span></span> H_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_of_upt_row_i_def A'_def fn_k_i least_eq2<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> A'_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A'_def fn_k_i<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> least_eq2 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> range <span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_row_i_range_res<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j not_zero_A' r<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> range <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H_rw <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> i_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> i_less_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k2 nrows_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Hermite_of_upt_row_i_def Hermite_of_row_i_def A'_def Let_def <span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps not_zero_i_A k i_less_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> H_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_of_upt_row_i_def A'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">rule</span> Hermite_of_row_preserves_previous_cols<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ False e_A'<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> mod_type_class.from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e_A' i_less_k2 not_zero_A' False<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> mod_type_class.from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> least_eq2 <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>   
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="skolem">A'</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def A'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_row_preserves_previous_cols<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ False e_A'<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> mod_type_class.from_nat <span class="skolem">k</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> least_eq2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e_A' i_less_k2 not_zero_A' False<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> range <span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_less_k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems k<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> range <span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> H_rw A'_def2 <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hermite-in_residues_Hermite_of"><span class="command">lemma</span></span> in_residues_Hermite_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
  <span class="main">∈</span> range <span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> non_zero_i_eA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Hermite_of_preserves_zero_rows<span class="main">[</span><span class="operator">OF</span> _ a r b<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_echelon_form_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_Least<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i a r b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> least
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_of_upt_row_i_in_range_res<span class="main"><span class="main">[</span></span><span class="operator">OF</span> non_zero_i_eA e a r _ _ ji<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_less_card nrows_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-Hermite_Hermite_of"><span class="command">lemma</span></span> Hermite_Hermite_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hermite <span class="main">(</span>range <span class="free">ass</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> range <span class="main">(</span><span class="free">res</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Complete_set_non_associates <span class="main">(</span>range <span class="free">ass</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ass_function_Complete_set_non_associates a<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Complete_set_residues <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> range <span class="main">(</span><span class="free">res</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r res_function_Complete_set_residues<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b echelon_form_Hermite_of r<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> 
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">i</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> range <span class="free">ass</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_associates_Hermite_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a r b i<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">i</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">∈</span> range <span class="main">(</span><span class="free">res</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_residues_Hermite_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a r b i j<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proving that the Hermite Normal Form is computed by means of elementary operations›</span></span>

<span class="keyword1" id="Hermite-invertible_Hermite_reduce_above"><span class="command">lemma</span></span> invertible_Hermite_reduce_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> to_nat <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> Hermite_reduce_above <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> invertible_def matrix_mul_lid<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>row_add <span class="skolem">A</span> <span class="main">(</span>from_nat <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> from_nat <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H_QR<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?R</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>row_add <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="main">(</span><span class="free">res</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">$</span> from_nat <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">$</span> from_nat <span class="skolem">n</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="var">?P</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_row_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mod_type_class.from_nat <span class="skolem">n</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems Suc_le_eq add_to_nat_def from_nat_mono less_irrefl 
          monoid_add_class.add.right_neutral to_nat_0 to_nat_less_card<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> inv_QP<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="var">?P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_P inv_Q invertible_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span> <span class="main">=</span> Hermite_reduce_above <span class="var">?R</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_QR <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="main">(</span><span class="var">?P</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> row_add_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="var">?P</span><span class="main">)</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mul_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> inv_QP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Hermite-invertible_Hermite_of_row_i"><span class="command">lemma</span></span> invertible_Hermite_of_row_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> invertible_def matrix_mul_lid<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"mult_row <span class="free">A</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"mult_row <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ain</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ass_dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ass</span> <span class="var">?Ain</span> <span class="keyword1">dvd</span> <span class="var">?Ain</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> ass_function_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associatedD1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ass_dvd'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Ain</span> <span class="keyword1">dvd</span> <span class="free">ass</span> <span class="var">?Ain</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> ass_function_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associatedD1<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ain_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI iA is_zero_row_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ass_Ain_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ass</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="var">?n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ain_0 ass_dvd dvd_0_left_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="var">?P</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_mult_row<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span> <span class="main"><span class="main">$</span></span> <span class="free"><span class="free">i</span></span> <span class="main"><span class="main">$</span></span> <span class="var"><span class="var">?n</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">ass</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">A</span></span> <span class="main"><span class="main">$</span></span> <span class="free"><span class="free">i</span></span> <span class="main"><span class="main">$</span></span> <span class="var"><span class="var">?n</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ass</span> <span class="var">?Ain</span> <span class="keyword1">div</span> <span class="var">?Ain</span> <span class="main">*</span> <span class="main">(</span><span class="var">?Ain</span> <span class="keyword1">div</span> <span class="free">ass</span> <span class="var">?Ain</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ass</span> <span class="var">?Ain</span> <span class="keyword1">div</span> <span class="var">?Ain</span> <span class="main">*</span> <span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">ass</span> <span class="var">?Ain</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> div_mult_swap<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass_dvd<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">ass</span> <span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">ass</span> <span class="var">?Ain</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_div_mult_self<span class="main">[</span><span class="operator">OF</span> ass_dvd'<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass_Ain_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ass</span> <span class="var">?Ain</span> <span class="keyword1">div</span> <span class="var">?Ain</span> <span class="main">*</span> <span class="main">(</span><span class="var">?Ain</span> <span class="keyword1">div</span> <span class="free">ass</span> <span class="var">?Ain</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ain</span> <span class="keyword1">div</span> <span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?Ain</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?Ain</span> <span class="keyword1">div</span> <span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="main">*</span> <span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?Ain</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> div_mult_swap<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass_dvd'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?Ain</span> <span class="keyword1">div</span> <span class="var">?Ain</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_div_mult_self<span class="main">[</span><span class="operator">OF</span> ass_dvd<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ain_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ain</span> <span class="keyword1">div</span> <span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ass</span> <span class="main">(</span><span class="var">?Ain</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?Ain</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H_QM<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="var">?n</span> <span class="free">res</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="var">?M</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> invertible_Hermite_reduce_above <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> inv_QP<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="skolem">Q</span><span class="main">**</span><span class="var">?P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_P inv_Q invertible_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="var">?n</span> <span class="free">res</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H_QM<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="main">(</span><span class="var">?P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult_row_mat_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="var">?P</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mul_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> Hermite_reduce_above <span class="var">?M</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="var">?n</span> <span class="free">res</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inv_QP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Hermite-invertible_Hermite_of_upt_row_i"><span class="command">lemma</span></span> invertible_Hermite_of_upt_row_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> Hermite_of_upt_row_i <span class="free">A</span> <span class="free">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> invertible_def matrix_mul_lid<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H_QA<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> H_PH<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span> 
    <span class="main">=</span> <span class="skolem">P</span> <span class="main">**</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_Hermite_of_row_i<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> inv_PQ<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="skolem">P</span><span class="main">**</span><span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_P inv_Q invertible_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> 
    <span class="main">=</span> Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="skolem">P</span> <span class="main">**</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">k</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_PH <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_QA <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">**</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">**</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mul_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> inv_PQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-invertible_Hermite_of"><span class="command">lemma</span></span> invertible_Hermite_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_semidom<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> H_PH<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite_of_upt_row_i <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> 
    <span class="main">=</span> <span class="skolem">P</span> <span class="main">**</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invertible_Hermite_of_upt_row_i<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> E_QA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">**</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> echelon_form_of_invertible<span class="main">[</span><span class="operator">OF</span> b<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> inv_PQ<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="skolem">P</span><span class="main">**</span><span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_P inv_Q invertible_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span> 
    <span class="main">=</span> Hermite_of_upt_row_i <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_def Let_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_PH <span class="keyword1"><span class="command">unfolding</span></span> E_QA <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">**</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mul_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> inv_PQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The final theorem›</span></span>

<span class="keyword1" id="Hermite-Hermite"><span class="command">lemma</span></span> Hermite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ass_function <span class="free">ass</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"res_function <span class="free">res</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">∧</span> 
  Hermite <span class="main">(</span>range <span class="free">ass</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> range <span class="main">(</span><span class="free">res</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_Hermite_of<span class="main">[</span><span class="operator">OF</span> a b<span class="main">]</span> Hermite_Hermite_of<span class="main">[</span><span class="operator">OF</span> a r b<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proving the uniqueness of the Hermite Normal Form›</span></span>

<span class="keyword1" id="Hermite-diagonal_least_nonzero"><span class="command">lemma</span></span> diagonal_least_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>bezout_ring_div<span class="main">,</span> normalization_euclidean_semiring<span class="main">,</span> unique_euclidean_ring<span class="main">}</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> mod_type<span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite <span class="free">associates</span> <span class="free">residues</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_H<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> up_H<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> inv_H invertible_iff_is_unit is_unit_diagonal not_is_unit_0 up_H<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> Hiy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> up_H <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> Hiy not_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-diagonal_in_associates"><span class="command">lemma</span></span> diagonal_in_associates<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>bezout_ring_div<span class="main">,</span> normalization_euclidean_semiring<span class="main">,</span> unique_euclidean_ring<span class="main">}</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> mod_type<span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite <span class="free">associates</span> <span class="free">residues</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_H<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> up_H<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">associates</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> inv_H invertible_iff_is_unit is_unit_diagonal not_is_unit_0 up_H<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">unfolding</span></span> Hermite_def <span class="keyword1"><span class="command">unfolding</span></span> diagonal_least_nonzero<span class="main">[</span><span class="operator">OF</span> H inv_H up_H<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite-above_diagonal_in_residues"><span class="command">lemma</span></span> above_diagonal_in_residues<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>bezout_ring_div<span class="main">,</span> normalization_euclidean_semiring<span class="main">,</span> unique_euclidean_ring<span class="main">}</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> mod_type<span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite <span class="free">associates</span> <span class="free">residues</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_H<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> up_H<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> j_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">residues</span> <span class="main">(</span><span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> inv_H invertible_iff_is_unit is_unit_diagonal not_is_unit_0 up_H<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> H j_i <span class="keyword1"><span class="command">unfolding</span></span> Hermite_def <span class="keyword1"><span class="command">unfolding</span></span> diagonal_least_nonzero<span class="main">[</span><span class="operator">OF</span> H inv_H up_H<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The uniqueness of the Hermite Normal Form is proven following the proof presented in the book
  Integral Matrices (1972) by Morris Newman.›</span></span>

<span class="keyword1" id="Hermite-Hermite_unique"><span class="command">lemma</span></span> Hermite_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">K</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">,</span>normalization_euclidean_semiring<span class="main">,</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span>mod_type<span class="main">^</span><span class="tfree">'n</span><span class="main">::</span>mod_type"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A_PH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">P</span> <span class="main">**</span> <span class="free">H</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> A_QK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite <span class="free">associates</span> <span class="free">residues</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"Hermite <span class="free">associates</span> <span class="free">residues</span> <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="free">K</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cs_residues<span class="main">:</span> <span class="quoted"><span class="quoted">"Complete_set_residues <span class="free">residues</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">unfolding</span></span> Hermite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> inv_H<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">H</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_PH inv_A inv_P invertible_def invertible_mult matrix_mul_assoc matrix_mul_lid<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inv_K<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">K</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_QK inv_A inv_Q invertible_def invertible_mult matrix_mul_assoc matrix_mul_lid<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span><span class="main">**</span><span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> inv_U<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">U</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_def inv_P inv_Q invertible_def invertible_mult matrix_inv_left matrix_inv_right<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> H_UK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">**</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_PH A_QK inv_P 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_def matrix_inv_left matrix_mul_assoc matrix_mul_lid<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="free">K</span> <span class="keyword1">*k</span> <span class="skolem">U</span> <span class="main">=</span> <span class="free">H</span> <span class="main">**</span> adjugate <span class="free">K</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> H_UK matrix_mul_assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mult_adjugate_det matrix_mul_mat <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> upper_triangular_H<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">H</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H Hermite_def echelon_form_imp_upper_triagular<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> upper_triangular_K<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">K</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> K Hermite_def echelon_form_imp_upper_triagular<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> upper_triangular_U<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_triangular <span class="skolem">U</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_UK inv_K matrix_inv_right matrix_mul_assoc matrix_mul_rid upper_triangular_H 
      upper_triangular_K upper_triangular_inverse upper_triangular_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> unit_det_U<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>det <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_U invertible_iff_is_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> is_unit_diagonal_U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_unit <span class="main">(</span><span class="skolem">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_unit_diagonal<span class="main"><span class="main">[</span></span><span class="operator">OF</span> upper_triangular_U unit_det_U<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Uii_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Hii_Kii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> Hii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">associates</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> diagonal_in_associates<span class="main"><span class="main">[</span></span><span class="operator">OF</span> H inv_H upper_triangular_H<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Kii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">associates</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> diagonal_in_associates<span class="main"><span class="main">[</span></span><span class="operator">OF</span> K inv_K upper_triangular_K<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ass_Hii_Kii<span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="free">H</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> normalize <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> associatedI inv_H inv_K invertible_iff_is_unit is_unit_diagonal
                unit_imp_dvd upper_triangular_H upper_triangular_K<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> Hii_eq_Kii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">K</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Hermite_def Hii K Kii ass_Hii_Kii in_Ass_not_associated<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_UK upper_triangular_K upper_triangular_U upper_triangular_mult_diagonal<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Hii_eq_Kii mult_cancel_right1 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Hii_eq_Kii inv_H invertible_iff_is_unit
        is_unit_diagonal not_is_unit_0 upper_triangular_H<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> zero_above<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">j</span><span class="main">≥</span><span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">-</span> to_nat <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">U</span> <span class="main">$</span> <span class="bound">s</span> <span class="main">$</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> from_nat <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">-</span> <span class="main">(</span>to_nat <span class="main">(</span><span class="skolem">s</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
      <span class="keyword3"><span class="command">assume</span></span> induct_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">-</span> to_nat <span class="skolem">s</span> <span class="main">⟹</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">-</span> to_nat <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> s_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">unfolding</span></span> ncols_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add.commute add_diff_cancel_right' add_lessD1 add_to_nat_def 
          from_nat_to_nat_id less_diff_conv neq_iff not_le
          to_nat_from_nat_id to_nat_le zero_less_Suc<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="skolem">s</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> UNIV_s_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">}</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> p1 p2 s_less <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> sum_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">=</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> 
          <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">{</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">}</span><span class="main">.</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> UNIV_s_rw sum.insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diff_iff finite singletonI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> sum_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">{</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">}</span><span class="main">.</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">s</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">}</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">s</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> upper_triangular_U <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">hence</span></span> x_g_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff neq_iff singletonI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">+</span>from_nat <span class="skolem">p</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> to_nat <span class="skolem">x</span> <span class="main">-</span> to_nat <span class="skolem">s</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> x_g_s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">s</span> <span class="main">&lt;</span> to_nat <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> to_nat_mono<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">s</span><span class="main">+</span><span class="main">(</span>from_nat <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def add_to_nat_def
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_diff_less to_nat_less_card <span class="dynamic"><span class="dynamic">algebra_simps</span></span> to_nat_from_nat_id<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> xa<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> induct_step<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command">unfolding</span></span> ncols_def 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> from_nat <span class="main">(</span>to_nat <span class="skolem">s</span> <span class="main">+</span> to_nat <span class="main">(</span>from_nat <span class="skolem">p</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> True add_to_nat_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">x</span> <span class="main">-</span> to_nat <span class="skolem">s</span> <span class="main">&lt;</span> to_nat <span class="main">(</span>from_nat <span class="skolem">p</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute less_diff_conv2 less_imp_le to_nat_le x_g_s<span class="main">)</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">x</span> <span class="main">-</span> to_nat <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> from_nat_eq_imp_eq from_nat_to_nat_id le_less_trans 
                        less_imp_le not_le to_nat_less_card<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>                    
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def p1 p2<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Suc_leI to_nat_mono x_g_s zero_less_diff<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">-</span> to_nat <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">s</span><span class="main">+</span>from_nat <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_g_s x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> upper_triangular_K <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> H_UK matrix_matrix_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> 
          <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">-</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> 
          <span class="main">+</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sum_rw sum_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> H_s_sp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> 
          <span class="main">=</span> <span class="skolem">U</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> <span class="free">K</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Uii_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> cong_HK<span class="main">:</span> <span class="quoted"><span class="quoted">"cong <span class="main">(</span><span class="free">H</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span><span class="main">+</span>from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cong_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> H_s_sp_residues<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">residues</span> <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span><span class="main">+</span>from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> above_diagonal_in_residues<span class="main">[</span><span class="operator">OF</span> H inv_H upper_triangular_H s_less<span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> diagonal_least_nonzero<span class="main">[</span><span class="operator">OF</span> H inv_H upper_triangular_H<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Hii_Kii<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> K_s_sp_residues<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">residues</span> <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span><span class="main">+</span>from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> above_diagonal_in_residues<span class="main">[</span><span class="operator">OF</span> K inv_K upper_triangular_K s_less<span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> diagonal_least_nonzero<span class="main">[</span><span class="operator">OF</span> K inv_K upper_triangular_K<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">have</span></span> Hs_sp_Ks_sp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>             
          <span class="keyword1"><span class="command">using</span></span> cong_HK in_Res_not_congruent<span class="main">[</span><span class="operator">OF</span> cs_residues H_s_sp_residues K_s_sp_residues<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span><span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Hii_Kii inv_H invertible_iff_is_unit is_unit_diagonal upper_triangular_H<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> from_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_is_unit_0<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_1 <span class="keyword1"><span class="command">using</span></span> H_s_sp <span class="keyword1"><span class="command">unfolding</span></span> Hs_sp_Ks_sp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> mat_def vec_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Uii_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> upper_triangular_U <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> i_less_ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_ia <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> to_nat <span class="skolem">ia</span> <span class="main">-</span> to_nat <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ia_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> from_nat <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_less_ia a_def add_to_nat_def dual_order.strict_iff_order from_nat_to_nat_id 
            le_add_diff_inverse less_imp_diff_less to_nat_from_nat_id to_nat_less_card to_nat_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_is_0_eq i_less_ia less_one not_less to_nat_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">-</span> to_nat <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> a_def ncols_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False diff_less_mono not_less to_nat_less_card to_nat_mono'<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_above <span class="keyword1"><span class="command">unfolding</span></span> ia_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> H_UK matrix_mul_lid <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Examples of execution›</span></span>

<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">37</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">6</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="main">-</span><span class="numeral">7</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>
  <span class="keyword1">in</span> matrix_to_list_of_list <span class="main">(</span>Hermite_of <span class="bound">A</span> ass_function_euclidean res_function_euclidean euclid_ext2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">[:</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">:]</span><span class="main">,</span><span class="main">[:</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">:]</span><span class="main">,</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real poly<span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span>
  <span class="keyword1">in</span> matrix_to_list_of_list <span class="main">(</span>Hermite_of <span class="bound">A</span> ass_function_euclidean res_function_euclidean euclid_ext2<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Hermite_IArrays">
<div class="head">
<h1>Theory Hermite_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Hermite_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Hermite Normal Form refined to immutable arrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Hermite_IArrays
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Hermite.html">Hermite</a>
  <a href="../Echelon_Form/Echelon_Form_IArrays.html">Echelon_Form.Echelon_Form_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition of the algorithm over immutable arrays›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Hermite_reduce_above_iarrays</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unique_euclidean_ring iarray iarray <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> iarray iarray"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_reduce_above_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span>  <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_reduce_above_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i'</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> 
    <span class="bound">Aij</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">;</span>
    <span class="bound">Ai'j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i'</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span>
    <span class="keyword1">in</span> 
    <span class="free">Hermite_reduce_above_iarrays</span> <span class="main">(</span>row_add_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span>  <span class="bound">i'</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="bound">Aij</span> <span class="main">(</span><span class="bound">Ai'j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">Ai'j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="bound">Aij</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_of_row_i_iarray</span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> is_zero_iarray <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> 
     <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
  <span class="keyword1">else</span>
    <span class="keyword1">let</span> <span class="bound">j</span> <span class="main">=</span> least_non_zero_position_of_vector <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">Aij</span><span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">!!</span> <span class="bound">j</span><span class="main">)</span><span class="main">;</span>
    <span class="bound">A'</span> <span class="main">=</span> mult_row_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="bound">Aij</span><span class="main">)</span> <span class="keyword1">div</span> <span class="bound">Aij</span><span class="main">)</span>
    <span class="keyword1">in</span> Hermite_reduce_above_iarrays <span class="bound">A'</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_of_upt_row_i_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span>  <span class="main">=</span> foldl <span class="main">(</span>Hermite_of_row_i_iarray <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hermite_of_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span><span class="main">=</span> echelon_form_of_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> 
  <span class="keyword1">in</span> Hermite_of_upt_row_i_iarrays <span class="bound">A'</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proving the equivalence between definitions of both representations›</span></span>

<span class="keyword1" id="Hermite_IArrays-matrix_to_iarray_Hermite_reduce_above"><span class="command">lemma</span></span> matrix_to_iarray_Hermite_reduce_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Hermite_reduce_above <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">res</span><span class="main">)</span> 
  <span class="main">=</span> Hermite_reduce_above_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>nrows <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> n_tna<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> to_nat <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems Suc_lessD nrows_def to_nat_from_nat_id<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_reduce_above.simps
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_reduce_above_iarrays.simps
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def sub_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_tna 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_row_add<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> from_nat_to_nat_id 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth
    <span class="keyword1"><span class="command">unfolding</span></span> n_tna<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def n<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_IArrays-matrix_to_iarray_Hermite_of_row_i"><span class="command">lemma</span></span> matrix_to_iarray_Hermite_of_row_i<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="free">A</span> <span class="free">i</span><span class="main">)</span> 
  <span class="main">=</span> Hermite_of_row_i_iarray <span class="free">ass</span> <span class="free">res</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> zero_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> to_nat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_iarray_eq_iff is_zero_row_eq_row_zero vec_to_iarray_row'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def Hermite_of_row_i_iarray_def Let_def zero_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> Ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"least_non_zero_position_of_vector <span class="main">(</span>matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> to_nat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> least_rw<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> least_mod_type Ain Least_le<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> v_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span>to_nat <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'cols</span><span class="main">)</span><span class="main">,</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> False least_mod_type
        <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">$</span><span class="free">i</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> is_zero_row_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index<span class="main">[</span><span class="operator">OF</span> v_rw<span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> least_rw least_non_zero_position_of_vector_def to_nat_0 vec_matrix <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_row_i_def Hermite_of_row_i_iarray_def Let_def
      <span class="keyword1"><span class="command">unfolding</span></span> zero_rw<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mult_row<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> l
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> matrix_to_iarray_Hermite_reduce_above<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def to_nat_less_card<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Hermite_IArrays-matrix_to_iarray_Hermite_of_upt_row_i"><span class="command">lemma</span></span> matrix_to_iarray_Hermite_of_upt_row_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>unique_euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Hermite_of_upt_row_i <span class="free">A</span> <span class="free">i</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> 
  <span class="main">=</span> Hermite_of_upt_row_i_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hermite_of_upt_row_i_def Hermite_of_upt_row_i_iarrays_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>nrows <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> 
    <span class="main">=</span> matrix_to_iarray <span class="main">(</span>Hermite_of_row_i <span class="free">ass</span> <span class="free">res</span> <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">i</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i_iarray <span class="free">ass</span> <span class="free">res</span> 
    <span class="main">(</span>matrix_to_iarray <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">i</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="main">(</span>from_nat <span class="skolem">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_Hermite_of_row_i <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i_iarray <span class="free">ass</span> <span class="free">res</span> <span class="main">(</span>matrix_to_iarray <span class="main">(</span>Hermite_of_upt_row_i <span class="skolem">A</span> <span class="skolem">i</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Hermite_of_row_i_iarray <span class="free">ass</span> <span class="free">res</span> 
    <span class="main">(</span>Hermite_of_upt_row_i_iarrays <span class="main">(</span>matrix_to_iarray <span class="skolem">A</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">ass</span> <span class="free">res</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps i <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  Hermite_of_upt_row_i_iarrays <span class="main">(</span>matrix_to_iarray <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_upt_row_i_iarrays_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_IArrays-matrix_to_iarray_Hermite_of"><span class="command">lemma</span></span> matrix_to_iarray_Hermite_of<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>Hermite_of <span class="free">A</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span><span class="main">)</span> 
  <span class="main">=</span> Hermite_of_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">ass</span> <span class="free">res</span> <span class="free">bezout</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">≤</span> nrows <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hermite_of_def Hermite_of_iarrays_def Let_def
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_Hermite_of_upt_row_i<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_echelon_form_of
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Examples of execution using immutable arrays›</span></span>

<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="numeral">37</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">6</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="main">-</span><span class="numeral">7</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>
  <span class="keyword1">in</span> matrix_to_iarray <span class="main">(</span>Hermite_of <span class="bound">A</span> ass_function_euclidean res_function_euclidean euclid_ext2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> IArray<span class="main">[</span>IArray<span class="main">[</span><span class="numeral">37</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">6</span><span class="main">::</span>int<span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span>IArray<span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="main">-</span><span class="numeral">7</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1">in</span> <span class="main">(</span>Hermite_of_iarrays <span class="bound">A</span> ass_function_euclidean res_function_euclidean euclid_ext2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">(</span><span class="main">[</span><span class="main">[</span><span class="main">[:</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">:]</span><span class="main">,</span><span class="main">[:</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">:]</span><span class="main">,</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">::</span>real poly<span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span>
  <span class="keyword1">in</span> matrix_to_iarray <span class="main">(</span>Hermite_of <span class="bound">A</span> ass_function_euclidean res_function_euclidean euclid_ext2<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>