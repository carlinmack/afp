<div id="Dirichlet_Misc">
<div class="head">
<h1>Theory Dirichlet_Misc</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Dirichlet_Misc.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous auxiliary facts›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_Misc
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../../HOL/HOL/Main.html">Main</a> 
    <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> geometric_sum_nat_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> geometric_sum_nat_dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> geometric_sum_nat<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> real <span class="free">a</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> real <span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> geometric_sum<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> real <span class="free">a</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> real <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_diff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_nat_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> * <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> * <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dvd_div_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Set_filter_insert<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Set.filter <span class="free">P</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="free">x</span> <span class="keyword1">then</span> insert <span class="free">x</span> <span class="main">(</span>Set.filter <span class="free">P</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> Set.filter <span class="free">P</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> Set_filter_union<span class="main">:</span> <span class="quoted"><span class="quoted">"Set.filter <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Set.filter <span class="free">P</span> <span class="free">A</span> <span class="main">∪</span> Set.filter <span class="free">P</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Set_filter_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Set.filter <span class="free">P</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> Set_filter_image<span class="main">:</span> <span class="quoted"><span class="quoted">"Set.filter <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> Set.filter <span class="main">(</span><span class="free">P</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Set_filter_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟷</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">⟹</span>  Set.filter <span class="free">P</span> <span class="free">A</span> <span class="main">=</span> Set.filter <span class="free">Q</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> finite_Set_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> finite <span class="main">(</span>Set.filter <span class="free">P</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_insert'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⟹</span> inj_on <span class="main">(</span>insert <span class="free">x</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def insert_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   card_even_subset_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> even <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   card_odd_subset_aux<span class="main">:</span>  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> odd <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   card_even_odd_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> even <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> odd <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> card <span class="main">(</span>Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_ne_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>singleton <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pow <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{}</span><span class="main">,</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set_filter_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> fin <span class="main">=</span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pow <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> Pow <span class="skolem">A</span> <span class="main">∪</span> insert <span class="skolem">x</span> <span class="main">`</span> Pow <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Pow_insert<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span> <span class="main">∪</span> 
            insert <span class="skolem">x</span> <span class="main">`</span> Set.filter <span class="main">(</span>even <span class="main">∘</span> card <span class="main">∘</span> insert <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Pow_insert Set_filter_union Set_filter_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span>even <span class="main">∘</span> card <span class="main">∘</span> insert <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> Set.filter <span class="main">(</span>odd <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> o_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Set_filter_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> card_insert_disjoint<span class="main">)</span> 
         <span class="main">(</span><span class="operator">insert</span> insert.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span> <span class="main">∪</span> insert <span class="skolem">x</span> <span class="main">`</span> <span class="main">…</span><span class="main">)</span> <span class="main">=</span> 
                 card <span class="main">(</span>Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">`</span> <span class="main">…</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_Un_disjoint finite_Set_filter finite_imageI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  insert.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> card <span class="main">(</span>Set.filter <span class="main">(</span>odd <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_image inj_on_insert'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span>odd <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> Pow <span class="skolem">A</span> <span class="main">-</span> Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span> <span class="main">-</span> card <span class="main">(</span>Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Diff_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_Set_filter<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>Pow <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_diff_inverse_nat<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> not_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> card_mono<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> insert.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Pow<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> even <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span>odd <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Pow <span class="free">A</span> <span class="main">-</span> Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> card <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">A</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> card <span class="main">(</span>Set.filter <span class="main">(</span>even <span class="main">∘</span> card<span class="main">)</span> <span class="main">(</span>Pow <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Diff_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_Set_filter <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Pow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> *
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">A</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> card <span class="free">A</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> odd <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> even <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> odd <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> bij_betw_prod_divisors_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="main">(</span><span class="free">b</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">*</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">*</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def coprime_crossproduct_nat coprime_divisors<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">*</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> division_decomp<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> b' c' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">*</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_dvd_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_prime_power_divisors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="free">p</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">(^)</span> <span class="free">p</span><span class="main">)</span> <span class="main">{..</span><span class="free">k</span><span class="main">}</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">(^)</span> <span class="free">p</span><span class="main">)</span> <span class="main">{..</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def prime_gt_Suc_0_nat power_inject_exp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(^)</span> <span class="free">p</span> <span class="main">`</span> <span class="main">{..</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_imp_power_dvd divides_primepow_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> power_diff'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> unique_euclidean_semiring<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="free">m</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">div</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> sum_divisors_coprime_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="main">(</span><span class="free">b</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span><span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">z</span> <span class="main">*</span> snd <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.cartesian_product<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_betw bij_betw_prod_divisors_coprime assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Multiplicative_Function">
<div class="head">
<h1>Theory Multiplicative_Function</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Multiplicative_Function.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Multiplicative arithmetic functions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Multiplicative_Function
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span> 
    <a href="Dirichlet_Misc.html">Dirichlet_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">locale</span></span> multiplicative_function <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_coprime_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> coprime <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> one<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> mult_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> P <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> P<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> P<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_coprime_aux assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prod_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> coprime <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>prod <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>prod <span class="free">g</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span> <span class="main">*</span> prod <span class="free">g</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>prod <span class="free">g</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_coprime prod_coprime_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prod_prime_factors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Primes.prime_factorization_nat assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_coprime<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_prime_factors_imp_prime primes_coprime<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_sum_divisors<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_divisors_coprime_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_coprime coprime_imp_coprime dvd_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum_distrib_left<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> multiplicative_function' <span class="main">=</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f_prime_power</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f_prime</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prime_power<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f_prime_power</span> <span class="free">p</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prime_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> <span class="free">f_prime_power</span> <span class="free">p</span> <span class="main">1</span> <span class="main">=</span> <span class="free">f_prime</span> <span class="free">p</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">f_prime</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> prime_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> prod_prime_factors'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">p</span> <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_prime_factors<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">intro</span> prod.cong refl prime_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> efficient_code_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">←</span> <span class="free">ps</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">p</span> <span class="main">(</span>Suc <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">←</span> <span class="free">ps</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">p</span> <span class="main">(</span>Suc <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">p</span> <span class="main">(</span>Suc <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distinct_set_conv_list <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">x</span> <span class="main">(</span>multiplicity <span class="bound">x</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def prime_factors_multiplicity <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_prime_factors' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> efficient_code<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ps</span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">ps</span> <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">←</span> <span class="free">ps</span> <span class="main">()</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">p</span> <span class="main">(</span>Suc <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> efficient_code_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">()</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> completely_multiplicative_function <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_aux<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> P <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> P<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> P<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_aux one_aux mult_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> multiplicative_function <span class="quoted"><span class="free">f</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_aux one_aux mult<span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>prod <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prod_prime_factors'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_nat<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod power<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> completely_multiplicative_function' <span class="main">=</span>
  completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f_prime</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">f_prime</span> <span class="free">p</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prod_prime_factors''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f_prime</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_prime_factors'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_prime prime_factors_multiplicity <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.cong<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> efficient_code_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">←</span> <span class="free">ps</span><span class="main">.</span> <span class="free">f_prime</span> <span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">←</span> <span class="free">ps</span><span class="main">.</span> <span class="free">f_prime</span> <span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f_prime</span> <span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distinct_set_conv_list <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="free">f_prime</span> <span class="bound">x</span> <span class="main">^</span> multiplicity <span class="bound">x</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def prime_factors_multiplicity 
                                  <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_prime_factors'' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> efficient_code<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ps</span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">ps</span> <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">←</span> <span class="free">ps</span> <span class="main">()</span><span class="main">.</span> <span class="free">f_prime</span> <span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> efficient_code_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">()</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> f.prod_prime_factors<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> g.prod_prime_factors<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.cong assms <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_of_natI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span> <span class="main">⟹</span> multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> multiplicative_function_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_of_natD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ring_char_0<span class="main">,</span> comm_semiring_1<span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> 
     multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> multiplicative_function_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_eq_1_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>  <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">*</span> <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f.mult_coprime g.mult_coprime mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f.mult_coprime <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>  <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicative_function_mult multiplicative_function_inverse assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_function_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> completely_multiplicative_function <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">*</span> <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f.mult g.mult mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_function_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f.mult <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_function_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>  <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> completely_multiplicative_function_mult 
              completely_multiplicative_function_inverse assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> multiplicative_function<span class="main">)</span> completely_multiplicativeI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> prime_factors <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_prime_factors<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms prime_factors_multiplicity P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> mn <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> P_def prime_factors_multiplicity power_add›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.mono_neutral_right dvd_prime_factors finite_set_mset<span class="main">)</span>
                       <span class="main">(</span><span class="operator">use</span> mn <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> prime_factors_multiplicity›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">m</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_prime_factors <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.mono_neutral_right dvd_prime_factors finite_set_mset<span class="main">)</span>
                       <span class="main">(</span><span class="operator">use</span> mn <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> prime_factors_multiplicity›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_prime_factors <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Indicator function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> semiring_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ind</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> ind_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ind <span class="free">P</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ind_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> ind <span class="free">P</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ind_True <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> ind <span class="free">P</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_nonzero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ind_False <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">P</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> ind <span class="free">P</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_nonzero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ind_eq_1_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"ind <span class="free">P</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ind_eq_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"ind <span class="free">P</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">P</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_ind <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> coprime <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>ind <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_nonzero<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dirichlet_Product">
<div class="head">
<h1>Theory Dirichlet_Product</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Dirichlet_Product.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Dirichlet convolution›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_Product
  <span class="keyword2"><span class="keyword">imports</span></span>
     <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
     <a href="Multiplicative_Function.html">Multiplicative_Function</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_coprime_dvd_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">.</span> <span class="free">g</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> coprime <span class="bound">r</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">r</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">r</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="free">b</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coprime_imp_coprime dvd_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dirichlet_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> semiring_0<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dirichlet_prod</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">d</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_divisors_code<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> 
             fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">d</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="bound">acc</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span> <span class="main">=</span>
           fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">d</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">d</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_atLeastAtMost_code <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
     fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_divisors_code<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">f'</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">g'</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> dirichlet_prod <span class="free">f'</span> <span class="free">g'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="free">f'</span> <span class="free">g'</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_altdef1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">(div)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">(div)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_altdef2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span><span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span><span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> UNIV <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> UNIV<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_image_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.Sigma<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_commutes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span><span class="free">f</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_0<span class="main">)</span> <span class="free">g</span> <span class="main">=</span> dirichlet_prod <span class="free">g</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="free">g</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span><span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">d</span></span><span class="main">,</span><span class="bound"><span class="bound">r</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef2 mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_divisors_nat'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">&lt;..</span></span></span><span class="free"><span class="free"><span class="free">n</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span> <span class="main"><span class="main"><span class="main">×</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">&lt;..</span></span></span><span class="free"><span class="free"><span class="free">n</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_assoc_aux1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_prod <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">b</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_prod <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">c</span></span><span class="main">,</span><span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> snd <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef2 sum_distrib_left mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> snd <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                               <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.Sigma finite_divisors_nat' ballI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">a</span></span><span class="main">,</span><span class="bound"><span class="bound">b</span></span><span class="main">,</span><span class="bound"><span class="bound">c</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">b</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness
               <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">*</span></span></span><span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_assoc_aux2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="free">n</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">b</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="free">n</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">c</span></span><span class="main">,</span><span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> fst <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef2 sum_distrib_right mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> fst <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                               <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">f</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.Sigma finite_divisors_nat' ballI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">a</span></span><span class="main">,</span><span class="bound"><span class="bound">b</span></span><span class="main">,</span><span class="bound"><span class="bound">c</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">b</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness
               <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">*</span></span></span><span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">c</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_assoc<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_prod <span class="free">g</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_prod <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_assoc_aux1 dirichlet_prod_assoc_aux2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_const_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="free">n</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.delta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_const_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="main">*</span> <span class="free">g</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.delta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">dirichlet_inverse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dirichlet_inverse</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>
      <span class="keyword1">else</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">dirichlet_inverse</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_induct <span class="main">[</span><span class="operator">case_names</span> 0 1 gt1<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction_schema</span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf_measure <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">declare</span></span> dirichlet_inverse.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_gt_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span>
     <span class="main">-</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">f'</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">i'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i'</span> <span class="free">n'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_induct<span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>gt1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="skolem">k</span> <span class="main">=</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gt1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> gt1.prems<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_gt_1 * <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_gt_1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> 
             <span class="main">-</span><span class="free">i</span> <span class="main">*</span> dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> 
                          dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_gt_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> of_int_dirichlet_prod<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> of_int_dirichlet_inverse<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int <span class="free">i</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>gt1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> gt1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">-</span> <span class="main">(</span>of_int <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">_</span> <span class="main">*</span> <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_gt_1 of_int_dirichlet_prod<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
                  dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int <span class="free">i</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gt1<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>of_int <span class="free">i</span> <span class="main">*</span> <span class="main">…</span><span class="main">)</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int <span class="free">i</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> gt1.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_gt_1<span class="main">)</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
   
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">i</span> <span class="keyword1">else</span>
     <span class="main">-</span><span class="free">i</span> <span class="main">*</span> fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> 
     dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="bound">acc</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> 
            dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">d</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum_atLeastAtMost_code <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">i</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_gt_1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">*</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">d</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">dvd</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">n</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">d</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="free">f</span> <span class="main">1</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="skolem">n</span> <span class="main">+</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fin n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="skolem">n</span> <span class="main">=</span> 
      <span class="main">-</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_inverse_gt_1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">i</span> <span class="main">*</span> 
                   <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">1</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> 
                   <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">*</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
               
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_inverse'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">*</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dirichlet_prod_inverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_commutes<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_noninvertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dirichlet_inverse.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dirichlet_inverse.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_dirichlet_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def sum_divisors_coprime_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">s</span></span> <span class="main">|</span> <span class="bound">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_coprime_dvd_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">r</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">r</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f.mult_coprime<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>›</span></span> dvd_div_iff_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> dvd_div_iff_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> coprime_imp_coprime dvd_mult_left<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> g.mult_coprime<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">r</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">s</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_div_if_dvd <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_product mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> multiplicative_dirichlet_prodD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1_cancel"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> fg<span class="main">:</span> multiplicative_function <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fg.Suc_0<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_prod_Suc_0<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">1</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span> <span class="main">=</span> 
                   <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less.prems
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_divisors_nat'<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                     <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_divisors_nat'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span>
                          <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_divisors_coprime_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span>
                          <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">.</span>
                          <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_coprime_dvd_cong<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ccontr<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">r</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">r</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f.mult_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="skolem">r</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">s</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>›</span></span> less.prems
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>›</span></span> less.prems
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le mult_dvd_mono Nat.gr0I<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>›</span></span> less.prems
          <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less coprime_divisors <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less f g <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">}</span><span class="main">.</span> 
                        <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.cartesian_product<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r1</span><span class="main">,</span><span class="bound">r2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r1</span><span class="main">.</span> <span class="bound">r1</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">r2</span><span class="main">.</span> <span class="bound">r2</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span>
                         <span class="main">(</span><span class="free">f</span> <span class="bound">r1</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">r2</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="bound">r1</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="bound">r2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="bound">r1</span><span class="main">.</span> <span class="bound">r1</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">r2</span><span class="main">.</span> <span class="bound">r2</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less.prems
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.remove <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.cartesian_product sum_product dirichlet_prod_def mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">*</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">b</span> <span class="main">=</span>
                   dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fg.mult_coprime add_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_dirichlet_prodD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1_cancel"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_prod <span class="free">g</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> multiplicative_dirichlet_prodD1<span class="main">[</span><span class="operator">OF</span> this assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_dirichlet_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_dirichlet_prodD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="main">(</span>dirichlet_inverse <span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_prod_inverse<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_prime_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> bij_betw_prime_power_divisors<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_diff'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="free">p</span>  <span class="main">=</span> <span class="free">f</span> <span class="main">1</span> <span class="main">*</span> <span class="free">g</span> <span class="free">p</span> <span class="main">+</span> <span class="free">f</span> <span class="free">p</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dirichlet_prod_prime_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">locale</span></span> multiplicative_dirichlet_prod <span class="main">=</span> 
  f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="main">+</span> g<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">g</span></span> 
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> multiplicative_function <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicative_dirichlet_prod 
        f.multiplicative_function_axioms g.multiplicative_function_axioms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">locale</span></span> multiplicative_dirichlet_prod' <span class="main">=</span> 
  f<span class="main">:</span> multiplicative_function' <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">f_prime_power</span></span> <span class="quoted"><span class="free">f_prime</span></span> <span class="main">+</span> 
  g<span class="main">:</span> multiplicative_function' <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">g_prime_power</span></span> <span class="quoted"><span class="free">g_prime</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f_prime_power</span> <span class="free">g_prime_power</span> <span class="free">f_prime</span> <span class="free">g_prime</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">sublocale</span></span> multiplicative_dirichlet_prod <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> multiplicative_function' <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">p</span> <span class="bound">k</span> <span class="main">+</span> <span class="free">g_prime_power</span> <span class="bound">p</span> <span class="bound">k</span> <span class="main">+</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="bound">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">g_prime_power</span> <span class="bound">p</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">f_prime</span> <span class="bound">p</span> <span class="main">+</span> <span class="free">g_prime</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod_prime_power<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">(</span>insert <span class="skolem">k</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="free">f_prime_power</span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">+</span> <span class="free">g_prime_power</span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">+</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f.prime_power g.prime_power add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="free">f_prime_power</span> <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">g_prime_power</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f.prime_power g.prime_power<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>Suc <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f.prime_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> g.prime_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f.prime g.prime add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dirichlet_Series">
<div class="head">
<h1>Theory Dirichlet_Series</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Dirichlet_Series.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formal Dirichlet series›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_Series
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Dirichlet_Product.html">Dirichlet_Product</a>
  <a href="Multiplicative_Function.html">Multiplicative_Function</a>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A formal Dirichlet series
    \[A(s) = \sum_{n=1}^\infty \frac{a_n}{n^s}\]
  is represented its coefficient sequence starting from 1. For simplicity, we represent this
  in Isabelle with a function of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"nat <span class="main"><span class="main">⇒</span></span> <span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> whose value for $n$ is the $n+1$-th 
  coefficient.
›</span></span>  
<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'a</span> fds <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_fds

<span class="keyword1"><span class="command">lift_definition</span></span> fds_nth <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">.</span> case_nat <span class="main">0</span> <span class="bound">f</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
<span class="keyword1"><span class="command">lift_definition</span></span> fds <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∘</span> Suc"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_fds<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_fds'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> fds_nth <span class="main">(</span>fds <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff fds_nth_fds<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_fds_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_nth <span class="main">(</span>fds <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_fds_nth <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_eq_fds_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds <span class="free">f</span> <span class="main">=</span> fds <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc <span class="main">=</span> <span class="skolem">g</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc <span class="main">=</span> <span class="skolem">g</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_eq_fds_iff'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span> <span class="main">⟹</span> fds <span class="free">f</span> <span class="main">=</span> fds <span class="free">g</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds <span class="free">f</span> <span class="main">=</span> fds <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_fds_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_eqI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds <span class="main">(</span>fds_nth <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_eq_fds_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> zero<span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> fds <span class="free">f</span> <span class="main">=</span> fds <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_fds_nth_fds_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span>fds_nth <span class="main">(</span>fds <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_fds_nth_fds_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span>fds_nth <span class="main">(</span>fds <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_const</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_const</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fds_ind</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fds_ind</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> fds <span class="main">(</span>ind <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">bundle</span></span> fds_syntax
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">notation</span></span> fds_nth <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">$</span>"</span> 75<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> fds <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">χ</span>"</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dirichlet_prod <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">zero_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_fds</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>zero<span class="main">,</span>one<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_fds</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>plus<span class="main">,</span>zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">plus_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_fds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">+</span> fds_nth <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring_0</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">times_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_fds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> fds <span class="main">(</span>dirichlet_prod <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>uminus<span class="main">,</span>zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">uminus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">uminus_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_fds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>minus<span class="main">,</span>zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">minus_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">minus_fds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">-</span> fds_nth <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹General properties›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_fds_def fds_nth_fds fun_eq_iff<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_one<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_fds_def fds_nth_fds fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_one_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">1</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_one<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_one_not_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟹</span> fds_nth <span class="main">1</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_one<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">+</span> fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> monoid_add<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fds_def fds_nth_fds fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>cancel_comm_monoid_add<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_fds_def fds_nth_fds fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="main">-</span><span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> group_add<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_fds_def fds_nth_fds fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_fds_def fds_nth_fds dirichlet_prod_def fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_mult_const_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult fds_const_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_mult_const_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> fds_const <span class="free">c</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="free">n</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult fds_const_def<span class="main">)</span>


<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>semigroup_add<span class="main">,</span> zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> plus_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>ab_semigroup_add<span class="main">,</span> zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">ab_semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> plus_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>cancel_semigroup_add<span class="main">,</span> zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">cancel_semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> plus_fds_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>cancel_ab_semigroup_add<span class="main">,</span> zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">cancel_ab_semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> plus_fds_def minus_fds_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">)</span> <span class="quoted">monoid_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_monoid_add</span><span class="main">)</span> <span class="quoted">comm_monoid_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">cancel_comm_monoid_add</span><span class="main">)</span> <span class="quoted">cancel_comm_monoid_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">group_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> minus_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_group_add</span><span class="main">)</span> <span class="quoted">ab_group_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring_0</span><span class="main">)</span> <span class="quoted">semiring_0</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult dirichlet_prod_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult dirichlet_prod_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib<span class="main">)</span>
  
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_semiring_0</span><span class="main">)</span> <span class="quoted">comm_semiring_0</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult dirichlet_prod_commutes<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult dirichlet_prod_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring_0_cancel</span><span class="main">)</span> <span class="quoted">semiring_0_cancel</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_one fds_nth_mult<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_semiring_0_cancel</span><span class="main">)</span> <span class="quoted">comm_semiring_0_cancel</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring_1</span><span class="main">)</span> <span class="quoted">semiring_1</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_one fds_nth_mult<span class="main">)</span>
    
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_semiring_1</span><span class="main">)</span> <span class="quoted">comm_semiring_1</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_one fds_nth_mult<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring_1_cancel</span><span class="main">)</span> <span class="quoted">semiring_1_cancel</span> <span class="keyword1"><span class="command">..</span></span> 
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">ring</span><span class="main">)</span> <span class="quoted">ring</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">ring_1</span><span class="main">)</span> <span class="quoted">ring_1</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_ring</span><span class="main">)</span> <span class="quoted">comm_ring</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring_no_zero_divisors</span><span class="main">)</span> <span class="quoted">semiring_no_zero_divisors</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> fds_nth <span class="skolem">f</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> fds_nth <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> fds_nth <span class="skolem">f</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> fds_nth <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ex<span class="main">[</span><span class="operator">THEN</span> LeastI_ex<span class="main">,</span> <span class="operator">folded</span> m_def n_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">f</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">m'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">f</span> <span class="skolem">m'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m'</span> 
    <span class="keyword1"><span class="command">using</span></span> conjI<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">f</span> <span class="skolem">m'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m'</span> <span class="keyword1"><span class="command">using</span></span> that *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">g</span> <span class="skolem">n'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n'</span> 
    <span class="keyword1"><span class="command">using</span></span> conjI<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">g</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n'</span> <span class="keyword1"><span class="command">using</span></span> that *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">.</span> fds_nth <span class="skolem">f</span> <span class="bound">d</span> <span class="main">*</span> fds_nth <span class="skolem">g</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">then</span> fds_nth <span class="skolem">f</span> <span class="skolem">m</span> <span class="main">*</span> fds_nth <span class="skolem">g</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">d</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> mn<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m' n' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> mn<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> False mn<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> k
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult_less_cancel1<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> mn<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k m' n' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="skolem">f</span> <span class="skolem">m</span> <span class="main">*</span> fds_nth <span class="skolem">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.delta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: instance fds :: (semiring_no_zero_divisors_cancel) semiring_no_zero_divisors_cancel
   Maybe using Bell series and cancellation on FPSs *)</span> 

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">ring_no_zero_divisors</span><span class="main">)</span> <span class="quoted">ring_no_zero_divisors</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">idom</span><span class="main">)</span> <span class="quoted">idom</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">real_vector</span><span class="main">)</span> <span class="quoted">real_vector</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">scaleR_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scaleR_fds</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_scaleR <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_fds_def fun_eq_iff fds_nth_fds<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">real_algebra</span><span class="main">)</span> <span class="quoted">real_algebra</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> fds_nth_mult
                             dirichlet_prod_def scaleR_sum_right<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted">real_algebra_1</span><span class="main">)</span> <span class="quoted">real_algebra_1</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_fds <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_const<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_const_def fds_nth_fds fun_eq_iff<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_const_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_const<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_const_not_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> fds_nth <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_const_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_const <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_const_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_const <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_const fds_nth_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_const_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> monoid_add<span class="main">)</span> <span class="main">=</span> fds_const <span class="free">a</span> <span class="main">+</span> fds_const <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_const<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_const_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> cancel_comm_monoid_add<span class="main">)</span> <span class="main">=</span> fds_const <span class="free">a</span> <span class="main">-</span> fds_const <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_const<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_const_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span><span class="main">-</span> <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ab_group_add<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> fds_const <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_const<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_const_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> semiring_0<span class="main">)</span> <span class="main">=</span> fds_const <span class="free">a</span> <span class="main">*</span> fds_const <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_const fds_nth_mult<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_const_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span>of_nat <span class="free">c</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_const_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span>of_int <span class="free">c</span><span class="main">)</span> <span class="main">=</span> of_int <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_const_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span>of_real <span class="free">c</span><span class="main">)</span> <span class="main">=</span> of_real <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def fds_eq_iff fds_const_def fds_nth_one<span class="main">)</span>


<span class="keyword1"><span class="command">instantiation</span></span> fds <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>inverse<span class="main">,</span> comm_ring_1<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inverse_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inverse_fds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> dirichlet_inverse <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>inverse <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_fds</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divide_fds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> numeral_fds<span class="main">:</span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span> <span class="main">=</span> fds_const <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_const <span class="main">(</span>of_nat <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_const_of_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>numeral <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ind_False <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_ind <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_commutes<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_nth <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> fds_nth_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> dirichlet_prod_def<span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">subst</span> dirichlet_prod_altdef1<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> sum.cong refl assms<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_mult_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> fds_nth <span class="free">g</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_inverse<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">(</span>inverse <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_fds_def fds_nth_fds fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_fds_nonunit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span> <span class="main">⟹</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_inverse dirichlet_inverse_noninvertible<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_0_fds <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_fds_def fds_eq_iff dirichlet_inverse.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_left_inverse<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span> <span class="main">⟹</span> inverse <span class="free">f</span> <span class="main">*</span> <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult fds_nth_inverse dirichlet_prod_inverse' fds_nth_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_right_inverse<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult fds_nth_inverse dirichlet_prod_inverse fds_nth_one<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_left_inverse_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> inverse <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> assms<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">g</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">-</span> inverse <span class="free">g</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> ring_distribs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_left_inverse<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> inverse <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_right_inverse_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> inverse <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_left_inverse_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_1_fds <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_left_inverse_unique <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_const_fds <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_right_inverse_unique<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fds_const_mult <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_const_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_mult_fds<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span> <span class="main">=</span> inverse <span class="free">f</span> <span class="main">*</span> inverse <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="main">*</span> inverse <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> fds_right_inverse<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_right_inverse_unique <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_fds_nonunit<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_zeta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> one fds"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fds_zeta</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_zeta_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_zeta_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth fds_zeta <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_zeta_def fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_zeta_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_nth fds_zeta <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_zeta<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> fds_zeta_commutes<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> semiring_1 fds<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> fds_zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_commutes<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ind_True <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_ind <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> fds_zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_extensional_prod_nat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">d</span></span> <span class="main">∈</span> extensional <span class="free">A</span><span class="main">.</span> prod <span class="bound">d</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>PiE <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">{..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_PiE<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"prod <span class="skolem">d</span> <span class="free">A</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> prod_dvd_prod_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">d</span></span> <span class="main">∈</span> extensional <span class="free">A</span><span class="main">.</span> prod <span class="bound">d</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extensional_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The $n$-th coefficient of a product of Dirichlet series can be determined by 
  summing over all products of $k_i$-th coefficients of the series such that the 
  product of the $k_i$ is $n$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="main">∈</span> extensional <span class="free">A</span> <span class="main">∧</span> prod <span class="bound">d</span> <span class="free">A</span> <span class="main">=</span> <span class="free">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_ne_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>singleton <span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">d</span></span> <span class="main">∈</span> extensional <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">d</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="skolem">n</span> <span class="keyword1">else</span> undefined<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extensional_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">d</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">d</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">d</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> fst <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">z</span></span> <span class="main">|</span> fst <span class="bound">z</span> <span class="main">*</span> snd <span class="bound">z</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="main">∈</span> extensional <span class="skolem">A</span> <span class="main">∧</span> prod <span class="bound">d</span> <span class="skolem">A</span> <span class="main">=</span> snd <span class="bound">z</span><span class="main">.</span> 
              fds_nth <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef2 sum_distrib_left case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> fst <span class="bound">z</span> <span class="main">*</span> snd <span class="bound">z</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">d</span></span> <span class="main">∈</span> extensional <span class="skolem">A</span><span class="main">.</span> prod <span class="bound">d</span> <span class="skolem">A</span> <span class="main">=</span> snd <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                      fds_nth <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_divisors_nat'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> insert.hyps <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.Sigma finite_extensional_prod_nat ballI<span class="main">)</span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="main">∈</span> extensional <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> prod <span class="bound">d</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?g</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extensional_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps insert.prems 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extensional_def sum.delta <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span>  <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> insert.hyps insert.prems 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">xa</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> fst <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">else</span> snd <span class="skolem">z</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">z</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 5 insert.hyps insert.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_power_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_prod_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_power_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_fds_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">^</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span>fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_Suc2<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Shifting the argument›</span></span>

<span class="keyword1"><span class="command">class</span></span> nat_power <span class="main">=</span> semiring_1 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">nat_power</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">nat_power</span> <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">nat_power</span> <span class="free">n</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_1_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">nat_power</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_1_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nat_power</span> <span class="free">n</span> <span class="main">1</span> <span class="main">=</span> of_nat <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_add<span class="main">:</span>            <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">nat_power</span> <span class="free">n</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">nat_power</span> <span class="free">n</span> <span class="free">a</span> <span class="main">*</span> <span class="free">nat_power</span> <span class="free">n</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_mult_distrib<span class="main">:</span>   
    <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">nat_power</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="free">nat_power</span> <span class="free">m</span> <span class="free">a</span> <span class="main">*</span> <span class="free">nat_power</span> <span class="free">n</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_power<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">nat_power</span> <span class="free">n</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> of_nat <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">nat_power</span> <span class="free">n</span> <span class="free">a</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nat_power_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> nat_power <span class="free">m</span> <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="free">m</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nat_power_power_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> nat_power <span class="main">(</span><span class="free">m</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> nat_power <span class="free">m</span> <span class="free">n</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_mult_distrib<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> nat_power_field <span class="main">=</span> nat_power <span class="main">+</span> field <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> nat_power <span class="free">n</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nat_power_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> nat_power <span class="free">n</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> nat_power <span class="free">n</span> <span class="free">a</span> <span class="main">/</span> nat_power <span class="free">n</span> <span class="free">b</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> nat_power_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> nat <span class="main">::</span> <span class="quoted">nat_power</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">nat_power_nat</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add power_mult_distrib power_mult<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> real <span class="main">::</span> <span class="quoted">nat_power_field</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">nat_power_real</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span>real <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nat_power <span class="skolem">n</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> nat_power <span class="skolem">n</span> <span class="skolem">a</span> <span class="main">^</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def exp_of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_add powr_mult<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following operation corresponds to shifting the argument of a Dirichlet series, i.\,e.\ 
  subtracting a constant from it. In effect, this turns the series
    \[A(s) = \sum_{n=1}^\infty \frac{a_n}{n^s}\]
  into the series
    \[A(s - c) = \sum_{n=1}^\infty \frac{n^c \cdot a_n}{n^s}\ .\]
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_shift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> nat_power <span class="main">⇒</span> <span class="tfree">'a</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_shift</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">*</span> nat_power <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="free">n</span> <span class="main">*</span> nat_power <span class="free">n</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_shift_def fds_nth_fds<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="main">(</span>fds_shift <span class="free">c'</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="main">(</span><span class="free">c'</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_add mult_ac<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">a</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_shift_def one_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">a</span> <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_shift_def fds_const_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>monoid_add<span class="main">,</span> nat_power<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">c</span> <span class="free">f</span> <span class="main">+</span> fds_shift <span class="free">c</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1_cancel<span class="main">,</span> nat_power<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">c</span> <span class="free">f</span> <span class="main">-</span> fds_shift <span class="free">c</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>    

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ring<span class="main">,</span> nat_power<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fds_shift <span class="free">c</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring<span class="main">,</span> nat_power<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">c</span> <span class="free">f</span> <span class="main">*</span> fds_shift <span class="free">c</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> fds_nth_mult dirichlet_prod_altdef2 
        sum_distrib_left sum_distrib_right nat_power_mult_distrib <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring<span class="main">,</span> nat_power<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">c</span> <span class="free">f</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_by_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="main">0</span> <span class="free">f</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_shift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_shift <span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span> nat_power<span class="main">}</span><span class="main">)</span> <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>fds_shift <span class="free">a</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">a</span> <span class="free">f</span> <span class="main">*</span> fds_shift <span class="free">a</span> <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">a</span> <span class="free">f</span> <span class="main">*</span> fds_shift <span class="free">a</span> <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_right_inverse_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_fds_nonunit<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_divide <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_shift <span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span> nat_power<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">/</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">a</span> <span class="free">f</span> <span class="main">/</span> fds_shift <span class="free">a</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">a</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_shift <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">a</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_shift <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Scaling the argument›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following operation corresponds to scaling the argument of a Dirichlet series with 
  a natural number, i.\,e.\ turning the series
    \[A(s) = \sum_{n=1}^\infty \frac{a_n}{n^s}\]
  into the series
    \[A(ks) = \sum_{n=1}^\infty \frac{a_n}{\left(n^k\right)^2}\ .\]
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_scale</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> zero<span class="main">)</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_scale</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
     fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> is_nth_power <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">n</span> <span class="keyword1">then</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>nth_root_nat <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_scale <span class="main">0</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_scale_def fds_eq_iff<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_scale <span class="main">1</span> <span class="free">f</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_scale_def fds_eq_iff<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_scale_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_scale_def fds_nth_fds<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_nth_scale_nonpower <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_nth_power <span class="free">c</span> <span class="free">n</span> <span class="main">⟹</span>  fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_scale_def fds_nth_fds<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_scale<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> is_nth_power <span class="free">c</span> <span class="free">n</span> <span class="keyword1">then</span> fds_nth <span class="free">f</span> <span class="main">(</span>nth_root_nat <span class="free">c</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_scale <span class="free">c</span> <span class="main">(</span>fds_const <span class="free">c'</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale fds_nth_const <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_scale <span class="free">c</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_scale<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_scale <span class="free">c</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_one <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_scale_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_scale <span class="free">c</span> <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_of_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_scale_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_scale <span class="free">c</span> <span class="main">(</span>of_int <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_int <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_of_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_scale_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_scale <span class="free">c</span> <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_scale_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fds_scale_of_nat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_scale<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_scale <span class="free">c</span> <span class="main">(</span>fds_scale <span class="free">c'</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_scale <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">c'</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> cc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_nth_power <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">c'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> cc' 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="main">(</span>fds_scale <span class="free">c'</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale is_nth_power_def power_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False cc' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">^</span> <span class="main">(</span><span class="free">c'</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_nth_powerE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> cc' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_scale <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">c'</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="main">(</span>fds_scale <span class="free">c'</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cc' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          
<span class="keyword1"><span class="command">lemma</span></span> fds_scale_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> monoid_add fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_scale <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_scale <span class="free">c</span> <span class="free">f</span> <span class="main">+</span> fds_scale <span class="free">c</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>cancel_comm_monoid_add<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_scale <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_scale <span class="free">c</span> <span class="free">f</span> <span class="main">-</span> fds_scale <span class="free">c</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> group_add fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_scale <span class="free">c</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fds_scale <span class="free">c</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_0 fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_scale <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_scale <span class="free">c</span> <span class="free">f</span> <span class="main">*</span> fds_scale <span class="free">c</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_nth_power <span class="free">c</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span> <span class="main">*</span> fds_scale <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="bound">r</span> <span class="main">*</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_nth_power_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">^</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> is_nth_powerE<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> map_prod <span class="main">(</span>nth_root_nat <span class="free">c</span><span class="main">)</span> <span class="main">(</span>nth_root_nat <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> map_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">rs</span></span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">¬</span>is_nth_power <span class="free">c</span> <span class="main">(</span>fst <span class="bound">rs</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span>is_nth_power <span class="free">c</span> <span class="main">(</span>snd <span class="bound">rs</span><span class="main">)</span><span class="main">}</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span> <span class="main">*</span> fds_scale <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="bound">r</span> <span class="main">*</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n'</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> fds_nth <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> sum.reindex_bij_witness_not_neutral<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">h</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def A_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_divisors_nat'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">rd</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">rd</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rd</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">rd</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def i_def h_def A_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">rd</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n'</span><span class="main">}</span> <span class="main">-</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rd</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">rd</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> that  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE 
            <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def i_def h_def A_def power_mult_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> power_eq_iff_eq_base<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span> <span class="skolem">rd</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">rd</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rd</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n'</span><span class="main">}</span> <span class="main">-</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">rd</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def i_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">rd</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rd</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n'</span><span class="main">}</span> <span class="main">-</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">rd</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_def S_def power_mult_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">rd</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="bound">r</span> <span class="main">*</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rd</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">rd</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def case_prod_unfold<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold i_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_scale_shift<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_shift <span class="free">d</span> <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_scale <span class="free">c</span> <span class="main">(</span>fds_shift <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale power_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ind_nth_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_ind <span class="main">(</span>is_nth_power <span class="free">k</span><span class="main">)</span> <span class="main">=</span> fds_scale <span class="free">k</span> fds_zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_def fds_nth_scale <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formal derivative›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The formal derivative of a series
    \[A(s) = \sum_{n=1}^\infty \frac{a_n}{n^s}\]
  can easily be seen to be
    \[A'(s) = -\sum_{n=1}^\infty \frac{\ln n\cdot a_n}{n^s}\ .\]
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_deriv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> real_algebra fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_deriv</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">-</span>ln <span class="main">(</span>real <span class="free">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> fds_nth <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv fds_nth_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv fds_nth_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_of_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_deriv_const<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>of_int <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_of_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_deriv_const<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>of_real <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_deriv_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fds_deriv <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="free">f</span> <span class="main">+</span> fds_deriv <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="free">f</span> <span class="main">-</span> fds_deriv <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> fds_deriv <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv fds_nth_mult dirichlet_prod_altdef2 scaleR_right.sum 
        <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ln_mult <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_algebra<span class="main">,</span> field<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">=</span> fds_deriv <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">=</span> inverse <span class="free">f</span> <span class="main">*</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_left_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">…</span> <span class="main">=</span> fds_deriv <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">+</span> inverse <span class="free">f</span> <span class="main">*</span> fds_deriv <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> fds_deriv <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span><span class="main">)</span> <span class="main">+</span> 
                                inverse <span class="free">f</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> fds_deriv <span class="free">f</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square divide_fds_def inverse_mult_fds add_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">c</span> <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_scale<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">c</span> <span class="main">*</span> fds_scale <span class="free">c</span> <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_deriv fds_nth_scale is_nth_powerE fds_const_of_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
                ln_realpow * <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fds_const_of_nat <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_eq_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="free">f</span> <span class="main">=</span> fds_deriv <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">-</span>fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>fds_nth <span class="main">(</span>fds_deriv <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_fds_deriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> fds <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="main">-</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> fds <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
          <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> mangoldt <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult fds_nth_deriv dirichlet_prod_altdef2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> mangoldt <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> mangoldt <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right refl<span class="main">)</span> 
               <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mangoldt_def mult mult_ac <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_divisors_nat' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> mangoldt <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">r</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">r</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="bound"><span class="bound"><span class="bound">r</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">fst</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> mangoldt <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S</span> <span class="main">*</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> mangoldt <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mangoldt_sum<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_deriv <span class="main">(</span>fds <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_fds_deriv'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span>
     fds_deriv <span class="free">f</span> <span class="main">=</span> <span class="main">-</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> completely_multiplicative_fds_deriv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_zeta<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_deriv fds_zeta <span class="main">=</span> 
     <span class="main">-</span>fds mangoldt <span class="main">*</span> <span class="main">(</span>fds_zeta <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>real_algebra_1<span class="main">}</span> fds<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> completely_multiplicative_fds_deriv <span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> fds_zeta_altdef<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_mangoldt_times_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"fds mangoldt <span class="main">*</span> fds_zeta <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_def mangoldt_sum<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_zeta'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv fds_zeta <span class="main">=</span> 
    <span class="main">-</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>real_algebra_1<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_zeta fds_mangoldt_times_zeta<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formal integral›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_integral</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> real_algebra fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_integral</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">else</span> <span class="main">-</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_integral_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_integral <span class="free">a</span> <span class="main">0</span> <span class="main">=</span> fds_const <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_integral_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_integral_add<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_integral <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_integral <span class="free">a</span> <span class="free">f</span> <span class="main">+</span> fds_integral <span class="free">b</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_integral_def scaleR_diff_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_integral_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_integral <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_integral <span class="free">a</span> <span class="free">f</span> <span class="main">-</span> fds_integral <span class="free">b</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_integral_def scaleR_diff_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_integral_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_integral <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fds_integral <span class="free">a</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_integral_def scaleR_diff_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">b</span> <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_integral <span class="free">a</span> <span class="main">(</span>fds_shift <span class="free">b</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_integral_def fds_shift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_fds_integral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> fds_deriv <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_def fds_integral_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_integral_fds_deriv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_integral <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_def fds_integral_def fds_eq_iff<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formal logarithm›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_ln</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_field<span class="main">}</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_ln</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds_integral <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span>fds_deriv <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_Suc_0_fds_deriv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_fds_ln <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_ln_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_deriv_fds_integral<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_Suc_0_fds_ln <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def fds_integral_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def fds_integral_def divide_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">0</span> <span class="main">=</span> fds_const <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def fds_integral_def divide_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">1</span> <span class="main">=</span> fds_const <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def fds_integral_def divide_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_ln <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">a</span> <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_ln <span class="free">l</span> <span class="main">(</span>fds_shift <span class="free">a</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def fds_shift_integral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">g</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">+</span> <span class="free">l''</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_ln <span class="free">l'</span> <span class="free">f</span> <span class="main">+</span> fds_ln <span class="free">l''</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_integral <span class="main">(</span><span class="free">l'</span> <span class="main">+</span> <span class="free">l''</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> fds_deriv <span class="free">g</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> fds_deriv <span class="free">g</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span>
               fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="main">*</span> inverse <span class="free">g</span><span class="main">)</span> <span class="main">+</span> fds_deriv <span class="free">g</span> <span class="main">/</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> inverse_mult_fds<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_right_inverse<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*</span> inverse <span class="free">g</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_right_inverse<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_integral_add fds_ln_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">l'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> fds_ln <span class="free">l'</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_ln <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">l'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> fds_ln <span class="free">l'</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_mult <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> fds_nth <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">l'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_ln <span class="main">(</span><span class="free">l'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_ln <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">l'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_ln <span class="main">(</span><span class="free">l'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formal exponential›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_exp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_algebra_1<span class="main">,</span>banach<span class="main">}</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_exp</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">f'</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span>
                <span class="keyword1">in</span>  fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="bound">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_exp_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sums_If_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_times_fds_nth_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span>exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="main">(</span><span class="free">f</span> <span class="main">-</span> fds_const <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_exp <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def fds_nth_fds' <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>exp <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def fds_nth_fds' one_fds_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="main">0</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span> <span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_fds_def fds_nth_fds' power_0_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> suminf_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="free">c</span> <span class="main">*</span> <span class="main">…</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>exp <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_const_def fds_eq_iff fds_nth_fds' <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>exp <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_exp_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fds_exp_const <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_fds<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_exp <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_exp_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fds_exp_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_exp <span class="main">1</span> <span class="main">=</span> fds_const <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_exp_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fds_exp_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_Suc_0_exp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">0</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_finite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subseries›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_subseries</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> semiring_1<span class="main">)</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_subseries</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">n</span> <span class="keyword1">then</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_subseries<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="free">n</span> <span class="keyword1">then</span> fds_nth <span class="free">f</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_nth_fds'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">1</span> <span class="main">⟹</span> fds_subseries <span class="free">P</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_eq_iff one_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">1</span> <span class="main">⟹</span> fds_subseries <span class="free">P</span> <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_eq_iff fds_const_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_subseries <span class="free">P</span> <span class="free">f</span> <span class="main">+</span> fds_subseries <span class="free">P</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_eq_iff plus_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ring_1 fds<span class="main">)</span> <span class="main">=</span> fds_subseries <span class="free">P</span> <span class="free">f</span> <span class="main">-</span> fds_subseries <span class="free">P</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_eq_iff minus_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ring_1 fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> fds_subseries <span class="free">P</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_eq_iff minus_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_subseries <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">c</span> <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_deriv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_deriv_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_subseries_integral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> fds_subseries <span class="free">P</span> <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_integral <span class="free">c</span> <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_integral_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fds_primepow_subseries</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> semiring_1<span class="main">)</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_primepow_subseries</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> fds_subseries <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> prime_factors <span class="bound">n</span> <span class="main">⊆</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_primepow_subseries_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> prime_factors <span class="bound">n</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_subseries <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_subseries <span class="free">P</span> <span class="free">f</span> <span class="main">*</span> fds_subseries <span class="free">P</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">P</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span> <span class="main">*</span> fds_subseries <span class="free">P</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">d</span> <span class="main">⊆</span> prime_factors <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that 2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_prime_factors<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">using</span></span> P<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> P<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_nth_fds' fds_nth_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span>fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_altdef2 <span class="keyword1"><span class="command">using</span></span> 2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_nth_fds' <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> P'<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">P</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">n</span> <span class="main">=</span> prime_factors <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prime_factors <span class="skolem">a</span> <span class="main">∪</span> prime_factors <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_factors_product<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="main">(</span>fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_altdef2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_subseries_def fds_nth_fds'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_subseries_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_primepow_subseries_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_primepow_subseries <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fds_primepow_subseries <span class="free">p</span> <span class="free">f</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>  <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_primepow_subseries_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_primepow_subseries <span class="free">p</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fds_primepow_subseries <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_function_only_pows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="main">(</span>fds_primepow_subseries <span class="free">p</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> completely_multiplicative_function <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_subseries prime_factors_product mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Truncation›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_truncate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span><span class="main">{</span>zero<span class="main">}</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_truncate</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_truncate<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">m</span> <span class="keyword1">then</span> fds_nth <span class="free">f</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_def fds_nth_fds'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="main">0</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_truncate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_truncate <span class="free">m</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_def fds_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_truncate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="main">(</span>min <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_truncate' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_shift <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">a</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_truncate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_add_strong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> monoid_add fds<span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">+</span> fds_truncate <span class="free">m</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_truncate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">+</span> fds_truncate <span class="free">m</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> monoid_add fds<span class="main">)</span> <span class="main">=</span> 
     fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_truncate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">*</span> fds_truncate <span class="free">m</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">m</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="var">?B</span> <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate fds_nth_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span>fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">d</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="var">?A</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate fds_nth_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_truncate fds_deriv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_integral<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_integral <span class="free">c</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_truncate fds_integral_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_power<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span>
            fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">*</span> fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">*</span> fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_truncate_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_inverse_cong_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">=</span> <span class="free">f'</span> <span class="bound">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">i'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i'</span> <span class="free">n'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_induct<span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>gt1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="skolem">k</span> <span class="main">=</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gt1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> dirichlet_inverse <span class="free">f'</span> <span class="free">i</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> gt1.prems<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_gt_1 * <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_cong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟹</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> fds_nth <span class="free">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span>
   fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="free">f'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>inverse <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_truncate_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">m</span> <span class="keyword1">then</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>inverse <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span>
             dirichlet_inverse <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span> <span class="main">(</span>inverse <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_inverse_cong_simp<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_fds_nonunit fds_nth_truncate<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> * 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_fds_def fds_nth_fds' fds_nth_truncate Suc_le_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_divide<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">/</span> fds_truncate <span class="free">m</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">/</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">/</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> 
          fds_truncate <span class="free">m</span> <span class="main">(</span>inverse <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_inverse fds_truncate_mult divide_fds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">*</span> inverse <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_truncate_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span> <span class="main">/</span> fds_truncate <span class="free">m</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_ln<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> real_normed_field fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_ln <span class="free">l</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def fds_truncate_integral fds_truncate_deriv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 
                    fds_truncate_divide<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_truncate_exp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_truncate_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> truncate_f'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="skolem">f'</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def fds_eq_iff fds_nth_truncate<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
          <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="skolem">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def fds_nth_fds' a_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f'_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 
                  fds_nth_truncate truncate_f' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="skolem">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="skolem">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="skolem">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_truncate <span class="free">m</span> <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="skolem">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> fds_truncate <span class="free">m</span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">…</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">(</span><span class="skolem">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">…</span> <span class="bound">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def fds_nth_fds' a_def f'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_eqI_truncate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_truncate <span class="bound">m</span> <span class="free">f</span> <span class="main">=</span> fds_truncate <span class="bound">m</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_truncate <span class="skolem">n</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_truncate <span class="skolem">n</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Normed series›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_norm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_div_algebra<span class="main">}</span> fds <span class="main">⇒</span> real fds"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fds_norm</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_norm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_norm_def fds_nth_fds'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_norm_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_norm <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff one_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_norm_mult_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> fds_nth <span class="main">(</span>fds_norm <span class="free">f</span> <span class="main">*</span> fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_def norm_mult <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_norm_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_norm_mult_nonneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_norm <span class="free">f</span> <span class="main">*</span> fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lifting a real series to a real algebra›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_of_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real fds <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_algebra_1<span class="main">}</span> fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_of_real</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_of_real <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> of_real <span class="main">(</span>fds_nth <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_of_real_def fds_nth_fds'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_of_real_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fds_of_real_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fds_of_real_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>of_real <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fds_of_real_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fds_of_real <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fds_of_real_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_of_real <span class="free">f</span> <span class="main">+</span> fds_of_real <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fds_of_real_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_of_real <span class="free">f</span> <span class="main">*</span> fds_of_real <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fds_of_real_deriv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="main">(</span>fds_of_real <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff one_fds_def fds_const_def fds_nth_mult 
                    dirichlet_prod_def fds_deriv_def scaleR_conv_of_real<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_of_real_higher_deriv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>fds_of_real <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_of_real <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Convergence and connection to concrete functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following definitions establish a connection of a formal Dirichlet series to 
  the concrete analytic function that it corresponds to. This correspondence is usually 
  partial in the sense that a series may not converge everywhere.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval_fds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">}</span><span class="main">)</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_fds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">L</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sums_Suc_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def sums_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_converges</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">}</span><span class="main">)</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_converges</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def sums_iff eval_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_abs_converges</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">}</span><span class="main">)</span> fds <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_abs_converges</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_imp_converges <span class="main">[</span><span class="operator">dest</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟹</span> fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def fds_converges_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_norm_cancel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_altdef<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_def summable_sums_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sums_Suc_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_const_abs_converges <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> 
          summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> norm <span class="free">c</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_const_converges <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_abs_converges_imp_converges<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_cong<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sums_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
          
<span class="keyword1"><span class="command">lemma</span></span> fds_zero_abs_converges <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">0</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_zero_converges <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">0</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_zero <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eval_fds_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_one_abs_converges <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">1</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_one <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_const_abs_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_one_converges <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">1</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_one <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fds_const_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_truncate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_truncate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_subseries <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_subseries<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fds_const_one <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eval_fds_const<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_truncate<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_truncate <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_finite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_truncate Suc_le_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_truncate<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> fds_converges_add<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> summable_add<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fds_converges_def<span class="main"><span class="main">]</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def add_divide_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_add<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span>fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> summable_add<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fds_abs_converges_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?A</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_triangle_ineq add_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_add<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">+</span> eval_fds <span class="free">g</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">g</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def sums_iff eval_fds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sums_add<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def sums_iff add_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> fds_converges_uminus<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> summable_minus<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fds_converges_def<span class="main"><span class="main">]</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def add_divide_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> The_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"The <span class="free">P</span> <span class="main">=</span> The <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟷</span> <span class="free">Q</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_uminus<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟹</span> eval_fds <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">-</span>eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def eval_fds_def suminf_minus<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> fds_converges_diff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> summable_diff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fds_converges_def<span class="main"><span class="main">]</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def diff_divide_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_diff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span>fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> summable_add<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fds_abs_converges_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?A</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_triangle_ineq4 diff_divide_distrib<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_diff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">-</span> eval_fds <span class="free">g</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">g</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def sums_iff eval_fds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sums_diff<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def sums_iff diff_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> eval_fds_at_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="main">(</span>of_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> of_nat <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_at_numeral<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> of_nat <span class="bound">n</span> <span class="main">^</span> numeral <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_fds_at_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"numeral <span class="free">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_at_1<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> of_nat <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_fds_at_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">lemma</span></span> eval_fds_at_0<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_fds_at_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> suminf_fds_zeta_aux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth fds_zeta <span class="bound">n</span> <span class="main">/</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> real_normed_field<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_zeta<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> fds_converges_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_field<span class="main">,</span> real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> fds_converges <span class="free">f</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_diff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_field<span class="main">,</span> real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> fds_abs_converges <span class="free">f</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_diff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_eval_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_field<span class="main">,</span> real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_diff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> fds_converges_scale <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_field<span class="main">,</span> real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> fds_converges <span class="free">f</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> 
          summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> summable <span class="var">?g</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_mono_reindex <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale is_nth_power_def strict_mono_def power_strict_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_power_left nat_power_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_scale <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_field<span class="main">,</span> real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> 
          summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> summable <span class="var">?g</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_mono_reindex <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale is_nth_power_def strict_mono_def power_strict_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_power_left nat_power_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_scale <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_field<span class="main">,</span> real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_scale <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_mono_reindex <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_scale is_nth_power_def strict_mono_def power_strict_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_power_left nat_power_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">≤</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">n</span> <span class="main">≥</span> ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">≤</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_integral_def norm_divide <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_ln<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> fds_ln_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_integral<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Moebius_Mu">
<div class="head">
<h1>Theory Moebius_Mu</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Moebius_Mu.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The M\"{o}bius $\mu$ function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Moebius_Mu
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Squarefree.html">HOL-Computational_Algebra.Squarefree</a>"</span>
  <a href="Dirichlet_Series.html">Dirichlet_Series</a>
  <a href="Dirichlet_Misc.html">Dirichlet_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">moebius_mu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">moebius_mu</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> squarefree <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="main">(</span>prime_factors <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> abs_moebius_mu_le<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>moebius_mu <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>linordered_idom<span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> moebius_mu <span class="free">n</span> <span class="main">=</span> moebius_mu <span class="free">n</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>card <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_moebius_commute<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> moebius_mu <span class="main">=</span> dirichlet_prod moebius_mu <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> dirichlet_prod_altdef1<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_moebius_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> fds moebius_mu <span class="main">=</span> fds moebius_mu <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult dirichlet_prod_moebius_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> of_int_moebius_mu <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>moebius_mu <span class="free">n</span><span class="main">)</span> <span class="main">=</span> moebius_mu <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> minus_1_power_ring_neq_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ring_1<span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="free">n</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_nth_fds_moebius_mu <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="main">=</span> moebius_mu"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff fds_nth_fds<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> prime_factors_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factors_dvd<span class="main">)</span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_eq_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">¬</span>squarefree <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_not_squarefree <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>squarefree <span class="free">n</span> <span class="main">⟹</span> moebius_mu <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"moebius_mu <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_imp_power_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> moebius_mu_eq_zero_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">^</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> squarefree_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_power'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"moebius_mu <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> moebius_mu <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_0_left moebius_mu_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_squarefree_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"squarefree <span class="free">n</span> <span class="main">⟹</span> moebius_mu <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_squarefree_eq'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> size <span class="main">(</span>prime_factorization <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"prime_factorization <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="var">?P</span> <span class="main">=</span> sum <span class="main">(</span>count <span class="var">?P</span><span class="main">)</span> <span class="main">(</span>set_mset <span class="var">?P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> size_multiset_overloaded_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>set_mset <span class="var">?P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> count_prime_factorization_prime<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_eq_zero_iff squarefree_factorial_semiring'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>set_mset <span class="var">?P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_squarefree_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> sum_moebius_mu_divisors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">::</span> int<span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">d</span> <span class="main">∈</span> Prod <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_right<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> prime_factors <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity prime_gt_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A' <span class="keyword1"><span class="command">have</span></span> A_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span><span class="main">∏</span><span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> sum prime_factorization <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prod<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{#</span><span class="bound">x</span><span class="main">#}</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_prime<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mset_set <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆#</span> mset_set <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_imp_msubset_mset_set<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆#</span> prime_factorization <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mset_set_set_mset_msubset<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="skolem">A</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_nz
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_factorization_subset_imp_dvd<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> Prod <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span>set_mset <span class="main">(</span>prime_factorization <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main">)</span>
                    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_eq_zero_iff squarefree_factorial_semiring'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Primes.prime_factorization_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">∏</span><span class="main">(</span>prime_factors <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">x</span> <span class="main">⊆</span> prime_factors <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dvd_prime_factors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Prod <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"moebius_mu <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">P</span></span> <span class="main">|</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="main">∏</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_on_Prod_primes <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">P</span></span> <span class="main">|</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span><span class="main">∏</span><span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> squarefree_prod_coprime prime_imp_coprime squarefree_prime<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primes_dvd_imp_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"moebius_mu <span class="main">(</span><span class="main">∏</span><span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="main">(</span>prime_factors <span class="main">(</span><span class="main">∏</span><span class="skolem">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> moebius_mu_squarefree_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span><span class="main">∏</span><span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factors_prod<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_prime prime<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"moebius_mu <span class="main">(</span><span class="main">∏</span><span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span><span class="main">}</span> <span class="main">=</span> 
               <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span> <span class="main">∧</span> even <span class="main">(</span>card <span class="bound">P</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⊆</span> prime_factors <span class="free">n</span> <span class="main">∧</span> odd <span class="main">(</span>card <span class="bound">P</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">P</span> <span class="main">∈</span> <span class="main">…</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">P</span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">P</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">P</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">P</span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">P</span> <span class="main">::</span> int<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">P</span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span>card <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">P</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">P</span> <span class="main">::</span> int<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">P</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span>int <span class="main">(</span>card <span class="var">?B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> card <span class="var">?A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_even_odd_subset <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_empty_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>card <span class="var">?A</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> int <span class="main">(</span>card <span class="var">?A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> of_int <span class="main">(</span>moebius_mu <span class="bound">d</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_int_sum <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_0<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_moebius_mu_divisors'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum_moebius_mu_divisors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_zeta_times_moebius_mu<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_nth_mult dirichlet_prod_altdef1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_fds <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="main">1</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_moebius_mu_divisors'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">1</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_moebius_inverse_zeta<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds moebius_mu <span class="main">=</span> inverse <span class="main">(</span>fds_zeta <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field fds<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_right_inverse_unique<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_zeta_times_moebius_mu<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_formula_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>moebius_mu <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>fds_nth <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds moebius_mu <span class="main">=</span> <span class="main">(</span>inverse fds_zeta <span class="main">::</span> real fds<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> fds_moebius_inverse_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">…</span> <span class="free">n</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span>fds_nth fds_zeta<span class="main">)</span> <span class="main">1</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_nth_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dirichlet_inverse_cong<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_formula_int<span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> int<span class="main">)</span> <span class="main">1</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>moebius_mu <span class="free">n</span><span class="main">)</span> <span class="main">=</span> moebius_mu <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> moebius_mu_formula_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real_of_int <span class="main">(</span>dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_inverse_gt_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_formula<span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_int_moebius_mu <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> moebius_mu_formula_int<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_dirichlet_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> moebius_mu<span class="main">:</span> multiplicative_function <span class="quoted">moebius_mu</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_dirichlet_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> moebius_mu"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff moebius_mu_formula<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>moebius_mu <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> moebius_mu<span class="main">:</span> 
  multiplicative_function' <span class="quoted">moebius_mu</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"moebius_mu <span class="skolem">p</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def prime_factorization_prime squarefree_prime<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"moebius_mu <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_power'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> moebius_mu_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_mu <span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> moebius_mu.prime<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> of_int <span class="main">(</span>dirichlet_inverse <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> int<span class="main">)</span> <span class="main">1</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> moebius_mu_formula_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> fds_moebius_inversion<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fds moebius_mu <span class="main">*</span> <span class="free">g</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> fds_zeta"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> fds_zeta"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*</span> fds moebius_mu <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> <span class="main">(</span>fds_zeta <span class="main">*</span> fds moebius_mu<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_zeta_times_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fds moebius_mu <span class="main">*</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fds moebius_mu <span class="main">*</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">*</span> <span class="free">f</span> <span class="main">=</span> fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">*</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_zeta_times_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> fds_zeta"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_inversion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> dirichlet_prod moebius_mu <span class="free">g</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="free">g</span> <span class="main">=</span> fds <span class="free">f</span> <span class="main">*</span> fds_zeta"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> fds_moebius_inversion <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_mangoldt<span class="main">:</span> <span class="quoted"><span class="quoted">"fds mangoldt <span class="main">=</span> fds moebius_mu <span class="main">*</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_moebius_inversion<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> fds_mangoldt_times_zeta <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* 2.18 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> sum_divisors_moebius_mu_times_multiplicative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> multiplicative_function <span class="quoted"><span class="skolem">g'</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicative_dirichlet_prod multiplicative_function_mult
              moebius_mu.multiplicative_function_axioms assms<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> g'_primepow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">k</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g'_def dirichlet_prod_prime_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_power'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu.prime<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def g'_def dirichlet_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="skolem">g'</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_prime_factors<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g'_primepow prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="comment1">(* Theorem 2.17 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_iff_inverse_moebius_mu<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span> ring_no_zero_divisors<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> dirichlet_inverse <span class="free">f</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span> <span class="main">⟷</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> fds <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> fds <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult fds_nth_fds dirichlet_prod_altdef2 mult mult.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod moebius_mu <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef2 sum_distrib_right case_prod_unfold mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod moebius_mu <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds moebius_mu <span class="main">*</span> fds_zeta<span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds moebius_mu <span class="main">*</span> fds_zeta <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac fds_zeta_times_moebius_mu<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">1</span> <span class="skolem">n</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">1</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_one<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> fds <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">1</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> fds <span class="free">g</span> <span class="main">*</span> fds <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff g_def fds_nth_mult dirichlet_prod_inverse'<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="free">g</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult_cancel_right<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> moebius_mu <span class="skolem">n</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> completely_multiplicativeI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">g</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> dirichlet_prod_inverse'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">g</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pk <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">g</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod_prime_power<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>Suc <span class="skolem">k</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> g<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pk <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_power'<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pk Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu.prime<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_fds_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>fds <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> completely_multiplicative_iff_inverse_moebius_mu<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_fds_def multiplicative_function_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_fds_inverse'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inverse <span class="free">f</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fds <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>fds <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> completely_multiplicative_fds_inverse assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
    

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> fds_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> selberg_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds moebius_mu <span class="main">=</span>
     <span class="main">(</span>fds mangoldt<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> fds_deriv <span class="main">(</span>fds mangoldt <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span>real_algebra_1<span class="main">}</span> fds<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="main">(</span>fds_deriv fds_zeta <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds fds_nth_deriv power2_eq_square scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>fds mangoldt <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> fds_deriv <span class="main">(</span>fds mangoldt<span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_zeta"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_zeta <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> fds moebius_mu <span class="main">=</span> <span class="main">(</span><span class="main">(</span>fds mangoldt<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> fds_deriv <span class="main">(</span>fds mangoldt<span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
                                      <span class="main">(</span>fds_zeta <span class="main">*</span> fds moebius_mu<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> fds_zeta_times_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> selberg_aux'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mangoldt <span class="free">n</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mangoldt <span class="main">⋆</span> mangoldt<span class="main">)</span> <span class="free">n</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">(</span>moebius_mu <span class="main">⋆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">b</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span>
         <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span>real_algebra_1<span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> selberg_aux <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> that 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult power2_eq_square fds_nth_deriv
        dirichlet_prod_commutes <span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="More_Totient">
<div class="head">
<h1>Theory More_Totient</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      More_Totient.thy
    Author:    Manuel Eberl, TU München
    
    Additional properties of Euler's totient function
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Euler's $\phi$ function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> More_Totient
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Moebius_Mu.html">Moebius_Mu</a>
    <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_totient_times_zeta<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1<span class="main">)</span> <span class="main">*</span> fds_zeta <span class="main">=</span> fds of_nat"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_zeta<span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
          dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds of_nat<span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds dirichlet_prod_def totient_divisor_sum of_nat_sum <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
             <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_zeta<span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds of_nat<span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_totient_times_zeta'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds totient <span class="main">*</span> fds_zeta <span class="main">=</span> fds id"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_totient_times_zeta<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">nat</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1"><span class="command">lemma</span></span> fds_totient<span class="main">:</span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds of_nat <span class="main">*</span> fds moebius_mu"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> fds of_nat <span class="main">*</span> fds moebius_mu"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_totient_times_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> 
               fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc fds_zeta_times_moebius_mu mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> totient_conv_moebius_mu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"int <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dirichlet_prod moebius_mu int <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> moebius_inversion<span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_sum <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> totient_divisor_sum <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_sum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">interpretation</span></span> totient<span class="main">:</span> multiplicative_function <span class="quoted">totient</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicative_function int"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_prod moebius_mu int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicative_dirichlet_prod moebius_mu.multiplicative_function_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod moebius_mu int <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> int <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff totient_conv_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicative_function totient"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_function_of_natD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> even_prime_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> even <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_odd_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> twopow_dvd_totient<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≡</span> card <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> odd <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="keyword1">dvd</span> totient <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> odd <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> even <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"totient <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> totient.prod_prime_factors<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">n</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">∪</span> <span class="skolem">P'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def P'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P'</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def P'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"totient <span class="free">n</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_increasing<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def prime_factors_multiplicity r_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_dvd_prod totient_even<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> card <span class="skolem">P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P'</span><span class="main">.</span> totient <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">r</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> totient <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def P_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> totient_conv_moebius_mu'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>int <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> int <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> totient_conv_moebius_mu <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> int <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> real <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> real <span class="free">n</span> <span class="main">*</span> moebius_mu <span class="bound">d</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> field_char_0_class.of_nat_div<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> totient_prime_power_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"totient <span class="main">(</span><span class="free">p</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">-</span> <span class="free">p</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"totient <span class="main">(</span><span class="free">p</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">-</span> card <span class="main">(</span><span class="main">(*)</span> <span class="free">p</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> totient_def totatives_prime_power_Suc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Diff_subset<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(*)</span> <span class="free">p</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">p</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_image<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> totient<span class="main">:</span> multiplicative_function' <span class="quoted">totient</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">-</span> <span class="bound">p</span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"totient <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> totient_prime_power_Suc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Liouville_Lambda">
<div class="head">
<h1>Theory Liouville_Lambda</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Liouville_Lambda.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Liouville $\lambda$ function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Liouville_Lambda
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
    <a href="Dirichlet_Series.html">Dirichlet_Series</a>
    <a href="Multiplicative_Function.html">Multiplicative_Function</a> 
    <a href="Moebius_Mu.html">Moebius_Mu</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">liouville_lambda</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">liouville_lambda</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> size <span class="main">(</span>prime_factorization <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> liouville_lambda<span class="main">:</span> completely_multiplicative_function' <span class="quoted">liouville_lambda</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"liouville_lambda <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> liouville_lambda <span class="skolem">a</span> <span class="main">*</span> liouville_lambda <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> liouville_lambda_def prime_factorization_mult power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> liouville_lambda_def prime_factorization_prime One_nat_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 
              <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_prime <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> liouville_lambda <span class="free">p</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> liouville_lambda_def prime_factorization_prime<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_prime_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> liouville_lambda <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> liouville_lambda_def prime_factorization_prime_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_squarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"squarefree <span class="free">n</span> <span class="main">⟹</span> liouville_lambda <span class="free">n</span> <span class="main">=</span> moebius_mu <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> liouville_lambda_def moebius_mu_squarefree_eq' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> power_neg_one_If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="free">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ring_1<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_power_even<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> even <span class="free">m</span> <span class="main">⟹</span> liouville_lambda <span class="main">(</span><span class="free">n</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> liouville_lambda.power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evenE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> liouville_lambda_def power_neg_one_If<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_power_odd<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"odd <span class="free">m</span> <span class="main">⟹</span> liouville_lambda <span class="main">(</span><span class="free">n</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> liouville_lambda <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> liouville_lambda.power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> oddE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> liouville_lambda_def power_neg_one_If<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"liouville_lambda <span class="main">(</span><span class="free">n</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="free">m</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> liouville_lambda <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> liouville_lambda_power_even liouville_lambda_power_odd power_0_left<span class="main">)</span>
                                      
<span class="keyword1"><span class="command">interpretation</span></span> squarefree<span class="main">:</span> multiplicative_function' 
  <span class="quoted"><span class="quoted">"ind squarefree"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ind squarefree <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> squarefree_power_iff squarefree_prime ind_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> squarefree_mult_coprime squarefree_power_iff ind_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> squarefree_multD 
          <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
        

<span class="keyword1"><span class="command">interpretation</span></span> is_nth_power<span class="main">:</span> multiplicative_function <span class="quoted"><span class="quoted">"ind <span class="main">(</span>is_nth_power <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_mult_coprime_nat_iff<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> is_nth_power<span class="main">:</span> multiplicative_function' 
  <span class="quoted"><span class="quoted">"ind <span class="main">(</span>is_nth_power <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_nth_power_prime_power_nat_iff ind_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> is_square<span class="main">:</span> multiplicative_function <span class="quoted"><span class="quoted">"ind is_square"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_mult_coprime_nat_iff<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> is_square<span class="main">:</span> multiplicative_function' 
  <span class="quoted"><span class="quoted">"ind is_square"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_nth_power_prime_power_nat_iff ind_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_divisors_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> liouville_lambda <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> ind is_square <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_function_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> liouville_lambda <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> liouville_lambda.multiplicative_sum_divisors<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>ind is_square<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_nth_power.multiplicative_function_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> p_gt_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">.</span> liouville_lambda <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> liouville_lambda <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pk <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_imp_power_dvd <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divides_primepow_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> pk <span class="keyword2"><span class="keyword">and</span></span> p_gt_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">k</span><span class="main">.</span> liouville_lambda <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def prime_gt_1_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> pk <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="skolem">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> pk <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ind is_square <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_square.prime_power<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">.</span> liouville_lambda <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> ind is_square <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_liouville_lambda_times_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"fds liouville_lambda <span class="main">*</span> fds_zeta <span class="main">=</span> fds_ind is_square"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> liouville_lambda_divisors_sum fds_nth_mult dirichlet_prod_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_liouville_lambda<span class="main">:</span> <span class="quoted"><span class="quoted">"fds liouville_lambda <span class="main">=</span> fds_ind is_square <span class="main">*</span> fds moebius_mu"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds liouville_lambda <span class="main">*</span> fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> fds_ind is_square <span class="main">*</span> fds moebius_mu"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_liouville_lambda_times_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds liouville_lambda <span class="main">*</span> fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> fds liouville_lambda"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc fds_zeta_times_moebius_mu mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> liouville_lambda_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"liouville_lambda <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"liouville_lambda <span class="free">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds liouville_lambda<span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds liouville_lambda <span class="main">=</span> fds_ind is_square <span class="main">*</span> <span class="main">(</span>fds moebius_mu <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_liouville_lambda<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">…</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> ind is_square <span class="bound">d</span> <span class="main">*</span> moebius_mu <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_def is_nth_power_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="bound">d</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> power2_eq_imp_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_moebius_mu<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>moebius_mu <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> linordered_idom<span class="main">)</span> <span class="main">=</span> ind squarefree <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_def moebius_mu_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Divisor_Count">
<div class="head">
<h1>Theory Divisor_Count</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Divisor_Count.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The divisor functions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Divisor_Count
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
  <a href="Dirichlet_Series.html">Dirichlet_Series</a>
  <a href="More_Totient.html">More_Totient</a>
  <a href="Moebius_Mu.html">Moebius_Mu</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The general divisor function›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">divisor_sigma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> nat_power <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divisor_sigma</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> nat_power <span class="bound">d</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_divisor_sigma<span class="main">:</span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span>divisor_sigma <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fds_zeta <span class="main">*</span> fds_shift <span class="free">x</span> fds_zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef1 divisor_sigma_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> divisor_sigma<span class="main">:</span> multiplicative_function <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> 
           <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> nat_power <span class="bound">n</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="var">?f</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_dirichlet_prod<span class="main"><span class="keyword3">;</span></span> <span class="operator">standard</span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> divisor_sigma <span class="free">x</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> fds_divisor_sigma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult <span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> divisor_sigma <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>divisor_sigma <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_naive <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> fold_atLeastAtMost_nat
        <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> nat_power <span class="bound">d</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> nat_power <span class="bound">d</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> divisor_sigma_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fold_atLeastAtMost_nat
        <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> nat_power <span class="bound">d</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_atLeastAtMost_code<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> nat_power <span class="bound">d</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> nat_power <span class="bound">d</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_of_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">(</span>of_nat <span class="free">x</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> of_nat <span class="main">(</span>divisor_sigma <span class="free">x</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> divisor_sigma_def of_nat_sum
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> nat_power_of_nat<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_prime_power_field<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span> nat_power<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="keyword1">if</span> nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span>
             <span class="main">(</span>nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">^</span> Suc <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> nat_power <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> divisor_sigma_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_on_def prime_gt_Suc_0_nat 
          divides_primepow_nat <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_imp_power_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat nat_power_power_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span>
                    <span class="main">(</span>nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">^</span> Suc <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> geometric_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat_power <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lessThan_Suc_atMost
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_prime_power_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Suc <span class="free">k</span> <span class="keyword1">else</span>
             <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> Suc <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_power <span class="free">p</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divisor_sigma_prime_power_field<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> nat_power_real_def <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> divisor_sigma_of_nat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_nat_eq_iff<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> gt_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> power_gt1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> not_one<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> of_nat_power <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> of_nat_eq_1_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> gt_1 <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> Suc <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> geometric_sum_nat_dvd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult prime_gt_Suc_0_nat power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span>
          real <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Suc <span class="free">k</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> Suc <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divisor_sigma_prime_power_field <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">real</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> assms False dvd not_one<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc nat_power_real_def 
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat real_of_nat_div of_nat_diff prime_ge_Suc_0_nat power_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> divisor_sigma_of_nat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_nat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> divisor_sigma_field<span class="main">:</span> 
  multiplicative_function' <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span> nat_power<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> nat_power <span class="bound">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> 
        <span class="main">(</span>nat_power <span class="bound">p</span> <span class="free">x</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>nat_power <span class="bound">p</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> nat_power <span class="bound">p</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divisor_sigma_prime_power_field prime_gt_0_nat <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> divisor_sigma_real<span class="main">:</span> 
  multiplicative_function' <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span>real <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> real <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divisor_sigma_prime_power_field prime_gt_0_nat powr_def of_nat_eq_1_iff
                   exp_of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult_ac <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc power_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def that prime_gt_0_nat of_nat_eq_1_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> divisor_sigma_nat<span class="main">:</span> 
  multiplicative_function' <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">(</span><span class="free">x</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Suc <span class="bound">k</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="bound">k</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that 2 one_less_power prime_gt_1_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prime_ge_Suc_0_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divisor_sigma_prime_power_nat mult_ac<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">.</span> nat_power <span class="bound">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">d</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> nat_power <span class="bound">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> nat_power <span class="free">p</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The divisor-counting function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">divisor_count</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divisor_count</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> card <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_count <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_count_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_count <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_count_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_0_left_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">0</span> <span class="free">n</span> <span class="main">=</span> divisor_count <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_def divisor_count_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_0_left<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">0</span> <span class="free">n</span> <span class="main">=</span> of_nat <span class="main">(</span>divisor_count <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> divisor_sigma_0_left_nat <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> divisor_sigma_of_nat <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_count <span class="free">n</span> <span class="main">=</span> divisor_sigma <span class="main">0</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_0_left<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_naive <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"divisor_count <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> 
     fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> Suc <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> divisor_sigma_naive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> nat"</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_count_altdef <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> divisor_count<span class="main">:</span> multiplicative_function' <span class="quoted">divisor_count</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> Suc <span class="bound">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_count_altdef divisor_sigma.mult_coprime
                             divisor_sigma_nat.prime_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_dvd_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"divisor_count <span class="free">a</span> <span class="main">≤</span> divisor_count <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divisor_count_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> card_mono <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_trans<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The divisor sum function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">divisor_sum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divisor_sum</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">∑</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sum_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sum <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sum_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sum_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sum <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sum_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_1_left_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> divisor_sum <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sum_def divisor_sigma_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_1_left<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sigma <span class="main">1</span> <span class="free">n</span> <span class="main">=</span> of_nat <span class="main">(</span>divisor_sum <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sum_def divisor_sigma_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sum_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_sum <span class="free">n</span> <span class="main">=</span> divisor_sigma <span class="main">1</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_1_left_nat<span class="main">)</span>
    
<span class="keyword1"><span class="command">interpretation</span></span> divisor_sum<span class="main">:</span> 
  multiplicative_function' <span class="quoted">divisor_sum</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> Suc <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> divisor_sigma_nat.prime_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sum_altdef<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sum_altdef divisor_sigma_nat.prime_power divisor_sigma.mult_coprime<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sum_dvd_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"divisor_sum <span class="free">a</span> <span class="main">≤</span> divisor_sum <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divisor_sum_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_le_included <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sum_naive <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"divisor_sum <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> 
     fold_atLeastAtMost_nat <span class="main">(</span><span class="main">λ</span><span class="bound">d</span> <span class="bound">acc</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="bound">d</span> <span class="main">+</span> <span class="bound">acc</span> <span class="keyword1">else</span> <span class="bound">acc</span><span class="main">)</span> <span class="main">1</span> <span class="free">n</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> divisor_sigma_naive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sum_altdef <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> fds_divisor_count<span class="main">:</span> <span class="quoted"><span class="quoted">"fds divisor_count <span class="main">=</span> fds_zeta <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> 
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef1 divisor_count_def power2_eq_square<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_zeta_1<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="main">1</span> fds_zeta <span class="main">=</span> fds of_nat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_shift_zeta_Suc_0<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_shift <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> fds_zeta <span class="main">=</span> fds id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_divisor_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"fds divisor_sum <span class="main">=</span> fds_zeta <span class="main">*</span> fds id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef1 divisor_sum_def<span class="main">)</span>
    

<span class="keyword1"><span class="command">lemma</span></span> fds_divisor_sum_eq_totient_times_d<span class="main">:</span> <span class="quoted"><span class="quoted">"fds divisor_sum <span class="main">=</span> fds totient <span class="main">*</span> fds divisor_count"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds divisor_sum <span class="main">=</span> fds_zeta <span class="main">*</span> fds id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> fds_divisor_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds id <span class="main">=</span> fds totient <span class="main">*</span> fds_zeta"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_totient_times_zeta' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> fds totient <span class="main">*</span> fds divisor_count"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fds_divisor_count <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> fds_divisor_sum_times_moebius_mu<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span>comm_ring_1<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds moebius_mu <span class="main">=</span> fds of_nat"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span>divisor_sigma <span class="main">1</span><span class="main">)</span> <span class="main">*</span> fds moebius_mu <span class="main">=</span> 
          fds of_nat <span class="main">*</span> <span class="main">(</span>fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fds_zeta_commutes <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_divisor_sigma fds_shift_zeta_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> fds_zeta_times_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Theorem 2.20 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> inverse_divisor_sigma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span> nat_power<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>fds <span class="main">(</span>divisor_sigma <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">a</span> <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="main">*</span> fds moebius_mu"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span>divisor_sigma <span class="free">a</span><span class="main">)</span> <span class="main">=</span> fds_zeta <span class="main">*</span> fds_shift <span class="free">a</span> fds_zeta"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_divisor_sigma<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">…</span> <span class="main">=</span> fds moebius_mu <span class="main">*</span> inverse <span class="main">(</span>fds_shift <span class="free">a</span> fds_zeta<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_moebius_inverse_zeta inverse_mult_fds<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>fds_shift <span class="free">a</span> fds_zeta<span class="main">)</span> <span class="main">=</span>
               fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> fds_nth <span class="main">(</span>fds_shift <span class="free">a</span> fds_zeta<span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> completely_multiplicative_fds_inverse'<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_shift <span class="free">a</span> <span class="main">(</span>fds moebius_mu<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Arithmetic_Summatory">
<div class="head">
<h1>Theory Arithmetic_Summatory</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Arithmetic_Summatory.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Summatory arithmetic functions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Arithmetic_Summatory
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="More_Totient.html">More_Totient</a>
    <a href="Moebius_Mu.html">Moebius_Mu</a>
    <a href="Liouville_Lambda.html">Liouville_Lambda</a>
    <a href="Divisor_Count.html">Divisor_Count</a> 
    <a href="Dirichlet_Series.html">Dirichlet_Series</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sum_upto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sum_upto</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> sum_upto_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n'</span> <span class="main">⟹</span> sum_upto <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> sum_upto <span class="free">f'</span> <span class="free">n'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_Nats_le_real <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>ind <span class="free">P</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> of_nat <span class="main">(</span>card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>ind <span class="free">P</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span>card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_sum_divisors<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">d</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">k</span><span class="main">:</span><span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> real <span class="bound">k</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">k</span><span class="main">:</span><span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> real <span class="bound">k</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">a</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span> <span class="main">≤</span> real <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_mult <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">k</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">k</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> * <span class="dynamic"><span class="dynamic">divide_simps</span></span> mult.commute <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">d</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.Sigma<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex_bij_betw<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_dirichlet_prod<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_upto_sum_divisors<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_real<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto real <span class="free">x</span> <span class="main">=</span> of_int <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">∑</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> sum_upto real <span class="free">x</span> <span class="main">=</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">∑</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> A
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">*</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summable_imp_convergent_sum_upto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="free">f</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> real_normed_vector<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum_upto <span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_Suc_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> summable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sums_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.atLeast1_atMost_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atLeastSucAtMost_greaterThanAtMost<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum <span class="free">f</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">)</span> <span class="main">⤏</span> <span class="skolem">c</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_nat_sequentially<span class="main"><span class="main">]</span></span> filterlim_floor_sequentially<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum <span class="free">f</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Hyperbola method›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyperbola_method_semiring<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> sum_upto <span class="free">f</span> <span class="free">A</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="free">B</span> <span class="main">=</span> 
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="main">+</span>
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">&gt;</span> <span class="free">A</span> <span class="main">*</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="free">A</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> *<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> nat_mult_leD1<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">a</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">a</span> <span class="main">*</span> real <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span> <span class="main">≤</span> real <span class="skolem">a</span> <span class="main">*</span> real <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> nat_mult_leD2<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">a</span> <span class="main">*</span> real <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> nat_mult_leD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> le_sqrt_mult_imp_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="free">A</span> <span class="main">*</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> sum_upto <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> sum_upto <span class="free">g</span>"</span></span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bound</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> real <span class="bound">r</span> <span class="main">≤</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">r</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> real <span class="bound">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SIGMA</span> <span class="bound">r</span><span class="main">:</span><span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> real <span class="bound">r</span> <span class="main">≤</span> <span class="free">A</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">r</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SIGMA</span> <span class="bound">d</span><span class="main">:</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">B</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> real <span class="bound">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> <span class="skolem">F</span> <span class="free">A</span> <span class="main">*</span> <span class="skolem">G</span> <span class="free">B</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">i</span><span class="main">:</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> 
          sum_upto <span class="free">f</span> <span class="free">A</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="free">B</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S</span> <span class="main">+</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def dirichlet_prod_altdef2 F_def G_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_divisors_nat'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span><span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="main">_</span> <span class="var">?A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">r</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">r</span></span></span><span class="main"><span class="main"><span class="main">*</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">r</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">snd</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">∪</span> <span class="var">?C</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="free">A</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="free">B</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">r</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> real <span class="bound">r</span> <span class="main">≤</span> <span class="free">A</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_product<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> real <span class="bound">r</span> <span class="main">≤</span> <span class="free">A</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">B</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="main">_</span> <span class="var">?X</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cartesian_product<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">∩</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> le_sqrt_mult_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?B</span> <span class="main">∪</span> <span class="var">?C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?B</span> <span class="main">∩</span> <span class="var">?C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.union_inter finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?B</span></span></span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?Bound</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?C</span></span></span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?Bound</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> le_nat_iff le_floor_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nat_mult_leD1 nat_mult_leD2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?B'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> sum <span class="bound">f</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> sum <span class="bound">f</span> <span class="var">?B'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?B'</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">G</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left G_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="var">?C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">∈</span><span class="var">?C'</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">F</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_right F_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> F_def G_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyperbola_method_semiring_sqrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> sum_upto <span class="free">f</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">+</span>
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms hyperbola_method_semiring<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sqrt <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> hyperbola_method<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="main">+</span>
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="free">B</span> <span class="main">-</span>
             sum_upto <span class="free">f</span> <span class="free">A</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hyperbola_method_semiring<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hyperbola_method_sqrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">+</span>
             sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">-</span>
             sum_upto <span class="free">f</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms hyperbola_method<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sqrt <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Partial_Summation">
<div class="head">
<h1>Theory Partial_Summation</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Partial_Summation.thy
    Author:    Manuel Eberl, TU München
    
    The partial summation rule as given by Apostol in "Introduction to Analytic Number Theory"
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Partial summation›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Partial_Summation
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span>
    <a href="Arithmetic_Summatory.html">Arithmetic_Summatory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_vimage_real_of_nat_greaterThanAtMost<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>real <span class="main">-`</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="main">-`</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>nat <span class="main">⌊</span><span class="free">y</span><span class="main">⌋</span><span class="main">..</span>nat <span class="main">⌈</span><span class="free">x</span><span class="main">⌉</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_le_iff le_nat_iff le_ceiling_iff floor_le_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> real_normed_algebra<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≡</span> sum_upto <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="main">-</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_f<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partial_summation_strong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
       <span class="main">(</span><span class="free">A</span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">A</span> <span class="free">y</span> <span class="main">*</span> <span class="free">f</span> <span class="free">y</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">∈</span> real <span class="main">-`</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">chi</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">chi</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">t</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">chi</span> <span class="bound">n</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
          <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span>max <span class="bound">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="keyword1">has_integral</span> <span class="var">?I</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_sum ballI finite_Nats_le_real<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy 1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus_strong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> continuous_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cont_f<span class="main"><span class="main">]</span></span> deriv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> 
                  <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> 
                     <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_on_superset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">chi</span> <span class="skolem">n</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> chi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_mult_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="var">?I</span><span class="main">)</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def A_def chi_def sum_distrib_right <span class="keyword1"><span class="command">using</span></span> xy
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_cong sum.mono_neutral_cong_right finite_Nats_le_real<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span>max <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
               <span class="free">A</span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span>  <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>max <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def ring_distribs sum_subtractf sum_distrib_right A_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> real <span class="main">-`</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>max <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">y</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>max <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">∈</span> real <span class="main">-`</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>max <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S1</span> <span class="main">+</span> <span class="var">?S2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.union_disjoint finite_Nats_le_real finite_vimage_real_of_nat_greaterThanAtMost<span class="main">)</span> 
       <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S1</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="free">y</span> <span class="main">*</span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def sum_upto_def sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">∈</span> real <span class="main">-`</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partial_summation_integrable_strong<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> partial_summation_strong'<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span>real <span class="main">-`</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> 
            <span class="free">A</span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">A</span> <span class="free">y</span> <span class="main">*</span> <span class="free">f</span> <span class="free">y</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> partial_summation_strong <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> real_normed_algebra<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≡</span> sum_upto <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="main">-</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_f<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partial_summation_sum_upto_strong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">A</span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span>real <span class="main">-`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> partial_summation_strong<span class="main">[</span><span class="operator">OF</span> fin order.refl x deriv cont_f<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partial_summation_integrable_sum_upto_strong<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> partial_summation_sum_upto_strong'<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
            <span class="free">A</span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> partial_summation_sum_upto_strong <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Euler_Products">
<div class="head">
<h1>Theory Euler_Products</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Euler_Products.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Euler product expansions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Euler_Products
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span>
  <a href="Multiplicative_Function.html">Multiplicative_Function</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_factors_power_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> prime_factors <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prime_power_product_in_Pi<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">g</span> <span class="bound">p</span><span class="main">)</span>
    <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> UNIV<span class="main">)</span> <span class="main">→</span>
       <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">f</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> prime_factors <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="skolem">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factors_prod<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> prime_factors <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_factors_power_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd prime_gt_0_nat <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_prime_power<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">^</span> snd <span class="bound">x</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> prime <span class="bound">a</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">m</span> <span class="skolem">q</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prime_power_eq_imp_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> 1 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_prime_powers<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">g</span> <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> UNIV<span class="main">)</span>
     <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">m</span></span> <span class="bound"><span class="bound">p</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">p</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">n</span></span> <span class="main"><span class="main">∧</span></span> prime <span class="bound"><span class="bound">p</span></span> <span class="keyword1"><span class="keyword1">then</span></span> multiplicity <span class="bound"><span class="bound">p</span></span> <span class="bound"><span class="bound">m</span></span> <span class="keyword1"><span class="keyword1">else</span></span> undefined<span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
         <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_power_product_in_Pi<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="skolem">q</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">q</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> multiplicity <span class="skolem">q</span> <span class="main">(</span><span class="bound">x</span> <span class="main">^</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_prod_distrib<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="skolem">q</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> multiplicity_distinct_prime_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> 3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">p</span> <span class="keyword1">then</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span> <span class="keyword1">else</span> undefined<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">m</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.mono_neutral_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>prime_factors <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> 4<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_factorization_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_field<span class="main">,</span>banach<span class="main">,</span>second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   abs_convergent_euler_product<span class="main">:</span>
            <span class="quoted"><span class="quoted">"abs_convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   euler_product_LIMSEQ<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> summable'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">abs_summable_on</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_summable_on_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">UNIV</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> summable<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> summable''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> abs_summable_on_reindex_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> summable'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?h</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_sandwich<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually allI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">interpret</span></span> product_sigma_finite <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span>nat<span class="main">.</span> count_space <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> product_sigma_finite.intro sigma_finite_measure_count_space<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">.</span> <span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl infsetsum_nat' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> summable''<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> UNIV<span class="main">.</span>
                         <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">^</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_prod_PiE <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat summable''<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> UNIV<span class="main">.</span>
                         <span class="free">f</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f.prod_coprime<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_coprime<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_reindex_bij_betw bij_betw_prime_powers<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_Diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> summable'<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat' summable'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">-</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> 
                   insert <span class="main">0</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span>prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="main">¬</span>prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong_neutral<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="main">¬</span>prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_infsetsum_bound<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="skolem">n</span><span class="main">&lt;..}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_mono_neutral_left summable' abs_summable_on_normI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> prime_factors <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">n</span><span class="main">&lt;..}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">m</span> <span class="main">&gt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> prime_factors <span class="skolem">m</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">&lt;..}</span> <span class="main">=</span> UNIV <span class="main">-</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span>UNIV<span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> summable <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_Diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span>UNIV<span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">using</span></span> summable 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">m</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suminf_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> refl summable_LIMSEQ' summable<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_norm_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tendsto_diff<span class="main">[</span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span>"</span></span><span class="main"><span class="main">]</span></span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> prime <span class="bound">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext prod.mono_neutral_cong_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_imp_abs_convergent_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_summable_on_reindex_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_prime_power<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_summable_on_Sigma_project1'<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong refl<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">=</span> UNIV <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">i</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_Diff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infsetsum_nat' summable''<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> norm <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"summable <span class="var">?T</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> norm <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_field<span class="main">,</span>banach<span class="main">,</span>second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   abs_convergent_euler_product'<span class="main">:</span>
            <span class="quoted"><span class="quoted">"abs_convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   completely_multiplicative_summable_norm<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   euler_product_LIMSEQ'<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> summable_reindex<span class="main">[</span><span class="operator">OF</span> summable this<span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f.power norm_power<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> summable_geometric_iff<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">note</span></span> * <span class="keyword2"><span class="keyword">and</span></span> this
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> summable' <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> suminf_geometric<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> f.power<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> abs_convergent_euler_product<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> f<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> euler_product_LIMSEQ<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> f<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq eq'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dirichlet_Series_Analysis">
<div class="head">
<h1>Theory Dirichlet_Series_Analysis</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Dirichlet_Series_Analysis.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Analytic properties of Dirichlet series›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_Series_Analysis
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Complex_Analysis/Complex_Analysis.html">HOL-Complex_Analysis.Complex_Analysis</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Going_To_Filter.html">HOL-Library.Going_To_Filter</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Real_Asymp/Real_Asymp.html">HOL-Real_Asymp.Real_Asymp</a>"</span>
  <a href="Dirichlet_Series.html">Dirichlet_Series</a>
  <a href="Moebius_Mu.html">Moebius_Mu</a>
  <a href="Partial_Summation.html">Partial_Summation</a>
  <a href="Euler_Products.html">Euler_Products</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO Move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> frequently_eventually_frequently<span class="main">:</span>
  <span class="quoted"><span class="quoted">"frequently <span class="free">P</span> <span class="free">F</span> <span class="main">⟹</span> eventually <span class="free">Q</span> <span class="free">F</span> <span class="main">⟹</span> frequently <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> frequently_rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> eventually_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following illustrates a concept we will need later on: A property holds for
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> going to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>F›</span></span></span></span> if we can find e.\,g.\ a sequence that tends to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>F›</span></span></span></span> and whose elements
  eventually satisfy <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> frequently_going_toI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"frequently <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">going_to</span> <span class="free">F</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> frequently_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">going_to</span> <span class="free">F</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>inf <span class="main">(</span>filtercomap <span class="free">f</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>principal <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> going_to_within_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>inf <span class="main">(</span>filtercomap <span class="free">f</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>principal <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> filterlim_inf filterlim_principal
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_iff_le_filtercomap filtercomap_filtercomap<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> frequently_filtercomapI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"frequently <span class="free">P</span> <span class="main">(</span>filtercomap <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> frequently_going_toI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted">UNIV</span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> going_to_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> frequently_going_to_at_topE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"frequently <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top sequentially"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> real <span class="bound">k</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> frequently_def eventually_going_to_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≥</span> real <span class="bound">k</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≥</span> real <span class="bound">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_at_top_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Apostol often uses statements like `$P(s_k)$ for all $k$ in an infinite sequence
  $s_k$ such that $\mathfrak{R}(s_k)\longrightarrow\infty$ as $k\to\infty$'.

  Instead, we write <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"frequently <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">(</span></span>Re <span class="keyword1"><span class="keyword1">going_to</span></span> at_top<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This lemma shows that
  our statement is equivalent to his.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> frequently_going_to_at_top_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"frequently <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">going_to</span> <span class="main">(</span>at_top <span class="main">::</span> real filter<span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top sequentially<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> frequently_going_toI <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> frequently_going_to_at_topE<span class="main">)</span>
<span class="comment1">(* END TODO *)</span>

<span class="keyword1"><span class="command">lemma</span></span> surj_bullet_1<span class="main">:</span> <span class="quoted"><span class="quoted">"surj <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>real_normed_algebra_1<span class="main">,</span> real_inner<span class="main">}</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> surjI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dot_square_norm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> bullet_1_going_to_at_top_neq_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>real_normed_algebra_1<span class="main">,</span> real_inner<span class="main">}</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> going_to_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filtercomap_neq_bot_surj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ surj_bullet_1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>



<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def abs_summable_on_nat_iff
           <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> summable_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_altdef'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_abs_converges_altdef<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> abs_summable_on_cong_neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_altdef 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong_neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def fds_abs_converges_altdef
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiplicative_function_divide_nat_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">/</span> nat_power <span class="main">0</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">/</span> nat_power <span class="main">1</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span> <span class="main">/</span> nat_power <span class="skolem">a</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span> <span class="main">/</span> nat_power <span class="skolem">b</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f.mult_coprime nat_power_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_function_divide_nat_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">/</span> nat_power <span class="main">0</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span> <span class="main">/</span> nat_power <span class="skolem">a</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span> <span class="main">/</span> nat_power <span class="skolem">b</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f.mult nat_power_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Convergence and absolute convergence›</span></span>

<span class="keyword1"><span class="command">class</span></span> nat_power_normed_field <span class="main">=</span> nat_power_field <span class="main">+</span> real_normed_field <span class="main">+</span> real_inner <span class="main">+</span> real_algebra_1 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">real_power</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> real_power_nat_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">real_power</span> <span class="main">(</span>real <span class="free">n</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> nat_power <span class="free">n</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> real_power_1_right_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">real_power</span> <span class="free">d</span> <span class="main">1</span> <span class="main">=</span> <span class="free">d</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> real_power_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">real_power</span> <span class="free">d</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">real_power</span> <span class="free">d</span> <span class="free">a</span> <span class="main">*</span> <span class="free">real_power</span> <span class="free">d</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> real_power_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">real_power</span> <span class="free">d</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> norm_real_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">real_power</span> <span class="free">x</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">c</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nat_power_of_real_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_power <span class="free">n</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has_field_derivative_nat_power_aux<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="keyword1">LIM</span> <span class="bound">y</span> inf_class.inf
              <span class="main">(</span>Inf <span class="main">(</span>principal <span class="main">`</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>principal <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                <span class="main">(</span>nat_power <span class="free">n</span> <span class="bound">y</span> <span class="main">-</span> nat_power <span class="free">n</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="free">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> nat_power <span class="free">n</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span>
                norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> Inf <span class="main">(</span>principal <span class="main">`</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has_vector_derivative_real_power_aux<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">real_power</span> <span class="bound">y</span> <span class="free">c</span> <span class="main">-</span> <span class="free">real_power</span> <span class="free">x</span> <span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span>
               <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">real_power</span> <span class="free">x</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span>
               norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">S</span><span class="main">∈</span><span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">.</span> principal <span class="bound">S</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> norm_nat_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> norm <span class="main">(</span>nat_power <span class="free">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">y</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_power_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> real_power <span class="free">d</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> real_power <span class="free">d</span> <span class="free">a</span> <span class="main">/</span> real_power <span class="free">d</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_power_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_power_1_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> real_power <span class="free">d</span> <span class="main">1</span> <span class="main">=</span> of_real <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_power_1_right_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> has_vector_derivative_real_power <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> real_power <span class="bound">y</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">c</span> <span class="main">*</span> real_power <span class="free">x</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_at_within<span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> has_vector_derivative_real_power_aux<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def
                nhds_def bounded_linear_scaleR_left<span class="main">)</span>
              
<span class="keyword1"><span class="command">lemma</span></span> has_field_derivative_nat_power <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> nat_power <span class="free">n</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> ln <span class="main">(</span>real <span class="free">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> nat_power <span class="free">n</span> <span class="free">x</span><span class="main">)</span>
     <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> nat_power_normed_field<span class="main">)</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_at_within<span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> has_field_derivative_nat_power_aux<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> has_field_derivative_def has_derivative_def netlimit_at<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nhds_def at_within_def bounded_linear_mult_right<span class="main">)</span>
              
<span class="keyword1"><span class="command">lemma</span></span> continuous_on_real_power <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">⟹</span> continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_vector_derivative has_vector_derivative_real_power<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">instantiation</span></span> real <span class="main">::</span> <span class="quoted">nat_power_normed_field</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">real_power_real</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">real_power_real</span> <span class="main">=</span> <span class="keyword1">(powr)</span>"</span></span>
  
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat_power <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> nat_power <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_def netlimit_at has_derivative_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nhds_def at_within_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">x</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> real_power <span class="bound">y</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">c</span> <span class="main">*</span> real_power <span class="skolem">x</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span>
             <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def nhds_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_add<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> complex <span class="main">::</span> <span class="quoted">nat_power_normed_field</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">nat_power_complex</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nat_power_complex</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> of_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">real_power_complex</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">real_power_complex</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nat_power <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> nat_power <span class="skolem">m</span> <span class="skolem">z</span> <span class="main">*</span> nat_power <span class="skolem">n</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nat_power_complex_def of_nat_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_times_real<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>nat_power <span class="skolem">n</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nat_power_complex_def
    <span class="keyword1"><span class="command">using</span></span> norm_powr_real_powr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat_power <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> nat_power <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def scaleR_conv_of_real mult_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">y</span> inf_class.inf <span class="main">(</span>Inf <span class="main">(</span>principal <span class="main">`</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>principal <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">(</span>nat_power <span class="skolem">n</span> <span class="bound">y</span> <span class="main">-</span> nat_power <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> nat_power <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span>
           cmod <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">:&gt;</span> <span class="main">(</span>Inf <span class="main">(</span>principal <span class="main">`</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_def netlimit_at has_derivative_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nhds_def at_within_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> real_power <span class="bound">y</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">c</span> <span class="main">*</span> real_power <span class="skolem">x</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> has_vector_derivative_real_field<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">y</span> <span class="keyword1">at</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">(</span>real_power <span class="bound">y</span> <span class="skolem">c</span> <span class="main">-</span> real_power <span class="skolem">x</span> <span class="skolem">c</span> <span class="main">-</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> real_power <span class="skolem">x</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span>
           norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">:&gt;</span> <span class="keyword1">INF</span> <span class="bound">S</span><span class="main">∈</span><span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">.</span> principal <span class="bound">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def nhds_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat_power <span class="skolem">n</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_Reals_eq scaleR_conv_of_real<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def exp_add exp_of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real
          <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Ln_of_nat<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nat_power_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nat_power <span class="free">n</span> <span class="main">(</span>of_real <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> nat_power_normed_field<span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>real <span class="free">n</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_power_of_real_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_of_real <span class="free">f</span><span class="main">)</span> 
     <span class="main">(</span>of_real <span class="free">s</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_normed_field<span class="main">,</span>banach<span class="main">}</span><span class="main">)</span> <span class="main">⟷</span> fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> summable_Suc_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_of_real <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="free">s</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_normed_field<span class="main">,</span>banach<span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
             of_real <span class="main">(</span>eval_fds <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_converges_def suminf_of_real<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_summable_zeta_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges fds_zeta <span class="free">s</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges fds_zeta <span class="free">s</span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong always_eventually<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide fds_nth_zeta powr_minus norm_nat_power <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_real_powr_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_summable_zeta<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> nat_power_normed_field<span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> fds_abs_converges fds_zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_moebius_mu<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span>nat_power_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> abs_moebius_mu_le norm_nat_power norm_divide
                   moebius_mu_def norm_power<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_real_powr_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conv_abscissa</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span>banach<span class="main">,</span>real_normed_field<span class="main">,</span> real_inner<span class="main">}</span> fds <span class="main">⇒</span> ereal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">conv_abscissa</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="bound">s</span><span class="main">.</span> fds_converges <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span><span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">abs_conv_abscissa</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span>banach<span class="main">,</span>real_normed_field<span class="main">,</span> real_inner<span class="main">}</span> fds <span class="main">⇒</span> ereal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">abs_conv_abscissa</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="bound">s</span><span class="main">.</span> fds_abs_converges <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span><span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> fds_converges <span class="free">g</span> <span class="bound">s</span> <span class="main">⟹</span> fds_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> conv_abscissa <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conv_abscissa_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> fds_abs_converges <span class="free">g</span> <span class="bound">s</span> <span class="main">⟹</span> fds_abs_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> abs_conv_abscissa_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">class</span></span> dirichlet_series <span class="main">=</span> euclidean_space <span class="main">+</span> real_normed_field <span class="main">+</span> nat_power_normed_field <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_in_Basis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> Basis"</span></span>
    
<span class="keyword1"><span class="command">instance</span></span> real <span class="main">::</span> <span class="quoted">dirichlet_series</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">instance</span></span> complex <span class="main">::</span> <span class="quoted">dirichlet_series</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Basis_complex_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">SORT_CONSTRAINT</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> dirichlet_series<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_Re_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">z'</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">z'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">z'</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power <span class="dynamic"><span class="dynamic">divide_simps</span></span> powr_mono mult_left_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="skolem">s0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s0</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> INF_less_iff abs_conv_abscissa_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fds_abs_converges_Re_le<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_diverges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&lt;</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs_conv_abscissa_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> INF_lower<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> uniformly_Cauchy_eval_fds_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"Bseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"compact <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniformly_Cauchy_on <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniformly_Cauchy_onI'<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ε</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> Inf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> σ_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">σ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
      <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cInf_lower bounded_inner_imp_bdd_below compact_imp_bounded B<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">using</span></span> B <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_contains_Inf bounded_inner_imp_bdd_below compact_imp_bounded B 
            compact_imp_closed compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> B<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> σ_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="main">-</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compact_imp_bounded<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">norm_B_aux</span></span> <span class="keyword2"><span class="keyword">where</span></span> norm_B_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> norm <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">norm_B_aux</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">norm_B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">norm_B</span> <span class="main">=</span> <span class="skolem">norm_B_aux</span> <span class="main">+</span> norm <span class="free">s0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> norm_B_aux <span class="keyword1"><span class="command">have</span></span> norm_B<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">s0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">norm_B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
      <span class="keyword1"><span class="command">using</span></span> norm_triangle_ineq4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="free">s0</span></span><span class="main">]</span> norm_B_aux<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_B_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">norm_B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>›</span></span> imageE norm_ge_zero order.trans<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> bounded <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_aux</span></span> <span class="keyword2"><span class="keyword">where</span></span> C_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C_aux</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bseq_def<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> max <span class="skolem">C_aux</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> C_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">A</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A_def sum_upto_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> <span class="skolem">C_aux</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">norm_B</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> real <span class="bound">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">δ</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ_def <span class="keyword1"><span class="command">using</span></span> σ_gt
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_neg_powr filterlim_real_sequentially<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> order_tendstoD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≥</span> <span class="skolem">M</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">norm_B</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> real <span class="bound">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
      
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"max <span class="skolem"><span class="skolem">M</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> ballI allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="skolem">m</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>
              dist <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="skolem">m</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">-</span><span class="main">{..</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Groups_Big.sum_diff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> real <span class="main">-`</span> <span class="main">{</span>real <span class="skolem">m</span><span class="main">&lt;..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> 
                   <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span> <span class="main">*</span> real_power <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_diff real_power_nat_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> real_power <span class="bound">t</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                    <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> real_power <span class="skolem">n</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> real_power <span class="skolem">m</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span> <span class="var">?S</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?h</span> <span class="keyword1">has_integral</span> <span class="main">_</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> mn
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> partial_summation_strong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> nat_power <span class="skolem">n</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span>
                    integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="var">?h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff real_power_nat_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> nat_power <span class="skolem">n</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span>integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="var">?h</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> norm_triangle_ineq4<span class="main"><span class="main">]</span></span> add_right_mono order.refl<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> nat_power <span class="skolem">n</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mn <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> C_pos s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_nat_power <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_mono C powr_mono2'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_nat_power <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_mono C<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="var">?h</span><span class="main">)</span> <span class="main">≤</span> 
                   integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integral_norm_bound_integral ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">from</span></span> mn <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_mult <span class="keyword1"><span class="command">using</span></span> C_pos mn 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono C<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_real_power dot_square_norm <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> dot_square_norm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
                     <span class="main">(</span>real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> 
                      real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> 
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?l</span> <span class="keyword1">has_integral</span> <span class="var">?I</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> mn s
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> 
                   <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> inner_diff_left<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="var">?l</span> <span class="main">=</span> <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span>real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s mn
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> inner_diff_left<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">s0</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> inner_diff_left<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">s0</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn s
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono divide_nonneg_pos<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_diff_left<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="var">?l</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
               <span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">s0</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> C_pos mn
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono mult_nonneg_nonneg integral_nonneg
              integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span>
                   <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">s0</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">s0</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> norm_minus_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> nat_power <span class="skolem">m</span> <span class="main">(</span><span class="main">-</span><span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">norm_B</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> C_pos s mn σ_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> σ_gt <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">norm_B</span>›</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> nat_power_real_def δ_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono powr_mono frac_le add_mono norm_B<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_diff_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">norm_B</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uniformly_Cauchy_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uniformly_convergent_eval_fds_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Bseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="main">(</span><span class="free">s0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"compact <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cauchy_uniformly_convergent uniformly_Cauchy_eval_fds_aux assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uniformly_convergent_eval_fds_aux'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="main">(</span><span class="free">s0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"compact <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniformly_convergent_eval_fds_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> conv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def summable_iff_convergent'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Bseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convergent_imp_Bseq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bounded_partial_sums_imp_fps_converges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Bseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> uniformly_convergent_eval_fds_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_converges_def summable_iff_convergent'
             <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> uniformly_convergent_imp_convergent<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fds_converges_Re_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="main">(</span><span class="free">s0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniformly_convergent_eval_fds_aux' assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"uniform_limit <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span> <span class="skolem">l</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uniformly_convergent_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tendsto_uniform_limitI<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="skolem">l</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sums_def'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0AtMost<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def sums_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="skolem">s0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s0</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> INF_less_iff conv_abscissa_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fds_converges_Re_le<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_diverges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&lt;</span> conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conv_abscissa_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> INF_lower<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fds_converges_imp_abs_converges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="free">s'</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_real_powr_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_diff_left<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_LIMSEQ_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tendsto_norm<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_tendstoD<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
          real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="free">s'</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span>
              norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s'</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power inner_diff_left powr_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s'</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono elim<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="free">s'</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> inner_diff_left powr_diff<span class="main">)</span> 
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_le_abs_conv_abscissa<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conv_abscissa_def abs_conv_abscissa_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> INF_superset_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_PInf_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">¬</span>fds_converges <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conv_abscissa_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Inf_eq_PInfty<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_PInfI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">¬</span>fds_converges <span class="free">f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> conv_abscissa_PInf_iff<span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_MInf_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fds_converges <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fds_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> spec<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">B</span>"</span></span><span class="main">]</span> fds_diverges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ereal_bot<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_MInfI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> fds_converges <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span> fds<span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> conv_abscissa_MInf_iff<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_PInf_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">¬</span>fds_abs_converges <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> abs_conv_abscissa_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Inf_eq_PInfty<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_PInfI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">¬</span>fds_converges <span class="free">f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> abs_conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_conv_abscissa_PInf_iff<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_MInf_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fds_abs_converges <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fds_abs_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> spec<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">B</span>"</span></span><span class="main">]</span> fds_abs_diverges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ereal_bot<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_abs_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_MInfI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> fds_abs_converges <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span> fds<span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> abs_conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_conv_abscissa_MInf_iff<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_geI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c'</span><span class="main">.</span> ereal <span class="bound">c'</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">c'</span> <span class="main">∧</span> <span class="main">¬</span>fds_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">≥</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>conv_abscissa <span class="free">f</span> <span class="main">≥</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> ereal <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>fds_converges <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> fds_converges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_leI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c'</span><span class="main">.</span> ereal <span class="bound">c'</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">c'</span> <span class="main">∧</span> fds_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> ereal <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">&lt;</span> conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> fds_diverges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_geI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c'</span><span class="main">.</span> ereal <span class="bound">c'</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">c'</span> <span class="main">∧</span> <span class="main">¬</span>fds_abs_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">≥</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>abs_conv_abscissa <span class="free">f</span> <span class="main">≥</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> ereal <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>fds_abs_converges <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> fds_abs_converges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_leI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c'</span><span class="main">.</span> ereal <span class="bound">c'</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">c'</span> <span class="main">∧</span> fds_abs_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> ereal <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">&lt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> fds_abs_diverges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_leI_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> ereal <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">d</span> <span class="main">⟹</span> fds_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conv_abscissa_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> ereal <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∧</span> fds_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_leI_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> ereal <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">d</span> <span class="main">⟹</span> fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> ereal <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∧</span> fds_abs_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_truncate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conv_abscissa_MInf_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_truncate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_truncate <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_MInf_iff<span class="main">)</span>

  
<span class="keyword1"><span class="command">theorem</span></span> abs_conv_le_conv_abscissa_plus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="main">≤</span> conv_abscissa <span class="free">f</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> ereal <span class="skolem">c</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="keyword1">then</span> <span class="skolem">c</span> <span class="main">-</span> <span class="numeral">2</span>
                     <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> real_of_ereal <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> less <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> ereal <span class="skolem">c'</span> <span class="main">∧</span> <span class="skolem">c'</span> <span class="main">&lt;</span> <span class="skolem">c</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c'_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> c' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">c'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_diff_left dot_square_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_converges_imp_abs_converges<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> c'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> fds_abs_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> uniformly_convergent_eval_fds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"compact <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> Inf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> σ_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">σ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">using</span></span> that 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cInf_lower bounded_inner_imp_bdd_below compact_imp_bounded B<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">using</span></span> B <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_contains_Inf bounded_inner_imp_bdd_below compact_imp_bounded B 
          compact_imp_closed compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> B<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> σ_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="keyword1">then</span> <span class="skolem">σ</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> 
                         <span class="main">(</span><span class="skolem">σ</span> <span class="main">+</span> real_of_ereal <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> σ_gt <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="quoted"><span class="quoted">‹compact <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> uniformly_convergent_eval_fds_aux'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> fds_converges<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> σ_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">corollary</span></span> uniformly_convergent_eval_fds'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"compact <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> uniformly_convergent_eval_fds<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"uniform_limit <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span> <span class="skolem">l</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uniformly_convergent_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">≤</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> 
                <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span>Suc <span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lessThan_Suc_atMost<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniform_limit <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="bound">N</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span> <span class="skolem">l</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> uniform_limit_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> eventually_sequentially_Suc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uniformly_convergent_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Derivative of a Dirichlet series›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_deriv_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="main">(</span><span class="free">s0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cauchy <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> fds_nth <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> CauchyI'<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ε</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ'</span> <span class="main">=</span> <span class="skolem">δ</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> gt <span class="keyword1"><span class="command">have</span></span> δ_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ_def<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def summable_iff_convergent'<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Bseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convergent_imp_Bseq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C_aux</span></span> <span class="keyword2"><span class="keyword">where</span></span> C_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C_aux</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bseq_def<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> max <span class="skolem">C_aux</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> C_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">A</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A_def sum_upto_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> <span class="skolem">C_aux</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span>"</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">C'</span> <span class="main">*</span> real <span class="bound">m</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">δ'</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ'_def <span class="keyword1"><span class="command">using</span></span> gt δ_pos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_neg_powr filterlim_real_sequentially<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> order_tendstoD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      M1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≥</span> <span class="skolem">M1</span> <span class="main">⟹</span> <span class="skolem">C'</span> <span class="main">*</span> real <span class="bound">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ'</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">δ'</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> δ_pos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lim_ln_over_power<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> order_tendstoD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this zero_less_one<span class="main">]</span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="skolem">δ'</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M2</span></span> <span class="keyword2"><span class="keyword">where</span></span> M2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">M2</span> <span class="main">⟹</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="skolem">δ'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">-</span>ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> fds_nth <span class="free">f</span> <span class="bound">k</span>"</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"max <span class="main"><span class="main">(</span></span>max <span class="skolem"><span class="skolem">M1</span></span> <span class="skolem"><span class="skolem">M2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> real_power <span class="bound">t</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>            
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> real_power <span class="bound">t</span> <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">norm_g'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">norm_g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">norm_g</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">norm_g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">δ</span> <span class="main">*</span> ln <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g_g'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">g'</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> 
        <span class="keyword1"><span class="command">using</span></span> mn that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def g'_def real_power_diff <span class="dynamic"><span class="dynamic">field_simps</span></span> real_power_add 
                               <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>real <span class="main">-`</span> <span class="main">{</span>real <span class="skolem">m</span><span class="main">&lt;..</span>real <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">m</span><span class="main">.</span> <span class="var">?f'</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="var">?f'</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              norm <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_diff<span class="main">)</span> 
           <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_minus_commute sum_negf scaleR_conv_of_real mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{..</span><span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> real <span class="main">-`</span> <span class="main">{</span>real <span class="skolem">m</span><span class="main">&lt;..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="free">s0</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">unfolding</span></span> g_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_power_nat_power <span class="dynamic"><span class="dynamic">field_simps</span></span> nat_power_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">g'</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                    <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">m</span> <span class="main">-</span> <span class="var">?S</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?h</span> <span class="keyword1">has_integral</span> <span class="main">_</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> mn
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> partial_summation_strong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> g_g' <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">m</span> <span class="main">-</span> integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="var">?h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">+</span> 
                             norm <span class="main">(</span>integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="var">?h</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> norm_triangle_ineq4<span class="main"><span class="main">]</span></span> add_right_mono order.refl<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> norm_mult <span class="keyword1"><span class="command">using</span></span> mn C_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono C<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="skolem">δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn M2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def norm_real_power norm_mult δ_def inner_diff_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ'_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">A</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">g</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> norm_mult <span class="keyword1"><span class="command">using</span></span> mn C_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono C<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">g</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span> <span class="main">*</span> <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="skolem">δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn M2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def norm_real_power norm_mult δ_def inner_diff_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ'_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">*</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ'</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> δ_pos mn C_pos
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono powr_mono2'<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="var">?h</span><span class="main">)</span> <span class="main">≤</span> integral <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">norm_g'</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integral_norm_bound_integral ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">from</span></span> mn <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_g'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">norm_g'</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def norm_g'_def <span class="keyword1"><span class="command">using</span></span> 3 mn
          <span class="keyword1"><span class="command">unfolding</span></span> norm_mult
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> norm_triangle_ineq<span class="main"><span class="main">]</span></span><span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_real_power inner_diff_left dot_square_norm norm_mult δ_def
                   <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_mult <span class="keyword1"><span class="command">using</span></span> C_pos mn 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono C<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">*</span> integral <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">norm_g'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> norm_g'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_g'_def δ_def inner_diff_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">norm_g'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">norm_g</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">norm_g</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> norm_g'_def norm_g_def power2_eq_square <span class="keyword1"><span class="command">using</span></span> mn δ_pos
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 
                 <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">norm_g'</span> <span class="main">=</span> <span class="skolem">norm_g</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">norm_g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">norm_g</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_g_def <span class="keyword1"><span class="command">using</span></span> δ_pos mn
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_nonpos_pos mult_nonpos_nonneg add_nonneg_nonneg mult_nonneg_nonneg<span class="main">)</span>
             <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">norm_g</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">norm_g</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="main">-</span><span class="skolem">norm_g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span> <span class="main">+</span>
                        real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> δ_pos
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> norm_g_def power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="skolem">δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> δ'_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span> <span class="main">≤</span>
                          <span class="main">…</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> δ_pos
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">≤</span>
                     real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ'</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn δ_pos
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono powr_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ'</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span>
                     real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ'</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> δ_pos
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span>real <span class="skolem">m</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="skolem">norm_g'</span> <span class="main">≤</span>
                        real <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ'</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">*</span> <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">δ'</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">s0</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">=</span>
                   <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">m</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> C'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> C_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> Cauchy_convergent<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_iff_convergent' fds_converges_def fds_nth_deriv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   fds_converges_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   has_field_derivative_eval_fds <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="free">f</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="keyword1">then</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">else</span>
             <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">+</span> real_of_ereal <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="keyword1">then</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span>
             <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">+</span> real_of_ereal <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> <span class="skolem">s1</span> <span class="main">∧</span> <span class="skolem">s1</span> <span class="main">&lt;</span> <span class="skolem">s2</span> <span class="main">∧</span> <span class="skolem">s2</span> <span class="main">&lt;</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s1_def s2_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">s1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_converges_deriv_aux<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">s2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_converges_deriv_aux<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> δ_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="main">(</span>cball <span class="free">s</span> <span class="skolem">δ</span><span class="main">)</span> 
          <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> uniformly_convergent_eval_fds_aux'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s''</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> s''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> cball <span class="free">s</span> <span class="skolem">δ</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s''</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> dist <span class="free">s</span> <span class="skolem">s''</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Euclidean_dist_upper<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_in_Basis<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">(</span>of_real <span class="skolem">s2</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">∙</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> δ_def dist_real_def abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> δ_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
     <span class="quoted"><span class="quoted">"uniform_limit <span class="main">(</span>cball <span class="free">s</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">l</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uniformly_convergent_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span>Suc <span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lessThan_Suc_atMost<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniform_limit <span class="main">(</span>cball <span class="free">s</span> <span class="skolem">δ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="bound">s</span><span class="main">)</span> 
                  <span class="skolem">l</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uniform_limit_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> eventually_sequentially_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="main">(</span>cball <span class="free">s</span> <span class="skolem">δ</span><span class="main">)</span> 
              <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uniformly_convergent_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="free">f</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_series'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> cball <span class="free">s</span> <span class="skolem">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> interior <span class="main">(</span>cball <span class="free">s</span> <span class="skolem">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms fds_converges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span>
            fds_nth <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s'</span> <span class="keyword1">within</span> cball <span class="free">s</span> <span class="skolem">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_deriv <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_deriv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="free">f</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_at_within<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> has_field_derivative_eval_fds' <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> 
  DERIV_chain2<span class="main">[</span><span class="operator">OF</span> has_field_derivative_eval_fds<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_eval_fds <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>eval_fds <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_eval_fds DERIV_isCont assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_subset<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_eval_fds' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_compose3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_on_eval_fds <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="main">(</span>eval_fds <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_continuous_on <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_on_eval_fds' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> continuous_on_eval_fds assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_deriv_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conv_abscissa_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c'</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">c'</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span> <span class="main">∧</span> fds_converges <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">c'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_converges_deriv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
              norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword2"><span class="keyword">and</span></span> exp_le <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power fds_integral_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?s0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">real</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="var">?s0</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> real_of_ereal <span class="var">?s0</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">c</span> <span class="main">&gt;</span> <span class="var">?s0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> ε<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">&gt;</span> <span class="var">?s0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ε_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ε <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> at_top<span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="skolem">ε</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_tendstoD lim_ln_over_power <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> zero_less_one<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">≤</span> norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_integral <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="skolem">ε</span> <span class="main">*</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power <span class="dynamic"><span class="dynamic">field_simps</span></span> 
                          powr_diff inner_diff_left fds_integral_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> fds_abs_converges <span class="free">f</span> <span class="bound">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_ln<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
     abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def abs_conv_abscissa_integral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_deriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> 
          abs_conv_abscissa <span class="main">(</span>fds_integral <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_integral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_integral <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_integral_fds_deriv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_higher_deriv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_deriv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_higher_deriv_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_deriv_le<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_restrict<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_subseries <span class="free">P</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_deriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> deriv <span class="main">(</span>eval_fds <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_higher_deriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series<span class="main">)</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> conv_abscissa <span class="skolem">f</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems open_halfspace_gt<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="skolem">f</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_gt inner_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>fds_deriv <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> funpow_Suc_right<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="main">(</span>fds_deriv <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Suc.IH le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_deriv_le<span class="main"><span class="main">]</span></span> Suc.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deriv <span class="main">(</span>eval_fds <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cong_ev refl eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span> eval_fds_deriv<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="skolem">f</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> funpow_Suc_right<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication of two series›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> real_normed_field<span class="main">,</span> second_countable_topology<span class="main">,</span> nat_power<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   summable_dirichlet_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   suminf_dirichlet_prod<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> summable'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="skolem">A</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> abs_summable_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ subset_UNIV<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> summable<span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff'<span class="main">)</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">/</span> nat_power <span class="skolem">a</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">b</span> <span class="main">/</span> nat_power <span class="skolem">b</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              <span class="free">f</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">b</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_mult_distrib<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="skolem">x</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> nat_power <span class="skolem">x</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound"><span class="bound">m</span></span><span class="main">,</span><span class="bound"><span class="bound">n</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="skolem">x</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound"><span class="bound">m</span></span><span class="main">,</span><span class="bound"><span class="bound">n</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> finite_divisors_nat'<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef2 case_prod_unfold sum_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">m</span> <span class="main">/</span> nat_power <span class="bound">m</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV <span class="main">×</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> summable' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_product<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">m</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">m</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> 
                           <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span>UNIV<span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_summable_on_reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_on_def image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> 
                           <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span>UNIV<span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> summable''<span class="main">:</span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> abs_summable_on_Sigma_project1'<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> summable'''<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq abs_summable_on_nat_iff'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> summable' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infsetsum_nat'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">m</span> <span class="main">/</span> nat_power <span class="bound">m</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> summable' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_product <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong refl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span>UNIV<span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> 
                      <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infsetsum_reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_on_def image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span>UNIV<span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> 
                      <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">x</span><span class="main">.</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">/</span> nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> infsetsum <span class="var">?T</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> summable'' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_Sigma<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">/</span> nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> summable''' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat'<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   summable_dirichlet_prod_real<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   suminf_dirichlet_prod_real<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> dirichlet_prod <span class="free">f</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> summable_dirichlet_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> suminf_dirichlet_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_mult<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> summable_dirichlet_prod<span class="main">[</span><span class="operator">OF</span> _ _ assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fds_abs_converges_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_nth_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_power<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span> <span class="main">⟹</span> fds_abs_converges <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_prod<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> fds_abs_converges <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">⟹</span> fds_abs_converges <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_mult_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> 
      max <span class="main">(</span>abs_conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">(</span>abs_conv_abscissa <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">c'</span>"</span></span><span class="main"><span class="main">]</span></span> fds_abs_converges_mult <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_abs_converges<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_mult_leI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span>
   abs_conv_abscissa <span class="free">g</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_conv_abscissa_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_shift <span class="skolem">c</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&lt;</span> ereal <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">f</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">f</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_shift <span class="skolem">c</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_shift fds_abs_converges <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> fds_abs_converges <span class="main">(</span>fds_shift <span class="skolem">c</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">d</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"fds_shift <span class="free">c</span> <span class="free">f</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_shift <span class="free">c</span> <span class="free">f</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span>"</span></span><span class="main">)</span>
                  <span class="main">(</span><span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">*</span> eval_fds <span class="free">g</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> suminf_dirichlet_prod<span class="main">[</span><span class="operator">OF</span> _ _ assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fds_abs_converges_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def fds_nth_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_mult fds_abs_converges_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> fds_abs_converges <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> eval_fds <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fds_mult fds_abs_converges_prod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> inverse <span class="main">(</span>eval_fds <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>inverse <span class="free">f</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">*</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_mult assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">f</span> <span class="main">*</span> <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_left_inverse assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">1</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_integral_has_field_derivative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_integral<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> 
                  eval_fds <span class="main">(</span>fds_deriv <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_integral <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> holomorphic_fds_eval <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span><span class="main">}</span> <span class="main">⟹</span> eval_fds <span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> holomorphic_on_def field_differentiable_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ballI exI <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> analytic_fds_eval <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="keyword1">analytic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="keyword1">analytic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> analytic_on_open<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> analytic_on_subset<span class="main">[</span><span class="operator">OF</span> this assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conv_abscissa_MInf_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_MInf_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conv_abscissa_MInf_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_MInf_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_const <span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conv_abscissa_MInf_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_const <span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_MInf_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>numeral <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_fds<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>numeral <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_fds<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_power_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_conv_abscissa_mult_le<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_power_leI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_conv_abscissa_power_le<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_prod_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_mult_leI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_add_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">(</span>conv_abscissa <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_abscissa_leI_weak<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_converges_add <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_add_leI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> conv_abscissa <span class="free">g</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> 
     conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_abscissa_add_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_sum_leI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> conv_abscissa_add_leI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_add_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>abs_conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">(</span>abs_conv_abscissa <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI_weak<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_add <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_abs_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_add_leI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> abs_conv_abscissa <span class="free">g</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> 
     abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_conv_abscissa_add_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_sum_leI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_add_leI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_cmult_left <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_converges_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_def mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_cmult_right <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span><span class="free">f</span> <span class="main">*</span> fds_const <span class="free">c</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_converges_cmult_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_cmult_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">⟷</span> fds_converges <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_const <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_converges_cmult_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>inverse <span class="free">c</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">c</span> <span class="main">*</span> <span class="free">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_abscissa_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_cmult_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">*</span> fds_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_cmult<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_const <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
          abs_conv_abscissa <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_conv_abscissa_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_const <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>inverse <span class="free">c</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">c</span> <span class="main">*</span> <span class="free">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_const <span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> abs_conv_abscissa_mult_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"fds_const <span class="free"><span class="free">c</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_abscissa_cmult_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_conv_abscissa_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_diff_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">(</span>conv_abscissa <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_abscissa_add_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_diff_leI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> conv_abscissa <span class="free">g</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> 
     conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_abscissa_add_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_diff_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span>
     max <span class="main">(</span>abs_conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">(</span>abs_conv_abscissa <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_conv_abscissa_add_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_diff_leI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> abs_conv_abscissa <span class="free">g</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> 
     abs_conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_conv_abscissa_add_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> eval_fds_integral_has_field_derivative' <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> 
  DERIV_chain'<span class="main">[</span><span class="operator">OF</span> _ eval_fds_integral_has_field_derivative<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_completely_multiplicative_log_deriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="free">f</span> <span class="main">=</span> <span class="main">-</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> completely_multiplicative_fds_deriv'<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">/</span> <span class="free">f</span> <span class="main">=</span> <span class="main">-</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span> <span class="main">=</span> <span class="main">-</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">…</span> <span class="main">=</span> 
               abs_conv_abscissa <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> abs_conv_abscissa <span class="var">?f</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="var">?f</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_deriv<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span>nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="skolem">c</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_deriv_def fds_nth_fds' 
                      scaleR_conv_of_real powr_minus norm_mult norm_divide norm_nat_power<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span>
              norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span>
                 nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">≤</span> <span class="main">¦</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span>nat_power <span class="bound">n</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span>
                  nat_power <span class="skolem">n</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> mangoldt <span class="skolem">n</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds' norm_mult norm_divide 
                                   norm_nat_power abs_mult mangoldt_nonneg<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono divide_right_mono mangoldt_le<span class="main">)</span>
             <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mangoldt_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_nat_power <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniqueness›</span></span>
  
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">SORT_CONSTRAINT</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> dirichlet_series<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> norm_dirichlet_series_cutoff_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span><span class="free">s0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="free">N</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> fds_abs_converges_Re_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">s0</span></span> <span class="quoted"><span class="quoted">"of_real <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">(</span>of_real <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_ignore_initial_segment<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>nat"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fds_abs_converges_Re_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">s0</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_ignore_initial_segment<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_norm_cancel<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>
          <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_norm **<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">c</span> <span class="main">/</span> nat_power <span class="free">N</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_le * ** summable_divide allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">N</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> real <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono2<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> real <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span>
                    norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span> <span class="main">*</span> real <span class="free">N</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">N</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> 
            norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">c</span> <span class="main">/</span> nat_power <span class="free">N</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">N</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power <span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="free">N</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_zeroD_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">h</span> <span class="main">(</span><span class="free">s0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> freq<span class="main">:</span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">h</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">h</span> <span class="skolem">N</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> LeastI_ex<span class="main">[</span><span class="operator">OF</span> ex<span class="main">,</span> <span class="operator">folded</span> N_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> less_N<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">h</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> Least_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">,</span> <span class="operator">folded</span> N_def<span class="main">]</span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less<span class="main">)</span>
      
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">s0</span> <span class="main">∙</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">remainder</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">remainder</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">h</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span>
                         nat_power <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span> <span class="skolem">c</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">h</span> <span class="skolem">N</span> <span class="main">=</span> nat_power <span class="skolem">N</span> <span class="skolem">s</span> <span class="main">*</span> eval_fds <span class="free">h</span> <span class="skolem">s</span> <span class="main">-</span> nat_power <span class="skolem">N</span> <span class="skolem">s</span> <span class="main">*</span> <span class="skolem">remainder</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> conv <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword1"><span class="command">have</span></span> conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">h</span> <span class="skolem">s</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_abs_converges_Re_le<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> conv''<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">h</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> conv'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">h</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span> 
             <span class="main">(</span>eval_fds <span class="free">h</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span>Suc <span class="skolem">N</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_split_initial_segment<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span>Suc <span class="skolem">N</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span>Suc <span class="skolem">N</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">N</span> <span class="keyword1">then</span> fds_nth <span class="free">h</span> <span class="skolem">N</span> <span class="main">/</span> nat_power <span class="skolem">N</span> <span class="skolem">s</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_N<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_nth <span class="free">h</span> <span class="skolem">N</span> <span class="main">/</span> nat_power <span class="skolem">N</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.delta<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> remainder_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sums_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> remainder_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">remainder</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> norm_dirichlet_series_cutoff_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s0</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">N</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span></span></span><span class="main">,</span> <span class="operator">folded</span> remainder_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">remainder</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">h</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
           nat_power <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="skolem">N</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">unfolding</span></span> remainder_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> *<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def powr_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> freq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="bound">c</span> <span class="main">∧</span> eval_fds <span class="free">h</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> frequently_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_going_to_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> real <span class="bound">k</span> <span class="main">∧</span> eval_fds <span class="free">h</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">k</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> real <span class="bound">k</span> <span class="main">∧</span> eval_fds <span class="free">h</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> S_limit<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">k</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> at_top sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_at_top_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> S <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> real <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">c</span><span class="main">)</span> sequentially"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">h</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">≤</span> 
           <span class="main">(</span>real <span class="skolem">N</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">k</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">A</span><span class="main">)</span> sequentially"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="free">h</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">N</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">k</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>  norm <span class="main">(</span><span class="skolem">remainder</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="var">?X</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> S<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">k</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_nat_power c_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">remainder</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">k</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim S<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> remainder_bound<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono powr_divide <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span>real <span class="skolem">N</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">k</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ S_limit<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">real_asymp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_null_comparison<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">h</span> <span class="skolem">N</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_const_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fds_nth <span class="free">h</span> <span class="skolem">N</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_zeroD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">h</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> freq<span class="main">:</span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">h</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">∙</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_real_inner_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> of_real_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> conv <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="free">h</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">h</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_converges_imp_abs_converges<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2-<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eval_fds_zeroD_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_eqD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">g</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span>   <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="main">=</span> eval_fds <span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_diff_le<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">(</span>conv_abscissa <span class="free">g</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>conv_abscissa <span class="free">f</span><span class="main">)</span> <span class="main">(</span>conv_abscissa <span class="free">g</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">(* TODO: something like "frequently_elim" would be great here *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="main">=</span> eval_fds <span class="free">g</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> frequently_eventually_frequently<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> frequently_mono <span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fds_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_converges <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">-</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eval_fds_zeroD fds_abs_converges_diff assms * conv'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Limit at infinity›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_at_top_tail_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"ereal <span class="free">c</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span>eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>nat"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide norm_nat_power norm_powr_real_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> summable_c<span class="main">:</span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">note</span></span> c
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ereal <span class="free">c</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> summable_norm_cancel<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_def sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sums_split_initial_segment<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> norm <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_norm summable_ignore_initial_segment summable<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_le allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
            norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span> <span class="main">/</span> real <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff norm_divide norm_nat_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono divide_nonneg_pos powr_mono2 mult_pos_pos<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> summable_ignore_initial_segment summable summable_divide summable_c<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_divide summable_ignore_initial_segment summable_c<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">B</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def powr_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_eval_fds_Re_at_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_conv_le_conv_abscissa_plus_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> ereal <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="skolem">c</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>eval_fds <span class="free">f</span> <span class="skolem">s</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">using</span></span> eval_fds_at_top_tail_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> that c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>eval_fds <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> 
                      <span class="skolem">B</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">S</span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">S</span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_pos_mult_at_top<span class="main">[</span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ln <span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span> _ lim<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> real_tendsto_divide_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def mult_ac <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_null_comparison<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Lim_null <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_eval_fds_Re_at_top'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> complex fds<span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniform_limit UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">t</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="main">(</span>of_real <span class="bound">σ</span> <span class="main">+</span> of_real <span class="bound">t</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>
                       <span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">.</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_conv_le_conv_abscissa_plus_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> ereal <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="skolem">c</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uniform_limit_iff
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ε</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="bound">σ</span> <span class="main">&lt;</span> <span class="skolem">ε</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>UNIV<span class="main">.</span>
            dist <span class="main">(</span>eval_fds <span class="free">f</span> <span class="main">(</span>of_real <span class="bound">σ</span> <span class="main">+</span> of_real <span class="bound">t</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">ε</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">σ</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>eval_fds <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">σ</span> <span class="main">+</span> of_real <span class="skolem">t</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="skolem">σ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eval_fds_at_top_tail_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">σ</span> <span class="main">+</span> of_real <span class="skolem">t</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span><span class="main">]</span> elim c
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm B_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>eval_fds <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">σ</span> <span class="main">+</span> of_real <span class="skolem">t</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_eval_fds_Re_going_to_at_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds<span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⤏</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eval_fds_Re_at_top<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_eval_fds_Re_going_to_at_top'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span><span class="free">f</span> <span class="main">::</span> complex fds<span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⤏</span> fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Re <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eval_fds_Re_at_top<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any Dirichlet series that is not identically zero and does not diverge everywhere
  has a half-plane in which it converges and is non-zero.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> fds_nonzero_halfplane_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fds_converges <span class="free">f</span> <span class="bound">s</span> <span class="main">∧</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> ereal <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fds_converges <span class="free">f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> c <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> fds_converges <span class="quasi_keyword">simp</span><span class="main">:</span> less_le_trans›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_fds_zeroD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> frequently_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_conj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Normed series›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_norm_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_normed_field<span class="main">,</span>banach<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_def fds_abs_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_norm_def fds_nth_fds' norm_divide norm_nat_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_norm_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_normed_field<span class="main">,</span>banach<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_norm_def fds_nth_fds' norm_divide norm_nat_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_converges_norm_iff'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_normed_field<span class="main">,</span>banach<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">⟷</span> fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_def fds_abs_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_norm_def fds_nth_fds' norm_divide norm_nat_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_norm_iff'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_normed_field<span class="main">,</span>banach<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">⟷</span> fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def fds_norm_def fds_nth_fds' norm_divide norm_nat_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_norm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI_weak<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_norm_iff'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_leI_weak <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_norm_iff' fds_abs_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_abscissa_norm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">=</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> conv_abscissa <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI_weak<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_norm_iff'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> conv_abscissa_leI_weak <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   fds_abs_converges_norm_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     eval_fds_norm_mult_le<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">≤</span> eval_fds <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span> <span class="main">*</span> fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_abs_converges_mult assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="main">(</span>fds_norm <span class="free">f</span> <span class="main">*</span> fds_norm <span class="free">g</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> always_eventually divide_right_mono order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fds_nth_norm_mult_le<span class="main"><span class="main">]</span></span> 
            <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span> <span class="main">*</span> fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_mult assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">≤</span> eval_fds <span class="main">(</span>fds_norm <span class="free">f</span> <span class="main">*</span> fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def fds_abs_converges_def norm_divide
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_le allI divide_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult fds_nth_norm_mult_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_mult assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">≤</span> eval_fds <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_norm <span class="free">g</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_norm_nonneg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def fds_abs_converges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_nonneg<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   fds_abs_converges_norm_power<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     eval_fds_norm_power_le<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">≤</span> eval_fds <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_norm_mult assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">≤</span> eval_fds <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eval_fds_norm_mult_le<span class="main"><span class="main">]</span></span> assms * 
                                   mult_left_mono eval_fds_norm_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Logarithms of Dirichlet series›</span></span>

<span class="comment1">(* TODO: Move ? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> eventually_gt_ereal_at_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">⟹</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">c</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_log_deriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span> 
           <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">/</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">*</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_mult fds_abs_converges<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span> <span class="main">*</span> <span class="free">f</span> <span class="main">=</span> fds_deriv <span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a sufficiently nice absolutely convergent Dirichlet series that converges
  to some function $f(s)$ and a holomorphic branch of $\ln f(s)$, we can construct 
  a Dirichlet series that absolutely converges to that logarithm.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> eval_fds_ln<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="quoted">ereal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">⟹</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="free">l</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">⟹</span> exp <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> holo_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">s0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span>Re <span class="free">s</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">s0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≥</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≥</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">g</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="bound">s</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">s0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> open_A<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s0</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_ln_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_integral<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def abs_conv_abscissa_deriv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> deriv_g <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">/</span> eval_fds <span class="free">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span> <span class="keyword1">within</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="free">s0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="skolem">B</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Re <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> deriv_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> deriv <span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> holomorphic_derivI<span class="main">[</span><span class="operator">OF</span> holo_g open_A<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> s
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> at_within_open<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ open_A<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> exp <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="free">f</span> <span class="skolem">s</span> <span class="main">*</span> deriv <span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> deriv_g s<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">insert</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="var">?A</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open open_A<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="main">(</span>eval_fds <span class="free">f</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="free">f</span> <span class="skolem">s</span> <span class="main">*</span> deriv <span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_cong_ev refl eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="free">f</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="free">f</span> <span class="skolem">s</span> <span class="main">*</span> deriv <span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds <span class="free">f</span> <span class="keyword1">has_field_derivative</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s' assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="skolem">s</span> <span class="main">*</span> deriv <span class="free">g</span> <span class="skolem">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deriv <span class="free">g</span> <span class="skolem">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">/</span> eval_fds <span class="free">f</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> deriv_g <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> has_field_derivative_at_within<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="free">s0</span><span class="main">}</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_zero_constant<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> convex_halfspace_gt<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>complex"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s0</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_ln<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_deriv<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> ereal <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 2 assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">/</span> <span class="main">(</span>eval_fds <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fds_log_deriv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> s1 s2 2 nz
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> * <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">⟹</span> <span class="var">?h</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>at_top <span class="main">::</span> real filter<span class="main">)</span> <span class="main">≠</span> bot"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_ereal_at_top<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">s0</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="main">⤏</span> <span class="skolem">c</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="main">⤏</span> fds_nth <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> l <span class="keyword1"><span class="command">unfolding</span></span> o_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_eval_fds_Re_at_top<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">1</span> <span class="main">-</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Re <span class="free">s</span> <span class="main">&gt;</span> <span class="free">s0</span>›</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> l <span class="keyword2"><span class="keyword">and</span></span> nz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Less explicitly: For a sufficiently nice absolutely convergent Dirichlet series converging
  to a function $f(s)$, the formal logarithm absolutely converges to some logarithm of $f(s)$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> eval_fds_ln'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="quoted">ereal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span>Re <span class="free">s</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">s0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≥</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≥</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">⟹</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="free">l</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"exp <span class="main">(</span>eval_fds <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>inverse <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span>eval_fds <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_ln_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_integral<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def abs_conv_abscissa_deriv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="free">s0</span><span class="main">}</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_zero_constant<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> convex_halfspace_gt<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>complex"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s0</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fds_ln_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_integral<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_deriv<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> ereal <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 2 assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_deriv <span class="free">f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">/</span> <span class="main">(</span>eval_fds <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fds_log_deriv<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> s1 s2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="free">s0</span> <span class="main">⟹</span> <span class="var">?h</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>at_top <span class="main">::</span> real filter<span class="main">)</span> <span class="main">≠</span> bot"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_ereal_at_top<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">s0</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="main">⤏</span> <span class="skolem">c</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="main">⤏</span> fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span>fds_nth <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹conv_abscissa <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹conv_abscissa <span class="free">f</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_eval_fds_Re_at_top<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span>fds_nth <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Re <span class="free">s</span> <span class="main">&gt;</span> <span class="free">s0</span>›</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> l <span class="keyword2"><span class="keyword">and</span></span> nz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_completely_multiplicative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="free">f</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">l</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="free">f</span> <span class="main">=</span> fds_integral <span class="free">l</span> <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_ln_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="free">f</span> <span class="main">=</span> <span class="main">-</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> completely_multiplicative_fds_deriv' assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">/</span> <span class="free">f</span> <span class="main">=</span> <span class="main">-</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> inverse <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_integral <span class="free">l</span> <span class="main">(</span><span class="main">-</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> 
               fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">l</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_integral_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_ln_completely_multiplicative_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≡</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">h</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">abs_summable_on</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span> <span class="main">×</span> UNIV<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"eval_fds <span class="free">h</span> <span class="free">s</span> <span class="main">=</span> <span class="free">l</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">×</span>UNIV<span class="main">.</span>
            <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> completely_multiplicative_function <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff' fds_abs_converges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">l</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fds_ln_completely_multiplicative <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def fds_eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> *
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV <span class="main">⟷</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="free">l</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> mangoldt <span class="bound">x</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">/</span>
                nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> Collect primepow"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong_neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_fds mangoldt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sum1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="free">l</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="keyword1">else</span> 
                        fds_nth <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> mangoldt <span class="bound">x</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span>
                      <span class="keyword1">abs_summable_on</span> Collect primepow"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_summable_on_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> mangoldt <span class="bound">x</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span> 
                         <span class="keyword1">abs_summable_on</span> Collect primepow"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> primepow_gt_Suc_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> mangoldt <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span>
                 <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">(</span><span class="var">?P</span> <span class="main">×</span> UNIV<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_primepows <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?th1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f.mult f.power mangoldt_def aprimedivisor_prime_power ln_realpow prime_gt_0_nat 
          nat_power_power_left <span class="dynamic"><span class="dynamic">divide_simps</span></span> scaleR_conv_of_real <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">h</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">h</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_nat'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> primepow <span class="bound">n</span><span class="main">}</span><span class="main">.</span>
        <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">l</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span>  nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong_neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq fds_nth_fds mangoldt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">l</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> primepow <span class="bound">n</span><span class="main">.</span>
         <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">l</span> <span class="main">*</span> <span class="free">g</span> <span class="main">1</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?x</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> sum1 primepow_gt_Suc_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_Un_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span>Collect primepow<span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">*</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> infsetsum <span class="var">?f</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> primepow_gt_Suc_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="var">?P</span> <span class="main">×</span> UNIV<span class="main">)</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span>
                    mangoldt <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> bij_betw_primepows <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="var">?P</span> <span class="main">×</span> UNIV<span class="main">)</span><span class="main">.</span> 
                     <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f.mult f.power mangoldt_def aprimedivisor_prime_power ln_realpow prime_gt_0_nat 
          nat_power_power_left <span class="dynamic"><span class="dynamic">divide_simps</span></span> scaleR_conv_of_real <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> eval_fds_ln_completely_multiplicative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">abs_summable_on</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span> <span class="main">×</span> UNIV<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
                  <span class="free">l</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">×</span>UNIV<span class="main">.</span>
                        <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_ln<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_mult <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_abs_converges<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> eval_fds_ln_completely_multiplicative_strong <span class="main">[</span><span class="operator">OF</span> this assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Exponential and logarithm›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summable_fds_exp_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f'</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> real_normed_algebra_1<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="free">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_finite<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∉</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_nth_power_eq_0<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="free">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   fds_abs_converges_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     eval_fds_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> exp <span class="main">(</span>eval_fds <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="skolem">f</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_exp <span class="skolem">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> exp <span class="main">(</span>eval_fds <span class="skolem">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="skolem">f</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> fds_nth <span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">(</span>UNIV <span class="main">×</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> abs_summable_on_Sigma_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_power<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span> <span class="main">*</span> inverse <span class="main">(</span>fact <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cmult_left<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs_summable_on_nat_iff'
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main"><span class="main">[</span></span><span class="operator">OF</span> always_eventually<span class="main"><span class="main">[</span></span><span class="operator">OF</span> allI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_norm <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_power<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="skolem">k</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_norm <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="skolem">k</span><span class="main">)</span>"</span></span> 
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_mult norm_nat_power<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_norm <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="skolem">k</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S'</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_altdef
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_cdiv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff scaleR_conv_of_real <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S'</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_norm <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_altdef eval_fds_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_nat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> suminf_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">…</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">note</span></span> eq
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nonneg<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> norm <span class="main">(</span>norm <span class="var">?S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> eval_fds <span class="main">(</span>fds_norm <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_norm_power_le<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>norm <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> norm <span class="main">(</span>fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="skolem">k</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                        eval_fds <span class="main">(</span>fds_norm <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="skolem">k</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> exp_converges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_norm <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_fds <span class="main">(</span>fds_norm <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">x</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> summable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">×</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_summable_on_Times_swap<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> summable'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="bound">k</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> abs_summable_on_cmult_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat_power <span class="skolem">n</span> <span class="free">s</span>"</span></span><span class="main">,</span>
              <span class="operator">OF</span> abs_summable_on_Sigma_project2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> summable<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> summable <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_summable_on_Sigma_project1'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span>nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> 
                           <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="bound">k</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span>nat_power <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> summable'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_cmult_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> summable'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong refl infsetsum_nat'<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="skolem">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def fds_nth_fds' abs_summable_on_Sigma_iff scaleR_conv_of_real 
                    fds_abs_converges_altdef <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_exp <span class="skolem">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def eval_fds_def fds_nth_fds'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> summable'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">-</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">y</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> fact <span class="bound">y</span> <span class="main">/</span> nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_Sigma_project1'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> summable<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">y</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> fact <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span>nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> 
                    <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> summable' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> infsetsum_cmult_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">y</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>nat_power <span class="bound">x</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> 
                    <span class="keyword1">abs_summable_on</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_summable_on_finite_diff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span> <span class="main">*</span> inverse <span class="main">(</span>nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> summable' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_cmult_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span> <span class="main">*</span> inverse <span class="main">(</span>nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong_neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> summable 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_swap<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> scaleR_conv_of_real case_prod_unfold<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_scaleR_right<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> eval_fds <span class="skolem">f</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_power that<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong_neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_fds <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def abs_summable_on_nat_iff'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_fds <span class="skolem">f</span> <span class="free">s</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_power<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> eval_fds <span class="skolem">f</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_converges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>eval_fds <span class="skolem">f</span> <span class="free">s</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nat'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff' sums_iff <span class="dynamic"><span class="dynamic">field_simps</span></span> norm_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span>eval_fds <span class="skolem">f</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_exp <span class="skolem">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> exp <span class="main">(</span>eval_fds <span class="skolem">f</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="free">f</span> <span class="main">-</span> fds_const <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="skolem">f'</span><span class="main">)</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_diff conv assms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_const <span class="main">(</span>exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="skolem">f'</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_mult conv fds_abs_converges_diff assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_times_fds_nth_0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_const <span class="main">(</span>exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="skolem">f'</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def fds_exp_times_fds_nth_0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_exp <span class="skolem">f'</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fds_mult<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span>eval_fds <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ev<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f'</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> f'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_diff eval_fds_diff fds_abs_converges_imp_converges exp_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> exp <span class="main">(</span>eval_fds <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_exp <span class="free">f</span> <span class="main">*</span> fds_exp <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI_truncate<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">(</span>fds_exp <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?T</span> <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span> <span class="main">+</span> <span class="var">?T</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_exp fds_truncate_add_strong <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span> <span class="main">+</span> <span class="var">?T</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eval_fds_eqD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span> <span class="main">+</span> <span class="var">?T</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_exp fds_abs_converges_add<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span> <span class="main">+</span> <span class="var">?T</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conv_abscissa_PInf_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_mult fds_abs_converges_exp<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conv_abscissa_PInf_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span> <span class="main">+</span> fds_truncate <span class="skolem">m</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span>
                          eval_fds <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>
            <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fds_add eval_fds_mult eval_fds_exp fds_abs_converges_add 
                     fds_abs_converges_exp exp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">…</span> <span class="main">=</span> <span class="var">?T</span> <span class="main">(</span>fds_exp <span class="free">f</span> <span class="main">*</span> fds_exp <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_truncate_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> fds_truncate_exp<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">(</span>fds_exp <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_right_inverse_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_exp <span class="free">f</span> <span class="main">*</span> fds_exp <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_exp <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_exp_add<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_exp <span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_exp <span class="free">f</span> <span class="main">*</span> fds_exp <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_conv_abscissa_exp<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_conv_abscissa_mono fds_abs_converges_exp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_deriv_exp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_exp <span class="free">f</span> <span class="main">*</span> fds_deriv <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI_truncate<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fds_truncate <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_deriv <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_deriv<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">(</span>fds_deriv <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?T</span> <span class="main">(</span>fds_deriv <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_deriv fds_truncate_exp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_deriv <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eval_fds_eqD<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> abscissa <span class="main">=</span> conv_le_abs_conv_abscissa abs_conv_abscissa_exp
    <span class="keyword1"><span class="command">note</span></span> abscissa' <span class="main">=</span> abscissa<span class="main">[</span><span class="operator">THEN</span> le_less_trans<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_deriv <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges <span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_deriv <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_conv_abscissa_exp<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_deriv <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conv_abscissa_PInf_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_deriv <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges_mult fds_abs_converges_exp<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fds_abs_converges <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_deriv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_exp <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_deriv <span class="main">(</span>fds_truncate <span class="skolem">m</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conv_abscissa_PInf_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∃<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">s</span> <span class="keyword1">in</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">going_to</span> at_top<span class="main">.</span>
            eval_fds <span class="main">(</span>fds_deriv <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span>
            eval_fds <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_deriv <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually eventually_frequently allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_deriv <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span>
              deriv <span class="main">(</span>eval_fds <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fds_exp eval_fds_mult fds_abs_converges_mult fds_abs_converges_exp
                  fds_abs_converges eval_fds_deriv abscissa'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> exp <span class="main">(</span>eval_fds <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext eval_fds_exp<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">…</span>  <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> exp <span class="main">(</span>eval_fds <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">*</span> deriv <span class="main">(</span>eval_fds <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> DERIV_imp_deriv <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fds_deriv<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_exp <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_deriv <span class="main">(</span><span class="var">?T</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fds_exp eval_fds_mult fds_abs_converges_mult fds_abs_converges_exp
                       fds_abs_converges eval_fds_deriv abs_conv_abscissa_deriv<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">…</span> <span class="main">=</span> <span class="var">?T</span> <span class="main">(</span>fds_exp <span class="free">f</span> <span class="main">*</span> fds_deriv <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_truncate_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_exp fds_truncate_deriv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_truncate_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">(</span>fds_deriv <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_ln_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fds_const <span class="main">(</span>exp <span class="free">l</span> <span class="main">/</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exp <span class="free">l</span> <span class="main">/</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> fds_const <span class="var">?c</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> <span class="main">(</span>fds_exp <span class="main">(</span><span class="main">-</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_exp <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fds_const <span class="var">?c</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="main">(</span><span class="var">?g</span> <span class="main">*</span> <span class="var">?h</span><span class="main">)</span> <span class="main">*</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_exp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_const <span class="var">?c</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="var">?g</span><span class="main">)</span> <span class="main">*</span> <span class="var">?h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="var">?g</span> <span class="main">=</span> fds_const <span class="main">(</span>inverse <span class="var">?c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_deriv_eq_imp_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span><span class="free">f</span> <span class="main">*</span> fds_exp <span class="main">(</span><span class="main">-</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            fds_exp <span class="main">(</span><span class="main">-</span> fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fds_deriv <span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="main">/</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">/</span> <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def fds_right_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span><span class="free">f</span> <span class="main">*</span> fds_exp <span class="main">(</span><span class="main">-</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="main">(</span>fds_const <span class="main">(</span>inverse <span class="var">?c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_const <span class="var">?c</span> <span class="main">*</span> fds_const <span class="main">(</span>inverse <span class="var">?c</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_const_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_exp_ln <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"exp <span class="free">l</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_exp <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_exp_ln_strong<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_ln_exp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_ln <span class="free">l</span> <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_deriv_eq_imp_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_ln <span class="free">l</span> <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="free">f</span> <span class="main">*</span> <span class="main">(</span>fds_exp <span class="free">f</span> <span class="main">/</span> fds_exp <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> divide_fds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_exp <span class="free">f</span> <span class="main">/</span> fds_exp <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_fds_def fds_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds_ln <span class="free">l</span> <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fds_deriv <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Euler products›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_euler_product_LIMSEQ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">s</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">⇢</span> 
             eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> euler_product_LIMSEQ<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_function_divide_nat_power<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_euler_product_LIMSEQ'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">⇢</span> 
             eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> euler_product_LIMSEQ'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> completely_multiplicative_function_divide_nat_power<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_convergent_euler_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_convergent_prod 
             <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">∑</span><span class="bound">i</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">s</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_convergent_euler_product<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_function_divide_nat_power<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_convergent_euler_product'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_convergent_prod 
             <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_fds_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_convergent_euler_product'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">/</span> nat_power <span class="bound">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> completely_multiplicative_function_divide_nat_power<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_convergent_zero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_field<span class="main">,</span> real_normed_field<span class="main">,</span> banach<span class="main">,</span> second_countable_topology<span class="main">}</span> fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⇢</span> eval_fds <span class="free">f</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_euler_product_LIMSEQ' assms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"convergent_prod <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_convergent_prod_imp_convergent_prod fds_abs_convergent_euler_product' assms<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> convergent_prod_to_zero_iff<span class="main">[</span><span class="operator">OF</span> conv<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> lim
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> nat_power <span class="bound">p</span> <span class="free">s</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> fds_nth <span class="free">f</span> <span class="bound">p</span> <span class="main">=</span> nat_power <span class="bound">p</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="skolem">p</span> <span class="main">=</span> nat_power <span class="skolem">p</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_power <span class="skolem">p</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nat_power_nonzero<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convergent_prod_to_zero_iff<span class="main">[</span><span class="operator">OF</span> conv<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> tendsto_unique<span class="main">[</span><span class="operator">OF</span> _ lim this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>nat_power_normed_field<span class="main">,</span>banach<span class="main">,</span>euclidean_space<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   euler_product_fds_zeta<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>
                <span class="main">⇢</span> eval_fds fds_zeta <span class="free">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     eval_fds_zeta_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds fds_zeta <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth fds_zeta<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth fds_zeta <span class="bound">p</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> 
          <span class="main">⇢</span> eval_fds fds_zeta <span class="free">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?g</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_euler_product_LIMSEQ' * fds_abs_summable_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> nat_power <span class="bound">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext prod.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_zeta_def fds_nth_fds<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>nat_power <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_nat_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_less_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_power <span class="skolem">p</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> fds_nth fds_zeta <span class="bound">p</span> <span class="main">=</span> nat_power <span class="bound">p</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_zeta_def fds_nth_fds<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds fds_zeta <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms * ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_abs_convergent_zero_iff<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_primepow_subseries_euler_product_cm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">&gt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_primepow_subseries <span class="free">p</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="free">p</span> <span class="main">/</span> nat_power <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">pa</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">pa</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="main">(</span>fds_primepow_subseries <span class="free">p</span> <span class="free">f</span><span class="main">)</span> <span class="bound">pa</span> <span class="main">/</span>
                 nat_power <span class="bound">pa</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequentially <span class="main">≠</span> bot"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> eval_fds <span class="main">(</span>fds_primepow_subseries <span class="free">p</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_euler_product_LIMSEQ' completely_multiplicative_function_only_pows assms
          fds_abs_converges_subseries<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="free">p</span> <span class="main">/</span> nat_power <span class="free">p</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">pa</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">pa</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="main">(</span>fds_primepow_subseries <span class="free">p</span> <span class="free">f</span><span class="main">)</span> <span class="bound">pa</span> <span class="main">/</span>
              nat_power <span class="bound">pa</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">q</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="free">p</span> <span class="main">/</span> nat_power <span class="free">p</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_subseries prime_prime_factors<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="free">p</span> <span class="main">/</span> nat_power <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.delta<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fds_nth <span class="free">f</span> <span class="free">p</span> <span class="main">/</span> nat_power <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-negative Dirichlet series›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_Reals_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">locale</span></span> nonneg_dirichlet_series <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dirichlet_series fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg_coeffs_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fds_nth <span class="free">f</span> <span class="free">n</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="free">n</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nonneg_coeffs_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_dirichlet_series_0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_dirichlet_series_1 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_fds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_dirichlet_series_const <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> nonneg_dirichlet_series <span class="main">(</span>fds_const <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_const_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_dirichlet_series_add <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> nonneg_dirichlet_series <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> nonneg_dirichlet_series <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonneg_Reals_add_I f.nonneg_coeffs g.nonneg_coeffs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_dirichlet_series_mult <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> nonneg_dirichlet_series <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> nonneg_dirichlet_series <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonneg_Reals_sum nonneg_Reals_mult_I f.nonneg_coeffs g.nonneg_coeffs 
                      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_dirichlet_series_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> nonneg_dirichlet_series
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_exp <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> exp <span class="main">(</span>fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> fds_nth <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> nonneg_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> of_real <span class="skolem">c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonneg_Reals_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> of_real <span class="main">(</span>exp <span class="skolem">c'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def exp_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> nonneg_power<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="skolem">f'</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="skolem">f'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">insert</span> nonneg_coeffs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> nonneg_dirichlet_series <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nonneg_dirichlet_series_power<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> nonneg_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_exp_def fds_nth_fds' f'_def c_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="skolem">f'</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> fact <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_finite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_nth_power_eq_0 less <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">…</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> scaleR_conv_of_real
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nonneg_Reals_mult_I nonneg_Reals_sum nonneg_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> nonneg_Reals_of_real_iff <span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_exp <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≥</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_dirichlet_series_lnD<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"exp <span class="free">l</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">(</span>fds_exp <span class="main">(</span>fds_ln <span class="free">l</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nonneg_dirichlet_series.nonneg_exp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> nonneg_dirichlet_series
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_of_real_norm<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_of_real <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span>fds_of_real <span class="main">(</span>fds_norm <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonneg_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonneg_Reals_cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* TODO: Simplify proof *)</span>
<span class="keyword1"><span class="command">lemma</span></span> pringsheim_landau_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abscissa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">∧</span> fds_abs_converges <span class="free">f</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> nonneg_dirichlet_series <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">c</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span><span class="main">}</span> <span class="keyword1">then</span> eval_fds <span class="free">f</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="bound">s</span><span class="main">)</span>"</span></span>

  <span class="comment1">― ‹We can find some $\varepsilon &gt; 0$ such that the Dirichlet series can be continued
      analytically in a ball of radius $1 + \varepsilon$ around $a$.›</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹open <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ball <span class="free">c</span> <span class="skolem">δ</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_contains_ball<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">δ</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> δ <span class="keyword1"><span class="command">have</span></span> ε<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ball_a_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"ball <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span><span class="main">}</span> <span class="main">∪</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> ball <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Re <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> Im <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff x_def y_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span><span class="main">}</span> <span class="main">∪</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">≤</span> <span class="free">c</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_norm cmod_def a_def ε_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> δ
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> real_less_lsqrt<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> ball <span class="free">c</span> <span class="skolem">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_norm cmod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> holo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="keyword1">holomorphic_on</span> ball <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ball_a_subset<span class="main"><span class="main">]</span></span> holomorphic_on_If_Un<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ereal <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>*<span class="main">:</span>  <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> ereal <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> Re <span class="bound">s</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> open_halfspace_Re_gt<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fds_norm <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fds_of_real <span class="skolem">f'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def fds_of_real_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_nth <span class="skolem">f'</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> nonneg_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonneg_Reals_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">g'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">(</span>complex_of_real <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open open_halfspace_Re_gt<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">g'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="free">f</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cong_ev refl eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_higher_deriv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ereal <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">&lt;</span> ereal <span class="main">(</span>complex_of_real <span class="skolem">a</span> <span class="main">∙</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">g'</span> <span class="skolem">a</span> <span class="main">=</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> nth_deriv_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_abs_converges<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_higher_deriv a_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abscissa<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> nth_deriv_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="skolem">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="skolem">k</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_deriv_def fds_eq_iff fds_nth_fds' scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> deriv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="skolem">f'</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> complex_of_real <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nth_deriv_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fds_altdef<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_deriv_eq fds_nth_fds' powr_Reals_eq scaleR_conv_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> of_real <span class="main">(</span>fds_nth <span class="skolem">f'</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_scaleR_right<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real f_f'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> of_real <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="skolem">f'</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="skolem">f'</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms δ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def ε_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> ball <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def dist_norm cmod_def s_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> holomorphic_power_series<span class="main">[</span><span class="operator">OF</span> holo this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> sums<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">g'</span> <span class="skolem">a</span> <span class="main">/</span> fact <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="skolem">g'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> deriv
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">-</span>of_real <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def a_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">…</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> power_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">/</span> fact <span class="bound">n</span> <span class="main">*</span> <span class="main">…</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">/</span> fact <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nth_deriv_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_f' fds_abs_converges_imp_converges mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">/</span> fact <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> summable_of_real_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword1">abs_summable_on</span> <span class="main">(</span>UNIV <span class="main">×</span> UNIV<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> abs_summable_on_Sigma_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> nth_deriv_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_altdef'
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cmult_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_deriv_eq fds_nth_fds' powr_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 4
    <span class="keyword1"><span class="command">have</span></span> nth_deriv_f_f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> fds_of_real <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def fds_of_real_norm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> norm_nth_deriv_f<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> 
                                 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> of_real <span class="main">(</span>fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_f' fds_nth_deriv scaleR_conv_of_real norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_nonneg f_f'<span class="main">)</span>

    <span class="keyword1"><span class="command">note</span></span> summable
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">/</span> fact <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> norm <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span>
                    <span class="main">(</span>real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?h</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> norm <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span>
                    <span class="main">(</span>real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span>norm <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> 
              <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> norm <span class="main">(</span>fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?S</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_scaleR_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_divide norm_power mult_ac nth_deriv_eq fds_nth_fds'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_divide norm_power norm_nth_deriv_f<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nth_deriv_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fds_altdef<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def nth_deriv_f_f'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> fact <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span>
                  <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f'</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">/</span> fact <span class="skolem">n</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> s_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">-</span>of_real <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def a_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s_a norm_minus_cancel norm_of_real <span class="keyword1"><span class="command">using</span></span> ε <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> infsetsum_nonneg<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="var">?h</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs_summable_on_nat_iff' <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword1">abs_summable_on</span> <span class="main">(</span>UNIV <span class="main">×</span> UNIV<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> abs_summable_on_Times_swap<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span>
           <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">abs_summable_on</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_summable_on_Sigma_project1'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> fds_nth <span class="free">f</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">abs_summable_on</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> abs_summable_on_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>fds_nth <span class="skolem">f'</span> <span class="skolem">k</span> <span class="main">/</span> <span class="skolem">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span>real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_scaleR_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> infsetsum_cong<span class="main">)</span> 
         <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real f_f' power_minus' power_mult_distrib <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∑<span class="hidden">⇩</span><sub>a</sub></span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span>real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span>real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_converges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>ln <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">]</span> exp_converges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">-</span>ln <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infsetsum_nat'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_summable_on_nat_iff' sums_iff scaleR_conv_of_real
                                            <span class="dynamic"><span class="dynamic">divide_simps</span></span> norm_divide norm_mult norm_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fds_nth <span class="skolem">f'</span> <span class="skolem">k</span> <span class="main">/</span> <span class="skolem">k</span> <span class="keyword1">powr</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">…</span> <span class="main">=</span> fds_nth <span class="free">f</span> <span class="skolem">k</span> <span class="main">/</span> nat_power <span class="skolem">k</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real f_f' powr_def exp_minus
                     <span class="dynamic"><span class="dynamic">field_simps</span></span> exp_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> exp_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_abs_converges_def abs_summable_on_nat_iff'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ε</span></span></span> <span class="main"><span class="main"><span class="main">/</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def a_def ε<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pringsheim_landau<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex fds"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abscissa<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">c</span><span class="main">.</span> fds_abs_converges <span class="free">f</span> <span class="main">(</span>complex_of_real <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pringsheim_landau_aux<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> A <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges <span class="free">f</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≤</span> complex_of_real <span class="skolem">x</span> <span class="main">∙</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> abs_conv_abscissa_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Inf_lower<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">corollary</span></span> entire_continuation_imp_abs_conv_abscissa_MInfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> abs_conv_abscissa <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> holo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> abscissa <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span> <span class="main">=</span> ereal <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="free">f</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pringsheim_landau<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> abscissa _ holo<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">s</span> <span class="main">=</span> eval_fds <span class="free">f</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> holo<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="free">f</span> <span class="main">≤</span> abs_conv_abscissa <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ereal <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="skolem">a</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms s<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span><span class="free">c</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> 
           open_halfspace_Re_gt convex_connected convex_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Convergence of the $\zeta$ and M\"{o}bius $\mu$ series›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_summable_zeta_real_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_abs_converges fds_zeta <span class="free">s</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_abs_converges fds_zeta <span class="free">s</span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong always_eventually<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_zeta powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_real_powr_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_summable_zeta_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⟹</span> fds_abs_converges fds_zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fds_abs_converges_moebius_mu_real<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fds_abs_converges <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>norm <span class="main">(</span>fds_nth <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="skolem">n</span> <span class="main">/</span> nat_power <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> abs_moebius_mu_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_real_powr_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Application to the M\"{o}bius $\mu$ function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_squares_sums'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inverse_squares_sums sums_Suc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"pi<span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">6</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> norm_summable_moebius_over_square<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>moebius_mu <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> summable_Suc_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> summable_comparison_test<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inverse_squares_sums <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> abs_moebius_mu_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> summable_moebius_over_square<span class="main">:</span>
  <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> norm_summable_moebius_over_square <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_norm_cancel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_over_square_sums<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> eval_fds <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real fds<span class="main">)</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">::</span> real fds<span class="main">)</span> <span class="main">=</span> fds_zeta <span class="main">*</span> fds moebius_mu"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_zeta_times_moebius_mu <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">…</span> <span class="numeral">2</span> <span class="main">=</span> eval_fds fds_zeta <span class="numeral">2</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_mult fds_abs_converges_moebius_mu_real<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inverse_squares_sums' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_at_numeral suminf_fds_zeta_aux sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">6</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> summable_moebius_over_square <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Arithmetic_Summatory_Asymptotics">
<div class="head">
<h1>Theory Arithmetic_Summatory_Asymptotics</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Arithmetic_Summatory_Asymptotics.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Asymptotics of summatory arithmetic functions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Arithmetic_Summatory_Asymptotics
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../Euler_MacLaurin/Euler_MacLaurin_Landau.html">Euler_MacLaurin.Euler_MacLaurin_Landau</a>
    <a href="Arithmetic_Summatory.html">Arithmetic_Summatory</a> 
    <a href="Dirichlet_Series_Analysis.html">Dirichlet_Series_Analysis</a>
    <a href="../Landau_Symbols/Landau_More.html">Landau_Symbols.Landau_More</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary bounds›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_inverse_squares_tail_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI exI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> norm_divide norm_one norm_power
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono power_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> inverse_squares_sums<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono mult_mono mult_pos_pos add_nonneg_pos<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">0</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> telescope_sums' real_tendsto_divide_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">subst</span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> filterlim_tendsto_add_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const 
            filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_sum_tail_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"abs <span class="var">?S</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> sum_inverse_squares_tail_bound<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"real <span class="free"><span class="free"><span class="free">d</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> abs <span class="main">(</span>moebius_mu <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">¦</span>moebius_mu <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span>
            <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> real_norm_def abs_abs abs_divide power_abs abs_of_nat
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono abs_moebius_mu_le<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> *<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> ** <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="var">?S</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> abs <span class="main">(</span>moebius_mu <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_rabs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_le allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>moebius_mu <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> real <span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abs_divide abs_of_nat power_abs of_nat_add <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono abs_moebius_mu_le<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> * **<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_inverse_squares_tail_bound<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_inverse_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≤</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">13</span> <span class="main">/</span> <span class="numeral">22</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> order_tendstoD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> euler_mascheroni_LIMSEQ euler_mascheroni_less_13_over_22<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> harm <span class="bound">n</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">13</span> <span class="main">/</span> <span class="numeral">22</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≤</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">13</span> <span class="main">/</span> <span class="numeral">22</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>real <span class="skolem">N</span><span class="main">)</span> <span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> harm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">13</span> <span class="main">/</span> <span class="numeral">22</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span><span class="main">]</span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_inverse_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">13</span><span class="main">/</span><span class="numeral">22</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> sum_upto_inverse_bound<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> sum_upto_inverse_bound<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">13</span><span class="main">/</span><span class="numeral">22</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">13</span><span class="main">/</span><span class="numeral">22</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   moebius_sum_tail_bound'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">G</span> <span class="bound">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   moebius_sum_tail_bigo<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">G</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">G</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">using</span></span> moebius_sum_tail_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="skolem">t</span><span class="main">⌋</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> real_of_int <span class="main">⌊</span><span class="skolem">t</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Summatory totient function›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> summatory_totient_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_int <span class="main">(</span>floor <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span>floor <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="skolem">H</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto real <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">H</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_real H_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> H_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">H</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">t</span> <span class="main">-</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> of_int <span class="main">(</span>floor <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>floor <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonpos_nonneg divide_nonpos_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">H</span> <span class="skolem">t</span> <span class="main">-</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> of_int <span class="main">(</span>floor <span class="skolem">t</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span>floor <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_nonpos_nonneg mult_nonpos_nonneg<span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">linarith</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">H</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">H</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> H'_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">H'</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">H'</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">t</span><span class="main">.</span> <span class="main">¦</span>moebius_mu <span class="bound">i</span> <span class="main">*</span> <span class="skolem">H</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H'_def sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_mono abs_moebius_mu_le H_bound<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left sum_distrib_right mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_upto_inverse_bound<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">*</span> ln <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult sum_upto_inverse_bigo<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> H'_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="main">(</span>int <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> sum_upto real <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> totient_conv_moebius_mu<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_dirichlet_prod of_int_dirichlet_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">H</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">H'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def H'_def sum.distrib ring_distribs
                    sum_distrib_left sum_distrib_right power_divide mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{..&lt;</span>Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left refl<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">6</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">G</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sums_split_initial_segment<span class="main">[</span><span class="operator">OF</span> moebius_over_square_sums<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sums_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> G_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">G</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">H'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> 
            <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">G</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">H'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">G</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">H'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo H'_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">G</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> moebius_sum_tail_bigo <span class="main">[</span><span class="operator">folded</span> G_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">G</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> summatory_totient_asymptotics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> summatory_totient_asymptotics
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> summatory_totient_asymptotics''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summatory_totient_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Asymptotic distribution of squarefree numbers›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_sqrt_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> sqrt <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_sqrt_le_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> real_sqrt_le_iff<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> squarefree_asymptotics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> squarefree <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span>ind squarefree<span class="main">)</span> moebius_mu"</span></span>
  
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> multiplicative_function <span class="quoted"><span class="skolem">g</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicative_dirichlet_prod squarefree.multiplicative_function_axioms 
              moebius_mu.multiplicative_function_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> multiplicative_function' <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> g'<span class="main">:</span> multiplicative_dirichlet_prod' <span class="quoted"><span class="quoted">"ind squarefree"</span></span> <span class="quoted">moebius_mu</span>
     <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicative_dirichlet_prod'.intro squarefree.multiplicative_function'_axioms 
              moebius_mu.multiplicative_function'_axioms<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>
                           <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g'.prime_power g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> mult_g_square<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicative_function <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib g.mult_coprime<span class="main">)</span>
    
  <span class="keyword1"><span class="command">have</span></span> g_square<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> moebius_mu <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">using</span></span> mult_g_square moebius_mu.multiplicative_function_axioms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicative_function_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g.prime_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> moebius_mu <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu.prime_power<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> moebius_mu <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> g_nonsquare<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_square <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> that False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_nth_power_conv_multiplicity_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="skolem">m</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">m</span><span class="main">.</span> <span class="keyword1">if</span> multiplicity <span class="bound">p</span> <span class="skolem">m</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> g.prod_prime_factors'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">have</span></span> abs_g_le<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">g</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_square <span class="skolem">m</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_square g_nonsquare abs_moebius_mu_le <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE<span class="main">)</span>
    
  <span class="keyword1"><span class="command">have</span></span> fds_g<span class="main">:</span> <span class="quoted"><span class="quoted">"fds <span class="skolem">g</span> <span class="main">=</span> fds_ind squarefree <span class="main">*</span> fds moebius_mu"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def fds_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="skolem">g</span> <span class="main">*</span> fds_zeta <span class="main">=</span> fds_ind squarefree <span class="main">*</span> <span class="main">(</span>fds_zeta <span class="main">*</span> fds moebius_mu<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_g mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">*</span> fds moebius_mu <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real fds<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_zeta_times_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_ind squarefree <span class="main">=</span> fds <span class="skolem">g</span> <span class="main">*</span> fds_zeta"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ind_squarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"ind squarefree <span class="main">=</span> dirichlet_prod <span class="skolem">g</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ind squarefree <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="skolem">g</span> <span class="skolem">f</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">m</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real_of_int <span class="main">⌊</span><span class="bound">x</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">⌋</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">m</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="skolem">H</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">H</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">m</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real_of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">⌋</span> <span class="main">-</span> 
                         <span class="skolem">x</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">m</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?S</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> H_def sum_upto_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> real_of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⌋</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs_mult sum_upto_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_mono abs_g_le<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sqrt <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> H_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI<span class="main">)</span>
  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> squarefree <span class="bound">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?A</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">H</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> squarefree <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> squarefree <span class="bound">n</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span>ind squarefree <span class="main">::</span> nat <span class="main">⇒</span> real<span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_ind <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">d</span> <span class="main">*</span> sum_upto <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> ind_squarefree <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_dirichlet_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> real <span class="skolem">i</span><span class="main">⌋</span><span class="main">}</span> <span class="main">=</span> of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> real <span class="skolem">i</span><span class="main">⌋</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">d</span> <span class="main">*</span> of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">⌋</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_betw_not_neutral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw power2 <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> sqrt <span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{}</span><span class="main">)</span> 
              <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">i</span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span>is_square <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_on_def power_eq_iff_eq_base le_sqrt_iff 
                       is_nth_power_def le_nat_iff le_floor_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_nonsquare<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> real <span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">H</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def sum_upto_def sum.distrib ring_distribs sum_subtractf 
                    sum_distrib_left sum_distrib_right mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> real <span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> 
                 sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">/</span> real <span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">m</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span>Suc <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">m</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">6</span> <span class="main">/</span> pi<span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sums_split_initial_segment<span class="main">[</span><span class="operator">OF</span> moebius_over_square_sums<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sums_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> J_def sum_upto_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">H</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?A</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">H</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">H</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo H_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> J_def
        <span class="keyword1"><span class="command">using</span></span> moebius_sum_tail_bigo sqrt_at_top <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">J</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> squarefree_asymptotics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> squarefree <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> squarefree_asymptotics
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> squarefree_asymptotics''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> squarefree <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">{</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> squarefree <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> squarefree_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="main">::</span> real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_half_sqrt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The hyperbola method›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hyperbola_method_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">R</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">R</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">R</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span><span class="main">-</span><span class="main">(</span>sum_upto <span class="free">f</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sum_upto <span class="free">g</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">R</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="var">?A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hyperbola_method_sqrt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> landau_o.big.uminus_in_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> frac_le_1<span class="main">:</span> <span class="quoted"><span class="quoted">"frac <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1"><span class="command">lemma</span></span> ln_minus_ln_floor_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">-</span> ln <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> ln <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">-</span> ln <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ln_diff_le_inverse<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">-</span> ln <span class="main">(</span>floor <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">≥</span> ln <span class="main">(</span>of_int <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> ln_minus_ln_floor_bigo<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span>floor <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span>floor <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">::</span>real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ln_minus_ln_floor_bound<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span>floor <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_asymptotics_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span>
                    <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> euler_mascheroni <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> frac <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> R_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>sqrt <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono frac_le_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sqrt <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">≤</span> sqrt <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> R_bound'<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">using</span></span> R_bound<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> R_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> eventually_mono<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> R_bound'<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                          <span class="bound">x</span> <span class="main">*</span> harm <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf frac_def R_def sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> harm <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> harm_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> euler_mascheroni <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> 
         <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>harm <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> euler_mascheroni<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">S</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> S_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="skolem">S</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_int <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def ln_sqrt<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_int <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_minus_ln_floor_bigo sqrt_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">S</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">S</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> harm <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> euler_mascheroni<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> nat <span class="main"><span class="main">⌊</span></span>sqrt <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">⌋</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> at_top at_top"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_nat_sequentially<span class="main"><span class="main">]</span></span>
                  filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_floor_sequentially<span class="main"><span class="main">]</span></span> sqrt_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> harm <span class="bound">a</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">a</span><span class="main">)</span> <span class="main">+</span> euler_mascheroni<span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> harm_expansion_bigo_simple2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>nat <span class="main">⌊</span>sqrt <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">eventually_elim</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> real_of_int <span class="main">⌊</span>sqrt <span class="skolem">x</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sqrt_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult landau_o.big_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_sqrt_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> norm <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> frac <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> frac <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_nonneg_nonneg mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frac_le_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="free">x</span> <span class="main">-</span> frac <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="free">x</span> <span class="main">-</span> frac <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">⌊</span>sqrt <span class="free">x</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">⌊</span>sqrt <span class="free">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> sqrt <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="main">⌊</span>sqrt <span class="free">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> sqrt <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="main">⌊</span>sqrt <span class="free">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> sqrt <span class="free">x</span><span class="main">..</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summatory_divisor_count_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span>
          <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> euler_mascheroni <span class="main">*</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span>dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span> <span class="main">+</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hyperbola_method_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> norm <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> 
             <span class="numeral">2</span> <span class="main">*</span> norm <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> sum_upto_sqrt_bound<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> euler_mascheroni <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divisor_count_asymptotics_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> euler_mascheroni <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divisor_count_asymptotics_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_count <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> fds_divisor_count
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff power2_eq_square fds_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> 
               <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> dirichlet_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> summatory_divisor_count_asymptotics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">=o</span> 
     <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> summatory_divisor_count_asymptotics
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> summatory_divisor_count_asymptotics''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> 
           <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summatory_divisor_count_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_half_sqrt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> asymp_equiv_add_right<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summatory_divisor_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real <span class="free">m</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">m</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">n</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef divisor_count_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_SigmaI<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">n</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">m</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">m</span><span class="main">.</span> card <span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">m</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span> <span class="main">/</span> card <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">m</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mean_divisor_count_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">M</span> <span class="bound">m</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">m</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">M</span> <span class="bound">m</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">m</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">m</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> ln <span class="bound">m</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="var">?f</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>nat"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> summatory_divisor_eq <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> sqrt <span class="bound">m</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span> landau_o.big.divide_right
          summatory_divisor_count_asymptotics eventually_at_top_not_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">.</span> sqrt <span class="bound">m</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>nat"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> mean_divisor_count_asymptotics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mean_divisor_count_asymptotics
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> mean_divisor_count_asymptotics''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mean_divisor_count_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_half_sqrt <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallo_real_nat_transfer<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> euler_mascheroni <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> asymp_equiv_add_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The asymptotic ditribution of coprime pairs›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">m</span></span><span class="main">,</span><span class="bound"><span class="bound">n</span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span><span class="main">.</span> coprime <span class="bound">m</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coprime_pairs_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> totatives <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> totatives <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">C</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">D</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span> <span class="keyword1"><span class="command">unfolding</span></span> C_def D_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_UN_I finite_imageI<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>    
  
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> totient <span class="bound">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">N</span> <span class="main">=</span> <span class="skolem">C</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">D</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def C_def D_def totatives_def image_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">C</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">D</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">-</span> card <span class="main">(</span><span class="skolem">C</span> <span class="skolem">N</span> <span class="main">∩</span> <span class="skolem">D</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_Un_Int<span class="main">[</span><span class="operator">OF</span> fin<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">N</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="skolem">N</span> <span class="main">∩</span> <span class="skolem">D</span> <span class="skolem">N</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff totatives_def C_def D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">C</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_UN image_image C_def D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">C</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def C_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> totatives <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_UN_disjoint<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> totient <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> totient_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_image<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> totient <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> totient <span class="bound">m</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> totient <span class="bound">m</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">∈</span>
          <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="var">?f</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * **
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>nat"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_diff sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> landau_o.big.cmult_in_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> summatory_totient_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> coprime_pairs_asymptotics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coprime_pairs_asymptotics
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> coprime_pairs_asymptotics''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_pairs_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="bound">N</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.small.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> coprime_probability_tendsto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span> <span class="main">/</span> card <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="numeral">6</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="bound">N</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> real <span class="bound">N</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_refl_ev<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="bound">N</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> asymp_equiv_symI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> coprime_pairs_asymptotics''<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span>card <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="numeral">6</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_sym<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivD_const<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The asymptotics of the number of Farey fractions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">farey_fractions</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> rat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">farey_fractions</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">::</span> rat <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">q</span><span class="main">)</span> <span class="main">≤</span> int <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">}</span>  "</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fract_eq_coprime<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Rat.Fract <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Rat.Fract <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">d</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_rat<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">a</span> <span class="main">*</span> abs <span class="free">d</span> <span class="main">=</span> abs <span class="free">c</span> <span class="main">*</span> abs <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> abs <span class="free">a</span> <span class="main">=</span> abs <span class="free">c</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">=</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coprime_crossproduct_int<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">*</span> <span class="free">d</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">b</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> quotient_of_split<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>quotient_of <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> coprime <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free">q</span> <span class="main">=</span> Rat.Fract <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quotient_of_Fract <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Fract_eq_coprime<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quotient_of_split_asm<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Rat.quotient_of <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> coprime <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> Rat.Fract <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quotient_of_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> farey_fractions_bij<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> Rat.Fract <span class="main">(</span>int <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>int <span class="bound">b</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≤</span> <span class="free">N</span> <span class="main">∧</span> coprime <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span> <span class="main">(</span>farey_fractions <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">q</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">case</span></span> quotient_of <span class="bound"><span class="bound">q</span></span> <span class="keyword1"><span class="keyword1">of</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⇒</span></span> <span class="main"><span class="main">(</span></span>nat <span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">,</span></span> nat <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> farey_fractions_def Rat.zero_less_Fract_iff Rat.Fract_le_one_iff 
                   Rat.quotient_of_Fract Rat.normalize_def gcd_int_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> farey_fractions_def Rat.Fract_le_one_iff Rat.zero_less_Fract_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits quotient_of_split_asm<span class="main">)</span>
      <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_int_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Rat.quotient_of_Fract Rat.normalize_def Let_def gcd_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> farey_fractions_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">split</span> quotient_of_split<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Rat.zero_less_Fract_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_farey_fractions<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>farey_fractions <span class="free">N</span><span class="main">)</span> <span class="main">=</span> sum totient <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>farey_fractions <span class="free">N</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≤</span> <span class="free">N</span> <span class="main">∧</span> coprime <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> farey_fractions_bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≤</span> <span class="free">N</span> <span class="main">∧</span> coprime <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> totatives <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> totatives_def image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> totatives <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_UN_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> totient <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> totient_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl card_image<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_farey_fractions_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span>farey_fractions <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>totient <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> 
            <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> summatory_totient_asymptotics filterlim_real_sequentially 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span>farey_fractions <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef card_farey_fractions<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> card_farey_fractions_asymptotics'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> card <span class="main">(</span>farey_fractions <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="bound">N</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">*</span> ln <span class="bound">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_farey_fractions_asymptotics
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> card_farey_fractions_asymptotics''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span>farey_fractions <span class="bound">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">(</span>farey_fractions <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_farey_fractions_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> real <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">/</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="bound">N</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.small.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dirichlet_Efficient_Code">
<div class="head">
<h1>Theory Dirichlet_Efficient_Code</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Dirichlet_Efficient_Code.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Efficient code for number-theoretic functions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dirichlet_Efficient_Code
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Main.html">Main</a> 
  <a href="Moebius_Mu.html">Moebius_Mu</a> 
  <a href="More_Totient.html">More_Totient</a> 
  <a href="Divisor_Count.html">Divisor_Count</a>
  <a href="Liouville_Lambda.html">Liouville_Lambda</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
  <a href="../Polynomial_Factorization/Prime_Factorization.html">Polynomial_Factorization.Prime_Factorization</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prime_factorization_nat'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prime_factorization_nat'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span>
     <span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> prime_factorization_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span>
     <span class="keyword1">in</span>  map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">(=)</span> <span class="bound">p</span><span class="main">)</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>remdups_adj <span class="main">(</span>sort <span class="bound">ps</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> set_prime_factorization_nat'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>prime_factorization_nat' <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>prime_factorization_nat' <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_nat'_def Let_def multiset_prime_factorization_nat_correct<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pk p' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_nat'_def Let_def multiset_prime_factorization_nat_correct
          count_prime_factorization_prime <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> count_mset <span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>prime_factorization_nat' <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_nat'_def Let_def multiset_prime_factorization_nat_correct 
          count_prime_factorization_prime <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> count_mset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> distinct_prime_factorization_nat' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>prime_factorization_nat' <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_map inj_on_def prime_factorization_nat'_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> multiplicative_function'<span class="main">)</span> efficient_code' <span class="main">=</span> 
   efficient_code <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> prime_factorization_nat' <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">n</span><span class="main">,</span> 
     <span class="operator">OF</span> set_prime_factorization_nat' distinct_prime_factorization_nat'<span class="main">]</span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹M\"{o}bius $\mu$ function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">moebius_mu_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>unit <span class="main">⇒</span> nat list<span class="main">)</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">moebius_mu_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span><span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="main">¬</span><span class="numeral">9</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span>
        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">()</span> <span class="keyword1">in</span> <span class="keyword1">if</span> distinct <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">if</span> even <span class="main">(</span>length <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_conv_moebius_mu_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">qs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≡</span> <span class="free">qs</span> <span class="main">()</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">ps</span> <span class="main">=</span> prime_factorization <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> of_int <span class="main">(</span>moebius_mu_aux <span class="free">n</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">∨</span> <span class="numeral">9</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>mset <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> assms<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ps</span> <span class="main">=</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"distinct <span class="free">ps</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset <span class="free">ps</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distinct_count_atmost_1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset <span class="free">ps</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity count_prime_factorization_prime<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> set_mset_mset distinct_card<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword2"><span class="keyword">and</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_mu_def moebius_mu_aux_def ps_def 
            Let_def squarefree_factorial_semiring'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset <span class="free">ps</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> distinct_count_atmost_1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset <span class="free">ps</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset <span class="free">ps</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset <span class="free">ps</span><span class="main">)</span> <span class="skolem">p</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity count_prime_factorization_prime<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>squarefree <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> squarefree_factorial_semiring''<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def moebius_mu_aux_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> not_squarefreeI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> not_squarefreeI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_aux_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> moebius_mu_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"moebius_mu <span class="free">n</span> <span class="main">=</span> of_int <span class="main">(</span>moebius_mu_aux <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> prime_factorization_nat <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> moebius_mu_conv_moebius_mu_aux<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiset_prime_factorization_nat_correct<span class="main">)</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"moebius_mu <span class="numeral">12578972695257</span> <span class="main">::</span> int"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Euler's $\phi$ function›</span></span>
  
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">totient_aux1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">totient_aux1</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">totient_aux1</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">totient_aux1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> of_nat_totient_aux1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> prime <span class="bound">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient_aux1 <span class="free">n</span> <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient_aux1 <span class="skolem">n</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span>totient_aux1 <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="skolem">ps</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> primes_dvd_imp_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>  p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m prime_dvd_mult_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Cons.prems<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff real_of_nat_div p <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  
<span class="keyword1"><span class="command">lemma</span></span> totient_conv_totient_aux1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps</span> <span class="main">=</span> prime_factors <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"totient <span class="free">n</span> <span class="main">=</span> totient_aux1 <span class="free">n</span> <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient_aux1 <span class="free">n</span> <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> of_nat_totient_aux1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps</span> <span class="main">=</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span>totient <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> totient_formula2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prime_factors_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prime_factors_nat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> remdups_adj <span class="main">(</span>sort <span class="main">(</span>prime_factorization_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> set_prime_factors_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prime_factors_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> prime_factors <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> prime_factors_nat_def multiset_prime_factorization_nat_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_prime_factors_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>prime_factors_nat <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_nat_def<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">totient_aux2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">totient_aux2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> totient_conv_totient_aux2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"totient <span class="free">n</span> <span class="main">=</span> totient_aux2 <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"totient_aux2 <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> totient_aux2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distinct_set_conv_list <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="bound">p</span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
                                 power_Suc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> totient <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> totient.prod_prime_factors'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> totient_code1<span class="main">:</span> <span class="quoted"><span class="quoted">"totient <span class="free">n</span> <span class="main">=</span> totient_aux1 <span class="free">n</span> <span class="main">(</span>prime_factors_nat <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> totient_conv_totient_aux1<span class="main">)</span> <span class="operator">simp_all</span>
    
<span class="keyword1"><span class="command">lemma</span></span> totient_code2<span class="main">:</span> <span class="quoted"><span class="quoted">"totient <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> totient_aux2 <span class="main">(</span>prime_factorization_nat' <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_prime_factorization_nat' totient_conv_totient_aux2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> totient_code_naive <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> totient_code2

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"totient <span class="numeral">125789726827482323235784</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Divisor Functions›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span> <span class="main">=</span> divisor_count_naive divisor_sum_naive
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> divisor_count.efficient_code' divisor_sum.efficient_code'

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>divisor_count <span class="numeral">378568418621</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>divisor_sum <span class="numeral">378568418621</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Liouville's $\lambda$ function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"liouville_lambda <span class="free">n</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="main">(</span>length <span class="main">(</span>prime_factorization_nat <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> liouville_lambda_def multiset_prime_factorization_nat_correct<span class="main">)</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"liouville_lambda <span class="numeral">1264785343674</span> <span class="main">::</span> int"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>